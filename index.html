<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://cyannote.github.io.git/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/source/plugin/img/avatar.jpg">
    <h2 class="author">inverse</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>33</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>0</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-多线程-学习笔记" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/多线程-学习笔记/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.517Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h2 id="title-多线程"><a href="#title-多线程" class="headerlink" title="title:多线程"></a>title:多线程</h2><h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><p>内容介绍</p>
<ul>
<li><p>多线程概述</p>
</li>
<li><p>线程实现</p>
</li>
<li><p>多线程安全问题产生 &amp; 解决方案</p>
</li>
</ul>
<h2 id="1-多线程概述"><a href="#1-多线程概述" class="headerlink" title="1. 多线程概述"></a>1. 多线程概述</h2><p>学习多线程之前，我们先要了解几个关于多线程有关的概念。</p>
<p>A:进程：<strong>进程指正在运行的程序。</strong>确切的来说，当一个程序进入内存运行，即变成一个进程，进程是处于运行过程中的程序，并且具有一定独立功能。</p>
<p>B:线程：线程是进程中的一个<strong>执行单元</strong>，负责当前进程中程序的执行，一个进程中至少有一个线程。一个进程中是可以有多个线程的，这个应用程序也可以称之为多线程程序。</p>
<p>C:简而言之：一个程序运行后至少有一个进程，一个进程中可以包含多个线程</p>
<p>什么是多线程呢？即就是一个程序中有多个线程在同时执行。</p>
<h2 id="2-线程实现"><a href="#2-线程实现" class="headerlink" title="2. 线程实现"></a>2. 线程实现</h2><h3 id="2-1-实现线程一-继承Thread类"><a href="#2-1-实现线程一-继承Thread类" class="headerlink" title="2.1 实现线程一:继承Thread类"></a>2.1 实现线程一:继承Thread类</h3><p>该如何创建线程呢？通过API中搜索，查到Thread类。通过阅读Thread类中的描述。<em>Thread</em>是程序中的执行线程。Java 虚拟机允许应用程序并发地运行多个执行线程。</p>
<p>A:创建线程的步骤：</p>
<p>1.定义一个类继承Thread。</p>
<p>2.重写run方法。(thread非抽象类,run方法没有要求必须重写.为了开启线程,可手动重写run方法)</p>
<p>3.创建子类对象，就是创建线程对象。</p>
<p>4.调用start方法，开启线程并让线程执行，同时还会告诉jvm去调用run方法</p>
<h4 id="案例代码一"><a href="#案例代码一" class="headerlink" title="案例代码一:"></a>案例代码一:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			System.out.println(getName() + <span class="string">":"</span> + i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 多线程的实现方式：</span></span><br><span class="line"><span class="comment"> * 		方式1：一种方法是将类声明为 Thread 的子类。该子类应重写 Thread 类的 run 方法。接下来可以分配并启动该子类的实例</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Thread</span></span><br><span class="line"><span class="comment"> * 		String getName()      返回该线程的名称。 </span></span><br><span class="line"><span class="comment"> * 		void   setName(String name) 改变线程名称，使之与参数 name 相同。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * CPU执行程序的随机性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo2</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建线程实例</span></span><br><span class="line">		MyThread mt = <span class="keyword">new</span> MyThread();</span><br><span class="line">		<span class="comment">//修改线程名字</span></span><br><span class="line">		mt.setName(<span class="string">"张三"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//启动线程</span></span><br><span class="line">		mt.start();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建线程实例</span></span><br><span class="line">		MyThread mt2 = <span class="keyword">new</span> MyThread();</span><br><span class="line">		mt2.setName(<span class="string">"老王"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//启动线程</span></span><br><span class="line">		mt2.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-实现线程二-实现Runnable接口"><a href="#2-2-实现线程二-实现Runnable接口" class="headerlink" title="2.2 实现线程二:实现Runnable接口"></a>2.2 实现线程二:实现Runnable接口</h3><p>创建线程的另一种方法是声明实现 Runnable 接口的类。该类然后实现 run 方法。然后创建Runnable的子类对象，传入到某个线程的构造方法中，开启线程。</p>
<p>为何要实现Runnable接口，Runable是啥玩意呢？继续API搜索。</p>
<p>查看Runnable接口说明文档：Runnable接口用来指定每个线程要执行的任务。包含了一个 run 的无参数抽象方法，需要由接口实现类重写该方法。</p>
<p>创建线程的步骤。</p>
<p>1、定义类实现Runnable接口。</p>
<p>2、覆盖接口中的run方法。。</p>
<p>3、创建Thread类的对象</p>
<p>4、将Runnable接口的子类对象作为参数传递给Thread类的构造函数。</p>
<p>5、调用Thread类的start方法开启线程。</p>
<h4 id="案例代码二"><a href="#案例代码二" class="headerlink" title="案例代码二:"></a>案例代码二:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class MyThread2 implements Runnable &#123;</span><br><span class="line">	int num;</span><br><span class="line">	</span><br><span class="line">	public MyThread2(int num) &#123;</span><br><span class="line">		this.num = num;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@Override</span><br><span class="line">	public void run() &#123;</span><br><span class="line">		for (int i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">			//Thread t = Thread.currentThread();//获取当前线程的名称</span><br><span class="line">			//System.out.println(t.getName() + &quot;:&quot; + i);</span><br><span class="line">			</span><br><span class="line">			//链式编程</span><br><span class="line">			System.out.println(Thread.currentThread().getName() + &quot;:&quot; + i + num);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-多线程安全问题产生-amp-解决方案"><a href="#3-多线程安全问题产生-amp-解决方案" class="headerlink" title="3. 多线程安全问题产生&amp;解决方案"></a>3. 多线程安全问题产生&amp;解决方案</h2><h3 id="3-1-多线程卖票案例"><a href="#3-1-多线程卖票案例" class="headerlink" title="3.1 多线程卖票案例"></a>3.1 多线程卖票案例</h3><p>需求:用三个线程模拟三个售票窗口,共同卖100张火车票,每个线程打印出卖第几张票</p>
<h4 id="案例代码三"><a href="#案例代码三" class="headerlink" title="案例代码三:"></a>案例代码三:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public class TicketThread implements Runnable &#123;</span><br><span class="line">	int tickets = 100;//火车票数量</span><br><span class="line">	</span><br><span class="line">	@Override</span><br><span class="line">	public void run() &#123;</span><br><span class="line">		//出售火车票</span><br><span class="line">		while(true) &#123;</span><br><span class="line">			//当火车票小于0张，则停止售票</span><br><span class="line">			if(tickets &gt; 0) &#123;</span><br><span class="line">				/*</span><br><span class="line">				 * t1,t2,t3</span><br><span class="line">				 * 假设只剩一张票</span><br><span class="line">				 * t1过来了，他一看有票，他就进来了，但是他突然肚子不舒服，然后他就去上卫生间了</span><br><span class="line">				 * t2也过来了，他一看也有票，他也进来了，但是他的肚子也不舒服，他也去上卫生间了</span><br><span class="line">				 * </span><br><span class="line">				 * t1上完了卫生间回来了，开始售票</span><br><span class="line">				 * 	tickets = 0;</span><br><span class="line">				 * t2也上完卫生间回来了，他也进行售票</span><br><span class="line">				 *  tickets = -1;</span><br><span class="line">				 */</span><br><span class="line">				try &#123;</span><br><span class="line">					Thread.sleep(100);</span><br><span class="line">				&#125; catch (InterruptedException e) &#123;</span><br><span class="line">					// TODO Auto-generated catch block</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				System.out.println(Thread.currentThread().getName() + &quot;:&quot; +tickets--);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-多线程安全问题解决"><a href="#3-2-多线程安全问题解决" class="headerlink" title="3.2 多线程安全问题解决"></a>3.2 多线程安全问题解决</h3><h4 id="使用同步代码块解决"><a href="#使用同步代码块解决" class="headerlink" title="使用同步代码块解决"></a>使用同步代码块解决</h4><p>​    格式:</p>
<p>​    synchronized(锁对象){</p>
<p>​    //需要同步的代码</p>
<p>​    }</p>
<h5 id="案例代码四"><a href="#案例代码四" class="headerlink" title="案例代码四:"></a>案例代码四:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * 问题出现的原因：</span><br><span class="line"> * 		要有多个线程</span><br><span class="line"> * 		要有被多个线程所共享的数据</span><br><span class="line"> * 		多个线程并发的访问共享的数据</span><br><span class="line"> * </span><br><span class="line"> * 在火车上上厕所</span><br><span class="line"> * 张三来了，一看门是绿的，他就进去了，把门锁上了，门就变红了</span><br><span class="line"> * 李四来了，一看门市红色的，他就只能憋着</span><br><span class="line"> * 张三用完了厕所，把锁打开了，门就变成了绿色</span><br><span class="line"> * 李四一看门变绿了，他就进去了，把门锁上，门就变红了</span><br><span class="line"> * 王五来了，一看们是红色的，他也只能憋着</span><br><span class="line"> * 李四用完测试了，把锁打开了，肚子又不舒服了，扭头回去了，又把门锁上了，</span><br><span class="line"> * </span><br><span class="line"> * synchronized:同步（锁），可以修饰代码块和方法，被修饰的代码块和方法一旦被某个线程访问，则直接锁住，其他的线程将无法访问</span><br><span class="line"> * </span><br><span class="line"> * 同步代码块：</span><br><span class="line"> * 			synchronized(锁对象)&#123;</span><br><span class="line"> * </span><br><span class="line"> * 			&#125;</span><br><span class="line"> * </span><br><span class="line"> * 注意：锁对象需要被所有的线程所共享</span><br><span class="line"> * </span><br><span class="line"> * </span><br><span class="line"> * 同步：安全性高，效率低</span><br><span class="line"> * 非同步：效率高，但是安全性低</span><br><span class="line"> * </span><br><span class="line"> */</span><br><span class="line">public class TicketThread implements Runnable &#123;</span><br><span class="line">	int tickets = 100;//火车票数量</span><br><span class="line">	Object obj = new Object();</span><br><span class="line">	</span><br><span class="line">	@Override</span><br><span class="line">	public void run() &#123;</span><br><span class="line">		//出售火车票</span><br><span class="line">		while(true) &#123;</span><br><span class="line">			synchronized (obj) &#123;//Object可为任意锁对象</span><br><span class="line">				if(tickets &gt; 0) &#123;			</span><br><span class="line">					try &#123;</span><br><span class="line">						Thread.sleep(100);</span><br><span class="line">					&#125; catch (InterruptedException e) &#123;// TODO Auto-generated catch block</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">					System.out.println(Thread.currentThread().getName() + &quot;:&quot; +tickets--);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class TicktetTest &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		//创建线程对象</span><br><span class="line">		TicketThread tt = new TicketThread();</span><br><span class="line">		</span><br><span class="line">		Thread t = new Thread(tt);</span><br><span class="line">		t.setName(&quot;窗口1&quot;);</span><br><span class="line">		Thread t2 = new Thread(tt);</span><br><span class="line">		t2.setName(&quot;窗口2&quot;);</span><br><span class="line">		Thread t3 = new Thread(tt);</span><br><span class="line">		t3.setName(&quot;窗口3&quot;);</span><br><span class="line">		</span><br><span class="line">		//启动线程对象</span><br><span class="line">		t.start();</span><br><span class="line">		t2.start();</span><br><span class="line">		t3.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用同步方法解决"><a href="#使用同步方法解决" class="headerlink" title="使用同步方法解决"></a>使用同步方法解决</h4><p>格式:</p>
<p>修饰符 synchronized 返回值 方法名(){</p>
<p>}</p>
<h4 id="案例代码五"><a href="#案例代码五" class="headerlink" title="案例代码五:"></a>案例代码五:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * 同步方法:使用关键字synchronized修饰的方法，一旦被一个线程访问，则整个方法全部锁住，其他线程则无法访问</span><br><span class="line"> * </span><br><span class="line"> * synchronized</span><br><span class="line"> * 注意：</span><br><span class="line"> * 	非静态同步方法的锁对象是this</span><br><span class="line"> * 	静态的同步方法的锁对象是当前类的字节码对象//类名.class</span><br><span class="line"> */</span><br><span class="line">public class TicketThread implements Runnable &#123;</span><br><span class="line">	static int tickets = 100;// 火车票数量</span><br><span class="line">	Object obj = new Object();</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void run() &#123;</span><br><span class="line">		// 出售火车票</span><br><span class="line">		while (true) &#123;</span><br><span class="line">			/*synchronized (obj) &#123;</span><br><span class="line">				method();</span><br><span class="line">			&#125;*/		</span><br><span class="line">			//method();</span><br><span class="line">			method2();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private synchronized void method() &#123;</span><br><span class="line">		if (tickets &gt; 0) &#123;           </span><br><span class="line">			try &#123;</span><br><span class="line">				Thread.sleep(100);</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;	System.out.println(Thread.currentThread().getName() + &quot;:&quot; + tickets--);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	private static synchronized void method2() &#123;</span><br><span class="line">	</span><br><span class="line">		if (tickets &gt; 0) &#123;</span><br><span class="line"></span><br><span class="line">			try &#123;</span><br><span class="line">				Thread.sleep(100);</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;		System.out.println(Thread.currentThread().getName() + &quot;:&quot; + tickets--);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-线程控制常用方法"><a href="#4-线程控制常用方法" class="headerlink" title="4.线程控制常用方法"></a>4.线程控制常用方法</h2><h3 id="线程控制"><a href="#线程控制" class="headerlink" title="线程控制"></a>线程控制</h3><p>​    1:static sleep(long millis) 表示让当前线程对象进入休眠状态    没有执行资格 也没有执行权<br>​    2:public final void join() 线程加入(需在其他线程启动前调用)<br>​    3:public static void yield() 线程礼让<br>​    4:public final void setDaemon(boolean on) 后台线程(随主线程结束而结束)</p>
<h3 id="线程优先级"><a href="#线程优先级" class="headerlink" title="线程优先级:"></a>线程优先级:</h3><p>​    A:分时调度模型<br>​    B:抢占式调度模型<br>​        谁的优先级高 谁抢到执行权的概率就更高 如果线程之间的优先级相同 那就随机抽取<br>​    Max    10<br>​    Min    1<br>​    Norm 5<br>​    获取优先级    getPriority()    -&gt; int<br>​    设置优先级    setPriority()    -&gt; int</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/多线程-学习笔记/" data-id="cjycojogr0006wo7k537cdecx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-面向网络-学习笔记" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/面向网络-学习笔记/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.503Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/面向网络-学习笔记/">面向网络编程</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="面向网络编程"><a href="#面向网络编程" class="headerlink" title="面向网络编程"></a>面向网络编程</h1><h2 id="内容介绍"><a href="#内容介绍" class="headerlink" title="内容介绍"></a>内容介绍</h2><ul>
<li><p>网络编程概述</p>
</li>
<li><p>UDP</p>
</li>
<li><p>TCP</p>
</li>
</ul>
<h1 id="1-网络编程概述"><a href="#1-网络编程概述" class="headerlink" title="1. 网络编程概述"></a>1. 网络编程概述</h1><h3 id="网络协议"><a href="#网络协议" class="headerlink" title="网络协议"></a>网络协议</h3><p>通过计算机网络可以使多台计算机实现连接，位于同一个网络中的计算机在进行连接和通信时需要遵守一定的规则，这就好比在道路中行驶的汽车一定要遵守交通规则一样。在计算机网络中，这些连接和通信的规则被称为网络通信协议，它对数据的传输格式、传输速率、传输步骤等做了统一规定，通信双方必须同时遵守才能完成数据交换。</p>
<p>网络通信协议有很多种，目前应用最广泛的是TCP/IP协议(Transmission Control Protocal/Internet Protoal传输控制协议/英特网互联协议)，它是一个包括TCP协议和IP协议，UDP（User Datagram Protocol）协议和其它一些协议的协议组，在学习具体协议之前首先了解一下TCP/IP协议组的层次结构。</p>
<p>在进行数据传输时，要求发送的数据与收到的数据完全一样，这时，就需要在原有的数据上添加很多信息，以保证数据在传输过程中数据格式完全一致。TCP/IP协议的层次结构比较简单，共分为四层，如图所示。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511069275.png" alt="1558511069275"></p>
<ol>
<li>TCP/IP网络模型</li>
</ol>
<p>上图中，TCP/IP协议中的四层分别是应用层、传输层、网络层和链路层，每层分别负责不同的通信功能，接下来针对这四层进行详细地讲解。</p>
<p>链路层：<a href="http://zhidao.baidu.com/search?word=%CA%FD%BE%DD%C1%B4%C2%B7%B2%E3&fr=qb_search_exp&ie=gbk" target="_blank" rel="noopener">链路层</a>是用于定义物理传输通道，通常是对某些网络连接设备的驱动协议，例如针对光纤、<a href="http://zhidao.baidu.com/search?word=%CB%AB%BD%CA%CF%DF&fr=qb_search_exp&ie=gbk" target="_blank" rel="noopener">网线</a>提供的驱动。</p>
<p>网络层：网络层是整个TCP/IP协议的核心，它主要用于将传输的数据进行分组，将分组数据发送到目标计算机或者网络。</p>
<p>传输层：主要使网络程序进行通信，在进行网络通信时，可以采用TCP协议，也可以采用UDP协议。</p>
<p>应用层：主要负责应用程序的协议，例如HTTP协议、FTP协议等。</p>
<h3 id="IP地址和端口号"><a href="#IP地址和端口号" class="headerlink" title="IP地址和端口号"></a>IP地址和端口号</h3><p>要想使网络中的计算机能够进行通信，必须为每台计算机指定一个标识号，通过这个标识号来指定接受数据的计算机或者发送数据的计算机。</p>
<p>在TCP/IP协议中，这个标识号就是IP地址，它可以唯一标识一台计算机，目前，IP地址广泛使用的版本是IPv4，它是由4个字节大小的二进制数来表示，如：00001010000000000000000000000001。由于二进制形式表示的IP地址非常不便记忆和处理，因此通常会将IP地址写成十进制的形式，每个字节用一个十进制数字(0-255)表示，数字间用符号”.”分开，如 “192.168.1.100”。</p>
<p>随着计算机网络规模的不断扩大，对IP地址的需求也越来越多，IPV4这种用4个字节表示的IP地址面临枯竭，因此IPv6 便应运而生了，IPv6使用16个字节表示IP地址，它所拥有的地址容量约是IPv4的8×10^28^倍，达到2^128^个（算上全零的），这样就解决了网络地址资源数量不够的问题。</p>
<p>通过IP地址可以连接到指定计算机，但如果想访问目标计算机中的某个应用程序，还需要指定端口号。在计算机中，不同的应用程序是通过端口号区分的。端口号是用两个字节（16位的二进制数）表示的，它的取值范围是0~65535，其中，0~1023之间的端口号用于一些知名的网络服务和应用，用户的普通应用程序需要使用1024以上的端口号，从而避免端口号被另外一个应用或服务所占用。</p>
<p>接下来通过一个图例来描述IP地址和端口号的作用，如下图所示。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511180774.png" alt="1558511180774"></p>
<p>从上图中可以清楚地看到，位于网络中一台计算机可以通过IP地址去访问另一台计算机，并通过端口号访问目标计算机中的某个应用程序。</p>
<h2 id="InetAddress"><a href="#InetAddress" class="headerlink" title="InetAddress"></a>InetAddress</h2><p>了解了IP地址的作用，我们看学习下JDK中提供了一个InetAdderss类，该类用于封装一个IP地址，并提供了一系列与IP地址相关的方法，下表中列出了InetAddress类的一些常用方法。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511214304.png" alt="1558511214304"></p>
<h3 id="案例代码一"><a href="#案例代码一" class="headerlink" title="案例代码一:"></a>案例代码一:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import java.net.InetAddress;</span><br><span class="line">import java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * InetAddress:此类表示互联网协议 (IP) 地址。 </span><br><span class="line"> * </span><br><span class="line"> */</span><br><span class="line">public class InetAddressDemo &#123;</span><br><span class="line">	public static void main(String[] args) throws UnknownHostException   &#123;</span><br><span class="line">		//static InetAddress getByName(String host) </span><br><span class="line">		 //InetAddress address = InetAddress.getByName(&quot;msi&quot;);</span><br><span class="line">		InetAddress address = InetAddress.getByName(&quot;192.168.1.107&quot;);//ip地址是唯一的</span><br><span class="line">	</span><br><span class="line">		//System.out.println(address);//msi/192.168.1.107 ipconfig</span><br><span class="line">		</span><br><span class="line">		String hostAddress = address.getHostAddress();//192.168.1.107 返回IP地址</span><br><span class="line">		String hostName = address.getHostName();//msi	返回主机名</span><br><span class="line">		</span><br><span class="line">		System.out.println(hostAddress);</span><br><span class="line">		System.out.println(hostName);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-UDP协议"><a href="#2-UDP协议" class="headerlink" title="2. UDP协议"></a>2. UDP协议</h1><p>UDP是无连接通信协议，即在数据传输时，数据的发送端和接收端不建立逻辑连接。简单来说，当一台计算机向另外一台计算机发送数据时，发送端不会确认接收端是否存在，就会发出数据，同样接收端在收到数据时，也不会向发送端反馈是否收到数据。</p>
<p>由于使用UDP协议消耗资源小，通信效率高，所以通常都会用于音频、视频和普通数据的传输例如视频会议都使用UDP协议，因为这种情况即使偶尔丢失一两个数据包，也不会对接收结果产生太大影响。</p>
<p>但是在使用UDP协议传送数据时，由于UDP的面向无连接性，不能保证数据的完整性，因此在传输重要数据时不建议使用UDP协议。UDP的交换过程如下图所示。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511414342.png" alt="1558511414342"></p>
<h2 id="DatagramPacket"><a href="#DatagramPacket" class="headerlink" title="DatagramPacket"></a>DatagramPacket</h2><p>前面介绍了UDP是一种面向无连接的协议，因此，在通信时发送端和接收端不用建立连接。UDP通信的过程就像是货运公司在两个码头间发送货物一样。在码头发送和接收货物时都需要使用集装箱来装载货物，UDP通信也是一样，发送和接收的数据也需要使用”集装箱”进行打包，为此JDK中提供了一个DatagramPacket类，该类的实例对象就相当于一个集装箱，用于封装UDP通信中发送或者接收的数据。</p>
<p>想要创建一个DatagramPacket对象，首先需要了解一下它的构造方法。在创建发送端和接收端的DatagramPacket对象时，使用的构造方法有所不同，接收端的构造方法只需要接收一个字节数组来存放接收到的数据，而发送端的构造方法不但要接收存放了发送数据的字节数组，还需要指定发送端IP地址和端口号。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511462040.png" alt="1558511462040"></p>
<p>使用该构造方法在创建DatagramPacket对象时，指定了封装数据的字节数组和数据的大小，没有指定IP地址和端口号。很明显，这样的对象只能用于接收端，不能用于发送端。因为发送端一定要明确指出数据的目的地(ip地址和端口号)，而接收端不需要明确知道数据的来源，只需要接收到数据即可。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511497788.png" alt="1558511497788"></p>
<p>使用该构造方法在创建DatagramPacket对象时，不仅指定了封装数据的字节数组和数据的大小，还指定了数据包的目标IP地址（addr）和端口号（port）。该对象通常用于发送端，因为在发送数据时必须指定接收端的IP地址和端口号，就好像发送货物的集装箱上面必须标明接收人的地址一样。</p>
<p>上面我们讲解了DatagramPacket的构造方法，接下来对DatagramPacket类中的常用方法进行详细地讲解，如下表所示。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511555074.png" alt="1558511555074"></p>
<h2 id="DatagramSocket"><a href="#DatagramSocket" class="headerlink" title="DatagramSocket"></a>DatagramSocket</h2><p>DatagramPacket数据包的作用就如同是”集装箱”，可以将发送端或者接收端的数据封装起来。然而运输货物只有”集装箱”是不够的，还需要有码头。在程序中需要实现通信只有DatagramPacket数据包也同样不行，为此JDK中提供的一个DatagramSocket类。DatagramSocket类的作用就类似于码头，使用这个类的实例对象就可以发送和接收DatagramPacket数据包，发送数据的过程如下图所示。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511648849.png" alt="1558511648849"></p>
<p>在创建发送端和接收端的DatagramSocket对象时，使用的构造方法也有所不同，下面对DatagramSocket类中常用的构造方法进行讲解。</p>
<blockquote>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511665603.png" alt="1558511665603"></p>
</blockquote>
<p>该构造方法用于创建发送端的DatagramSocket对象，在创建DatagramSocket对象时，并没有指定端口号，此时，系统会分配一个<img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511672404.png" alt="1558511672404"></p>
<p>该构造方法既可用于创建接收端的DatagramSocket对象，又可以创建发送端的DatagramSocket对象，在创建接收端的DatagramSocket对象时，必须要指定一个端口号，这样就可以监听指定的端口。</p>
<p>上面我们讲解了DatagramSocket的构造方法，接下来对DatagramSocket类中的常用方法进行详细地讲解。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558511683905.png" alt="1558511683905"></p>
<h2 id="UDP实现"><a href="#UDP实现" class="headerlink" title="UDP实现"></a>UDP实现</h2><h3 id="案例代码二"><a href="#案例代码二" class="headerlink" title="案例代码二:"></a>案例代码二:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.DatagramPacket;</span><br><span class="line">import java.net.DatagramSocket;</span><br><span class="line">import java.net.InetAddress;</span><br><span class="line">import java.net.SocketException;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * 使用UDP协议发送数据</span><br><span class="line">		创建发送端Socket对象</span><br><span class="line">		创建数据并打包</span><br><span class="line">		发送数据</span><br><span class="line">		释放资源</span><br><span class="line"> * </span><br><span class="line"> * DatagramSocket:此类表示用来发送和接收数据,基于UDP协议的</span><br><span class="line"> * </span><br><span class="line"> * DatagramSocket() ：创建Socket对象并随机分配端口号</span><br><span class="line"> * DatagramSocket(int port) ：创建Socket对象并指定端口号</span><br><span class="line"> */</span><br><span class="line">public class SendDemo &#123;</span><br><span class="line">	public static void main(String[] args) throws IOException  &#123;</span><br><span class="line">		//创建发送端Socket对象</span><br><span class="line">		DatagramSocket ds = new DatagramSocket();</span><br><span class="line">		//创建数据并打包</span><br><span class="line">		/*</span><br><span class="line">		 * DatagramPacket :此类表示数据报包</span><br><span class="line">		 * 数据 byte[]</span><br><span class="line">		 * 设备的地址 ip</span><br><span class="line">		 * 进程的地址  端口号</span><br><span class="line">		   DatagramPacket(byte[] buf, int length, InetAddress address, int port) </span><br><span class="line">		 */</span><br><span class="line">		</span><br><span class="line">		String s = &quot;hello udp,im comming!&quot;;</span><br><span class="line">		byte[] bys = s.getBytes();</span><br><span class="line">		int length = bys.length;</span><br><span class="line">		InetAddress address = InetAddress.getByName(&quot;msi&quot;);//发送给当前设备</span><br><span class="line">		int port = 8888;</span><br><span class="line">		//打包</span><br><span class="line">		DatagramPacket dp = new DatagramPacket(bys,length,address,port);</span><br><span class="line">		//发送数据</span><br><span class="line">		ds.send(dp);</span><br><span class="line">		//释放资源</span><br><span class="line">		ds.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.DatagramPacket;</span><br><span class="line">import java.net.DatagramSocket;</span><br><span class="line">import java.net.InetAddress;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * 使用UDP协议接收数据</span><br><span class="line">		创建接收端Socket对象</span><br><span class="line">		接收数据</span><br><span class="line">		解析数据</span><br><span class="line">		输出数据</span><br><span class="line">		释放资源</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line">public class ReceiveDemo &#123;</span><br><span class="line">	public static void main(String[] args) throws IOException &#123;</span><br><span class="line">		//创建接收端Socket对象</span><br><span class="line">		DatagramSocket ds = new DatagramSocket(8888);</span><br><span class="line">		//接收数据</span><br><span class="line">		//DatagramPacket(byte[] buf, int length) </span><br><span class="line">		byte[] bys = new byte[1024];</span><br><span class="line">		DatagramPacket dp = new DatagramPacket(bys,bys.length);</span><br><span class="line">				</span><br><span class="line">		System.out.println(1);</span><br><span class="line">		ds.receive(dp);//阻塞</span><br><span class="line">		System.out.println(2);</span><br><span class="line">		</span><br><span class="line">		//解析数据</span><br><span class="line">		//InetAddress getAddress() : 获取发送端的IP对象</span><br><span class="line">		InetAddress address = dp.getAddress();</span><br><span class="line">		//byte[] getData()  ：获取接收到的数据，也可以直接使用创建包对象时的数组</span><br><span class="line">		byte[] data = dp.getData();</span><br><span class="line">		//int getLength()  ：获取具体收到数据的长度</span><br><span class="line">		int length = dp.getLength();	</span><br><span class="line">		</span><br><span class="line">		//输出数据</span><br><span class="line">		System.out.println(&quot;sender ---&gt; &quot; + address.getHostAddress());</span><br><span class="line">		//System.out.println(new String(data,0,length));</span><br><span class="line">		System.out.println(new String(bys,0,length));</span><br><span class="line">		//释放资源</span><br><span class="line">		ds.close();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-TCP协议"><a href="#3-TCP协议" class="headerlink" title="3. TCP协议"></a>3. TCP协议</h1><p>TCP通信同UDP通信一样，都能实现两台计算机之间的通信，通信的两端都需要创建socket对象。</p>
<p>区别在于，UDP中只有发送端和接收端，不区分客户端与服务器端，计算机之间可以任意地发送数据。</p>
<p>而TCP通信是严格区分客户端与服务器端的，在通信时，必须先由客户端去连接服务器端才能实现通信，服务器端不可以主动连接客户端，并且服务器端程序需要事先启动，等待客户端的连接。</p>
<p>在JDK中提供了两个类用于实现TCP程序，一个是ServerSocket类，用于表示服务器端，一个是Socket类，用于表示客户端。</p>
<p>通信时，首先创建代表服务器端的ServerSocket对象，该对象相当于开启一个服务，并等待客户端的连接，然后创建代表客户端的Socket对象向服务器端发出连接请求，服务器端响应请求，两者建立连接开始通信。</p>
<h2 id="ServerSocket"><a href="#ServerSocket" class="headerlink" title="ServerSocket"></a>ServerSocket</h2><p>通过前面的学习知道，在开发TCP程序时，首先需要创建服务器端程序。JDK的java.net包中提供了一个ServerSocket类，该类的实例对象可以实现一个服务器段的程序。通过查阅API文档可知，ServerSocket类提供了多种构造方法，接下来就对ServerSocket的构造方法进行逐一地讲解。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558512099477.png" alt="1558512099477"></p>
<p>使用该构造方法在创建ServerSocket对象时，就可以将其绑定到一个指定的端口号上（参数port就是端口号）。</p>
<p>接下来学习一下ServerSocket的常用方法，如表所示。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558512114435.png" alt="1558512114435"></p>
<p>ServerSocket对象负责监听某台计算机的某个端口号，在创建ServerSocket对象后，需要继续调用该对象的accept()方法，接收来自客户端的请求。当执行了accept()方法之后，服务器端程序会发生阻塞，直到客户端发出连接请求，accept()方法才会返回一个Scoket对象用于和客户端实现通信，程序才能继续向下执行。</p>
<h2 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h2><p>讲解了ServerSocket对象可以实现服务端程序，但只实现服务器端程序还不能完成通信，此时还需要一个客户端程序与之交互，为此JDK提供了一个Socket类，用于实现TCP客户端程序。</p>
<p>通过查阅API文档可知Socket类同样提供了多种构造方法，接下来就对Socket的常用构造方法进行详细讲解。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558512167076.png" alt="1558512167076"></p>
<p>使用该构造方法在创建Socket对象时，会根据参数去连接在指定地址和端口上运行的服务器程序，其中参数host接收的是一个字符串类型的IP地址。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558512185516.png" alt="1558512185516"></p>
<p>该方法在使用上与第二个构造方法类似，参数address用于接收一个InetAddress类型的对象，该对象用于封装一个IP地址。</p>
<p>在以上Socket的构造方法中，最常用的是第一个构造方法。</p>
<p>接下来学习一下Socket的常用方法，如表所示。</p>
<hr>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558512336328.png" alt="1558512336328">在Socket类的常用方法中，getInputStream()和getOutStream()方法分别用于获取输入流和输出流。当客户端和服务端建立连接后，数据是以IO流的形式进行交互的，从而实现通信。</p>
<p>接下来通过一张图来描述服务器端和客户端的数据传输，如下图所示。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558512348509.png" alt="1558512348509"></p>
<h2 id="TCP协议实现"><a href="#TCP协议实现" class="headerlink" title="TCP协议实现"></a>TCP协议实现</h2><h3 id="案例代码三"><a href="#案例代码三" class="headerlink" title="案例代码三:"></a>案例代码三:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.OutputStream;</span><br><span class="line">import java.net.InetAddress;</span><br><span class="line">import java.net.Socket;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * 使用TCP协议发送数据</span><br><span class="line">		创建发送端Socket对象（创建连接）</span><br><span class="line">		获取输出流对象</span><br><span class="line">		发送数据</span><br><span class="line">		释放资源</span><br><span class="line">		</span><br><span class="line">	Socket(InetAddress address, int port) </span><br><span class="line">	Exception in thread &quot;main&quot; java.net.ConnectException: Connection refused: connect</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line">public class ClientDemo &#123;</span><br><span class="line">	public static void main(String[] args) throws IOException &#123;</span><br><span class="line">		//创建发送端Socket对象（创建连接）</span><br><span class="line">		Socket s = new Socket(InetAddress.getByName(&quot;msi&quot;),10086);</span><br><span class="line">		//获取输出流对象</span><br><span class="line">		OutputStream os = s.getOutputStream();</span><br><span class="line">		//发送数据</span><br><span class="line">		String str = &quot;hello tcp,im comming!!!&quot;;</span><br><span class="line">		os.write(str.getBytes());</span><br><span class="line">		//释放资源</span><br><span class="line">		//os.close();</span><br><span class="line">		s.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.net.InetAddress;</span><br><span class="line">import java.net.ServerSocket;</span><br><span class="line">import java.net.Socket;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * 使用TCP协议接收数据</span><br><span class="line"> 		创建接收端Socket对象</span><br><span class="line"> 		监听（阻塞）</span><br><span class="line"> 		获取输入流对象</span><br><span class="line"> 		获取数据</span><br><span class="line"> 		输出数据</span><br><span class="line"> 		释放资源</span><br><span class="line"> 		</span><br><span class="line"> 	ServerSocket：接收端，服务端Socket</span><br><span class="line"> 	ServerSocket(int port) </span><br><span class="line"> 	Socket accept() </span><br><span class="line"> </span><br><span class="line"> */</span><br><span class="line">public class ServerDemo &#123;</span><br><span class="line">	public static void main(String[] args) throws IOException  &#123;</span><br><span class="line">		//创建接收端Socket对象</span><br><span class="line">		ServerSocket ss = new ServerSocket(10086);</span><br><span class="line"> 		//监听（阻塞）</span><br><span class="line">		Socket s = ss.accept();</span><br><span class="line"> 		//获取输入流对象</span><br><span class="line">		InputStream is = s.getInputStream();</span><br><span class="line"> 		//获取数据</span><br><span class="line">		byte[] bys = new byte[1024];</span><br><span class="line">		int len;//用于存储读到的字节个数</span><br><span class="line">		len = is.read(bys);</span><br><span class="line"> 		//输出数据</span><br><span class="line">		InetAddress address = s.getInetAddress();</span><br><span class="line">		System.out.println(&quot;client ---&gt; &quot; + address.getHostName());</span><br><span class="line">		System.out.println(new String(bys,0,len));</span><br><span class="line"> 		//释放资源</span><br><span class="line">		s.close();</span><br><span class="line">		//ss.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="TCP相关案例"><a href="#TCP相关案例" class="headerlink" title="TCP相关案例"></a>TCP相关案例</h2><h3 id="案例代码四"><a href="#案例代码四" class="headerlink" title="案例代码四:"></a>案例代码四:</h3><p>使用TCP协议发送数据，服务端将接收到的数据转换成大写返回给客户端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.OutputStream;</span><br><span class="line">import java.net.InetAddress;</span><br><span class="line">import java.net.Socket;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> 	需求：使用TCP协议发送数据，并将接收到的数据转换成大写返回</span><br><span class="line"> 	</span><br><span class="line"> 	客户端发出数据</span><br><span class="line"> 	服务端接收数据</span><br><span class="line"> 	服务端转换数据</span><br><span class="line"> 	服务端发出数据</span><br><span class="line"> 	客户端接收数据</span><br><span class="line"> 	</span><br><span class="line"> */</span><br><span class="line">public class ClientDemo &#123;</span><br><span class="line">	public static void main(String[] args) throws IOException &#123;</span><br><span class="line">		//创建客户端Socket对象</span><br><span class="line">		Socket s = new Socket(InetAddress.getByName(&quot;msi&quot;),10010);</span><br><span class="line">		//获取输出流对象</span><br><span class="line">		OutputStream os = s.getOutputStream();</span><br><span class="line">		//发出数据</span><br><span class="line">		os.write(&quot;tcp,im comming again!!!&quot;.getBytes());</span><br><span class="line">		</span><br><span class="line">		//获取输入流对象</span><br><span class="line">		InputStream is = s.getInputStream();</span><br><span class="line">		byte[] bys = new byte[1024];</span><br><span class="line">		int len;//用于存储读取到的字节个数</span><br><span class="line">		//接收数据</span><br><span class="line">		len = is.read(bys);</span><br><span class="line">		//输出数据</span><br><span class="line">		System.out.println(new String(bys,0,len));</span><br><span class="line">		</span><br><span class="line">		//释放资源</span><br><span class="line">		s.close();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.OutputStream;</span><br><span class="line">import java.net.ServerSocket;</span><br><span class="line">import java.net.Socket;</span><br><span class="line"></span><br><span class="line">public class ServerDemo &#123;</span><br><span class="line">	public static void main(String[] args) throws IOException &#123;</span><br><span class="line">		//创建服务端Socket对象</span><br><span class="line">		ServerSocket ss = new ServerSocket(10010);</span><br><span class="line">		//监听</span><br><span class="line">		Socket s = ss.accept();</span><br><span class="line">		//获取输入流对象</span><br><span class="line">		InputStream is = s.getInputStream();</span><br><span class="line">		//获取数据</span><br><span class="line">		byte[] bys = new byte[1024];</span><br><span class="line">		int len;//用于存储读取到的字节个数</span><br><span class="line">		len = is.read(bys);</span><br><span class="line">		String str = new String(bys,0,len);</span><br><span class="line">		//输出数据</span><br><span class="line">		System.out.println(str);</span><br><span class="line">		//转换数据</span><br><span class="line">		String upperStr = str.toUpperCase();</span><br><span class="line">		//获取输出流对象</span><br><span class="line">		OutputStream os = s.getOutputStream();</span><br><span class="line">		//返回数据（发出数据）</span><br><span class="line">		os.write(upperStr.getBytes());</span><br><span class="line">		</span><br><span class="line">		//释放资源</span><br><span class="line">		s.close();</span><br><span class="line">		//ss.close();//服务端一般不关闭</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="案例代码五"><a href="#案例代码五" class="headerlink" title="案例代码五:"></a>案例代码五:</h3><p>客户端:</p>
<p>1.提示用户输入用户名和密码,将用户输入的用户名和密码发送给服务端</p>
<p>2.接收服务端验证完用户名和密码的结果</p>
<p>服务端:</p>
<p>1.接收客户端发送过来的用户名和密码</p>
<p>2.如果用户名不是msi或者 密码不是123456,就向客户端写入”登录失败”</p>
<p>否则向客户端写入登录成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.net.Socket;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * 模拟用户登录</span><br><span class="line"> */</span><br><span class="line">public class ClientTest &#123;</span><br><span class="line">	public static void main(String[] args) throws  IOException  &#123;</span><br><span class="line">		//创建客户端Socket对象</span><br><span class="line">		//Socket s = new Socket(InetAddress.getByName(&quot;msi&quot;),8888);</span><br><span class="line">		Socket s = new Socket(&quot;msi&quot;,8888);</span><br><span class="line">		</span><br><span class="line">		//获取用户名和密码</span><br><span class="line">		BufferedReader br = new BufferedReader(new InputStreamReader(System.in));</span><br><span class="line">		System.out.println(&quot;请输入用户名:&quot;);</span><br><span class="line">		String username = br.readLine();</span><br><span class="line">		System.out.println(&quot;请输入密码:&quot;);</span><br><span class="line">		String password = br.readLine();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		//获取输出流对象</span><br><span class="line">		//BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(s.getOutputStream()));</span><br><span class="line">		PrintWriter out = new PrintWriter(s.getOutputStream(),true);</span><br><span class="line">		//写出数据</span><br><span class="line">		out.println(username);</span><br><span class="line">		out.println(password);</span><br><span class="line">		</span><br><span class="line">		//获取输入流对象</span><br><span class="line">		BufferedReader serverBr = new BufferedReader(new InputStreamReader(s.getInputStream()));</span><br><span class="line">		//获取服务器返回的数据</span><br><span class="line">		String result = serverBr.readLine();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">		//释放资源</span><br><span class="line">		s.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.net.ServerSocket;</span><br><span class="line">import java.net.Socket;</span><br><span class="line"></span><br><span class="line">public class ServerTest &#123;</span><br><span class="line">	public static void main(String[] args) throws IOException &#123;</span><br><span class="line">		//创建服务器端Socket对象</span><br><span class="line">		ServerSocket ss = new ServerSocket(8888);</span><br><span class="line">		//监听</span><br><span class="line">		Socket s = ss.accept();</span><br><span class="line">		//获取输入流对象</span><br><span class="line">		BufferedReader br = new BufferedReader(new InputStreamReader(s.getInputStream()));</span><br><span class="line">		//获取用户名和密码</span><br><span class="line">		String username = br.readLine();</span><br><span class="line">		String password = br.readLine();</span><br><span class="line">		//判断用户名和密码是否正确</span><br><span class="line">		boolean flag = false;</span><br><span class="line">		if(&quot;msi&quot;.equals(username) &amp;&amp; &quot;123456&quot;.equals(password)) &#123;</span><br><span class="line">			flag = true;</span><br><span class="line">		&#125;</span><br><span class="line">		//获取输出流对象</span><br><span class="line">		PrintWriter out = new PrintWriter(s.getOutputStream(),true);</span><br><span class="line">		</span><br><span class="line">		//返回判断信息</span><br><span class="line">		if(flag) &#123;</span><br><span class="line">			out.println(&quot;登陆成功&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		else &#123;</span><br><span class="line">			out.println(&quot;登陆失败&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		//释放资源</span><br><span class="line">		s.close();</span><br><span class="line">		//ss.close();//服务器一般不关闭</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="案例代码六"><a href="#案例代码六" class="headerlink" title="案例代码六:"></a>案例代码六:</h3><p>从客服端将一个文件发送给服务端,服务端接收后,返回”接收成功”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.BufferedWriter;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.io.OutputStreamWriter;</span><br><span class="line">import java.net.Socket;</span><br><span class="line">import java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line">public class Send &#123;</span><br><span class="line">	public static void main(String[] args) throws IOException &#123;</span><br><span class="line">		// 客户端文本文件，服务器输出文本文件(给客户端反馈)</span><br><span class="line">		Socket s = new Socket(&quot;127.0.0.1&quot;, 9995);</span><br><span class="line">		BufferedReader br = new BufferedReader(new FileReader(&quot;网络编程&quot;));</span><br><span class="line">		BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(</span><br><span class="line">				s.getOutputStream()));</span><br><span class="line">		String line;</span><br><span class="line">		while ((line = br.readLine()) != null) &#123;</span><br><span class="line">			bw.write(line);</span><br><span class="line">			bw.newLine();</span><br><span class="line">			bw.flush();</span><br><span class="line">		&#125;</span><br><span class="line">		s.shutdownOutput();//禁用此套接字的输出流。表示客服端数据发送完毕,服务端终止输入流的readline()命令</span><br><span class="line">		BufferedReader br2 = new BufferedReader(new InputStreamReader(</span><br><span class="line">				s.getInputStream()));</span><br><span class="line">		System.out.println(br2.readLine());</span><br><span class="line">		s.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.BufferedWriter;</span><br><span class="line">import java.io.FileWriter;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.io.OutputStreamWriter;</span><br><span class="line">import java.net.ServerSocket;</span><br><span class="line">import java.net.Socket;</span><br><span class="line"></span><br><span class="line">public class Receive &#123;</span><br><span class="line">	public static void main(String[] args) throws IOException &#123;</span><br><span class="line">		ServerSocket ss = new ServerSocket(9995);</span><br><span class="line">		Socket s = ss.accept();</span><br><span class="line">		BufferedReader br = new BufferedReader(new InputStreamReader(</span><br><span class="line">				s.getInputStream()));</span><br><span class="line">		BufferedWriter bw = new BufferedWriter(new FileWriter(&quot;网络编程copy&quot;));</span><br><span class="line">		String line;</span><br><span class="line">		while ((line = br.readLine()) != null) &#123;</span><br><span class="line">			bw.write(line);</span><br><span class="line">			bw.newLine();</span><br><span class="line">			bw.flush();</span><br><span class="line">		&#125;</span><br><span class="line">		//如果客服端不终止套接字的输入流,会造成br.readline()最后处于等待状态,因为readline()始终无法为null.</span><br><span class="line">		BufferedWriter bw2 = new BufferedWriter(new OutputStreamWriter(</span><br><span class="line">				s.getOutputStream()));</span><br><span class="line">		bw2.write(&quot;上传完成!!&quot;);</span><br><span class="line">		bw2.flush();</span><br><span class="line">		s.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/面向网络-学习笔记/" data-id="cjycojohb000cwo7kha6h3xlh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-代理模式和注解" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/代理模式和注解/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.488Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/代理模式和注解/">代理模式和注解</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="代理模式和注解"><a href="#代理模式和注解" class="headerlink" title="代理模式和注解"></a>代理模式和注解</h1><h2 id="1-代理模式"><a href="#1-代理模式" class="headerlink" title="1.代理模式"></a>1.代理模式</h2><p><strong>代理模式的概念:</strong></p>
<p>即Proxy Pattern，23种常用的面向对象软件的设计模式之一</p>
<p>代理模式的定义：为其他对象提供一种<a href="http://baike.baidu.com/view/24001.htm" target="_blank" rel="noopener">代理</a>以控制对这个对象的访问。在某些情况下，一个对象不适合或者不能直接引用另一个对象，而代理对象可以在客户端和目标对象之间起到中介的作用。</p>
<p><strong>代理模式的组成:</strong></p>
<p>抽象角色：通过接口或抽象类声明真实角色实现的业务方法。</p>
<p>代理角色：实现抽象角色，是真实角色的代理，通过真实角色的业务逻辑方法来实现抽象方法，并可以附加自己的操作。</p>
<p>真实角色：实现抽象角色，定义真实角色所要实现的业务逻辑，供代理角色调用。</p>
<h3 id="1-1-静态代理"><a href="#1-1-静态代理" class="headerlink" title="1.1 静态代理"></a>1.1 静态代理</h3><p>是由程序员创建或工具生成代理类的源码，再编译代理类。所谓静态也就是在程序运行前就已经存在代理类的字节码文件，代理类和委托类的关系在运行前就确定了。</p>
<p>抽象角色:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Itarget</span> </span>&#123;</span><br><span class="line">	<span class="comment">//抽象方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span> <span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真实对象:为真正的方法执行者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Target</span> <span class="keyword">implements</span> <span class="title">Itarget</span> </span>&#123;</span><br><span class="line">	<span class="comment">//重写抽象对象中的方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"show..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代理对象:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Itarget</span></span>&#123;</span><br><span class="line">	Itarget target;</span><br><span class="line">	<span class="comment">//构造方法中传入真实对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">(Itarget target)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.target = target;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//实际执行的是真实对象的方法,</span></span><br><span class="line">		target.show();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端通过代理对象执行真实对象的方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">proxyTest</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建真实对象</span></span><br><span class="line">		Target target = <span class="keyword">new</span> Target();</span><br><span class="line">		<span class="comment">//将真实对象传入代理对象构造方法</span></span><br><span class="line">		Proxy proxy = <span class="keyword">new</span> Proxy(target);</span><br><span class="line">		<span class="comment">//调用代理对象的实现方法,实际执行的是真实对象的方法</span></span><br><span class="line">		proxy.show();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2动态代理"><a href="#1-2动态代理" class="headerlink" title="1.2动态代理"></a>1.2动态代理</h3><p>是在实现阶段不用关心代理类，而在运行阶段才指定哪一个对象。</p>
<p>动态代理可以不用创建代理对象类,通过proxy.</p>
<p>抽象对象,真实对象同静态代理</p>
<p>客户端通过代理对象执行真实对象的方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">targetTest</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span> <span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建真实对象</span></span><br><span class="line">		myProxy target = <span class="keyword">new</span> target();</span><br><span class="line">		<span class="comment">//创建代理对象</span></span><br><span class="line">		myProxy proxy = (myProxy) Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">			<span class="comment">//通过匿名内部类的方法</span></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">					<span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> method.invoke(target, args);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		proxy.show();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-优点"><a href="#1-3-优点" class="headerlink" title="1.3  优点"></a>1.3  优点</h3><p>(1).职责清晰</p>
<p>真实的角色就是实现实际的<a href="http://baike.baidu.com/view/1642754.htm" target="_blank" rel="noopener">业务逻辑</a>，不用关心其他非本职责的事务，通过后期的代理完成一件完成事务，附带的结果就是编程简洁清晰。</p>
<p>(2).代理对象可以在客户端和目标对象之间起到中介的作用，这样起到了中介的作用和保护了目标对象的作用。</p>
<p>(3).高扩展性</p>
<h3 id="1-4-Java中动态代理"><a href="#1-4-Java中动态代理" class="headerlink" title="1.4 Java中动态代理"></a>1.4 Java中动态代理</h3><p>在jdk的api中提供了java.lang.reflect.Proxy它可以帮助我们完成动态代理创建</p>
<p>注意：在java中使用Proxy来完成动态代理对象的创建，只能为目标实现了接口的类创建代理对象。</p>
<p>动态代理是在内存中直接生成代理对象。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1560859644091.jpg" alt="img"></p>
<p>通过这个方法可以直接创建一个代理对象。</p>
<p>前两个参数帮助我们生产一个代理对象;</p>
<p>第三个参数控制目标行为访问的问题</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1560859681530.jpg" alt="img"></p>
<p>InvocationHandler详解</p>
<p>它是一个接口，接口中声明了一个方法</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1560859710306.jpg" alt="img"></p>
<p>Invoke方法，它是在代理对象调用行为时，会执行的方法，而invoke方法上有三个参数</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1560859731738.jpg" alt="img"></p>
<p>这个方法的主要作用是，当我们通过代理对象调用行为时，来控制目标行为是否可以被调用。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1560859750789.jpg" alt="img"></p>
<p>在开发中，我们使用动态代理可以完成性能监控，权限控制，日志记录等操作</p>
<hr>
<h2 id="2-注解Annotation"><a href="#2-注解Annotation" class="headerlink" title="2.注解Annotation"></a>2.注解Annotation</h2><p><strong>注解概述</strong></p>
<p>注解（Annotation），也叫元数据。一种代码级别的说明。它是JDK1.5及以后版本引入的一个特性，与类、接口、枚举是在同一个层次。它可以用于创建文档，跟踪代码中的依赖性，甚至执行基本编译时检查。注解是以‘@注解名’在代码中存在的</p>
<p>它可以声明在包、类、字段、方法、局部变量、方法参数等的前面，用来对这些元素进行说明，注释。</p>
<p>你可以在编译时选择代码里的注解是否只存在于源代码级，或者它也能在class文件、或者运行时中出现（SOURCE/CLASS/RUNTIME）。</p>
<p><strong>注解作用</strong></p>
<p>如果要对于元数据的作用进行分类，还没有明确的定义，不过我们可以根据它所起的作用，大致可分为三类：</p>
<p>编写文档：通过代码里标识的元数据生成文档。</p>
<p>代码分析：通过代码里标识的元数据对代码进行分析。</p>
<p>编译检查：通过代码里标识的元数据让<a href="http://baike.baidu.com/view/487018.htm" target="_blank" rel="noopener">编译器</a>能实现基本的编译检查 </p>
<p>在现在开发中使用注解，一般是用于将注解替换配置文件。（Xml配置文件）</p>
<h3 id="2-1-Java中基本内置注解"><a href="#2-1-Java中基本内置注解" class="headerlink" title="2.1 Java中基本内置注解"></a>2.1 Java中基本内置注解</h3><ul>
<li><strong>@override</strong></li>
</ul>
<p>它的作用是对覆盖超类中方法的方法进行标记，如果被标记的方法并没有实际覆盖超类中的方法，则编译器会发出错误警告。</p>
<p>注意事项:</p>
<p>​       对于接口中的方法重写，<a href="mailto:在jdk1.5时@Override" target="_blank" rel="noopener">在jdk1.5时@Override</a>它是会报错.</p>
<p>​       在jdk1.6后的版本就可以描述接口与类之间的重写</p>
<ul>
<li><strong>@Deprecated</strong></li>
</ul>
<p>它的作用是对不应该再使用的方法添加注解，当编程人员使用这些方法时，将会在编译时显示提示信息</p>
<p>问题:什么时候方法是过时的?</p>
<p>当前版本中方法它存在隐患，在后续版本中对其进行了补充，这时前一个版本中的方法就会标注成过时的。</p>
<ul>
<li><strong>@SuppressWarnings</strong></li>
</ul>
<p>它的作用是去掉程序中的警告.</p>
<p>其参数有：</p>
<p>deprecation，使用了过时的类或方法时的警告</p>
<p>unchecked，执行了未检查的转换时的警告</p>
<p>fallthrough，当 switch 程序块直接通往下一种情况而没有 break 时的警告</p>
<p>path，在类路径、源文件路径等中有不存在的路径时的警告</p>
<p>serial，当在可序列化的类上缺少serialVersionUID 定义时的警告</p>
<p>finally ，任何 finally 子句不能正常完成时的警告</p>
<p>all，关于以上所有情况的警告</p>
<h3 id="2-2-自定义注解"><a href="#2-2-自定义注解" class="headerlink" title="2.2 自定义注解"></a>2.2 自定义注解</h3><ul>
<li><strong>注解声明:</strong></li>
</ul>
<p>要声明一个注解通过  @interface</p>
<p>声明一个注解格式  @interface 注解名{}</p>
<ul>
<li><strong>注解本质分析</strong></li>
</ul>
<p>分析一下注解的本质:将其.class文件找到，反编译.  可以使用javap命令或反编译工具。</p>
<p>@interface MyAnnoation{}</p>
<p>反编译后的结果</p>
<p>interface MyAnnotation      extends Annotation</p>
<p>{</p>
<p>}</p>
<p>结论:注解本质上就是一个接口。它扩展了java.lang.annotation.Annotation接口;</p>
<p>在java中所有注解都是Annotation接口的子接口。</p>
<ul>
<li><strong>注解成员</strong></li>
</ul>
<p>注解本质上就是一个接口，那么它也可以有属性和方法。</p>
<p>但是接口中的属性是 public static final的，在注解中注解没有什么意义。</p>
<p>在开发中注解中经常存在的是方法。而在注解中叫做注解的属性.</p>
<ul>
<li><p><strong>注解属性类型</strong></p>
<p>1.基本类型  byte short int long float double char boolean</p>
<p>2.String</p>
<p>3.枚举类型</p>
<p>4.注解类型</p>
<p>5.Class类型</p>
<p>6.以上类型的一维数组类型</p>
</li>
<li><p><strong>注解属性的使用</strong></p>
<p>如果一个注解有属性，那么在使用注解时，要对属性进行赋值操作.</p>
<p>也可以给属性赋默认值  double d() default 1.23;</p>
<p>如果属性是数组类型</p>
<p>​       1.可以直接使用   属性名={值1,值2,。。。}方式,例如</p>
<p>​              @MyAnnotation(st = “aaa”,i=10,sts={“a”,”b”})</p>
<p>​       2.如果数组的值只有一个也可以写成下面方式</p>
<p>​              @MyAnnotation(st = “aaa”,i=10,sts=”a”)</p>
<p>​              注意sts属性它是数组类型，也就是说，只有一个值时，可以省略”{}”</p>
<p>对于属性名称 value的操作.</p>
<p>​       1.如果属性名称叫value,那么在使用时，可以省略属性名称</p>
<p>​              @MyAnnotation(“hello”)</p>
<p>​       2.如果有多个属性，都需要赋值，其中一个叫value,这时，必须写属性名称</p>
<p>​              @MyAnnotation(value=”hello”,i=10)</p>
</li>
<li><p><strong>自定义注解-元注解</strong></p>
<p>什么是元注解及其作用？</p>
<p>用于修饰注解的注解，可以描述注解在什么范围及在什么阶段使用等</p>
</li>
<li><p><strong>四个元注解介绍</strong></p>
<ul>
<li><p><strong>@Retention</strong></p>
<p>指定注解信息在哪个阶段存在 Source Class  Runtime</p>
</li>
</ul>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1560860691292.jpg" alt="img"></p>
<p>SOURCE它对应着编译阶段，可以帮助我们进行检查。</p>
<p>CLASS 它对应解析执行阶段</p>
<p>RUNTIME </p>
<p>它对应着在JVM中</p>
</li>
</ul>
<ul>
<li><p><strong>@Target</strong></p>
<p>指定注解修饰目标对象类型  TYPE 类、接口  FIELD 成员变量 METHOD 方法</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1560860740162.jpg" alt="img"></p>
</li>
<li><p><strong>Documented</strong></p>
<p>使用该元注解修饰，该注解的信息可以生成到javadoc 文档中</p>
</li>
<li><p><strong>Inherited</strong></p>
<p>如果一个注解使用该元注解修饰，应用注解目标类的子类会自动继承该注解 </p>
</li>
</ul>
<pre><code>@Retention @Target 是自定义注解必须使用两个元注解，并且，@Retention它的值应该是RUNTIME,因为我们会结合反射技术来使用。 @Target我们一般使用TYPE或METHOD</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/代理模式和注解/" data-id="cjycojogv0009wo7kfvdxzf0t" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-多表查询" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/多表查询/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.468Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/多表查询/">多表查询</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h1><h2 id="1-修改MySQL密码"><a href="#1-修改MySQL密码" class="headerlink" title="1 修改MySQL密码"></a>1 修改MySQL密码</h2><p>​    a: 关闭mySQL服务<br>​    b: 打开cmd窗口, 输入mysqld  –skip-grant-tables (不要关闭此页面)<br>​    c: 再打开一个cmd窗口,正常登陆,要输入密码时,回车跳过<br>​    d: 进入mysql ,use mysql数据库,update user set password = password(‘新密码’) where user = ‘root’<br>​    f:在任务管理器中结束掉mysqld的进程,再启动mysql服务</p>
<h2 id="2-备份和还原数据库"><a href="#2-备份和还原数据库" class="headerlink" title="2 备份和还原数据库"></a>2 备份和还原数据库</h2><p>​    备份数据库:<br>​        mysqldump -u root -p  数据库名  &gt;  存储路径(绝对路径)<br>​    还原数据库<br>​        外部: mysql -u root -p 存储路径&lt; 数据库</p>
<p>​        内部: use 数据库; source 本地存储路径</p>
<h2 id="3-多表关系"><a href="#3-多表关系" class="headerlink" title="3 多表关系"></a>3 多表关系</h2><p>​    外键    foreign key</p>
<pre><code>添加外键语法:    alter table 表名1 add foreign key(外键名称) references 表名2(主键名称)</code></pre><h2 id="4-三种表关系"><a href="#4-三种表关系" class="headerlink" title="4 三种表关系"></a>4 三种表关系</h2><h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><p>​        在多的一方建立外键 指向一方的主键        </p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002.jpg" alt="clip_image002"></p>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><p>​        建立中间表 存储外键分别指向其他表的主键</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1558490610522.jpg" alt="clip_image002-1558490610522"></p>
<h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><p>​    唯一外键对应</p>
<p>​        假设是一对多，在多的一方创建外键指向一的一方的主键，将外键设置为unique。<br>​    主键对应<br>​        将两个表的主键建立对应关系即可。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1558490661152.jpg" alt="clip_image002-1558490661152"></p>
<h2 id="5-多表查询语法"><a href="#5-多表查询语法" class="headerlink" title="5 多表查询语法"></a>5 多表查询语法</h2><pre><code>交叉连接查询: 查询出来的是两张表的每一条记录进行匹配的结果 会出现笛卡尔积
    select * from tb1 cross join tb2;
    select * from tb1 , tb2;

内连接:
    select * from tb1 inner join tb2 on 条件; 显示内连接
    select * from tb1 , tb2 where 条件; 隐式内连接

外连接:
    左外连接 select * from tb1 left outer join tb2 on 条件;    查询左表所有和两张表的共有部分
    右外连接 select * from tb1 right outer join tb2 on 条件;    查询右表所有和两张表的共有部分</code></pre><h2 id="6-子查询"><a href="#6-子查询" class="headerlink" title="6 子查询"></a>6 子查询</h2><p>子查询:一条select语句的执行依赖于另一条select语句</p>
<pre><code>select * from 表名 in/exists/all/any (select *...)

in(...)            在(...)范围内
exists(...)        若(...)存在查询结果,就执行select语句
all(...)        所有
any(...)        任一</code></pre><h2 id="7-练习题"><a href="#7-练习题" class="headerlink" title="7 练习题"></a>7 练习题</h2><p> 计算企业每年营业额的增长率</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558491166063.png" alt="1558491166063"></p>
<p>思路:</p>
<p>年营业额增长率 = (本年营业额 - 上年营业额) / 上年营业额 * 100%</p>
<p>关键在于如何同时获取本年营业额和上年营业额</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 将该表获取两次,筛选出本年营业额和上年营业额处于一行的数据</span><br><span class="line">--	使用左外连接 是由于第一年的营业额没有对应的上年营业额,它的增长率应为0%,为了保证数据的完整性,采用此方法.</span><br><span class="line">SELECT * FROM income i1 LEFT JOIN income i2 ON i1.year = i2.year + 1</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558492004088.png" alt="1558492004088"></p>
<p>round()对数据进行取整</p>
<p>concat()拼接数据</p>
<p>ifnull() 对数据为null时,进行处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT i1.*,IFNULL(CONCAT(ROUND((i1.zz -i2.zz)/i2.zz*100),&apos;%&apos;),&apos;0%&apos;) AS 增长率 FROM income i1 LEFT JOIN income i2 ON i1.year = i2.year + 1</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1558492510616.png" alt="1558492510616"></p>
<h2 id="8-事务"><a href="#8-事务" class="headerlink" title="8 事务"></a>8 事务</h2><p>事务: 指的是逻辑上的一组操作，组成这组操作的各个逻辑单元，要么全都成功，要么全都失败。</p>
<pre><code>事务特性:
    原子性/一致性/隔离性/持久性
    原子性: 组成事务的各个逻辑单元不可分割。
    一致性:事务执行的前后,数据完整性保持一致
    隔离性:事务执行过程中,应不受其他事务的干扰
    持久性:事务一旦结束，数据就持久化到数据库中。

如果不考虑事务的隔离级别 在进行操作时有可能出现问题:
    脏读/不可重复读/虚读

事务隔离级别的设置: 
set session isolation transaction level 事务隔离级别
查询事务级别:
    select @@tx_isolation;

事务可以设置的隔离级别:
    read uncommitted    读未提交
    read committed        读已提交
    repeatable read        可重复读
    serializable        串行化</code></pre><p>​    行列转置</p>
<p>利用聚合函数group by</p>
<p>max(case sname when’英语’ then score else 0 end)as “英语”</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/多表查询/" data-id="cjycojogf0002wo7kylvebwal" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-反射学习笔记" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/反射学习笔记/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.457Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/反射学习笔记/">反射学习笔记</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="反射学习笔记"><a href="#反射学习笔记" class="headerlink" title="反射学习笔记"></a>反射学习笔记</h1><hr>
<h2 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h2><p>反射机制的概述和字节码对象的获取方式</p>
<p>反射操作构造方法、成员方法、成员属性</p>
<p>JavaBean的概述&amp;BeanUtils的使用</p>
<hr>
<h2 id="1-反射机制概述和-常用方法"><a href="#1-反射机制概述和-常用方法" class="headerlink" title="1    反射机制概述和 常用方法"></a>1    反射机制概述和 常用方法</h2><h3 id="1-1-反射机制的概述和字节码对象的获取方式"><a href="#1-1-反射机制的概述和字节码对象的获取方式" class="headerlink" title="1.1    反射机制的概述和字节码对象的获取方式"></a>1.1    反射机制的概述和字节码对象的获取方式</h3><p>1.1.1    反射介绍</p>
<p>JAVA反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性；这种动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。</p>
<h4 id="1-1-2-字节码文件获取的三种方式"><a href="#1-1-2-字节码文件获取的三种方式" class="headerlink" title="1.1.2    字节码文件获取的三种方式"></a>1.1.2    字节码文件获取的三种方式</h4><p>对象名.getCalss();         // 次方法来自于Object  对象已经存在的情况下, 可以使用这种方式</p>
<p>类名.class            // 类名.class这是一个静态的属性, 只要知道类名, 就可以获取 </p>
<p>Class.forName(“com.itheima_01.Student”);            // 通过Class类中的静态方法, 指定字符串, 该字符串是类的全类名(包名+类名)<br>// 此处将会抛出异常都系 ClassNotFoundException 防止传入错误的类名</p>
<h3 id="1-2-反射操作构造方法"><a href="#1-2-反射操作构造方法" class="headerlink" title="1.2    反射操作构造方法"></a>1.2    反射操作构造方法</h3><h4 id="1-2-1-通过获取的构造创建对象"><a href="#1-2-1-通过获取的构造创建对象" class="headerlink" title="1.2.1    通过获取的构造创建对象"></a>1.2.1    通过获取的构造创建对象</h4><p>步骤:<br>1.获得Class对象<br>2获得构造<br>3.通过构造对象获得实例化对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Class的成员方法:</span><br><span class="line">		getConstructor(Class...objs)	-&gt; Constructor</span><br><span class="line">		getConstructors()	-&gt; Constructor[]</span><br><span class="line">		</span><br><span class="line">		getDeclaredConstructor(Class...objs)	-&gt; Constructor</span><br><span class="line">		getDeclaredConstructors()	-&gt; Constructor[] </span><br><span class="line">		newInstance()	-&gt;	Object</span><br><span class="line">		</span><br><span class="line">	Constructor成员方法</span><br><span class="line">		newInstance(Object...objs)	-&gt;	Object</span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-问题-直接通过Class类中的newInstance-和获取getConstructor-有什么区别"><a href="#1-2-2-问题-直接通过Class类中的newInstance-和获取getConstructor-有什么区别" class="headerlink" title="1.2.2    问题: 直接通过Class类中的newInstance()和获取getConstructor()有什么区别?"></a>1.2.2    问题: 直接通过Class类中的newInstance()和获取getConstructor()有什么区别?</h4><p>newInstance()方法, 只能通过空参的构造方法创建对象<br>getConstructor(Class<t>… parameterTypes)方法, 方法接受一个可变参数, 可以根据传入的类型来匹配对应的构造方法</t></p>
<h3 id="1-3-反射操作公共成员变量"><a href="#1-3-反射操作公共成员变量" class="headerlink" title="1.3    反射操作公共成员变量"></a>1.3    反射操作公共成员变量</h3><h4 id="1-3-1-反射public成员变量-字段"><a href="#1-3-1-反射public成员变量-字段" class="headerlink" title="1.3.1    反射public成员变量(字段)"></a>1.3.1    反射public成员变量(字段)</h4><p>通过反射运行public变量流程</p>
<p>通过反射获取该类的字节码对象<br>Class clazz = Class.forName(“com.heima.Person”);</p>
<p>创建该类对象<br>Object p = clazz.newInstance();</p>
<p>获取该类中需要操作的字段(成员变量)<br>getField(String name) –&gt; 方法传入字段的名称.<br>注意: 此方法只能获取公共的字段<br>Field f = clazz.getField(“age”);</p>
<p>通过字段对象中的方法修改属性值<br>void set(Object obj, Object value)  –&gt; 参数1): 要修改那个对象中的字段, 参数2): 将字段修改为什么值.<br>f.set(p, 23);</p>
<h4 id="1-3-2-方法总结"><a href="#1-3-2-方法总结" class="headerlink" title="1.3.2    方法总结"></a>1.3.2    方法总结</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> 通过反射获取成员变量并使用  </span><br><span class="line"> Field[] getFields()    --&gt; 返回该类所有(公共)的字段</span><br><span class="line"> <span class="function">Field <span class="title">getField</span><span class="params">(String name)</span>   --&gt; 返回指定名称字段</span></span><br><span class="line"><span class="function">            </span></span><br><span class="line"><span class="function">Field[] <span class="title">getDeclaredFields</span><span class="params">()</span> --&gt; 暴力反射获取所有字段<span class="params">(包括私有)</span> </span></span><br><span class="line"><span class="function">Field <span class="title">getDeclaredField</span><span class="params">(String name)</span> --&gt; 暴力反射获取指定名称字段</span></span><br></pre></td></tr></table></figure>

<h3 id="1-4-反射操作私有成员变量"><a href="#1-4-反射操作私有成员变量" class="headerlink" title="1.4    反射操作私有成员变量"></a>1.4    反射操作私有成员变量</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Field[] getDeclaredFields()     --&gt; 暴力反射获取所有字段(包括私有) </span><br><span class="line"><span class="function">Field <span class="title">getDeclaredField</span><span class="params">(String name)</span> --&gt; 暴力反射获取指定名称字段</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setAccessible</span><span class="params">(<span class="keyword">boolean</span> flag)</span> --&gt; 让jvm不检查权限</span></span><br></pre></td></tr></table></figure>

<p>1.5    通过反射获取成员方法并使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class的成员方法:</span><br><span class="line">		getMethod()	-&gt; Method</span><br><span class="line">		getMethods() -&gt;	Method[]	获取自己的以及从父类或父接口中继承/实现过来的<span class="keyword">public</span>修饰的成员方法对象</span><br><span class="line">		</span><br><span class="line">		getDeclaredMethod()	-&gt; Method </span><br><span class="line">		getDeclaredMethods() -&gt; Method[]	获取的自己的任意修饰符修饰的成员方法对象</span><br><span class="line">		</span><br><span class="line">	Method的成员方法:</span><br><span class="line">		invoke(Object obj,Object...params) -&gt;	Object</span><br></pre></td></tr></table></figure>

<h2 id="2-JavaBean的概述、BeanUtils的使用"><a href="#2-JavaBean的概述、BeanUtils的使用" class="headerlink" title="2    JavaBean的概述、BeanUtils的使用"></a>2    JavaBean的概述、BeanUtils的使用</h2><h3 id="2-1-JavaBean的概述和规范"><a href="#2-1-JavaBean的概述和规范" class="headerlink" title="2.1    JavaBean的概述和规范"></a>2.1    JavaBean的概述和规范</h3><p>JavaBean的概述:<br>    将需要操作的多个属性封装成JavaBean, 简单来说就是用于封装数据的<br>规范：<br>类使用公共进行修饰<br>提供私有修饰的成员变量<br>为成员变量提供公共getter和setter方法<br>提供公共无参的构造</p>
<h3 id="2-2-BeanUtils"><a href="#2-2-BeanUtils" class="headerlink" title="2.2    BeanUtils"></a>2.2    BeanUtils</h3><h4 id="2-2-1-准备工作"><a href="#2-2-1-准备工作" class="headerlink" title="2.2.1    准备工作"></a>2.2.1    准备工作</h4><ol>
<li>导入两个jar包<br>commons-beanutils.jar<br>commons-logging.jar</li>
<li>将jar包Build path 配置到当前的classpath环境变量中</li>
</ol>
<h3 id="2-3-BeanUtils的常用方法"><a href="#2-3-BeanUtils的常用方法" class="headerlink" title="2.3    BeanUtils的常用方法"></a>2.3    BeanUtils的常用方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>    <span class="title">setProperty</span><span class="params">(Object bean, String name, Object value)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">static</span> String <span class="title">getProperty</span><span class="params">(Object bean, String name)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>    <span class="title">populate</span><span class="params">(Object bean, Map properties)</span> </span></span><br><span class="line"><span class="function">setProperty  用来给对象中的属性赋值<span class="params">(了解)</span></span></span><br><span class="line"><span class="function">	参数1: 需要设置属性的对象</span></span><br><span class="line"><span class="function">	参数2: 需要修改的属性名称</span></span><br><span class="line"><span class="function">	参数3: 需要修改的具体元素	</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">getProperty 用来获取对象中的属性<span class="params">(了解)</span></span></span><br><span class="line"><span class="function">	参数1: 要获取的javaBean对象</span></span><br><span class="line"><span class="function">	参数2: 对象中的哪个属性</span></span><br><span class="line"><span class="function">	</span></span><br><span class="line"><span class="function">Populate 用来给对象中的属性赋值<span class="params">(掌握)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	参数1: 要设置属性的对象</span></span><br><span class="line"><span class="function">	参数2: 将属性以Map集合的形式传入</span></span><br><span class="line"><span class="function">				Key : 属性的名称</span></span><br><span class="line"><span class="function">				Value:  属性具体的值</span></span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">获取字节码文件对象</span><br><span class="line">	<span class="number">1</span>:对象名.getClass()</span><br><span class="line">	<span class="number">2</span>:类名.class属性</span><br><span class="line">	<span class="number">3</span>:Class.forName(<span class="string">"包名.类名"</span>)</span><br><span class="line">获取构造方法</span><br><span class="line">	Class的成员方法:</span><br><span class="line">		getConstructor(Class...objs)	-&gt; Constructor</span><br><span class="line">		getConstructors()	-&gt; Constructor[]</span><br><span class="line">		</span><br><span class="line">		getDeclaredConstructor(Class...objs)	-&gt; Constructor</span><br><span class="line">		getDeclaredConstructors()	-&gt; Constructor[] </span><br><span class="line">		newInstance()	-&gt;	Object</span><br><span class="line">		</span><br><span class="line">	Constructor成员方法</span><br><span class="line">		newInstance(Object...objs)	-&gt;	Object</span><br><span class="line">获取成员变量</span><br><span class="line">	Class的成员方法:</span><br><span class="line">		getField()	-&gt;	Field</span><br><span class="line">		getFields()	-&gt;	Field[]</span><br><span class="line">		</span><br><span class="line">		getDeclaredField(<span class="string">"age"</span>)	-&gt;	Field</span><br><span class="line">		getDeclaredFields()	-&gt;	Field[]</span><br><span class="line">	</span><br><span class="line">	Field的成员方法</span><br><span class="line">		set(Object obj,Object value)</span><br><span class="line">		get(Object obj)		-&gt;	Object</span><br><span class="line">		</span><br><span class="line">获取成员方法</span><br><span class="line">	Class的成员方法:</span><br><span class="line">		getMethod()	-&gt; Method</span><br><span class="line">		getMethods() -&gt;	Method[]	获取自己的以及从父类或父接口中继承/实现过来的<span class="keyword">public</span>修饰的成员方法对象</span><br><span class="line">		</span><br><span class="line">		getDeclaredMethod()	-&gt; Method </span><br><span class="line">		getDeclaredMethods() -&gt; Method[]	获取的自己的任意修饰符修饰的成员方法对象</span><br><span class="line">		</span><br><span class="line">	Method的成员方法:</span><br><span class="line">		invoke(Object obj,Object...params) -&gt;	Object </span><br><span class="line">		</span><br><span class="line">定义Javabean规范</span><br><span class="line">BeanUtils工具类的使用</span><br><span class="line">	setProperty(Object bean,String name,Object value)</span><br><span class="line">	getProperty(Object bean,String name)</span><br><span class="line">	populate(Object bean,Map m)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/反射学习笔记/" data-id="cjycojogg0003wo7ksbry0uti" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-分页案例" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/分页案例/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.453Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/分页案例/">分页案例</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>跨域</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1560486405774.png" alt="1560486405774"></p>
<p>$.getJSON(url,{name:value,name:value },function(){})</p>
<p>request获取的参数是String类型的,需转换成Integer类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> pageNo = Integer.parsInt(request.getParameter(<span class="string">"pageNo"</span>))</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/分页案例/" data-id="cjycojogd0001wo7kdh9yoklm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-金瓶梅中的代理模式" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/金瓶梅中的代理模式/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.442Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/金瓶梅中的代理模式/">金瓶梅中的代理模式</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="金瓶梅中的代理模式"><a href="#金瓶梅中的代理模式" class="headerlink" title="金瓶梅中的代理模式"></a>金瓶梅中的代理模式</h1><h2 id="1-什么是代理模式"><a href="#1-什么是代理模式" class="headerlink" title="1.什么是代理模式"></a>1.什么是代理模式</h2><p><strong>代理模式的概念:</strong></p>
<p>即Proxy Pattern，23种常用的面向对象软件的设计模式之一</p>
<p>代理模式的定义：为其他对象提供一种<a href="http://baike.baidu.com/view/24001.htm" target="_blank" rel="noopener">代理</a>以控制对这个对象的访问。在某些情况下，一个对象不适合或者不能直接引用另一个对象，而代理对象可以在客户端和目标对象之间起到中介的作用。</p>
<p><strong>代理模式的组成:</strong></p>
<p>抽象角色：通过接口或抽象类声明真实角色实现的业务方法。</p>
<p>代理角色：实现抽象角色，是真实角色的代理，通过真实角色的业务逻辑方法来实现抽象方法，并可以附加自己的操作。</p>
<p>真实角色：实现抽象角色，定义真实角色所要实现的业务逻辑，供代理角色调用。</p>
<hr>
<h2 id="2-金瓶梅中的代理模式"><a href="#2-金瓶梅中的代理模式" class="headerlink" title="2.金瓶梅中的代理模式"></a>2.金瓶梅中的代理模式</h2><p> 一日，<a href="https://www.baidu.com/s?wd=潘金莲&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">潘金莲</a>在门前收拾帘子时，手上叉竿一滑，不小心打到从门前经过的<a href="https://www.baidu.com/s?wd=西门庆&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">西门庆</a>，<a href="https://www.baidu.com/s?wd=西门庆&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">西门庆</a>定神一看惊为天人。<a href="https://www.baidu.com/s?wd=西门庆&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">西门庆</a>发现<a href="https://www.baidu.com/s?wd=武大郎&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">武大郎</a>家隔壁刚好就是他认识的王婆家，后来便时常借故到王婆家兜转。西门庆请托王婆帮他物色女人，王婆知道他看上<a href="https://www.baidu.com/s?wd=潘金莲&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">潘金莲</a>，因为贪爱西门庆的钱财，所以答应帮忙撮合。</p>
<p>某日，王婆请潘金莲到他家中帮忙缝纫，打扮得光鲜亮丽的西门庆此时依计又来串门。西门庆不时以花言巧语讨潘金莲欢心，王婆见潘金莲已经上勾，故意出门买酒，制造他们二人独处的机会。西门庆此时更加大胆，在一次肌肤挑逗后，郎有情妹有意的二人便在王婆房里云雨。  </p>
<p><strong>在这故事中,真实对象就是潘金莲了,西门庆属于客户端,代理对象王婆在客户端和真实对象之间起着中介的作用.</strong></p>
<hr>
<h2 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3.代码实现"></a>3.代码实现</h2><p>抽象角色:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Itarget</span> </span>&#123;</span><br><span class="line">	<span class="comment">//抽象方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span> <span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真实对象:为真正的方法执行者(金莲)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JinLian</span> <span class="keyword">implements</span> <span class="title">ITarget</span> </span>&#123;</span><br><span class="line">    <span class="comment">//重写抽象对象中的方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"JinLin is playing..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代理对象:在客户端和目标对象之间起到中介的作用(王婆)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WangPo</span> <span class="keyword">implements</span> <span class="title">ITarget</span></span>&#123;</span><br><span class="line">    ITarget target;</span><br><span class="line">    <span class="comment">//构造方法中传入真实对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WangPo</span><span class="params">(ITarget target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//实际执行的是真实对象的方法</span></span><br><span class="line">        target.play();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端访问:(西门庆)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//创建真实对象(通过多态的方式,可传入其他实现抽象方法的对象)</span></span><br><span class="line">        ITarget target = <span class="keyword">new</span> JinLian();</span><br><span class="line">        <span class="comment">//将真实对象传入代理对象构造方法</span></span><br><span class="line">        WangPo proxy = <span class="keyword">new</span> WangPo(target);</span><br><span class="line">        <span class="comment">//调用代理对象的实现方法,实际执行的是真实对象的方法</span></span><br><span class="line">        proxy.play();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/金瓶梅中的代理模式/" data-id="cjycojogp0005wo7kz3g5okwu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-课堂笔记" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/课堂笔记/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.427Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/课堂笔记/">linux安装</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>课堂笔记</p>
<h2 id="Linux安装"><a href="#Linux安装" class="headerlink" title="Linux安装"></a>Linux安装</h2><p>我们在虚拟机上来安装Linux</p>
<p>VMWare它是一个收费虚拟软件。</p>
<p>前提:需要一个Linux系统的镜像文件安装包</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage3.png" alt>{width=”5.145833333333333in” height=”2.2708333333333335in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage4.png" alt>{width=”5.072916666666667in” height=”1.5729166666666667in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage5.png" alt>{width=”5.09375in” height=”3.2083333333333335in”}</p>
<p>我们需要指定iso文件的位置</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage6.png" alt>{width=”5.768055555555556in” height=”2.349948600174978in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage7.png" alt>{width=”5.768055555555556in” height=”2.9073939195100613in”}</p>
<p>选择第一项，安装全新操作系统或升级现有操作系统</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage8.png" alt="11">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p>第13步：Tab键进行选择，选择Skip，退出检测</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage9.png" alt="12">{width=”5.763888888888889in” height=”3.207638888888889in”}</p>
<p>第14步：点击Next</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage10.png" alt="13">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p>第15步：选择语言，这里选择的是中文简体</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage11.png" alt="14">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p>第16步：选择键盘样式</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage12.png" alt="15">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p>第17步：选择存储设备</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage13.png" alt="16">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p>如果以前安装过虚拟机，会出现这个警告，选择是，忽略所有数据</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage14.png" alt="17">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage16.png" alt="19">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p>设置时区，勾选使用UTC时间</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage17.png" alt="20">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p>第21步：输入根用户（root）的密码</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage18.png" alt="21">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage19.png" alt>{width=”5.768055555555556in” height=”2.865334645669291in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage20.png" alt="28">{width=”5.763888888888889in” height=”4.320833333333334in”}</p>
<p>登录时，使用的用户是root,录入密码时不会显示</p>
<h2 id="Linux远程访问"><a href="#Linux远程访问" class="headerlink" title="Linux远程访问"></a>Linux远程访问</h2><p>使用CRT</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage22.png" alt>{width=”4.145833333333333in” height=”3.6770833333333335in”}</p>
<p>需要录入linux的ip地址及用户名密码</p>
<p>查看ip地址ifconfig</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1560603944797.png" alt="1560603944797"></p>
<p>注意事项:</p>
<ol>
<li><p>关于linux安装时失败问题，有可能是硬件虚拟化没有打开，需要在bios中开启虚拟化。通过 <img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage24.png" alt>{width=”1.90625in” height=”0.3125in”}可以查看</p>
</li>
<li><p>关于CRT安装与破解(参考图片)</p>
</li>
</ol>
<h2 id="Linux目录结构"><a href="#Linux目录结构" class="headerlink" title="Linux目录结构"></a>Linux目录结构</h2><p>Linux系统它是文件系统。</p>
<p>它的根目录 是”/“,是以树型结构来管理。</p>
<p>Root用户登录后，显示时有一个~,它其实代表的就是root目录</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage26.png" alt>{width=”5.465277777777778in” height=”3.3941918197725283in”}</p>
<p>我们可以将我们自己的文件安装在任意位置。</p>
<h2 id="Linux常用命令-重点"><a href="#Linux常用命令-重点" class="headerlink" title="Linux常用命令(重点)"></a>Linux常用命令(重点)</h2><h3 id="切换目录命令cd"><a href="#切换目录命令cd" class="headerlink" title="切换目录命令cd"></a>切换目录命令cd</h3><p>cd app 切换到app目录cd .. 切换到上一层目录cd / 切换到系统根目录cd ~ 切换到用户主目录cd - 切换到上一个所在目录</p>
<h3 id="列出文件列表-ls-ll"><a href="#列出文件列表-ls-ll" class="headerlink" title="列出文件列表 ls ll"></a>列出文件列表 ls ll</h3><p>ls(list)是一个非常有用的命令，用来显示当前目录下的内容。配合参数的使用，能以不同的方式显示目录内容。ls –help 可以帮助我们查看帮助信息</p>
<p>ls -a 显示所有文件或目录（包含隐藏的文件）</p>
<p>* ls -l 缩写成ll</p>
<p>在linux中以 . 开头的文件都是隐藏的文件</p>
<h3 id="创建与删除目录"><a href="#创建与删除目录" class="headerlink" title="创建与删除目录"></a>创建与删除目录</h3><p>mkdir(make directory)命令可用来创建子目录。mkdir app  在当前目录下创建app目录mkdir –p app2/test  级联创建aap2以及test目</p>
<p>rmdir(remove directory)命令可用来删除”空”的子目录：rmdir app  删除app目录</p>
<h3 id="浏览文件"><a href="#浏览文件" class="headerlink" title="浏览文件"></a>浏览文件</h3><p>cat操作</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1560602191070.png" alt="1560602191070"></p>
<p>more与less用法类似</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage28.png" alt>{width=”1.7395833333333333in” height=”0.22916666666666666in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage29.png" alt>{width=”1.8645833333333333in” height=”0.17708333333333334in”}</p>
<p>tail</p>
<p>tail命令是在实际使用过程中使用非常多的一个命令，它的功能是：用于显示文件后几行的内容。</p>
<p>用法:</p>
<p>tail -10 /etc/passwd 查看后10行数据</p>
<p>tail -f catalina.log 动态查看日志(*****)</p>
<p>ctrl+c 结束查看</p>
<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><p>cp是copy操作</p>
<p>mv它是move相当于剪切</p>
<p>cp(copy)命令可以将文件从一处复制到另一处。一般在使用cp命令时将一个文件复制成另一个文件或复制到某目录时，需要指定源文件名与目标文件名或目录。</p>
<p>cp a.txt b.txt 将a.txt复制为b.txt文件</p>
<p>cp a.txt ../ 将a.txt文件复制到上一层目录中</p>
<p>mv 移动或者重命名</p>
<p>mv a.txt ../ 将a.txt文件移动到上一层目录中</p>
<p>mv a.txt b.txt 将a.txt文件重命名为b.txt</p>
<p>rm它可以帮助我们删除文件与目录</p>
<p>rm 删除文件</p>
<p>用法：rm [选项]... 文件...</p>
<p>rm a.txt 删除a.txt文件</p>
<p>删除需要用户确认，y/n</p>
<p>rm 删除不询问</p>
<p>rm -f a.txt 不询问，直接删除</p>
<p>rm 删除目录</p>
<p>rm -r a 递归删除 可以删除文件夹(会询问)</p>
<p>不询问递归删除（慎用）</p>
<p>rm -rf a 不询问递归删除 可以删除文件夹(不会询问)</p>
<p>rm -rf * 删除所有文件</p>
<p>rm -rf /* 自杀</p>
<h3 id="打包压缩与解压"><a href="#打包压缩与解压" class="headerlink" title="打包压缩与解压"></a>打包压缩与解压</h3><p>tar命令位于/bin目录下，它能够将用户所指定的文件或目录打包成一个文件，但不做压缩。一般Linux上常用的压缩方式是选用tar将许多文件打包成一个文件，再以gzip压缩命令压缩成xxx.tar.gz(或称为xxx.tgz)的文件。</p>
<p>常用参数：</p>
<p>-c：创建一个新tar文件</p>
<p>-v：显示运行过程的信息</p>
<p>-f：指定文件名</p>
<p>-z：调用gzip压缩命令进行压缩</p>
<p>-t：查看压缩文件的内容</p>
<p>-x：解开tar文件</p>
<p>打包：</p>
<p>tar –cvf xxx.tar ./*</p>
<p>打包并且压缩：</p>
<p>tar –zcvf xxx.tar.gz ./*</p>
<p>解压</p>
<p>tar –xvf xxx.tar</p>
<p>tar -xvf xxx.tar.gz -C /usr/aaa</p>
<h3 id="文件查找"><a href="#文件查找" class="headerlink" title="文件查找"></a>文件查找</h3><p>查找符合条件的文件find</p>
<p>查找文件中符合条件的字符串grep</p>
<p>find指令用于查找符合条件的文件</p>
<p>示例：</p>
<p>find / -name “ins*“ 查找文件名称是以ins开头的文件</p>
<p>find / -name “ins*“ –ls</p>
<p>find / –user itcast –ls 查找用户itcast的文件</p>
<p>find / –user itcast –type d –ls 查找用户itcast的目录</p>
<p>find /-perm -777 –type d-ls 查找权限是777的文件</p>
<p>查找文件里符合条件的字符串。</p>
<p>用法: grep [选项]... PATTERN [FILE]...</p>
<p>示例：</p>
<p>grep lang anaconda-ks.cfg 在文件中查找lang</p>
<p>grep lang anaconda-ks.cfg –color 高亮显示</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage30.png" alt>{width=”4.695833333333334in” height=”0.2in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage31.png" alt>{width=”5.009027777777778in” height=”0.2in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage32.png" alt>{width=”5.382638888888889in” height=”0.1909722222222222in”}</p>
<h3 id="其它常用命令"><a href="#其它常用命令" class="headerlink" title="其它常用命令"></a>其它常用命令</h3><p>【pwd】</p>
<p>显示当前所在目录</p>
<p>【touch】</p>
<p>创建一个空文件</p>
<p>* touch a.txt</p>
<p>【ll -h】</p>
<p>友好显示文件大小</p>
<p>【wget】</p>
<p>下载资料</p>
<p>* wget <a href="http://nginx.org/download/nginx-1.9.12.tar.gz" target="_blank" rel="noopener">http://nginx.org/download/nginx-1.9.12.tar.gz</a></p>
<h2 id="VI与VIM编辑器"><a href="#VI与VIM编辑器" class="headerlink" title="VI与VIM编辑器"></a>VI与VIM编辑器</h2><p>有三种模式 命令行 插入 底行</p>
<p>通过 vi（vim） 文件名 就可以对文件进行操作</p>
<p>当操作时，开始是命令行模式 按I o a 切换到插入模式</p>
<p>按esc 可以在重新切换到命令行模式</p>
<p>在命令行模式下按 “:” 就可以切换到底行模式。</p>
<p>在命令行模式下可以使用一些快捷键</p>
<p>在Linux下一般使用vi编辑器来编辑文件。vi既可以查看文件也可以编辑文件。三种模式：命令行、插入、底行模式。</p>
<p>切换到命令行模式：按Esc键；</p>
<p>切换到插入模式：按 i 、o、a键；</p>
<p>i 在当前位置前插入</p>
<p>I 在当前行首插入</p>
<p>a 在当前位置后插入</p>
<p>A 在当前行尾插入</p>
<p>o 在当前行之后插入一行</p>
<p>O 在当前行之前插入一行</p>
<p>切换到底行模式：按 :（冒号）；更多详细用法，查询文档《Vim命令合集.docx》和《vi使用方法详细介绍.docx》</p>
<p>打开文件：vim file</p>
<p>退出：esc :q</p>
<p>修改文件：输入i进入插入模式</p>
<p>保存并退出：esc:wq</p>
<p>不保存退出：esc:q!</p>
<p>三种进入插入模式：</p>
<p>i:在当前的光标所在处插入</p>
<p>o:在当前光标所在的行的下一行插入</p>
<p>a:在光标所在的下一个字符插入</p>
<p>快捷键：命令行模式下</p>
<p>dd – 快速删除一行</p>
<p>yy - 复制当前行</p>
<p>nyy - 从当前行向后复制几行</p>
<p>p - 粘贴</p>
<p>R – 替换</p>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>&gt; 重定向输出，覆盖原有内容；&gt;&gt; 重定向输出，又追加功能；示例：</p>
<p>cat /etc/passwd &gt; a.txt 将输出定向到a.txt中</p>
<p>cat /etc/passwd &gt;&gt; a.txt 输出并且追加</p>
<p>ifconfig &gt; ifconfig.txt</p>
<h3 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h3><p>管道是Linux命令中重要的一个概念，其作用是将一个命令的输出用作另一个命令的输入。示例</p>
<p>ls --help | more 分页查询帮助信息</p>
<p>ps –ef | grep java 查询名称中包含java的进程</p>
<p>ifconfig | more</p>
<p>cat index.html | more</p>
<p>ps –ef | grep aio</p>
<h3 id="amp-amp-命令执行控制"><a href="#amp-amp-命令执行控制" class="headerlink" title="&amp;&amp;命令执行控制"></a>&amp;&amp;命令执行控制</h3><p>命令之间使用 &amp;&amp; 连接，实现逻辑与的功能。</p>
<p>只有在 &amp;&amp; 左边的命令返回真（命令返回值 $? == 0），&amp;&amp; 右边的命令才会被执行。 </p>
<p>只要有一个命令返回假（命令返回值 $? == 1），后面的命令就不会被执行。</p>
<p>mkdir test &amp;&amp; cd test</p>
<h3 id="系统常用命令"><a href="#系统常用命令" class="headerlink" title="系统常用命令"></a>系统常用命令</h3><p>date 显示或设置系统时间</p>
<p>date 显示当前系统时间</p>
<p>date -s “2014-01-01 10:10:10” 设置系统时间df 显示磁盘信息</p>
<p>df –h 友好显示大小free 显示内存状态</p>
<p>free –m 以mb单位显示内存组昂头top 显示，管理执行中的程序</p>
<p>clear 清屏幕</p>
<p>ps 正在运行的某个进程的状态</p>
<p>ps –ef 查看所有进程</p>
<p>ps –ef | grep ssh 查找某一进程kill 杀掉某一进程</p>
<p>kill 2868 杀掉2868编号的进程</p>
<p>kill -9 2868 强制杀死进程</p>
<p>du 显示目录或文件的大小。</p>
<p>du –h 显示当前目录的大小</p>
<p>who 显示目前登入系统的用户信息。</p>
<p>uname 显示系统信息。</p>
<p>uname -a 显示本机详细信息。依次为：内核名称(类别)，主机名，内核版本号，内核版本，内核编译日期，硬件名，处理器类型，硬件平台类型，操作系统名称</p>
<h2 id="Linux下用户与组管理"><a href="#Linux下用户与组管理" class="headerlink" title="Linux下用户与组管理"></a>Linux下用户与组管理</h2><h3 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h3><p>useradd 添加一个用户</p>
<p>useradd test 添加test用户</p>
<p>useradd test -d /home/t1 指定用户home目录</p>
<p>passwd 设置、修改密码</p>
<p>passwd test 为test用户设置密码</p>
<p>切换登录：</p>
<p>ssh -l test -p 22 192.168.19.128</p>
<p>su – 用户名</p>
<p>userdel 删除一个用户 一定要在root用户下才能删除</p>
<p>userdel test 删除test用户(不会删除home目录)</p>
<p>userdel –r test 删除用户以及home目录</p>
<h3 id="组管理"><a href="#组管理" class="headerlink" title="组管理"></a>组管理</h3><p>当在创建一个新用户user时，若没有指定他所属于的组，就建立一个和该用户同名的私有组</p>
<p>创建用户时也可以指定所在组</p>
<p>groupadd 创建组</p>
<p>groupadd public 创建一个名为public的组</p>
<p>useradd u1 –g public 创建用户指定组groupdel 删除组，如果该组有用户成员，必须先删除用户才能删除组。</p>
<p>groupdel public</p>
<h3 id="id，su命令"><a href="#id，su命令" class="headerlink" title="id，su命令"></a>id，su命令</h3><p>【id命令】</p>
<p>功能：查看一个用户的UID和GID用法：id [选项]... [用户名]</p>
<p>直接使用id</p>
<p>直接使用id 用户名</p>
<p>【su命令】</p>
<p>功能：切换用户。用法：su [选项]... [-] [用户 [参数]... ]示例：</p>
<p>su u1 切换到u1用户</p>
<p>su - u1 切换到u1用户，并且将环境也切换到u1用户的环境（推荐使用）</p>
<p>【账户文件】</p>
<p>/etc/passwd 用户文件/etc/shadow 密码文件/etc/group 组信息文件</p>
<p>【用户文件】</p>
<p>root:x:0:0:root:/root:/bin/bash账号名称： 在系统中是唯一的用户密码： 此字段存放加密口令用户标识码(User ID)： 系统内部用它来标示用户组标识码(Group ID)： 系统内部用它来标识用户属性用户相关信息： 例如用户全名等用户目录： 用户登录系统后所进入的目录用户环境: 用户工作的环境</p>
<p>【密码文件】</p>
<p>shadow文件中每条记录用冒号间隔的9个字段组成.用户名：用户登录到系统时使用的名字，而且是惟一的口令： 存放加密的口令最后一次修改时间: 标识从某一时刻起到用户最后一次修改时间最大时间间隔: 口令保持有效的最大天数，即多少天后必须修改口令最小时间间隔： 再次修改口令之间的最小天数警告时间：从系统开始警告到口令正式失效的天数不活动时间： 口令过期少天后，该账号被禁用失效时间：指示口令失效的绝对天数(从1970年1月1日开始计算)标志：未使用</p>
<p>【组文件】</p>
<p>root:x:0:组名：用户所属组组口令：一般不用GID：组ID用户列表：属于该组的所有用户</p>
<h2 id="文件权限管理"><a href="#文件权限管理" class="headerlink" title="文件权限管理"></a>文件权限管理</h2><h3 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage34.png" alt>{width=”5.095833333333333in” height=”2.173611111111111in”}</p>
<hr>
<p>  <strong>属主（user）</strong>   <strong>属组（group）</strong>   <strong>其他用户</strong><br>  r                  w                   x              r   w   x   r   w   x<br>  4                  2                   1              4   2   1   4   2   1</p>
<hr>
<p>r:对文件是指可读取内容 对目录是可以ls</p>
<p>w:对文件是指可修改文件内容，对目录 是指可以在其中创建或删除子节点(目录或文件)</p>
<p>x:对文件是指是否可以运行这个文件，对目录是指是否可以cd进入这个目录</p>
<h3 id="Linux三种文件类型："><a href="#Linux三种文件类型：" class="headerlink" title="Linux三种文件类型："></a>Linux三种文件类型：</h3><p>普通文件： 包括文本文件、数据文件、可执行的二进制程序文件等。</p>
<p>目录文件： Linux系统把目录看成是一种特殊的文件，利用它构成文件系统的树型结构。</p>
<p>设备文件： Linux系统把每一个设备都看成是一个文件</p>
<h3 id="文件类型标识"><a href="#文件类型标识" class="headerlink" title="文件类型标识"></a>文件类型标识</h3><p>普通文件（-）目录（d）符号链接（l）</p>
<p>* 进入etc可以查看，相当于快捷方式字符设备文件（c）块设备文件（s）套接字（s）命名管道（p）</p>
<h3 id="文件权限管理："><a href="#文件权限管理：" class="headerlink" title="文件权限管理："></a>文件权限管理：</h3><p>chmod 变更文件或目录的权限。</p>
<p>chmod 755 a.txt -rwxr-xr-x</p>
<p>chmod u=rwx,g=rx,o=rx a.txt</p>
<p>chmod 000 a.txt / chmod 777 a.txtchown 变更文件或目录改文件所属用户和组</p>
<p>chown u1:public aa ：变更当前的目录或文件的所属用户和组</p>
<p>chown -R u1:public aa ：变更目录中的所有的子目录及文件的所属用户和组</p>
<p>例如: aa 属于 root 用户 root组 假设aa下面有一个a.txt文件 root用户 root 组</p>
<p>chown u1:public aa aa属于u1用户 public组 a.txt root用户 root组</p>
<p>chown -R u1:public aa aa属于u1用户 public组 a.txt u1用户 public组</p>
<p>文件的权限:</p>
<p>R,W,X---------------(4,2,1)</p>
<p>文件权限的更改</p>
<p>Chmod 777 a.txt;</p>
<p>chmod u=rwx,g=rx,o=rx a.txt</p>
<p>文件所属用户或者组的一个更改</p>
<h2 id="常用网络操作"><a href="#常用网络操作" class="headerlink" title="常用网络操作"></a>常用网络操作</h2><h3 id="主机名配置"><a href="#主机名配置" class="headerlink" title="主机名配置"></a>主机名配置</h3><p>hostname 查看主机名</p>
<p>hostname xxx 修改主机名 重启后无效</p>
<p>如果想要永久生效，可以修改/etc/sysconfig/network文件</p>
<h3 id="IP地址配置"><a href="#IP地址配置" class="headerlink" title="IP地址配置"></a>IP地址配置</h3><p>Setup设置ip地址</p>
<p>ifconfig 查看(修改)ip地址(重启后无效)</p>
<p>ifconfig eth0 192.168.12.22 修改ip地址</p>
<p>如果想要永久生效</p>
<p>修改 /etc/sysconfig/network-scripts/ifcfg-eth0文件</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage35.png" alt>{width=”3.4166666666666665in” height=”2.2708333333333335in”}</p>
<h3 id="域名映射"><a href="#域名映射" class="headerlink" title="域名映射"></a>域名映射</h3><p>/etc/hosts文件用于在通过主机名进行访问时做ip地址解析之用</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage36.png" alt>{width=”5.768055555555556in” height=”0.586819772528434in”}</p>
<p>192.168.42.43 <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a></p>
<h3 id="网络服务管理"><a href="#网络服务管理" class="headerlink" title="网络服务管理"></a>网络服务管理</h3><p>service network status 查看指定服务的状态</p>
<p>service network stop 停止指定服务</p>
<p>service network start 启动指定服务</p>
<p>service network restart 重启指定服务</p>
<p>service ---status–all 查看系统中所有后台服务</p>
<p>netstat –nltp 查看系统中网络进程的端口监听情况</p>
<p>防火墙设置</p>
<p>防火墙根据配置文件/etc/sysconfig/iptables来控制本机的”出”、”入”网络访问行为。</p>
<p>service iptables status 查看防火墙状态</p>
<p>service iptables stop 关闭防火墙</p>
<p>service iptables start 启动防火墙</p>
<p>chkconfig iptables off 禁止防火墙自启</p>
<h2 id="Linux上软件安装介绍"><a href="#Linux上软件安装介绍" class="headerlink" title="Linux上软件安装介绍"></a>Linux上软件安装介绍</h2><ul>
<li>Linux上的软件安装有以下几种常见方式介绍</li>
</ul>
<ol>
<li>二进制发布包</li>
</ol>
<blockquote>
<p>软件已经针对具体平台编译打包发布，只要解压，修改配置即可</p>
</blockquote>
<ol start="2">
<li>RPM包</li>
</ol>
<blockquote>
<p>软件已经按照redhat的包管理工具规范RPM进行打包发布，需要获取到相应的软件RPM发布包，然后用RPM命令进行安装</p>
</blockquote>
<ol start="3">
<li>Yum在线安装</li>
</ol>
<blockquote>
<p>软件已经以RPM规范打包，但发布在了网络上的一些服务器上，可用yum在线安装服务器上的rpm软件，并且会自动解决软件安装过程中的库依赖问题</p>
</blockquote>
<ol start="4">
<li>源码编译安装</li>
</ol>
<blockquote>
<p>软件以源码工程的形式发布，需要获取到源码工程后用相应开发工具进行编译打包部署。</p>
</blockquote>
<ul>
<li>上传与下载工具介绍</li>
</ul>
<ol>
<li>FileZilla</li>
</ol>
<blockquote>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage37.png" alt>{width=”2.0625in” height=”0.2916666666666667in”}</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage38.png" alt>{width=”5.768055555555556in” height=”2.2918678915135606in”}</p>
</blockquote>
<ol start="2">
<li>lrzsz</li>
</ol>
<blockquote>
<p>我们可以使用yum安装方式安装 yum install lrzsz</p>
<p>Yum remove lrzsz</p>
<p>注意：必须有网络</p>
<p>可以在crt中设置上传与下载目录</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage39.png" alt>{width=”5.572916666666667in” height=”3.71875in”}</p>
<p>上传：</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1560602710805.png" alt="1560602710805"></p>
<p>下载</p>
<p>sz   文件名</p>
</blockquote>
<h3 id="在Linux上安装JDK"><a href="#在Linux上安装JDK" class="headerlink" title="在Linux上安装JDK:"></a>在Linux上安装JDK:</h3><p>【步骤一】：上传JDK到Linux的服务器.</p>
<p>* 上传JDK</p>
<p>* 卸载open-JDK</p>
<p>java –version</p>
<p>rpm -qa | grep java</p>
<p>rpm -e --nodeps java-1.6.0-openjdk-1.6.0.35-1.13.7.1.el6_6.i686</p>
<p>rpm -e --nodeps java-1.7.0-openjdk-1.7.0.79-2.5.5.4.el6.i686</p>
<p>【步骤二】：在Linux服务器上安装JDK.</p>
<p>* 通常将软件安装到/usr/local</p>
<p>* 直接解压就可以</p>
<p>tar –xvf jdk.tar.gz -C 目标路径</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage42.png" alt>{width=”4.322916666666667in” height=”0.20833333333333334in”}</p>
<p>【步骤三】：配置JDK的环境变量.</p>
<p>配置环境变量：</p>
<p>① vi /etc/profile</p>
<p>② 在末尾行添加</p>
<p>#set java environment</p>
<p>JAVA_HOME=/usr/local/jdk/jdk1.7.0_71</p>
<p>CLASSPATH=.:$JAVA_HOME/lib.tools.jar</p>
<p>PATH=$JAVA_HOME/bin:$PATH</p>
<p>export JAVA_HOME CLASSPATH PATH</p>
<p>保存退出</p>
<p>③source /etc/profile 使更改的配置立即生效</p>
<p>总结:</p>
<ol>
<li><p>进入local目录 cd /usr/local</p>
</li>
<li><p>上传你需要安装的jdk压缩文件(<strong>注意jdk要和centOS版本一致</strong>)</p>
</li>
<li><p>查询当前centos系统中默认的jdk(rpm -qa | grep java)</p>
</li>
<li><p>删除系统中默认的jdk (rpm -e –nodeps 查询到的jdk文件)</p>
</li>
<li><p>在local目录下创建一个jdk文件夹,然后把jdk压缩文件解压到jdk文件夹里面</p>
</li>
<li><p>配置JDK的环境变量(vi /etc/profile)</p>
</li>
</ol>
<p>在末尾行添加</p>
<p>#set java environment</p>
<p>JAVA_HOME=jdk安装的绝对路径</p>
<p>CLASSPATH=.:$JAVA_HOME/lib.tools.jar</p>
<p>PATH=$JAVA_HOME/bin:$PATH</p>
<p>export JAVA_HOME CLASSPATH PATH</p>
<ol start="7">
<li>source /etc/profile 使更改的配置立即生效</li>
</ol>
<h3 id="在Linux上安装Mysql"><a href="#在Linux上安装Mysql" class="headerlink" title="在Linux上安装Mysql:"></a>在Linux上安装Mysql:</h3><p>【步骤一】：将mysql的安装文件上传到Linux的服务器.</p>
<p>将mysql的tar解压</p>
<p>将系统自带的mysql卸载</p>
<p>先查看</p>
<p>rpm -qa |grep mysql</p>
<p>rpm -e –nodes 查询到的名称</p>
<p>【步骤二】：安装MYSQL服务端</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage47.png" alt>{width=”4.0in” height=”0.1875in”}</p>
<p>下面的提示是告诉我们root用户的密码第一次是随机生成的，它保存在/root/.mysql_secret中，第一次登录需要修改root密码</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage48.png" alt>{width=”5.216418416447944in” height=”2.0in”}</p>
<p>【步骤三】：安装MYSQL客户端</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage49.png" alt>{width=”3.9895833333333335in” height=”0.1875in”}</p>
<p>查看生成的root密码</p>
<p>cat /root/.mysql_secret</p>
<p>mysql -u root -p 密码</p>
<p>报错:原因是没有启动mysql服务</p>
<p>需要开启mysql服务</p>
<p>service mysql start </p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage52.png" alt>{width=”4.083333333333333in” height=”0.34375in”}</p>
<p>执行下面操作报错，原因是第一次操作mysql必须修改root用户的密码</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage53.png" alt>{width=”5.768055555555556in” height=”0.3638418635170604in”}</p>
<p>设置root用户的密码</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage54.png" alt>{width=”2.6979166666666665in” height=”0.22916666666666666in”}</p>
<p>总结:</p>
<ol>
<li><p>上传mysql安装压缩文件到local目录</p>
</li>
<li><p>创建一个mysql目录</p>
</li>
<li><p>把mysql的压缩文件解压到mysql目录中</p>
</li>
<li><p>将系统自带的mysql卸载</p>
</li>
<li><p>安装mysql的服务器(有可能系统缺少依赖) rpm -ivh MySQL-server-5.6.22-1.el6.i686.rpm</p>
</li>
<li><p>安装mysql的客户端</p>
</li>
<li><p>开启mysql服务</p>
</li>
<li><p>登录mysql mysql -uroot -p原始密码(保存在/root/.mysql_secret)</p>
</li>
<li><p>使用mysql必须修改root用户的密码</p>
</li>
<li><p>正常使用了</p>
</li>
</ol>
<ul>
<li><strong>Mysql服务加入到系统服务并自动启动操作：</strong></li>
</ul>
<p>chkconfig --add mysql</p>
<p>自动启动：</p>
<p>chkconfig mysql on</p>
<p>查询列表：</p>
<p>chkconfig</p>
<ul>
<li><p>关于mysql远程访问设置</p>
</li>
<li><p>grant all privileges on *.* to &#39;root&#39; @&#39;%&#39; identified by &#39;root&#39;;</p>
</li>
<li><p>flush privileges;</p>
</li>
</ul>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5Cmedia%5Cimage55.png" alt>{width=”5.768055555555556in” height=”0.8278226159230097in”}</p>
<p>在linux中很多软件的端口都被”防火墙”限止，我们需要将防火墙关闭</p>
<p>防火墙打开3306端口</p>
<p>/sbin/iptables -I INPUT -p tcp --dport 3306 -j ACCEPT</p>
<p>/etc/rc.d/init.d/iptables save</p>
<p>/etc/init.d/iptables status</p>
<p>学习阶段也可以直接将防火墙关闭</p>
<p>service iptables stop;</p>
<h3 id="在Linux上安装tomcat"><a href="#在Linux上安装tomcat" class="headerlink" title="在Linux上安装tomcat:"></a>在Linux上安装tomcat:</h3><p>1.Tomcat上传到linux上</p>
<p>2.将上传的tomcat解压</p>
<p>3.在tomcat/bin目录下执行 ./startup.sh（注意防火墙）</p>
<p>4.查看目标 tomcat/logs/catalina.out</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/课堂笔记/" data-id="cjycojoha000bwo7kq41uqeg6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-娱乐头条-1" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/娱乐头条-1/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.415Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/娱乐头条-1/">nginx,redis,gossip_spider</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><h3 id="什么是nginx"><a href="#什么是nginx" class="headerlink" title="什么是nginx?"></a>什么是nginx?</h3><p>Nginx是一款高性能的http 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器。由俄罗斯的程序设计师Igor Sysoev所开发，官方测试nginx能够支支撑5万并发链接，并且cpu、内存等资源消耗却非常低，运行非常稳定。</p>
<h3 id="为什么要用nginx"><a href="#为什么要用nginx" class="headerlink" title="为什么要用nginx?"></a>为什么要用nginx?</h3><ul>
<li>1) <strong>http服务器</strong>。Nginx是一个http服务可以独立提供http服务。可以做网页静态服务器。</li>
<li>2) 虚拟主机。可以实现在一台服务器虚拟出多个网站。例如个人网站使用的虚拟主机。</li>
<li>3) <strong>反向代理，负载均衡</strong>。当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要用多台服务器集群可以使用nginx做反向代理。并且多台服务器可以平均分担负载，不会因为某台服务器负载高宕机而某台服务器闲置的情况。</li>
</ul>
<h3 id="nginx的高可用"><a href="#nginx的高可用" class="headerlink" title="nginx的高可用"></a>nginx的高可用</h3><p>​        负载均衡高可用:为了避免出现nginx出现宕机,可对nginx进行高可用,为nginx提供备用机,使用高可用监控程序(keepalived)来处理,一般的处理模式是,两台同时运行,实际提供服务的只有一台,监控中心与这台服务器之间会传输诸如’I am alive’这样得信息来监控对方的运行状况,一旦发现对方挂掉,就马上切换到另一台,如果挂掉的主服务器重新发送激活的状态 ,监控中心就会将请求交由主服务器</p>
<hr>
<h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><h3 id="Redis的概念"><a href="#Redis的概念" class="headerlink" title="Redis的概念"></a>Redis的概念</h3><p>​    Redis是一款由C语言编写, 基于内存的持久化的数据库, 其中数据是以KEY-VALUE的形式存储的, Redis提供了丰富的数据类型</p>
<h3 id="Redis的特点"><a href="#Redis的特点" class="headerlink" title="Redis的特点"></a>Redis的特点</h3><ul>
<li>1) Redis将数据存储到内存当中, 所以Redis的读写效率非常高:  读 11w/s  写 8w/s</li>
<li>2) redis提供了丰富的数据类型:  string , hash , list ,set , sortedSet<ul>
<li>注意: redis中数据类型, 主要是描述的key-value中value的数据类型, 而key只有string</li>
</ul>
</li>
<li>3) Redis数据的移植非常快的</li>
<li>4) redis中所有的操作都是原子性的, 保证数据的完整性的</li>
</ul>
<h3 id="redis数据类型的使用场景和特点"><a href="#redis数据类型的使用场景和特点" class="headerlink" title="redis数据类型的使用场景和特点"></a>redis数据类型的使用场景和特点</h3><ul>
<li>string:   可以使用json转换对象, 存储<ul>
<li>特点:  和 java中 string是类似的, 表示的就是字符串</li>
<li>使用场景: 做缓存</li>
</ul>
</li>
<li>hash:  存储对象是比较方便的<ul>
<li>特点: 和 java中 hashMap是类似的</li>
<li>使用场景:  做缓存 (hash使用较少)</li>
</ul>
</li>
<li>list:<ul>
<li>特点:  和 java中 linkedList是类似, 可以看做是队列(FIFO)先进先出</li>
<li>使用场景:  任务队列</li>
</ul>
</li>
<li>set :<ul>
<li>特点:  和 java中set集合是类似的  去重 无序</li>
<li>使用场景: 去重业务</li>
</ul>
</li>
<li>sortedSet<ul>
<li>特点:  和 java中 sortedSet(TreeSet)类型    有序   去重</li>
<li>使用场景:  排序操作(排行榜)</li>
</ul>
</li>
</ul>
<h3 id="jedis连接池"><a href="#jedis连接池" class="headerlink" title="jedis连接池"></a>jedis连接池</h3><p>jedis看做是一个连接对象, 频繁的创建一个连接, 比较耗时耗资源的 通常情况, 采用连接池的技术, 提前的创建好一部分的连接对象, 放置到容器中, 反复的使用即可</p>
<ul>
<li>jedis的连接池基本使用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JedisPool jedisPool;</span><br><span class="line">    <span class="comment">// 什么加载: 随着类的加载而加载, 一般只会加载一次</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        config.setMaxTotal(<span class="number">100</span>);  <span class="comment">//最大连接数</span></span><br><span class="line">        config.setMaxIdle(<span class="number">50</span>);   <span class="comment">// 最大闲时的数量</span></span><br><span class="line">        config.setMinIdle(<span class="number">25</span>);   <span class="comment">// 最小闲时的数量</span></span><br><span class="line">      </span><br><span class="line">        jedisPool = <span class="keyword">new</span> JedisPool(config,<span class="string">"192.168.72.142"</span>,<span class="number">6379</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取连接的方法</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title">getJedis</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> jedisPool.getResource() ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="娱乐爬虫"><a href="#娱乐爬虫" class="headerlink" title="娱乐爬虫"></a>娱乐爬虫</h2><p>163娱乐爬虫流程</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1563178753672.png" alt="1563178753672"></p>
<h3 id="1-确定首页url"><a href="#1-确定首页url" class="headerlink" title="1.确定首页url"></a>1.确定首页url</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">News163Spider2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> IdWorker idWorker = <span class="keyword">new</span> IdWorker(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> NewsDao newsDao = <span class="keyword">new</span> NewsDao();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1.确定首页url</span></span><br><span class="line">        List&lt;String&gt; indexUrlList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_index.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_music.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_show.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_tv.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_star.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_movie.js?callback=data_callback"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-发送请求-获取数据"><a href="#2-发送请求-获取数据" class="headerlink" title="2.发送请求,获取数据"></a>2.发送请求,获取数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">page</span><span class="params">(String indexUrl)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String page = <span class="string">"02"</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//2.发送请求,获取数据</span></span><br><span class="line">            String jsonStr = HttpClientUtils.doGet(indexUrl);</span><br><span class="line">            <span class="keyword">if</span> (jsonStr == <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将jsonStr转换为标准json格式</span></span><br><span class="line">            jsonStr = jsonStr.substring(jsonStr.indexOf(<span class="string">"("</span>) + <span class="number">1</span>, jsonStr.lastIndexOf(<span class="string">")"</span>));</span><br><span class="line">            parseJson(jsonStr);</span><br><span class="line">            <span class="comment">//获取下一页url</span></span><br><span class="line"></span><br><span class="line">            indexUrl = indexUrl.replaceAll(<span class="string">"_[0-9]+.js"</span>, <span class="string">".js"</span>);</span><br><span class="line">            String[] split = indexUrl.split(<span class="string">".js"</span>);</span><br><span class="line">            indexUrl = split[<span class="number">0</span>] + <span class="string">"_"</span> + page + <span class="string">".js"</span> + split[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> pagenum = Integer.parseInt(page);</span><br><span class="line">            pagenum ++;</span><br><span class="line">            <span class="keyword">if</span> (pagenum &lt; <span class="number">10</span>)&#123;</span><br><span class="line">                page = <span class="string">"0"</span>+pagenum;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                page = pagenum + <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-解析数据-封装javabean"><a href="#3-解析数据-封装javabean" class="headerlink" title="3.解析数据,封装javabean"></a>3.解析数据,封装javabean</h3><h3 id="4-保存数据-去重"><a href="#4-保存数据-去重" class="headerlink" title="4.保存数据(去重)"></a>4.保存数据(去重)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseJson</span><span class="params">(String jsonStr)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//3.解析数据</span></span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; newsList = gson.fromJson(jsonStr, List.class);</span><br><span class="line">        <span class="keyword">for</span> (Map&lt;String, Object&gt; newsObject : newsList) &#123;</span><br><span class="line">            String docUrl = (String) newsObject.get(<span class="string">"docurl"</span>);</span><br><span class="line">            System.out.println(docUrl);</span><br><span class="line">            <span class="comment">//过滤网页</span></span><br><span class="line">            <span class="keyword">if</span> (!docUrl.contains(<span class="string">"ent.163.com"</span>) || docUrl.contains(<span class="string">"photoview"</span>)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//#########去重########</span></span><br><span class="line">            Jedis jedis = JedisUtils.getJedis();</span><br><span class="line">            Boolean flag = jedis.sismember(<span class="string">"bigData:spider:163News:docUrl02"</span>, docUrl);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//#########去重########</span></span><br><span class="line"></span><br><span class="line">            News news = parseNewsItem(docUrl);</span><br><span class="line">            <span class="comment">//4.保存数据</span></span><br><span class="line">            newsDao.saveNews(news);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//#########去重########</span></span><br><span class="line">            jedis = JedisUtils.getJedis();</span><br><span class="line">            jedis.sadd(<span class="string">"bigData:spider:163News:docUrl02"</span>,news.getDocurl());</span><br><span class="line">             jedis.close();</span><br><span class="line">            <span class="comment">//#########去重########</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解析新闻详情页  </span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> News <span class="title">parseNewsItem</span><span class="params">(String docUrl)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String html = HttpClientUtils.doGet(docUrl);</span><br><span class="line">        Document document = Jsoup.parse(html);</span><br><span class="line">        News news = <span class="keyword">new</span> News();</span><br><span class="line">        <span class="comment">//获取title</span></span><br><span class="line">        String title = document.select(<span class="string">"#epContentLeft&gt;h1"</span>).text();</span><br><span class="line">        news.setTitle(title);</span><br><span class="line">        <span class="comment">//获取time</span></span><br><span class="line">        String timeAndSource = document.select(<span class="string">".post_time_source"</span>).text();</span><br><span class="line"></span><br><span class="line">        String[] split = timeAndSource.split(<span class="string">"　来源: "</span>);</span><br><span class="line">        String time = split[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        news.setTime(time);</span><br><span class="line">        <span class="comment">//获取source</span></span><br><span class="line">        String source = split[<span class="number">1</span>].substring(<span class="number">0</span>, split[<span class="number">1</span>].indexOf(<span class="string">"举"</span>));</span><br><span class="line">        news.setSource(source);</span><br><span class="line">        <span class="comment">//获取content</span></span><br><span class="line">        String content = document.select(<span class="string">"#endText p"</span>).text();</span><br><span class="line">        news.setContent(content);</span><br><span class="line">        <span class="comment">//获取editor</span></span><br><span class="line">        String editor = document.select(<span class="string">".ep-editor"</span>).text();</span><br><span class="line">        editor = editor.substring(editor.indexOf(<span class="string">"："</span>) + <span class="number">1</span>, editor.indexOf(<span class="string">"_"</span>));</span><br><span class="line">        news.setEditor(editor);</span><br><span class="line">        <span class="comment">//获取id</span></span><br><span class="line">        <span class="keyword">long</span> id = idWorker.nextId();</span><br><span class="line">        news.setId(id + <span class="string">""</span>);</span><br><span class="line">        <span class="comment">//设置docurl</span></span><br><span class="line">        news.setDocurl(docUrl);</span><br><span class="line"><span class="comment">//        System.out.println(news);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回news</span></span><br><span class="line">        <span class="keyword">return</span> news;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-分页获取爬取"><a href="#5-分页获取爬取" class="headerlink" title="5.分页获取爬取"></a>5.分页获取爬取</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5.分页获取数据</span></span><br><span class="line">       <span class="keyword">while</span> (!indexUrlList.isEmpty()) &#123;</span><br><span class="line">           String indexUrl = indexUrlList.remove(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">           page(indexUrl);</span><br><span class="line">           System.out.println(<span class="string">"本栏目爬取完毕!"</span>);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<h3 id="整体爬虫代码"><a href="#整体爬虫代码" class="headerlink" title="整体爬虫代码"></a>整体爬虫代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">News163Spider2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> IdWorker idWorker = <span class="keyword">new</span> IdWorker(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> NewsDao newsDao = <span class="keyword">new</span> NewsDao();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1.确定首页url</span></span><br><span class="line">        List&lt;String&gt; indexUrlList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_index.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_music.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_show.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_tv.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_star.js?callback=data_callback"</span>);</span><br><span class="line">        indexUrlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_movie.js?callback=data_callback"</span>);</span><br><span class="line">        <span class="comment">//5.分页获取数据</span></span><br><span class="line">        <span class="keyword">while</span> (!indexUrlList.isEmpty()) &#123;</span><br><span class="line">            String indexUrl = indexUrlList.remove(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            page(indexUrl);</span><br><span class="line">            System.out.println(<span class="string">"本栏目爬取完毕!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">page</span><span class="params">(String indexUrl)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String page = <span class="string">"02"</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//2.发送请求,获取数据</span></span><br><span class="line">            String jsonStr = HttpClientUtils.doGet(indexUrl);</span><br><span class="line">            <span class="keyword">if</span> (jsonStr == <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将jsonStr转换为标准json格式</span></span><br><span class="line">            jsonStr = jsonStr.substring(jsonStr.indexOf(<span class="string">"("</span>) + <span class="number">1</span>, jsonStr.lastIndexOf(<span class="string">")"</span>));</span><br><span class="line">            parseJson(jsonStr);</span><br><span class="line">            <span class="comment">//获取下一页url</span></span><br><span class="line">            indexUrl = indexUrl.replaceAll(<span class="string">"_[0-9]+.js"</span>, <span class="string">".js"</span>);</span><br><span class="line">            String[] split = indexUrl.split(<span class="string">".js"</span>);</span><br><span class="line">            indexUrl = split[<span class="number">0</span>] + <span class="string">"_"</span> + page + <span class="string">".js"</span> + split[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">int</span> pagenum = Integer.parseInt(page);</span><br><span class="line">            pagenum ++;</span><br><span class="line">            <span class="keyword">if</span> (pagenum &lt; <span class="number">10</span>)&#123;</span><br><span class="line">                page = <span class="string">"0"</span>+pagenum;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                page = pagenum + <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseJson</span><span class="params">(String jsonStr)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//3.解析数据</span></span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; newsList = gson.fromJson(jsonStr, List.class);</span><br><span class="line">        <span class="keyword">for</span> (Map&lt;String, Object&gt; newsObject : newsList) &#123;</span><br><span class="line">            String docUrl = (String) newsObject.get(<span class="string">"docurl"</span>);</span><br><span class="line">            System.out.println(docUrl);</span><br><span class="line">            <span class="comment">//过滤网页</span></span><br><span class="line">            <span class="keyword">if</span> (!docUrl.contains(<span class="string">"ent.163.com"</span>) || docUrl.contains(<span class="string">"photoview"</span>)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//#########去重########</span></span><br><span class="line">            Jedis jedis = JedisUtils.getJedis();</span><br><span class="line">            Boolean flag = jedis.sismember(<span class="string">"bigData:spider:163News:docUrl02"</span>, docUrl);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//#########去重########</span></span><br><span class="line"></span><br><span class="line">            News news = parseNewsItem(docUrl);</span><br><span class="line"><span class="comment">//            System.out.println(news);</span></span><br><span class="line">            <span class="comment">//4.保存数据</span></span><br><span class="line">            newsDao.saveNews(news);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//#########去重########</span></span><br><span class="line">            jedis = JedisUtils.getJedis();</span><br><span class="line">            jedis.sadd(<span class="string">"bigData:spider:163News:docUrl02"</span>,news.getDocurl());</span><br><span class="line">             jedis.close();</span><br><span class="line">            <span class="comment">//#########去重########</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> News <span class="title">parseNewsItem</span><span class="params">(String docUrl)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String html = HttpClientUtils.doGet(docUrl);</span><br><span class="line">        Document document = Jsoup.parse(html);</span><br><span class="line">        News news = <span class="keyword">new</span> News();</span><br><span class="line">        <span class="comment">//获取title</span></span><br><span class="line">        String title = document.select(<span class="string">"#epContentLeft&gt;h1"</span>).text();</span><br><span class="line">        news.setTitle(title);</span><br><span class="line">        <span class="comment">//获取time</span></span><br><span class="line">        String timeAndSource = document.select(<span class="string">".post_time_source"</span>).text();</span><br><span class="line"></span><br><span class="line">        String[] split = timeAndSource.split(<span class="string">"　来源: "</span>);</span><br><span class="line">        String time = split[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        news.setTime(time);</span><br><span class="line">        <span class="comment">//获取source</span></span><br><span class="line">        String source = split[<span class="number">1</span>].substring(<span class="number">0</span>, split[<span class="number">1</span>].indexOf(<span class="string">"举"</span>));</span><br><span class="line">        news.setSource(source);</span><br><span class="line">        <span class="comment">//获取content</span></span><br><span class="line">        String content = document.select(<span class="string">"#endText p"</span>).text();</span><br><span class="line">        news.setContent(content);</span><br><span class="line">        <span class="comment">//获取editor</span></span><br><span class="line">        String editor = document.select(<span class="string">".ep-editor"</span>).text();</span><br><span class="line">        editor = editor.substring(editor.indexOf(<span class="string">"："</span>) + <span class="number">1</span>, editor.indexOf(<span class="string">"_"</span>));</span><br><span class="line">        news.setEditor(editor);</span><br><span class="line">        <span class="comment">//获取id</span></span><br><span class="line">        <span class="keyword">long</span> id = idWorker.nextId();</span><br><span class="line">        news.setId(id + <span class="string">""</span>);</span><br><span class="line">        <span class="comment">//设置docurl</span></span><br><span class="line">        news.setDocurl(docUrl);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回news</span></span><br><span class="line">        <span class="keyword">return</span> news;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分布式爬虫开发"><a href="#分布式爬虫开发" class="headerlink" title="分布式爬虫开发"></a>分布式爬虫开发</h2><h3 id="1-什么是分布式-分布式和集群的区别"><a href="#1-什么是分布式-分布式和集群的区别" class="headerlink" title="1. 什么是分布式, 分布式和集群的区别"></a>1. 什么是分布式, 分布式和集群的区别</h3><ul>
<li>分布式:  分布式指的就是某一个模块, 或者某个系统, 拆分成不同的业务,并进行分开部署, </li>
<li>集群:     集群更多强调的是将相同的模块或者是系统, 重复部署多次</li>
</ul>
<p>一般来说, 在大多数的情况下, 集群和分布式是同时存在, 共同作用于整个项目</p>
<ul>
<li><p>通俗描述:</p>
<ul>
<li><p>小饭店原来只有一个厨师，切菜洗菜备料炒菜全干。</p>
<p>后来客人多了，厨房一个厨师忙不过来，又请了个厨师，两个厨师都能炒一样的菜，这两个厨师的关系是集群。</p>
<p>为了让厨师专心炒菜，把菜做到极致，又请了个配菜师负责切菜，备菜，备料，厨师和配菜师的关系是分布式。</p>
<p>一个配菜师也忙不过来了，又请了个配菜师，两个配菜师关系是集群。</p>
</li>
</ul>
</li>
<li><p>从刚才的案例中, 请分析出, 集群和分布式能解决什么样的问题?</p>
<ul>
<li>1) 主要解决单节点压力过大  </li>
<li>2) 提高代码的复用性 :   </li>
<li>3) 降低模块间或者各个子系统的耦合性</li>
</ul>
</li>
</ul>
<p>缺点:  提高开发难度</p>
<h3 id="2-进行分布式爬虫编写"><a href="#2-进行分布式爬虫编写" class="headerlink" title="2. 进行分布式爬虫编写"></a>2. 进行分布式爬虫编写</h3><h4 id="2-1-为什么要进行分布式爬虫的改写"><a href="#2-1-为什么要进行分布式爬虫的改写" class="headerlink" title="2.1 为什么要进行分布式爬虫的改写"></a>2.1 为什么要进行分布式爬虫的改写</h4><p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1538301333207.png" alt="1538301333207"></p>
<ul>
<li>主要是由于程序的执行效率过低, 可以进行优化提升 </li>
</ul>
<blockquote>
<p>1) 专门用来获取163新闻详情页url程序</p>
<p>2) 专门用来解析163新闻详情页的程序  </p>
<p>3) 专门用来保存数据的程序  (公共的程序)</p>
<p>4) 专门用来获取腾讯新闻数据的程序</p>
</blockquote>
<h4 id="2-2-分布式爬虫的架构"><a href="#2-2-分布式爬虫的架构" class="headerlink" title="2.2 分布式爬虫的架构"></a>2.2 分布式爬虫的架构</h4><p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1538573149803.png" alt="1538573149803"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1) 用来执行去重的公共的key:  set</span><br><span class="line">		bigData:spider:docurl  </span><br><span class="line">2) 用来保存详情页docurl的key:  list</span><br><span class="line">		bigData:spider:163itemUrl:docurl</span><br><span class="line">3) 用来保存news对象key :  list</span><br><span class="line">		bigData:spider:newsJson</span><br></pre></td></tr></table></figure>

<h4 id="2-3-分布式爬虫开发"><a href="#2-3-分布式爬虫开发" class="headerlink" title="2.3 分布式爬虫开发:"></a>2.3 分布式爬虫开发:</h4><h5 id="2-3-1-163分布式爬虫改进"><a href="#2-3-1-163分布式爬虫改进" class="headerlink" title="2.3.1 163分布式爬虫改进"></a>2.3.1 163分布式爬虫改进</h5><blockquote>
<p>说明: 163爬虫一共要拆分成三个子工程, 目前将第一个工程命名为News163Master 第二个工程命名为 News163Slave  第三个工程命名为 PublicDaoNode</p>
</blockquote>
<ul>
<li>1) News163Master  开发</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//需求:  获取详情页的url</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1)  确定首页url 2) 发送请求, 获取数据 3) 解析数据 4) 去重判断  5) 将docurl保存到redis中 6) 获取下一页</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">News163Master</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 确定首页url:</span></span><br><span class="line">        List&lt;String&gt; urlList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        urlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_index.js?callback=data_callback"</span>);</span><br><span class="line">        urlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_star.js?callback=data_callback"</span>);</span><br><span class="line">        urlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_movie.js?callback=data_callback"</span>);</span><br><span class="line">        urlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_tv.js?callback=data_callback"</span>);</span><br><span class="line">        urlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_show.js?callback=data_callback"</span>);</span><br><span class="line">        urlList.add(<span class="string">"https://ent.163.com/special/000380VU/newsdata_music.js?callback=data_callback"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 分页获取数据</span></span><br><span class="line">        <span class="keyword">while</span>(!urlList.isEmpty()) &#123;</span><br><span class="line">            String indexUrl = urlList.remove(<span class="number">0</span>);</span><br><span class="line">            System.out.println(<span class="string">"获取了下一个栏目的数据#######################################"</span> );</span><br><span class="line">            page(indexUrl);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行分页的方法</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">page</span><span class="params">(String indexUrl)</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        String page = <span class="string">"02"</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//1. 发送请求获取数据</span></span><br><span class="line">            <span class="comment">// 此处获取的json的数据, 并不是一个非标准的json</span></span><br><span class="line"></span><br><span class="line">            String jsonStr = HttpClientUtils.doGet(indexUrl);</span><br><span class="line">            <span class="keyword">if</span>(jsonStr==<span class="keyword">null</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">"数据获取完成"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 转换为标准json方法</span></span><br><span class="line">            jsonStr = splitJson(jsonStr);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2. 解析数据, 3 保存数据</span></span><br><span class="line">            parseJson(jsonStr);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4. 获取下一页的url</span></span><br><span class="line">            <span class="keyword">if</span>(indexUrl.contains(<span class="string">"newsdata_index"</span>))&#123;</span><br><span class="line">                indexUrl = <span class="string">"https://ent.163.com/special/000380VU/newsdata_index_"</span> + page + <span class="string">".js?callback=data_callback"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(indexUrl.contains(<span class="string">"newsdata_star"</span>))&#123;</span><br><span class="line">                indexUrl = <span class="string">"https://ent.163.com/special/000380VU/newsdata_star_"</span> + page + <span class="string">".js?callback=data_callback"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(indexUrl.contains(<span class="string">"newsdata_movie"</span>))&#123;</span><br><span class="line">                indexUrl = <span class="string">"https://ent.163.com/special/000380VU/newsdata_movie_"</span> + page + <span class="string">".js?callback=data_callback"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(indexUrl.contains(<span class="string">"newsdata_tv"</span>))&#123;</span><br><span class="line">                indexUrl = <span class="string">"https://ent.163.com/special/000380VU/newsdata_tv_"</span> + page + <span class="string">".js?callback=data_callback"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(indexUrl.contains(<span class="string">"newsdata_show"</span>))&#123;</span><br><span class="line">                indexUrl = <span class="string">"https://ent.163.com/special/000380VU/newsdata_show_"</span> + page + <span class="string">".js?callback=data_callback"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(indexUrl.contains(<span class="string">"newsdata_music"</span>))&#123;</span><br><span class="line">                indexUrl = <span class="string">"https://ent.163.com/special/000380VU/newsdata_music_"</span> + page + <span class="string">".js?callback=data_callback"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            System.out.println(indexUrl);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5. page ++</span></span><br><span class="line">            <span class="keyword">int</span> pageNum = Integer.parseInt(page);</span><br><span class="line">            pageNum++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(pageNum &lt;<span class="number">10</span>)&#123;</span><br><span class="line">                page = <span class="string">"0"</span>+pageNum;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                page = pageNum+<span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析json的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseJson</span><span class="params">(String jsonStr)</span>  <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">//3.1 将json字符串转换成 指定的对象</span></span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line"></span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; newsList = gson.fromJson(jsonStr, List.class);</span><br><span class="line">        <span class="comment">// 3.2 遍历整个新闻的结合, 获取每一个新闻的对象</span></span><br><span class="line">        <span class="keyword">for</span> (Map&lt;String, Object&gt; newsObj : newsList) &#123;</span><br><span class="line">            <span class="comment">// 新闻 :  标题, 时间,来源 , 内容 , 新闻编辑  ,  新闻的url</span></span><br><span class="line">            <span class="comment">//3.2.1 获取新闻的url , 需要根据url, 获取详情页中新闻数据</span></span><br><span class="line">            String docUrl = (String) newsObj.get(<span class="string">"docurl"</span>);</span><br><span class="line">            <span class="comment">// 过滤掉一些不是新闻数据的url</span></span><br><span class="line">            <span class="keyword">if</span>(docUrl.contains(<span class="string">"photoview"</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(docUrl.contains(<span class="string">"v.163.com"</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(docUrl.contains(<span class="string">"c.m.163.com"</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(docUrl.contains(<span class="string">"dy.163.com"</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ###################去重处理代码######################</span></span><br><span class="line">            Jedis jedis = JedisUtils.getJedis();</span><br><span class="line">            Boolean flag = jedis.sismember(<span class="string">"bigData:spider:docurl"</span>, docUrl);</span><br><span class="line">            jedis.close();<span class="comment">//一定一定一定不要忘记关闭, 否则用着用着没了, 导致程序卡死不动</span></span><br><span class="line">            <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                <span class="comment">// 代表存在, 表示已经爬取过了</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ###################去重处理代码######################</span></span><br><span class="line">            <span class="comment">// 将docurl存储到redis的list集合中</span></span><br><span class="line">            jedis = JedisUtils.getJedis();</span><br><span class="line">            jedis.lpush(<span class="string">"bigData:spider:163itemUrl:docurl"</span>,docUrl);</span><br><span class="line">            jedis.close();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将非标准的json转换为标准的json字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">splitJson</span><span class="params">(String jsonStr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> firstIndex = jsonStr.indexOf(<span class="string">"("</span>);</span><br><span class="line">        <span class="keyword">int</span> lastIndex = jsonStr.lastIndexOf(<span class="string">")"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> jsonStr.substring(firstIndex + <span class="number">1</span>, lastIndex);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>2) News163Slave  开发</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 需求 :  解析新闻详情页的数据</span></span><br><span class="line"><span class="comment">// 步骤:  1) 从redis中获取docurl  2) 根据url解析商品的详情页 3) 封装成news对象  4) 将news对象转换为json数据</span></span><br><span class="line"><span class="comment">//          5) 将newsJson存储到redis的list中  6) 循环</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">News163Slave</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> IdWorker idWorker  = <span class="keyword">new</span> IdWorker(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//1.从redis中获取docurl</span></span><br><span class="line">            Jedis jedis = JedisUtils.getJedis();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//String docurl = jedis.rpop("bigData:spider:163itemUrl:docurl");  // 取不到的时候出来</span></span><br><span class="line">            <span class="comment">//  第一个参数: 阻塞的时间   如果list中没有数据了, 就会进行阻塞, 最多阻塞20s. 如果在23s之内有数据进来, 马上解除阻塞</span></span><br><span class="line">            <span class="comment">// 返回值:  list    在这个list中只会有两个元素, 第一个元素为key值  第二个元素为弹出的元素</span></span><br><span class="line">            List&lt;String&gt; list = jedis.brpop(<span class="number">20</span>, <span class="string">"bigData:spider:163itemUrl:docurl"</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">if</span>(list == <span class="keyword">null</span> || list.size()==<span class="number">0</span> )&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String docurl = list.get(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//2. 根据url解析商品的详情页 封装成news对象</span></span><br><span class="line">            News news = parseNewsItem(docurl);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3. 将news对象转换为json数据</span></span><br><span class="line">            Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">            String newsJson = gson.toJson(news);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4. 将newsJson存储到redis中</span></span><br><span class="line">            jedis = JedisUtils.getJedis();</span><br><span class="line">            jedis.lpush(<span class="string">"bigData:spider:newsJson"</span>, newsJson);</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据url 解析新闻详情页:</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> News <span class="title">parseNewsItem</span><span class="params">(String docUrl)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(docUrl);</span><br><span class="line">        <span class="comment">//  3.3.1 发送请求, 获取新闻详情页数据</span></span><br><span class="line">        String html = HttpClientUtils.doGet(docUrl);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.3.2 解析新闻详情页:</span></span><br><span class="line">        Document document = Jsoup.parse(html);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.3.2.1 :  解析新闻的标题:</span></span><br><span class="line">        News news = <span class="keyword">new</span> News();</span><br><span class="line">        Elements h1El = document.select(<span class="string">"#epContentLeft h1"</span>);</span><br><span class="line">        String title = h1El.text();</span><br><span class="line">        news.setTitle(title);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.3.2.2 :  解析新闻的时间:</span></span><br><span class="line">        Elements timeAndSourceEl = document.select(<span class="string">".post_time_source"</span>);</span><br><span class="line"></span><br><span class="line">        String timeAndSource = timeAndSourceEl.text();</span><br><span class="line"></span><br><span class="line">        String[] split = timeAndSource.split(<span class="string">"　来源: "</span>);<span class="comment">// 请各位一定一定一定要复制, 否则会切割失败</span></span><br><span class="line">        news.setTime(split[<span class="number">0</span>]);</span><br><span class="line">        <span class="comment">//3.3.2.3 :  解析新闻的来源:</span></span><br><span class="line">        news.setSource(split[<span class="number">1</span>]);</span><br><span class="line">        <span class="comment">//3.3.2.4 :  解析新闻的正文:</span></span><br><span class="line">        Elements ps = document.select(<span class="string">"#endText p"</span>);</span><br><span class="line">        String content = ps.text();</span><br><span class="line">        news.setContent(content);</span><br><span class="line">        <span class="comment">//3.3.2.5 :  解析新闻的编辑:</span></span><br><span class="line">        Elements spanEl = document.select(<span class="string">".ep-editor"</span>);</span><br><span class="line">        <span class="comment">// 责任编辑：陈少杰_b6952</span></span><br><span class="line">        String editor = spanEl.text();</span><br><span class="line">        <span class="comment">// 一定要接收返回值, 否则白写了</span></span><br><span class="line">        editor = editor.substring(editor.indexOf(<span class="string">"："</span>) + <span class="number">1</span>, editor.lastIndexOf(<span class="string">"_"</span>));</span><br><span class="line">        news.setEditor(editor);</span><br><span class="line">        <span class="comment">//3.3.2.6 :  解析新闻的url:</span></span><br><span class="line">        news.setDocurl(docUrl);</span><br><span class="line">        <span class="comment">//3.3.2.7: id</span></span><br><span class="line">        <span class="keyword">long</span> id = idWorker.nextId();</span><br><span class="line">        news.setId(id + <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> news;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>3) PublicDaoNode 开发</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 需求 : 公共的保存数据库的程序:</span></span><br><span class="line"><span class="comment">// 步骤:  1) 从redis中获取newsJson数据   2) 将newsJson转换成news对象  3) 去重判断  4) 保存数据</span></span><br><span class="line"><span class="comment">//       5) 将docurl存储到redis的去重的set集合中   6) 循环</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PublicDaoNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> NewsDao newsDao = <span class="keyword">new</span> NewsDao();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//1) 从redis中获取newsJson数据</span></span><br><span class="line">            Jedis jedis = JedisUtils.getJedis();</span><br><span class="line">            List&lt;String&gt; list = jedis.brpop(<span class="number">20</span>, <span class="string">"bigData:spider:newsJson"</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">if</span> (list == <span class="keyword">null</span> || list.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String newsJson = list.get(<span class="number">1</span>);</span><br><span class="line">            System.out.println(newsJson);</span><br><span class="line">            <span class="comment">//2. 将newsJson转换成news对象</span></span><br><span class="line">            Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">            News news = gson.fromJson(newsJson, News.class);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3) 去重判断</span></span><br><span class="line">            jedis = JedisUtils.getJedis();</span><br><span class="line">            Boolean flag = jedis.sismember(<span class="string">"bigData:spider:docurl"</span>, news.getDocurl());</span><br><span class="line">            jedis.close();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//4) 保存数据</span></span><br><span class="line"></span><br><span class="line">            newsDao.saveNews(news);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5)  将docurl存储到redis的去重的set集合中</span></span><br><span class="line">            jedis = JedisUtils.getJedis();</span><br><span class="line">            jedis.sadd(<span class="string">"bigData:spider:docurl"</span>, news.getDocurl());</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-2-2-腾讯娱乐分布式爬虫改进"><a href="#2-2-2-2-腾讯娱乐分布式爬虫改进" class="headerlink" title="2.2.2.2 腾讯娱乐分布式爬虫改进"></a>2.2.2.2 腾讯娱乐分布式爬虫改进</h5><blockquote>
<p>说明: 腾讯娱乐爬虫需要拆分成二个子工程, 一个子工程用于获取数据,封装news对象, 一个公共的子工程用于保存数据, 其中公共的已经开发完毕, 只需要拆分另一个子工程名为NewsTencentMaster即可</p>
</blockquote>
<ul>
<li>1) NewsTencentMaster 开发</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 需求 :  解析数据, 封装成news对象, 将news对象保存到redis中</span></span><br><span class="line"><span class="comment">//  1) 确定首页url  2) 发送请求, 获取数据  3) 解析数据 4)  去重判断  5) 封装news对象  6) 将news对象转换为newsJson</span></span><br><span class="line"><span class="comment">//  7) 将newsJson保存到Redis中   8) 分页获取</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsTencentMaster</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> IdWorker idWorker = <span class="keyword">new</span> IdWorker(<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1. 确定首页url</span></span><br><span class="line">        String topNewsUrl = <span class="string">"https://pacaio.match.qq.com/irs/rcd?cid=137&amp;token=d0f13d594edfc180f5bf6b845456f3ea&amp;ext=ent&amp;num=60"</span>;</span><br><span class="line">        String noTopNewsUrl = <span class="string">"https://pacaio.match.qq.com/irs/rcd?cid=146&amp;token=49cbb2154853ef1a74ff4e53723372ce&amp;ext=ent&amp;page=0"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 执行分页:</span></span><br><span class="line">        page(topNewsUrl, noTopNewsUrl);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行分页的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">page</span><span class="params">(String topNewsUrl, String noTopNewsUrl)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1. 热点新闻数据的获取:  只有一页数据</span></span><br><span class="line">        <span class="comment">//1.1 发送请求, 获取数据</span></span><br><span class="line">        String topNewsJsonStr = HttpClientUtils.doGet(topNewsUrl);</span><br><span class="line">        <span class="comment">//1.2 解析数据</span></span><br><span class="line">        List&lt;News&gt; topNewsList = parseJson(topNewsJsonStr);</span><br><span class="line">        <span class="comment">//1.3 保存数据</span></span><br><span class="line">        saveNews(topNewsList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 处理非热点数据</span></span><br><span class="line">        <span class="keyword">int</span> page = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.1 发送请求, 获取数据</span></span><br><span class="line">            String noTopNewsJsonStr = HttpClientUtils.doGet(noTopNewsUrl);</span><br><span class="line">            <span class="comment">//2.2 解析数据</span></span><br><span class="line">            List&lt;News&gt; noTopNewsList = parseJson(noTopNewsJsonStr);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (noTopNewsList == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2.3 保存数据</span></span><br><span class="line">            saveNews(noTopNewsList);</span><br><span class="line">            <span class="comment">//2.4 获取下一页url</span></span><br><span class="line">            noTopNewsUrl = <span class="string">"https://pacaio.match.qq.com/irs/rcd?cid=146&amp;token=49cbb2154853ef1a74ff4e53723372ce&amp;ext=ent&amp;page="</span> + page;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.5 自增 +1</span></span><br><span class="line">            page++;</span><br><span class="line"></span><br><span class="line">            System.out.println(page);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存数据的操作 : 腾讯返回数据的时候, 就会有重复的数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveNews</span><span class="params">(List&lt;News&gt; newsList)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = JedisUtils.getJedis();</span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        <span class="keyword">for</span> (News news : newsList) &#123;</span><br><span class="line">            <span class="comment">// 需要将news对象转换为newsJson</span></span><br><span class="line">            String newsJson = gson.toJson(news);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将newsJson存储到redis的list集合中</span></span><br><span class="line">            jedis.lpush(<span class="string">"bigData:spider:newsJson"</span>,newsJson);</span><br><span class="line">        &#125;</span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  解析新闻数据</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;News&gt; <span class="title">parseJson</span><span class="params">(String newsJsonStr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//3.1 将字符串json数据转换为指定的类型:   map</span></span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        Map&lt;String, Object&gt; map = gson.fromJson(newsJsonStr, Map.class);</span><br><span class="line">        <span class="comment">//获取一下, 本次获取了多少条数据</span></span><br><span class="line">        Double datanum = (Double) map.get(<span class="string">"datanum"</span>);</span><br><span class="line">        <span class="keyword">if</span> (datanum.intValue() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.2  获取data中数据 : 列表页中数据</span></span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; newsList = (List&lt;Map&lt;String, Object&gt;&gt;) map.get(<span class="string">"data"</span>);</span><br><span class="line">        <span class="comment">//3.3 遍历这个列表, 获取每一个新闻的数据</span></span><br><span class="line">        List&lt;News&gt; tencentNewList = <span class="keyword">new</span> ArrayList&lt;News&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map&lt;String, Object&gt; newsMap : newsList) &#123;</span><br><span class="line">            String docurl = (String) newsMap.get(<span class="string">"vurl"</span>);</span><br><span class="line">            <span class="keyword">if</span> (docurl.contains(<span class="string">"video"</span>)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//######################去重处理############################33</span></span><br><span class="line">            Jedis jedis = JedisUtils.getJedis();</span><br><span class="line">            Boolean flag = jedis.sismember(<span class="string">"bigData:spider:docurl"</span>, docurl);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                <span class="comment">// 如果为true, 表示已经存在, 已经爬取过了</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//######################去重处理############################33</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.3.1 封装news对象</span></span><br><span class="line">            News news = <span class="keyword">new</span> News();</span><br><span class="line"></span><br><span class="line">            news.setTitle((String) newsMap.get(<span class="string">"title"</span>));</span><br><span class="line">            news.setTime((String) newsMap.get(<span class="string">"update_time"</span>));</span><br><span class="line">            news.setSource((String) newsMap.get(<span class="string">"source"</span>));</span><br><span class="line">            news.setContent((String) newsMap.get(<span class="string">"intro"</span>));</span><br><span class="line">            news.setEditor((String) newsMap.get(<span class="string">"source"</span>));</span><br><span class="line">            news.setDocurl(docurl);</span><br><span class="line"></span><br><span class="line">            news.setId(idWorker.nextId() + <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">            tencentNewList.add(news);</span><br><span class="line"></span><br><span class="line">            System.out.println(docurl);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tencentNewList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: 开发完成以后., 一定要进行测试:如果能够在本地全部跑通, 才可以进行部署, 否则不要进行部署</p>
</blockquote>
<ul>
<li>测试:<ul>
<li>1) 清空数据: redis  和 mysql</li>
<li>2) 修改一个dao连接内容(修改本地连接)</li>
<li>3) 分别启动四个程序即可: 可以不分先后顺序</li>
</ul>
</li>
</ul>
<h3 id="3-进行分布式爬虫的部署"><a href="#3-进行分布式爬虫的部署" class="headerlink" title="3. 进行分布式爬虫的部署"></a>3. 进行分布式爬虫的部署</h3><h4 id="3-1-部署方案"><a href="#3-1-部署方案" class="headerlink" title="3.1 部署方案"></a>3.1 部署方案</h4><blockquote>
<p>说明: 目前一共有四个子项目, 其中二个master各占用一台虚拟机, 其中一个用来解析新闻详情页, 可以部署一个两台的集群, 其中一个用来保存数据的, 可以部署三台,构建一个集群, 一共为七台, 外加一台mysql和一台redis, 共需要九台服务器</p>
</blockquote>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1538574257790.png" alt="1538574257790"></p>
<ul>
<li>本次仅仅是模拟部署, 故采用三台服务器来模拟九台服务器:(实际中真实的九台服务器)<ul>
<li>1) 三台服务器都可以上网, 并都安装有jdk1.8以上</li>
<li>2) 三台服务器的防火墙均已关闭(实际中开放端口号)</li>
<li>3) 其中有一台需要安装 MySQL  其中一台安装 Redis,并均已正常开启,mysql必须开启远程登录</li>
</ul>
</li>
</ul>
<h4 id="3-2-部署准备工作"><a href="#3-2-部署准备工作" class="headerlink" title="3.2 部署准备工作"></a>3.2 部署准备工作</h4><ul>
<li><p>1) 检测linux环境:</p>
<ul>
<li>1.1) 使用 ping 命令检测三台是否可以联网,并都安装有jdk1.8<ul>
<li>注意:  Windows电脑上的jdk  和 linux上的jdk需要保持一致</li>
</ul>
</li>
<li>1.2) 使用 service iptables status 查看是否关闭防火墙</li>
<li>1.3) 检测MySQL:<ul>
<li>1.3.1) 在linux中能否正常连接mysql</li>
<li>1.3.2) 在sqlyog中远程连接mysql是否正常</li>
<li>1.3.3) linux和sqlyog连接MySQL的密码需要保持一致, 以免出现存储不进去的问题</li>
</ul>
</li>
<li>1.4)  使用 ps -ef | grep redis  检测redis是否正常启动</li>
</ul>
</li>
<li><p>将项目进行打包:一共有四个子项目, 共需要打包四个jar</p>
<ul>
<li>0) 修改NewsDao中连接数据库相关设置</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1544080592257.png" alt="1544080592257"></p>
</li>
</ul>
<ul>
<li>1) 添加打包插件:</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--这是jdk编译的插件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--打包的插件--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">manifest</span>&gt;</span> <span class="comment">&lt;!-- 注意 此为设置程序的主入口--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.cyannote.jdSpider.JdSlave<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>2) 修改打包插件中的主入口:</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1538574857793.png" alt="1538574857793"></p>
</li>
<li><p>3) 将项目进行编译</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1538574959362.png" alt="1538574959362"></p>
</li>
<li><p>4) 进行打包操作:</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1538575008618.png" alt="1538575008618"></p>
</li>
<li><p>5) 打包成功后, 会在打包过程中提示打包的位置</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1538575060321.png" alt="1538575060321"></p>
</li>
<li><p>6) 打开此位置, 查看此jar包中主入口是否是刚才是设置的主入口类</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1538575219745.png" alt="1538575219745"></p>
</li>
<li><p>7) 将其进行更该成对应的jar包的名称后, 放置一个适当的位置等待上传</p>
</li>
<li><p>8) 重复执行以上2~ 7 步, 将四个jar包都要打包出来</p>
<ul>
<li><strong>特别注意: 不要忘记修改主入口类(程序的入口)和 打包前进行编译</strong></li>
</ul>
</li>
</ul>
<p>注意: 需要单独对163slave程序再次进行打包操作. 在导包的时候, 需要修改idwork中编号,否则在部署的时候, 会出现id冲突的问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为, IDwork如果编号都一致了, 那么在同一时刻产生的id值是一样的</span><br></pre></td></tr></table></figure>

<h4 id="3-3-进行分布式部署"><a href="#3-3-进行分布式部署" class="headerlink" title="3.3 进行分布式部署"></a>3.3 进行分布式部署</h4><ul>
<li>注意, 在开启这三个服务器连接窗口的时候, 一定要三个一起开</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day05_spider_%E9%83%A8%E7%BD%B2/%E7%AC%94%E8%AE%B0/assets/1544081473781.png" alt="1544081473781"></p>
<blockquote>
<p>使用三台虚拟机模拟9台服务器, 其本质上就是使用xshell 或者 CRT 将三台虚拟机的连接窗口开启各开启三次即可, 然后自己进行分配, 那一台是MySQL, 那一台是Redis, 那一台是master….</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">统一jar包上传至 ; /export/servers/spider 目录下</span><br><span class="line"></span><br><span class="line">mkdir -p /export/servers/spider</span><br><span class="line">rm -rf /export/servers/spider/*</span><br><span class="line">cd /export/servers/spider</span><br></pre></td></tr></table></figure>

<ul>
<li>1) 将对应的jar包上传到 服务器中, 推荐使用 rz进行上传<ul>
<li>将jar包上传至每个服务器的: /export/servers/spider</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1) 安装 rz 命令:</span><br><span class="line">	安装命令:  yum -y install lrzsz</span><br><span class="line">2) 上传命令:  rz</span><br><span class="line">注意: 上传的位置和输入rz命令的位置是一样的</span><br></pre></td></tr></table></figure>

<ul>
<li>2) 启动各个jar包即可: 推荐先启动获取数据的集群, 后启动 解析数据的集群, 最后启动两个master</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">启动命令:  java -jar  xxx.jar</span><br></pre></td></tr></table></figure>

<hr>
<p>将爬虫设置为定时执行获取数据的操作:  目前采用的shell脚本的方式来操作</p>
<p>需求: 每二十分钟执行一次爬虫程序, 用于爬取最新的新闻信息</p>
<p>实现步骤:</p>
<ul>
<li>1) 更改hosts文件(此步骤需要在每一个centos中配置)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line"></span><br><span class="line">修改如下内容:</span><br><span class="line">192.168.72.141  node01</span><br><span class="line">192.168.72.142  node02</span><br><span class="line">192.168.72.143  node03</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">三台服务器必须要配置免密登录</span><br></pre></td></tr></table></figure>

<ul>
<li><p>2) 编写shell脚本:</p>
<blockquote>
<p>注意:  在进行修改shell脚本的时候, 一定要明确, 那台机子上部署了什么jar包</p>
</blockquote>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vi startSpider.sh</span><br><span class="line">i</span><br><span class="line"><span class="meta">#</span>脚本内容:  以下脚本为示例内容, 只提供大体逻辑, 根据实际进行局部修改</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>!/bin/sh</span><br><span class="line">echo "开始执行"</span><br><span class="line"></span><br><span class="line">for host in node01 node02 node03</span><br><span class="line">do</span><br><span class="line">   ssh -q $host "source /etc/profile; nohup java -jar /export/servers/spider/PublicDaoNode.jar &gt;&gt;/dev/daoLog.log 2&gt;&amp;1 &amp;"</span><br><span class="line">   if [ $host == node01 ]</span><br><span class="line">        then</span><br><span class="line">   ssh -q $host "source /etc/profile; nohup java -jar /export/servers/spider/News163Slave.jar &gt;&gt;/dev/163Slave.log 2&gt;&amp;1 &amp;"</span><br><span class="line">   fi</span><br><span class="line">   if [ $host == node02 ]</span><br><span class="line">        then</span><br><span class="line">   ssh -q $host "source /etc/profile; nohup java -jar /export/servers/spider/News163Slave.jar &gt;&gt;/dev/163Slave.log 2&gt;&amp;1 &amp;"</span><br><span class="line">   fi</span><br><span class="line">   if [ $host == node03 ]</span><br><span class="line">        then</span><br><span class="line">   ssh -q $host "source /etc/profile; nohup java -jar /export/servers/spider/News163Master.jar &gt;&gt;/dev/163Master.log 2&gt;&amp;1 &amp;"</span><br><span class="line">   ssh -q $host "source /etc/profile; nohup java -jar /export/servers/spider/NewsTencentMaster.jar &gt;&gt;/dev/tencent.log 2&gt;&amp;1 &amp;"</span><br><span class="line">   fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo "结束了"</span><br></pre></td></tr></table></figure>

<ul>
<li>3) 编写定时任务: 推荐定时任务和当前shell脚本在同一台虚拟机中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">crontab -e          // 设置定时, 输入完成后会自动进入一个设置文档中</span><br><span class="line">输入 i  进入编辑模式</span><br><span class="line">*/10 * * * * sh /export/servers/spider/startSpider.sh     // 表示每隔10分钟执行一次 启动爬虫的脚本</span><br><span class="line">输入 esc 退出命令行模式, 输入 :wq  保存退出即可</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1541345656514.png" alt></p>
<p><strong>必须修改脚本文件的权限,否则会出现无法启动脚本的情况.</strong></p>
<h3 id="4-使用代理ip"><a href="#4-使用代理ip" class="headerlink" title="4. 使用代理ip"></a>4. 使用代理ip</h3><p><a href="http://hc.apache.org/httpcomponents-client-4.5.x/tutorial/html/connmgmt.html#d5e485" target="_blank" rel="noopener">http://hc.apache.org/httpcomponents-client-4.5.x/tutorial/html/connmgmt.html#d5e485</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HttpHost proxy = <span class="keyword">new</span> HttpHost(<span class="string">"someproxy"</span>, <span class="number">8080</span>);</span><br><span class="line">DefaultProxyRoutePlanner routePlanner = <span class="keyword">new</span> DefaultProxyRoutePlanner(proxy);</span><br><span class="line">CloseableHttpClient httpclient = HttpClients.custom()</span><br><span class="line">        .setRoutePlanner(routePlanner)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<h4 id="5-3-1-集成在代码中"><a href="#5-3-1-集成在代码中" class="headerlink" title="5.3.1 集成在代码中"></a>5.3.1 集成在代码中</h4><ul>
<li>将代理的ip存放到redis中，存储类型list。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInitIP</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Jedis conn = JedisUtil.getConn();</span><br><span class="line">		BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(</span><br><span class="line">				<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(<span class="string">"C:\\Users\\maoxiangyi\\Desktop\\Proxies2018-06-06.txt"</span>)));</span><br><span class="line">		String line = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">while</span> ((line=bufferedReader.readLine())!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			conn.lpush(<span class="string">"spider:ip"</span>, line);</span><br><span class="line">		&#125;</span><br><span class="line">		bufferedReader.close();</span><br><span class="line">		conn.close();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>重构后的httpclient</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">execute</span><span class="params">(HttpRequestBase request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	RequestConfig requestConfig = RequestConfig.custom().setConnectTimeout(<span class="number">5000</span>)<span class="comment">// 设置创建连接的最长时间</span></span><br><span class="line">			.setConnectionRequestTimeout(<span class="number">5000</span>)<span class="comment">// 设置获取连接的最长时间</span></span><br><span class="line">			.setSocketTimeout(<span class="number">10</span> * <span class="number">1000</span>)<span class="comment">// 设置数据传输的最长时间</span></span><br><span class="line">			.build();</span><br><span class="line">	request.setConfig(requestConfig);</span><br><span class="line"></span><br><span class="line">	String html = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 从redis中获取代理IP</span></span><br><span class="line">	Jedis conn = JedisUtil.getConn();</span><br><span class="line">	<span class="comment">// 从右边弹出一个元素之后，从新放回左边</span></span><br><span class="line">	List&lt;String&gt; ipkv = conn.brpop(<span class="number">0</span>, <span class="string">"spider:ip"</span>);</span><br><span class="line">	<span class="comment">// CloseableHttpClient httpClient = getHttpClient();</span></span><br><span class="line">	CloseableHttpClient httpClient = getProxyHttpClient(ipkv.get(<span class="number">1</span>));</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		CloseableHttpResponse res = httpClient.execute(request);</span><br><span class="line">		<span class="keyword">if</span> (<span class="number">200</span> == res.getStatusLine().getStatusCode()) &#123;</span><br><span class="line">			html = EntityUtils.toString(res.getEntity(), Charset.forName(<span class="string">"utf-8"</span>));</span><br><span class="line">			<span class="comment">//请求成功之后，将代理IP放回去，下次继续使用</span></span><br><span class="line">			conn.lpush(<span class="string">"spider:ip"</span>, ipkv.get(<span class="number">1</span>));</span><br><span class="line">			conn.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		System.out.println(<span class="string">"请求失败"</span>);</span><br><span class="line">		<span class="comment">// TODO 需要开发自动重试功能</span></span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> html;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> PoolingHttpClientConnectionManager cm;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> CloseableHttpClient <span class="title">getProxyHttpClient</span><span class="params">(String ipkv)</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line">	String[] vals = ipkv.split(<span class="string">":"</span>);</span><br><span class="line">	System.out.println(vals);</span><br><span class="line">	HttpHost proxy = <span class="keyword">new</span> HttpHost(vals[<span class="number">0</span>], Integer.parseInt(vals[<span class="number">1</span>]));</span><br><span class="line">	DefaultProxyRoutePlanner routePlanner = <span class="keyword">new</span> DefaultProxyRoutePlanner(proxy);</span><br><span class="line">	<span class="keyword">return</span> HttpClients.custom().setConnectionManager(connectionManager).setRoutePlanner(routePlanner).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/娱乐头条-1/" data-id="cjycojohk000dwo7kf54t50js" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-在Linux-上安装JDK" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/在Linux-上安装JDK/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:08:51.403Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/在Linux-上安装JDK/">在linux安装JDk</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="在Linux-上安装JDK"><a href="#在Linux-上安装JDK" class="headerlink" title="在Linux 上安装JDK"></a>在Linux 上安装JDK</h1><h3 id="【步骤一】：上传或下载JDK到Linux的服务器"><a href="#【步骤一】：上传或下载JDK到Linux的服务器" class="headerlink" title="【步骤一】：上传或下载JDK到Linux的服务器:"></a>【步骤一】：上传或下载JDK到Linux的服务器:</h3><p>* 上传/下载JDK</p>
<p>* 卸载linux自带的open-JDK</p>
<p>​             <strong>查询linux自带的jdk</strong></p>
<p>​                java –version</p>
<p>​                rpm -qa | grep java</p>
<p> <strong>卸载linux自带的jdk</strong></p>
<p>​            rpm -e -nodeps 查询到的java版本号</p>
<p>​                    例如:</p>
<p>​                    rpm -e –nodeps java-1.6.0-openjdk-1.6.0.35-1.13.7.1.el6_6.i686</p>
<p>​                    rpm -e –nodeps java-1.7.0-openjdk-1.7.0.79-2.5.5.4.el6.i686</p>
<h3 id="【步骤二】：在Linux服务器上安装JDK"><a href="#【步骤二】：在Linux服务器上安装JDK" class="headerlink" title="【步骤二】：在Linux服务器上安装JDK"></a>【步骤二】：在Linux服务器上安装JDK</h3><p>* 通常将软件安装到/usr/local</p>
<p>* 直接解压就可以</p>
<pre><code>tar –xvf  jdk.tar.gz  -C (目标路径)</code></pre><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1561106276271.png" alt="1561106276271"></p>
<h3 id="【步骤三】：配置JDK的环境变量"><a href="#【步骤三】：配置JDK的环境变量" class="headerlink" title="【步骤三】：配置JDK的环境变量"></a>【步骤三】：配置JDK的环境变量</h3><p>配置环境变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">① vi /etc/profile</span><br><span class="line"></span><br><span class="line">② 在末尾行添加</span><br><span class="line">	#set java environment</span><br><span class="line">	JAVA_HOME=/usr/local/jdk/jdk1.7.0_71</span><br><span class="line">	CLASSPATH=.:$JAVA_HOME/lib.tools.jar</span><br><span class="line">	PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">	export JAVA_HOME CLASSPATH PATH</span><br><span class="line">保存退出</span><br><span class="line">③source /etc/profile  使更改的配置立即生效</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/在Linux-上安装JDK/" data-id="cjycojogh0004wo7k31w3dlcq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">next &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Hexo</h1>
    <h2 class="blog-subtitle"></h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/source/plugin/img/avatar.jpg">
    <h2 class="author">inverse</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>33</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>0</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/cyannote" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2018 - 2019 inverse<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title class="menuItem">首页</a>
          
            <a href="/tags" title class="menuItem">标签</a>
          
            <a href="/categories" title class="menuItem">分类</a>
          
            <a href="/archives" title class="menuItem">归档</a>
          
            <a href="/xxxxxxxxx" title class="menuItem">xxx</a>
          
            <a href="/xxxxxxx" title class="menuItem">xxxx</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>