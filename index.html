<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://cyannote.github.io.git/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/source/plugin/img/avatar.jpg">
    <h2 class="author">inverse</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>2</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>0</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-文件上传和下载" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/文件上传和下载/" class="article-date">
  <time class="post-time" datetime="2019-06-10T01:07:23.295Z" itemprop="datePublished">
    <span class="post-month">6月</span><br>
    <span class="post-day">10</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/文件上传和下载/">文件上传和下载</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="文件上传和下载"><a href="#文件上传和下载" class="headerlink" title="文件上传和下载"></a>文件上传和下载</h1><h2 id="1-文件上传"><a href="#1-文件上传" class="headerlink" title="1.文件上传"></a>1.文件上传</h2><p>导包:commons-fileupload .jar        commons-io  .jar</p>
<h3 id="1-1文件上传表单的三个要素"><a href="#1-1文件上传表单的三个要素" class="headerlink" title="1.1文件上传表单的三个要素"></a>1.1文件上传表单的三个要素</h3><ol>
<li>表单的提交的方式需要是POST</li>
<li>表单中需要有&lt;input type=”file”素，需要有name属性和值。</li>
<li>表单enctype=”multipart/form-data”</li>
</ol>
<h3 id="1-2文件上传的步骤"><a href="#1-2文件上传的步骤" class="headerlink" title="1.2文件上传的步骤"></a>1.2文件上传的步骤</h3><ol>
<li><p>创建磁盘文件项工厂</p>
<p>DiskFileItemFactory  df = new DiskFileItemFactory();</p>
</li>
<li><p>创建核心文件解析类</p>
<p>ServletFileUpload sf = new ServletFileUpload(df);</p>
</li>
<li><p>解析请求</p>
<p>list<fileitem>  list =  sf.parseRequest(request);</fileitem></p>
</li>
<li><p>遍历集合,判断请求项 for(FileItem f:list)</p>
<ol>
<li><p>若不是普通项 ! f.isFormItem()</p>
<p>获取文件名,  f.getName()</p>
<p>获取文件内容(输入流)f.getInputStream()</p>
<p>创建输出流 getServletContext.getRealPath(“存储路径”) ; OutPutStream os = new fileOutPutStream(realPath+”\“+filename);</p>
<p>IO流写入文件</p>
</li>
<li><p>普通项</p>
<p>获取参数名 f.getFileName()</p>
<p>获取内容 f.getString();//可传入编码格式解决中文乱码问题</p>
</li>
</ol>
</li>
</ol>
<h3 id="1-3-文件上传的Servlet"><a href="#1-3-文件上传的Servlet" class="headerlink" title="1.3 文件上传的Servlet"></a>1.3 文件上传的Servlet</h3><p>//1.创建磁盘文件项工厂DiskFileItemFactory</p>
<p>//创建一个核心的解析类ServletFileUpload</p>
<p>//利用核心类解析Request,解析后会得到多个部分,返回一个list集合 parseRequest</p>
<p>//遍历list集合,得到代表每个部分的文件项的对象.根据文件项判断是否为文件上传项</p>
<p>isFormItem()</p>
<p>文件上传的API</p>
<h3 id="1-4-DiskFileItemFactory-磁盘文件项工厂"><a href="#1-4-DiskFileItemFactory-磁盘文件项工厂" class="headerlink" title="1.4  DiskFileItemFactory:磁盘文件项工厂"></a>1.4  DiskFileItemFactory:磁盘文件项工厂</h3><p>sizeThreshold 设置文件上传的缓冲区大小,默认10kb</p>
<p>Repository 临时文件存放路径</p>
<h3 id="1-5-ServletFileUpload-核心解析类"><a href="#1-5-ServletFileUpload-核心解析类" class="headerlink" title="1.5  ServletFileUpload:核心解析类"></a>1.5  ServletFileUpload:核心解析类</h3><p>FileItemFactory</p>
<p>isMutipartContent:判断恩仇type属性是否为multipart/form-data</p>
<p>parseRequest:解析request对象,返回一个list集合(每个部分的文件对象)</p>
<p>setFileSizeMax:设置单个文件的大小</p>
<p>setSizeMax:设置上传文件的总大小 </p>
<p>setHeaderEncoding :设置中文文件名乱码的问题</p>
<p>setProgressListener:设置监听文件上传的进度</p>
<h3 id="1-6-FileItem"><a href="#1-6-FileItem" class="headerlink" title="1.6  FileItem"></a><strong>1.6  FileItem</strong></h3><p>isFormField:是否为普通项</p>
<p>getFieldName:获得普通项名字</p>
<p>getString:获得普通项内容</p>
<p>getName获得文件上传项名称</p>
<p>getInputStream:获得上传项内容</p>
<h3 id="1-7-getSize获得上传文件大小"><a href="#1-7-getSize获得上传文件大小" class="headerlink" title="1.7  getSize获得上传文件大小"></a>1.7  getSize获得上传文件大小</h3><p>getContentType:获得上传文件格式</p>
<p>delete删除临时文件</p>
<p>//相同文件名文件上传解决办法</p>
<p>UUID.randomUUID().toString().relplace(“-“,””)+fliename.substring(filename.lastIndexOf(“.”));</p>
<p>//同一文件夹文件过多解决</p>
<h3 id="文件上传代码"><a href="#文件上传代码" class="headerlink" title="文件上传代码"></a>文件上传代码</h3><p><strong>downloadServlet</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.OutputStream;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">import org.apache.commons.fileupload.FileItem;</span><br><span class="line">import org.apache.commons.fileupload.FileUploadException;</span><br><span class="line">import org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line">import org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line">import com.itheima.utils.UUIDUtils;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 上传Servlet</span><br><span class="line"> */</span><br><span class="line">public class uploadServlet extends HttpServlet &#123;</span><br><span class="line">	protected void doGet(HttpServletRequest request,</span><br><span class="line">			HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		doPost(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	protected void doPost(HttpServletRequest request,</span><br><span class="line">			HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			// request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">			// 1.创建磁盘文件项工厂</span><br><span class="line">			DiskFileItemFactory fileitemfactory = new DiskFileItemFactory();</span><br><span class="line">			// 设置文件缓冲区大小</span><br><span class="line">			fileitemfactory.setSizeThreshold(1024 * 1024 * 3);</span><br><span class="line">			// 设置临时文件路径</span><br><span class="line">			String path = getServletContext().getRealPath(&quot;/temp&quot;);</span><br><span class="line">			fileitemfactory.setRepository(new File(path));</span><br><span class="line">			// 2.创建核心解析类</span><br><span class="line">			ServletFileUpload si = new ServletFileUpload(fileitemfactory);</span><br><span class="line">			// 解决中文文件名乱码问题</span><br><span class="line">			si.setHeaderEncoding(&quot;UTF-8&quot;);</span><br><span class="line">			// 3.解析请求</span><br><span class="line">			List&lt;FileItem&gt; parseRequest = si.parseRequest(request);</span><br><span class="line">			// 4. 判断文件上传项</span><br><span class="line">            for (FileItem fileItem : parseRequest) &#123;</span><br><span class="line">                if (fileItem.isFormField()) &#123;</span><br><span class="line">                    // 基础项</span><br><span class="line">                    String name = f.getFieldName();</span><br><span class="line">                    // String content = f.getString();</span><br><span class="line">                    // 解决获取普通项内容乱码的问题</span><br><span class="line">                    String content = f.getString(&quot;UTF-8&quot;);</span><br><span class="line">                    System.out.println(name + &quot;---&quot; + content);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // 文件上传项</span><br><span class="line">                    // 获取文件名</span><br><span class="line">                    String filename = fileItem.getName();</span><br><span class="line">                    // 解决文件名重复的问题,UUID</span><br><span class="line">                   filename = UUIDUtils.getUUID(filename);</span><br><span class="line">                    // 处理ie浏览器文件名带路径的问题</span><br><span class="line">                    if (filename.lastIndexOf(&quot;\\&quot;) != -1) &#123;</span><br><span class="line">                        filename = filename.substring(filename</span><br><span class="line">                                                      .lastIndexOf(&quot;\\&quot;) + 1);</span><br><span class="line">                    &#125;</span><br><span class="line">                    // 获取文件内容</span><br><span class="line">                    InputStream is = fileItem.getInputStream();</span><br><span class="line">                    // 获取上传路径</span><br><span class="line">                    String realPath = getServletContext().getRealPath(</span><br><span class="line">                        &quot;/upload&quot;);</span><br><span class="line">                    // 创建输出流</span><br><span class="line">                    String path2 = UUIDUtils.getPath(filename);</span><br><span class="line">                    String path3 = realPath + path2;</span><br><span class="line">                    File file = new File(path3);</span><br><span class="line">                    if (!file.exists()) &#123;</span><br><span class="line">                        file.mkdirs();</span><br><span class="line">                    &#125;</span><br><span class="line">                    OutputStream os = new FileOutputStream(path3 + &quot;\\&quot;</span><br><span class="line">                                                           + filename);</span><br><span class="line">                    // 上传</span><br><span class="line">                    int len;</span><br><span class="line">                    byte[] b = new byte[1024];</span><br><span class="line">                    while ((len = is.read(b)) != -1) &#123;</span><br><span class="line">                        os.write(b, 0, len);</span><br><span class="line">                    &#125;</span><br><span class="line">                    // 关闭流</span><br><span class="line">                    is.close();</span><br><span class="line">                    os.close();</span><br><span class="line">                    // 删除临时文件</span><br><span class="line">                    fileItem.delete();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">		&#125; catch (FileUploadException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>upload.jsp</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">	pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">	function add() &#123;</span><br><span class="line">		document.getElementById(&quot;div1&quot;).innerHTML += &quot;&lt;div&gt;&lt;input type=&apos;file&apos; name=&apos;updowm&apos;&gt;&lt;input type=&apos;button&apos; value=&apos;删除&apos; onclick=&apos;del(this)&apos;&gt;&lt;/div&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	function del(who) &#123;</span><br><span class="line">		who.parentNode.parentNode.removeChild(who.parentNode);</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;上传页面&lt;/h1&gt;</span><br><span class="line">	&lt;form action=&quot;$&#123;pageContext.request.contextPath &#125;/uploadServlet&quot;</span><br><span class="line">		method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;button&quot; value=&quot;添加&quot; onclick=&quot;add()&quot;&gt;&lt;input</span><br><span class="line">			type=&quot;submit&quot; value=&quot;上传&quot;&gt;&lt;br&gt;</span><br><span class="line">		&lt;div id=&quot;div1&quot;&gt;&lt;/div&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-文件下载"><a href="#2-文件下载" class="headerlink" title="2.文件下载"></a>2.文件下载</h2><h3 id="2-1-文件下载流程"><a href="#2-1-文件下载流程" class="headerlink" title="2.1 文件下载流程"></a>2.1 文件下载流程</h3><ol>
<li><p>获取数据</p>
<p>String filename = request.getParameter(“filename”);</p>
</li>
<li><p>设置两个头和一个输入流</p>
<ol>
<li><p>设置两个头</p>
<p>设置Content-Type</p>
<p>response.setContentType(“getServletContext().getMimeType(filename)”);</p>
<p>设置Content-Disposition</p>
<p>response.setHeader(“Content-Disposition”,”attachment;filename=”+filename)</p>
</li>
<li><p>设置输入流</p>
<p>String path=getServletContext().getRealPath(“/download”);</p>
<p>InputStream is = new FileInputStream(path+”/“+filename);</p>
</li>
</ol>
</li>
<li><p>获取输出流</p>
<p>​        OutPutStream os = response.getOutputStream();</p>
</li>
</ol>
<h3 id="2-2文件下载代码"><a href="#2-2文件下载代码" class="headerlink" title="2.2文件下载代码"></a>2.2文件下载代码</h3><p><strong>downloadServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.DownloadEncodingUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件下载Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">downloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 获取数据</span></span><br><span class="line">		String filename = request.getParameter(<span class="string">"filename"</span>);</span><br><span class="line">		<span class="comment">// 解决文件名中文乱码问题</span></span><br><span class="line">		filename = <span class="keyword">new</span> String(filename.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">		<span class="comment">// 设置两个头,一个流</span></span><br><span class="line">		<span class="comment">// 设置ContentType</span></span><br><span class="line">		response.setContentType(getServletContext().getMimeType(filename));</span><br><span class="line">		<span class="comment">// 设置输入流</span></span><br><span class="line">		String realPath = getServletContext().getRealPath(<span class="string">"/download"</span>);</span><br><span class="line">		InputStream is = <span class="keyword">new</span> FileInputStream(realPath + <span class="string">"/"</span> + filename);</span><br><span class="line">		System.out.println(filename);</span><br><span class="line">		<span class="comment">// 解决不同浏览器文件名中文显示问题</span></span><br><span class="line">		String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">		<span class="keyword">if</span> (agent.contains(<span class="string">"Firefox"</span>)) &#123;</span><br><span class="line">			<span class="comment">// 火狐浏览器</span></span><br><span class="line">			filename = DownloadEncodingUtils.base64EncodeFileName(filename);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			filename = URLEncoder.encode(filename, <span class="string">"UTF-8"</span>);</span><br><span class="line">			filename = filename.replace(<span class="string">"+"</span>, <span class="string">" "</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 设置Content-Disposition</span></span><br><span class="line">		System.out.println(filename);</span><br><span class="line">		response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span></span><br><span class="line">				+ filename);</span><br><span class="line">		<span class="comment">// 获取输出流</span></span><br><span class="line">		ServletOutputStream os = response.getOutputStream();</span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">while</span> ((len = is.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">			os.write(b, <span class="number">0</span>, len);</span><br><span class="line">		&#125;</span><br><span class="line">		is.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>download.jsp</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;文件下载&lt;/h1&gt;</span><br><span class="line">	&lt;a href="$&#123;pageContext.request.contextPath &#125;/download/psb.jpg"&gt;psb.jpg&lt;/a&gt;</span><br><span class="line">	&lt;h3&gt;手动下载&lt;/h3&gt;</span><br><span class="line">	&lt;a</span><br><span class="line">		href="$&#123;pageContext.request.contextPath &#125;/downloadServlet?filename=psb.jpg"&gt;psb.jpg&lt;/a&gt;</span><br><span class="line">	&lt;br&gt;</span><br><span class="line">	&lt;a</span><br><span class="line">		href="$&#123;pageContext.request.contextPath &#125;/downloadServlet?filename=中文.jpg"&gt;中文.jpg&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-文件列表下载"><a href="#2-3-文件列表下载" class="headerlink" title="2.3 文件列表下载"></a>2.3 文件列表下载</h3><p><strong>multiDownloadServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.DownloadEncodingUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class multidownloadServlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">multidownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String path = request.getParameter(<span class="string">"path"</span>);</span><br><span class="line">		path = <span class="keyword">new</span> String(path.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">		File file = <span class="keyword">new</span> File(path);</span><br><span class="line">		String filename = file.getName();</span><br><span class="line">		<span class="comment">// 设置两个头,一个流</span></span><br><span class="line">		response.setContentType(getServletContext().getMimeType(filename));</span><br><span class="line">		InputStream is = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">		<span class="comment">// 处理中文名</span></span><br><span class="line">		String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">		<span class="keyword">if</span> (agent.contains(<span class="string">"Firefox"</span>)) &#123;</span><br><span class="line">			filename = DownloadEncodingUtils.base64EncodeFileName(filename);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			filename = URLEncoder.encode(filename, <span class="string">"UTF-8"</span>);</span><br><span class="line">			filename = filename.replace(<span class="string">"+"</span>, <span class="string">" "</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attach;filename="</span> + filename);</span><br><span class="line">		ServletOutputStream os = response.getOutputStream();</span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">while</span> ((len = is.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">			os.write(b, <span class="number">0</span>, len);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//关闭流</span></span><br><span class="line">		is.close();</span><br><span class="line">		os.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>multiDownload.jsp</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.io.File"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.util.LinkedList"</span>%&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;多文件下载&lt;/h1&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		<span class="comment">//创建队列</span></span><br><span class="line">		Queue&lt;File&gt; queue = <span class="keyword">new</span> LinkedList&lt;File&gt;();</span><br><span class="line">		<span class="comment">//创建根节点</span></span><br><span class="line">		File root = <span class="keyword">new</span> File(</span><br><span class="line">				<span class="string">"F:\\java基础增强\\javaweb_day19(文件上传和下载)\\资料\\下载资料列表"</span>);</span><br><span class="line">		<span class="comment">//根节点入队</span></span><br><span class="line">		queue.offer(root);</span><br><span class="line">		<span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">			<span class="comment">//出队</span></span><br><span class="line">			File file = queue.poll();</span><br><span class="line">			<span class="comment">//获取出队元素的所有子元素</span></span><br><span class="line">			File[] files = file.listFiles();</span><br><span class="line">			<span class="comment">//遍历子元素</span></span><br><span class="line">			<span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">				<span class="keyword">if</span> (f.isFile()) &#123;</span><br><span class="line">					<span class="comment">//为标准文件,则输出</span></span><br><span class="line">	%&gt;</span><br><span class="line">	&lt;h3&gt;</span><br><span class="line">		&lt;a</span><br><span class="line">			href="$&#123;pageContext.request.contextPath &#125;/multidownloadServlet?path=&lt;%=f.getCanonicalPath()%&gt;"&gt;&lt;%=f.getName()%&gt;&lt;/a&gt;</span><br><span class="line">	&lt;/h3&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="comment">//不是标准文件,则入队</span></span><br><span class="line">					queue.offer(f);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="日历对象-Calendar"><a href="#日历对象-Calendar" class="headerlink" title="日历对象 Calendar"></a>日历对象 Calendar</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Calendar cal = Calendar.getInstance();</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/文件上传和下载/" data-id="cjwqj8oqd0000s47kx4xz3d2h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-hello-world" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/hello-world/" class="article-date">
  <time class="post-time" datetime="2019-06-09T11:40:15.735Z" itemprop="datePublished">
    <span class="post-month">6月</span><br>
    <span class="post-day">09</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/hello-world/">Hello World</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/hello-world/" data-id="cjwqj8ora0001s47k3s4m8h3k" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Hexo</h1>
    <h2 class="blog-subtitle"></h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/source/plugin/img/avatar.jpg">
    <h2 class="author">inverse</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>2</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>0</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/cyannote" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2018 - 2019 inverse<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title class="menuItem">首页</a>
          
            <a href="/tags" title class="menuItem">标签</a>
          
            <a href="/categories" title class="menuItem">分类</a>
          
            <a href="/archives" title class="menuItem">归档</a>
          
            <a href="/xxxxxxxxx" title class="menuItem">xxx</a>
          
            <a href="/xxxxxxx" title class="menuItem">xxxx</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>