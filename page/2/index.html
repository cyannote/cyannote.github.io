<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://cyannote.github.io.git/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/source/plugin/img/avatar.jpg">
    <h2 class="author">inverse</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>19</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>0</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-mybatis" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/mybatis/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:05:15.011Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/mybatis/">MyBatis学习笔记</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h1><h2 id="1-mybatis概述"><a href="#1-mybatis概述" class="headerlink" title="1.mybatis概述"></a>1.mybatis概述</h2><h3 id="1-1-什么是mybatis"><a href="#1-1-什么是mybatis" class="headerlink" title="1. 1 什么是mybatis"></a>1. 1 什么是mybatis</h3><p>1：Hibernate就是一个持久层的的框架。对JDBC做了轻量级封装<br>2：Mybatis是一款优秀的持久层框架，它支持定制化SQL、存储过程以及高级映射</p>
<h3 id="1-2-mybatis概述"><a href="#1-2-mybatis概述" class="headerlink" title="1.2 mybatis概述"></a>1.2 mybatis概述</h3><p>1：它是基于Java编写的持久层框架，使开发者不必关心传统jdbc的api，只关心sql语句本身</p>
<p>2：mybatis 通过 xml或注解的方式将要执行的各种 statement 配置起来</p>
<p>3：采用 ORM 思想解决了实体和数据库映射的问题，对 jdbc 进行了封装，屏蔽了 jdbc api 底层访问细节，使我们不用与 jdbc api 打交道，就可以完成对数据库的持久化操作</p>
<h2 id="2-mybatis的CRUD操作"><a href="#2-mybatis的CRUD操作" class="headerlink" title="2.mybatis的CRUD操作"></a>2.mybatis的CRUD操作</h2><h3 id="2-1-mybatis查询所有的步骤"><a href="#2-1-mybatis查询所有的步骤" class="headerlink" title="2.1 mybatis查询所有的步骤"></a>2.1 mybatis查询所有的步骤</h3><p>1.创建工程</p>
<p>2.导入maven坐标</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.创建实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.导入log4j.properties文件</p>
<p><strong>查询所有</strong></p>
<p>5.创建SqlMapConfig.xml（省略）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span>用于指定别名</span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span>&gt;</span>配置环境</span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span>配置事务管理策略</span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span>配置数据区连接方式</span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span>配置数据库连接参数</span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.cyannote.dao"</span>/&gt;</span>用于指定dao接口所在的包</span><br></pre></td></tr></table></figure>

<p>6.创建UserDao.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>7.创建UserDao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.cyannote.dao.UserDao"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询所有--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"com.cyannotea.domain.User"</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>8.创建测试类MybatisTest .java（省略）</p>
<h3 id="2-2-与-的区别"><a href="#2-2-与-的区别" class="headerlink" title="2.2 #{}与${}的区别"></a>2.2 #{}与${}的区别</h3><p>#{}表示一个占位符号<br>通过#{}可以实现preparedStatement向占位符中设置值，自动进行java类型和jdbc类型转换，#{}可以有效防止sql注入。 #{}可以接收简单类型值或pojo属性值。 如果parameterType传输单个简单类型值，#{}括号中可以是value或其它名称。<br>${}表示拼接sql串<br>通过${}可以将parameterType 传入的内容拼接在sql中且不进行jdbc类型转换， ${}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，${}括号中只能是value。</p>
<h3 id="2-3-SqlMapConfig-xml配置文件"><a href="#2-3-SqlMapConfig-xml配置文件" class="headerlink" title="2.3  SqlMapConfig.xml配置文件"></a>2.3  SqlMapConfig.xml配置文件</h3><p>SqlMapConfig.xml中配置的内容和顺序如下：<br>properties（属性） </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SqlMapConfig.xml配置文件</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbcConfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>settings（全局配置参数）<br>typeAliases（类型别名）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 用于指定要配置别名的包，当指定之后，该包下的实体类都会注册别名，并且类名就是别名，不再区分大小写--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;package name="com.cyannote.domain"&gt;&lt;/package&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>typeHandlers（类型处理器）<br>objectFactory（对象工厂）<br>plugins（插件）<br>environments（环境集合属性对象）<br>environment（环境子属性对象）<br>transactionManager（事务管理）<br>dataSource（数据源）<br>mappers（映射器） </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">""</span>/&gt;</span> </span><br><span class="line">注册指定包下的所有mapper接口 </span><br><span class="line">如：<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.caynnote.dao"</span>/&gt;</span> </span><br><span class="line">注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。 </span><br><span class="line">应用场景：即可以使用XML配置文件，也可以使用注解。</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Mybatis映射文件的SQL深入"><a href="#2-4-Mybatis映射文件的SQL深入" class="headerlink" title="2.4 Mybatis映射文件的SQL深入"></a>2.4 Mybatis映射文件的SQL深入</h3><p>动态SQL的<if>标签</if></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据条件查询--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">    select * from user where 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName != null"</span>&gt;</span></span><br><span class="line">        and username = #&#123;userName&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userSex != null"</span>&gt;</span></span><br><span class="line">        and sex = #&#123;userSex&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>动态SQL之<where>标签</where></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--where标签的使用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName != null"</span>&gt;</span></span><br><span class="line">            and username = #&#123;userName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userSex != null"</span>&gt;</span></span><br><span class="line">            and sex = #&#123;userSex&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>动态标签之<foreach>标签</foreach></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--foreach标签的使用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findInIds"</span> <span class="attr">parameterType</span>=<span class="string">"queryVo"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and ids.size()&gt;0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">open</span>=<span class="string">" and id in ("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">item</span>=<span class="string">"uid"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">                #&#123;uid&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-mybatis的多表查询"><a href="#3-mybatis的多表查询" class="headerlink" title="3.mybatis的多表查询"></a>3.mybatis的多表查询</h2><h3 id="3-1-多对一-一对一"><a href="#3-1-多对一-一对一" class="headerlink" title="3.1 多对一(一对一):"></a>3.1 多对一(一对一):</h3><p><strong>方案一:创建新的javabean(包含两张表的字段)</strong></p>
<p>第一步：sql语句<br>                SELECT a.*,u.username,u.address FROM account a,USER u WHERE u.id = a.uid<br>第二步：在com.cyanote.domain中创建AccountUser.java<br>            创建一个新的javabean    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountUser</span> <span class="keyword">extends</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：AccountDao.java<br>    /**</p>
<p>​      *查询账号和客户的信息<br>​       */<br>​        List<accountuser> findByAccountUser();<br>第四步：AccountDao.xml</accountuser></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询所有 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByAccountUser"</span> <span class="attr">resultType</span>=<span class="string">"com.cyannote.domain.AccountUser"</span>&gt;</span></span><br><span class="line">    SELECT a.*,u.username,u.address FROM account a,user u WHERE u.id = a.uid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第五步：MybatisTest.java</p>
<p><strong>方案二:直接用用Account对象封装</strong></p>
<p>第一步：sql语句<br>select u.*,a.id as aid,a.uid,a.money from account a,user u where u.id = a.uid<br>第二步：修改Account.java<br>    在Account中封装User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   	 	<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：AccountDao.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*查询账号和客户的信息（方案二：直接用Account对象封装）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">List&lt;Account&gt; <span class="title">findByAccountUser2</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>第四步：AccountDao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义resultMap对象，用来封装账号信息--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"accountMap"</span> <span class="attr">type</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"aid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"money"</span> <span class="attr">column</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--association用来关联对象(用于多对一,或一对一)，property代表加载对象，javaType代表加载对象的数据类型，可以写成com.cyannote.domain.User--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 查询所有（方案二：直接用Account对象封装） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByAccountUser2"</span> <span class="attr">resultMap</span>=<span class="string">"accountMap"</span>&gt;</span></span><br><span class="line">    select u.*,a.id as aid,a.uid,a.money from account a,user u where u.id = a.uid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第五步：MybatisTest.java</p>
<h2 id="4-mybatis的延迟加载策略"><a href="#4-mybatis的延迟加载策略" class="headerlink" title="4.mybatis的延迟加载策略"></a>4.mybatis的延迟加载策略</h2><h3 id="4-1-什么是延迟加载"><a href="#4-1-什么是延迟加载" class="headerlink" title="4.1 什么是延迟加载"></a>4.1 什么是延迟加载</h3><p>什么是延迟加载<br>        在真正使用数据时才发起查询，不用的时候不查询。按需加载（懒加载）<br>什么是立即加载<br>        不管用不用，只要一调用方法，马上发起查询。<br>应用场景：<br>在对应的四种表关系中：一对多，多对一，一对一，多对多<br>        一对多，多对多：通常情况下我们都是采用延迟加载。（建议）<br>        多对一，一对一：通常情况下我们都是采用立即加载。（建议）</p>
<h3 id="4-2-配置延迟加载"><a href="#4-2-配置延迟加载" class="headerlink" title="4.2 配置延迟加载"></a>4.2 配置延迟加载</h3><p><strong>配置SqlMapConfig.xml:**</strong>(全局配置)**</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbcConfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--需要配置延迟加载策略--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--打开延迟加载的开关--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--将积极加载改为消息加载，即按需加载--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>配置AccountDao.xml</strong>:<strong>(局部配置)</strong></p>
<p>AccountDao.xml中使用fethcType属性用来控制延迟检索和立即检索：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--fetchType:</span></span><br><span class="line"><span class="comment">    eager：立即检索</span></span><br><span class="line"><span class="comment">    lazy：延迟检索</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"user"</span> <span class="attr">select</span>=<span class="string">"com.cyannote.dao.UserDao.findById"</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">fetchType</span>=<span class="string">"eager"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>只配置一处就可实现延迟加载,若两处都配置,局部配置优先级别更高.</p>
<h2 id="5-mybatis缓存"><a href="#5-mybatis缓存" class="headerlink" title="5.mybatis缓存"></a>5.mybatis缓存</h2><p>Mybatis中缓存分为一级缓存，二级缓存<br>一级缓存：是SqlSession级别的缓存（线程级别的缓存）<br>二级缓存：是SqlSessionFactory级别的缓存（进程级别的缓存）<br>一个SqlSessionFactory存在多个SqlSession。</p>
<h3 id="5-1-一级缓存-SqlSession"><a href="#5-1-一级缓存-SqlSession" class="headerlink" title="5.1 一级缓存(SqlSession)"></a>5.1 一级缓存(SqlSession)</h3><p>​        它指的是Mybatis中SqlSession对象的缓存。默认是开启SQLSession缓存的.</p>
<p>​        当我们执行查询之后，查询的结果会同时存入到SqlSession为我们提供一块区域中。一级缓存中存放的是一个对象.</p>
<p>​        该区域的结构是一个Map。当我们再次查询同样的数据，mybatis会先去sqlsession中查询是否有，有的话直接拿出来用，如果没有再查询数据库。</p>
<p>​        一级缓存是SqlSession 范围的缓存，当调用SqlSession 的修改，添加，删除，commit()，close()等方法时，就会清空一级缓存。</p>
<p>​        当SqlSession对象消失时，mybatis的一级缓存也就消失了。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1561621604792.jpg" alt="img"></p>
<p>​        第一次发起查询用户id 为1 的用户信息，先去找缓存中是否有id 为1 的用户信息，如果没有，从数据库查询用户信息。 得到用户信息，将用户信息存储到一级缓存中。 如果sqlSession 去执行commit 操作（执行插入、更新、删除），清空SqlSession 中的一级缓存，这样做的目的为了让缓存中存储的是最新的信息，避免脏读。 </p>
<p>​        第二次发起查询用户id 1 id 1 </p>
<h3 id="5-2-二级缓存-SqlSessionFactory"><a href="#5-2-二级缓存-SqlSessionFactory" class="headerlink" title="5.2 二级缓存(SqlSessionFactory)"></a>5.2 二级缓存(SqlSessionFactory)</h3><p>​        它指的是Mybatis中SqlSessionFactory对象的级别缓存。由同一个SqlSessionFactory对象创建的SqlSession共享其缓存。</p>
<p>​        二级缓存的使用步骤：</p>
<p>​               第一步：让Mybatis框架支持二级缓存（在SqlMapConfig.xml中配置）</p>
<p>​            因为cacheEnabled 的取值默认就为true，所以这一步可以省略不配置。为true 代表开启二级缓存； 为false 代表不开启二级缓存。  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--需要配置延迟加载策略--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启二级缓存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                第二步：让当前的映射文件支持二级缓存（在UserDao.xml中配置）</p>
<p>​            <cache>标签表示当前这个mapper 映射将使用二级缓存，区分的标准就看mapper 的namespace 值。</cache></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.cyannote.dao.UserDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​               第三步：让当前的操作支持二级缓存（在select标签中配置）</p>
<p>​            将UserDao.xml 映射文件中的<select>标签中设置useCache=”true”代表当前这个statement 要使用二级缓存，如果不使用二级缓存可以设置为false。 </select></p>
<p>注意：针对每次查询都需要最新的数据sql，要设置成useCache=false，禁用二级缓存。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据id查询用户 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">parameterType</span>=<span class="string">"INT"</span> <span class="attr">resultType</span>=<span class="string">"com.cyannote.domain.User"</span> <span class="attr">useCache</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    select * from user where id = #&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        二级缓存结构图 </p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1561621676615.jpg" alt="img"></p>
<p>​            经过测试，我们发现执行了两次查询，并且在执行第一次查询后，我们关闭了一级缓存，再去执行第二次查询时，我们发现并没有对数据库发出sql 语句，所以此时的数据就只能是来自于我们所说的二级缓存。 </p>
<p>​            但是查询到的2个对象不一致,原理是二级缓存中存放的是对象的散装数据，每次查询的时候需要重新封装实体对象。</p>
<p><strong>考虑二级缓存的应用场景：</strong></p>
<p>​            适应放置到二级缓存的数据：经常不会发生变化的数据，例如地区编码</p>
<p>​            不适合放置到二级缓存的数据：经常变化的数据, 财务数据</p>
<h2 id="6-mybatis注解开发"><a href="#6-mybatis注解开发" class="headerlink" title="6.mybatis注解开发"></a>6.mybatis注解开发</h2><p><strong>加载注解依赖</strong>(pom.xml)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>配置映射</strong>(SqlMapConfig.xml)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 指定带有注解的dao接口所在位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"com.cyannote.dao.UserDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-1-mybatis的注解说明"><a href="#6-1-mybatis的注解说明" class="headerlink" title="6.1 mybatis的注解说明"></a>6.1 mybatis的注解说明</h3><p>​            @Insert:实现新增 </p>
<p>​            @Update:实现更新 </p>
<p>​            @Delete:实现删除 </p>
<p>​            @Select:实现查询 </p>
<p>​            @Result:实现结果集封装 </p>
<p>​            @Results:可以与@Result一起使用，封装多个结果集 </p>
<p>​            @One:实现一对一结果集封装 </p>
<p>​            @Many:实现一对多结果集封装 </p>
<p>​            @SelectProvider: 实现动态SQL映射 </p>
<h3 id="6-2-使用注解开发"><a href="#6-2-使用注解开发" class="headerlink" title="6.2 使用注解开发"></a><strong>6.2 使用注解开发</strong></h3><p><strong>使用注解进行CRUD操作</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    查询所有</span></span><br><span class="line">  <span class="meta">@Select</span>(value = <span class="string">"select * from account"</span>)</span><br><span class="line">  <span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//    增加一条记录</span></span><br><span class="line">  <span class="meta">@Insert</span>(value = <span class="string">"insert into account (uid,money) values (#&#123;uid&#125;,#&#123;money&#125;)"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Account account)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//    删除一条记录</span></span><br><span class="line">  <span class="meta">@Delete</span>(value = <span class="string">"delete from account where id = #&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//    修改一条记录</span></span><br><span class="line">  <span class="meta">@Update</span>(value = <span class="string">"update account set uid = #&#123;uid&#125;,money = #&#123;money&#125; where id= #&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Account account)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>使用注解实现复杂关系映射开发</strong></p>
<p>@one:多对一和一对一</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(value = <span class="string">"SELECT * from account"</span>)</span><br><span class="line"><span class="meta">@Results</span>(id = <span class="string">"AccountUser"</span>, value = &#123;</span><br><span class="line">           <span class="meta">@Result</span>(id = <span class="keyword">true</span>, property = <span class="string">"id"</span>, column = <span class="string">"id"</span>),</span><br><span class="line">           <span class="meta">@Result</span>(property = <span class="string">"uid"</span>, column = <span class="string">"uid"</span>),</span><br><span class="line">           <span class="meta">@Result</span>(property = <span class="string">"money"</span>, column = <span class="string">"money"</span>),</span><br><span class="line">           <span class="meta">@Result</span>(property = <span class="string">"user"</span>, column = <span class="string">"uid"</span>, one = <span class="meta">@One</span>(select = <span class="string">"com.cyannote.dao.UserDao.findByUId"</span>))</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="function">List&lt;Account&gt; <span class="title">findAccountUser</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>@many:一对多和多对多</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(value = <span class="string">"select * from user"</span>)</span><br><span class="line"><span class="meta">@Results</span>(id = <span class="string">"UserAccount"</span>,value = &#123;</span><br><span class="line">            <span class="meta">@Result</span>(id = <span class="keyword">true</span> , property = <span class="string">"id"</span> , column = <span class="string">"id"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"username"</span>,column = <span class="string">"username"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"sex"</span> , column = <span class="string">"sex"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"birthday"</span> , column = <span class="string">"birthday"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"address"</span> , column = <span class="string">"address"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"accounts"</span>,column = <span class="string">"id"</span>,many = <span class="meta">@Many</span>(select = <span class="string">"com.cyannote.dao.AccountDao.findById"</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findUserAccount</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>使用联合查询的SQL语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(value = <span class="string">"SELECT u.*,a.id aid,a.UID,a.MONEY FROM USER u,account a WHERE a.uid = u.id"</span>)</span><br><span class="line">    <span class="meta">@Results</span>(id = <span class="string">"AccountUser2"</span>,value = &#123;</span><br><span class="line">            <span class="meta">@Result</span>(id = <span class="keyword">true</span>,property = <span class="string">"id"</span>,column = <span class="string">"aid"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"uid"</span>,column = <span class="string">"uid"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"money"</span>,column = <span class="string">"money"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"user.id"</span>,column = <span class="string">"id"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"user.username"</span>,column = <span class="string">"username"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"user.sex"</span>,column = <span class="string">"sex"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"user.birthday"</span>,column = <span class="string">"birthday"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"user.address"</span>,column = <span class="string">"address"</span>),</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAccountUser2</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>使用注解配置二级缓存</strong></p>
<p>第一步：配置SqlMapConfig.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启二级缓存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：配置UserDao.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheNamespace</span>(blocking = <span class="keyword">true</span>) <span class="comment">// 使用二级缓存</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/mybatis/" data-id="cjycoezpb0003l47kbsksybio" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-MySQL-单表查询笔记" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/MySQL-单表查询笔记/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:05:12.051Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/MySQL-单表查询笔记/">MySql单表查询</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MySQL单表查询"><a href="#MySQL单表查询" class="headerlink" title="MySQL单表查询"></a>MySQL单表查询</h1><p><strong>学习目标</strong></p>
<ul>
<li><p>理解数据库和关系型数据库的概念</p>
</li>
<li><p>独立完成数据库的安装</p>
</li>
<li><p>理解关系型数据库的存储结构</p>
</li>
<li><p>独立完成对数据库的添加，修改，删除，查询操作</p>
</li>
<li><p>独立完成对数据库表的添加，修改，删除，查询操作</p>
</li>
<li><p>独立完成对数据库表记录的添加，修改，删除，查询操作</p>
</li>
</ul>
<h2 id="1-MySQL的概述"><a href="#1-MySQL的概述" class="headerlink" title="1 MySQL的概述"></a>1 MySQL的概述</h2><h3 id="1-1-数据库的概述"><a href="#1-1-数据库的概述" class="headerlink" title="1.1 数据库的概述"></a>1.1 数据库的概述</h3><h4 id="什么是数据库"><a href="#什么是数据库" class="headerlink" title="什么是数据库"></a>什么是数据库</h4><p>数据库就是一个文件系统，通过标准的SQL语句获取数据</p>
<h3 id="1-2-MySQL的概述"><a href="#1-2-MySQL的概述" class="headerlink" title="1.2 MySQL的概述"></a>1.2 MySQL的概述</h3><h4 id="什么是MySQL数据库"><a href="#什么是MySQL数据库" class="headerlink" title="什么是MySQL数据库"></a>什么是MySQL数据库</h4><p><img src="D:%5Ctypora%E5%9B%BE%E7%89%87%5C1558492939657-1558493290446.png" alt="1558492939657"></p>
<h3 id="1-3关系型数据库概述"><a href="#1-3关系型数据库概述" class="headerlink" title="1.3关系型数据库概述"></a>1.3关系型数据库概述</h3><h4 id="什么是关系型数据库"><a href="#什么是关系型数据库" class="headerlink" title="什么是关系型数据库"></a>什么是关系型数据库</h4><p>关系型数据库存放的是实体之间的关系</p>
<p><img src="D:%5Ctypora%E5%9B%BE%E7%89%87%5C1558493010920.png" alt="1558493010920"></p>
<h4 id="常见的关系型数据库"><a href="#常见的关系型数据库" class="headerlink" title="常见的关系型数据库"></a>常见的关系型数据库</h4><ul>
<li><p>MySQL</p>
</li>
<li><p>Oracle</p>
</li>
<li><p>SQLServer</p>
</li>
<li><p>DB2</p>
</li>
<li><p>SyBase</p>
</li>
</ul>
<h2 id="2-MySQL的数据存储方式的概述"><a href="#2-MySQL的数据存储方式的概述" class="headerlink" title="2 MySQL的数据存储方式的概述"></a>2 MySQL的数据存储方式的概述</h2><h3 id="2-1-服务器的概念"><a href="#2-1-服务器的概念" class="headerlink" title="2.1 服务器的概念"></a>2.1 服务器的概念</h3><h4 id="什么是服务器"><a href="#什么是服务器" class="headerlink" title="什么是服务器"></a>什么是服务器</h4><p>服务器要从硬件和软件两个方面来说：</p>
<ul>
<li><p>硬件：指的就是一台计算机。</p>
</li>
<li><p>软件：需要在这台电脑上安装数据库服务器。</p>
</li>
</ul>
<h3 id="2-2-MySQL数据库存储的方式"><a href="#2-2-MySQL数据库存储的方式" class="headerlink" title="2.2 MySQL数据库存储的方式"></a>2.2 MySQL数据库存储的方式</h3><h4 id="存储方式的描述"><a href="#存储方式的描述" class="headerlink" title="存储方式的描述"></a>存储方式的描述</h4><p><img src="D:%5Ctypora%E5%9B%BE%E7%89%87%5C1558493046345.png" alt="1558493046345"></p>
<p>一台数据库服务器中会创建很多数据库（一个项目，会创建一个数据库）。在数据库中会创建很多张表（一个实体会创建一个表）。在表中会有很多记录（一个对象的实例会添加一条新的记录）。</p>
<h2 id="3-SQL的概述"><a href="#3-SQL的概述" class="headerlink" title="3 SQL的概述"></a>3 SQL的概述</h2><h3 id="3-1-SQL的概念"><a href="#3-1-SQL的概念" class="headerlink" title="3.1 SQL的概念"></a>3.1 SQL的概念</h3><h4 id="什么是SQL"><a href="#什么是SQL" class="headerlink" title="什么是SQL"></a>什么是SQL</h4><p><img src="D:%5Ctypora%E5%9B%BE%E7%89%87%5C1558493065295-1558493411567.png" alt="1558493065295"></p>
<h3 id="3-2-SQL的分类"><a href="#3-2-SQL的分类" class="headerlink" title="3.2 SQL的分类"></a>3.2 SQL的分类</h3><h4 id="DDL：数据定义语言"><a href="#DDL：数据定义语言" class="headerlink" title="DDL：数据定义语言"></a>DDL：数据定义语言</h4><p>create，drop，alter..</p>
<h4 id="DCL：数据控制语言"><a href="#DCL：数据控制语言" class="headerlink" title="DCL：数据控制语言"></a>DCL：数据控制语言</h4><p>grant，if…</p>
<h4 id="DML：数据操纵语言"><a href="#DML：数据操纵语言" class="headerlink" title="DML：数据操纵语言"></a>DML：数据操纵语言</h4><p>insert，update，delete…</p>
<h4 id="DQL：数据查询语言"><a href="#DQL：数据查询语言" class="headerlink" title="DQL：数据查询语言"></a>DQL：数据查询语言</h4><p>select</p>
<h2 id="4-使用SQL"><a href="#4-使用SQL" class="headerlink" title="4 使用SQL"></a>4 使用SQL</h2><h3 id="4-1-SQL对数据库进行操作"><a href="#4-1-SQL对数据库进行操作" class="headerlink" title="4.1 SQL对数据库进行操作"></a>4.1 SQL对数据库进行操作</h3><h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><ul>
<li><p>语法：</p>
<ul>
<li>create database 数据库名称 [character set 字符集 collate 字符集校对规则];</li>
</ul>
</li>
</ul>
<h4 id="查看数据库"><a href="#查看数据库" class="headerlink" title="查看数据库"></a>查看数据库</h4><ul>
<li><p>语法：</p>
<ul>
<li>查看数据库服务器中所有的数据库：show databases;</li>
</ul>
</li>
<li><p>查看某个数据库的定义信息： show create database 数据库名称;</p>
</li>
</ul>
<h4 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h4><ul>
<li><p>语法：</p>
<ul>
<li>alter database 数据库名称 character set 字符集 collate 校对规则;</li>
</ul>
</li>
</ul>
<h4 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h4><ul>
<li><p>语法:</p>
<ul>
<li>drop database 数据库名称;</li>
</ul>
</li>
</ul>
<h4 id="其他数据库操作"><a href="#其他数据库操作" class="headerlink" title="其他数据库操作"></a>其他数据库操作</h4><ul>
<li><p>切换数据库：use 数据库名称;</p>
</li>
<li><p>查看当前正在使用的数据库：</p>
</li>
</ul>
<h3 id="4-2-SQL对数据库表进行操作"><a href="#4-2-SQL对数据库表进行操作" class="headerlink" title="4.2 SQL对数据库表进行操作"></a>4.2 SQL对数据库表进行操作</h3><h4 id="SQL创建表"><a href="#SQL创建表" class="headerlink" title="SQL创建表"></a>SQL创建表</h4><ul>
<li><p>语法：</p>
<ul>
<li>create table 表名称(字段名称 字段类型(长度) 约束,字段名称 字段类型(长度) 约束…);</li>
</ul>
</li>
<li><p>字段类型</p>
<ul>
<li>一个实体对应一个表，一个实体属性对应表的一个字段。</li>
</ul>
</li>
</ul>
<blockquote>
<p>Java中的类型 MySQL中的类型</p>
<p>byte/short/int/long tinyint/smallint/int/bigint</p>
<p>float float</p>
<p>double double</p>
<p>boolean bit</p>
<p>char/String char和varchar类型</p>
<p><strong>char和varchar的区别：</strong></p>
<p><strong>* char代表是固定长度的字符或字符串。</strong></p>
<p><strong>* 定义类型char(8),向这个字段存入字符串hello，那么数据库使用三个空格将其补全。</strong></p>
<p><strong>* varchar代表的是可变长度的字符串。</strong></p>
<p><strong>* 定义类型varchar(8), 向这个字段存入字符串hello,那么存入到数据库的就是hello。</strong></p>
<p>Date date/time/datetime/timestamp</p>
<p><strong>datetime和timestamp区别</strong></p>
<p><strong>* datetime就是既有日期又有时间的日期类型，如果没有向这个字段中存值，数据库使用null存入到数据库中</strong></p>
<p><strong>* timestamp也是既有日期又有时间的日期类型，如果没有向这个字段中存值，数据库使用当前的系统时间存入到数据库中。</strong></p>
<p>File BLOB/TEXT</p>
</blockquote>
<ul>
<li><p>约束</p>
<ul>
<li><p>约束作用：保证数据的完整性</p>
</li>
<li><p>单表约束分类：</p>
<ul>
<li><p>主键约束：primary key 主键约束默认就是唯一 非空的</p>
</li>
<li><p>唯一约束：unique</p>
</li>
<li><p>非空约束：not null</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>建表语句：</p>
</li>
</ul>
<p>create database web_test1;</p>
<p>use web_test1;</p>
<p>create table user(</p>
<p>id int primary key auto_increment,</p>
<p>username varchar(20) unique,</p>
<p>password varchar(20) not null,</p>
<p>age int,</p>
<p>birthday date</p>
<p>);</p>
<h4 id="SQL查看表"><a href="#SQL查看表" class="headerlink" title="SQL查看表"></a>SQL查看表</h4><ul>
<li><p>查看某个数据库下的所有的表</p>
</li>
<li><p>语法：show tables;</p>
</li>
<li><p>查看某个表的结构信息</p>
</li>
<li><p>语法：desc 表名;</p>
</li>
</ul>
<h4 id="SQL删除表"><a href="#SQL删除表" class="headerlink" title="SQL删除表"></a>SQL删除表</h4><ul>
<li><p>删除表</p>
<ul>
<li>语法：drop table 表名;</li>
</ul>
</li>
</ul>
<blockquote>
<p><img src="media/image14.png" alt>{width=”4.134722222222222in” height=”0.8847222222222222in”}</p>
</blockquote>
<h4 id="SQL修改表"><a href="#SQL修改表" class="headerlink" title="SQL修改表"></a>SQL修改表</h4><ul>
<li><p>修改表：添加列</p>
<ul>
<li>alter table 表名 add 列名 类型(长度) 约束;</li>
</ul>
</li>
<li><p>修改表：修改列类型，长度和约束</p>
<ul>
<li>alter table 表名 modify 列名 类型(长度) 约束;</li>
</ul>
</li>
<li><p>修改表：删除列</p>
<ul>
<li>alter table 表名 drop 列名;</li>
</ul>
</li>
<li><p>修改表：修改列名称</p>
<ul>
<li>alter table 表名 change 旧列名 新列名 类型(长度) 约束;</li>
</ul>
</li>
<li><p>修改表：修改表名</p>
<ul>
<li>rename table 表名 to 新的表名;</li>
</ul>
</li>
<li><p>修改表：修改表的字符集</p>
<ul>
<li>alter table 表名 character set 字符集;</li>
</ul>
</li>
</ul>
<h3 id="4-3-SQL对数据库表的记录进行操作（重点）"><a href="#4-3-SQL对数据库表的记录进行操作（重点）" class="headerlink" title="4.3 SQL对数据库表的记录进行操作（重点）"></a>4.3 SQL对数据库表的记录进行操作（重点）</h3><h4 id="SQL添加表的记录"><a href="#SQL添加表的记录" class="headerlink" title="SQL添加表的记录"></a>SQL添加表的记录</h4><ul>
<li><p>语法：</p>
<ul>
<li><p>向表中插入某些列：insert into 表名 (列名1,列名2,列名3…) values (值1,值2,值3…)</p>
</li>
<li><p>向表中插入所有列：insert into 表名 values (值1,值2,值3…);</p>
</li>
</ul>
</li>
<li><p><strong>注意事项</strong></p>
<ul>
<li><p><strong>1.值的类型与数据库中表列的类型一致。</strong></p>
</li>
<li><p><strong>2.值的顺序与数据库中表列的顺序一致。</strong></p>
</li>
<li><p><strong>3.值的最大长度不能超过列设置最大长度。</strong></p>
</li>
<li><p><strong>4.值的类型是字符串或者是日期类型，使用单引号引起来。</strong></p>
</li>
</ul>
</li>
<li><p>添加记录</p>
<ul>
<li>添加某几列</li>
</ul>
</li>
</ul>
<p>insert into user (id,username,password) values (null,&#39;aaa&#39;,&#39;123&#39;);</p>
<ul>
<li>添加所有列</li>
</ul>
<p>insert into user values (null,&#39;bbb&#39;,&#39;123&#39;,23,&#39;1993-09-01&#39;);</p>
<ul>
<li>添加中文记录</li>
</ul>
<p>insert into user values (null,&#39;张三&#39;,&#39;123&#39;,23,&#39;1993-09-01&#39;);</p>
<p><strong>直接向数据库中插入中文记录会出现错误！！！</strong></p>
<p><strong>解决方法：</strong></p>
<p><strong>show variables like &#39;%character%&#39;; --查看数据库中与字符集相关参数：</strong></p>
<p><strong>需要将MySQL数据库服务器中的客户端部分的字符集改为gbk。</strong></p>
<p><strong>找到MySQL的安装路径：my.ini文件，修改文件中[client]下的字符集</strong></p>
<p>* 重新启动MySQL的服务器</p>
<p>services.msc</p>
<h4 id="SQL修改表的记录"><a href="#SQL修改表的记录" class="headerlink" title="SQL修改表的记录"></a>SQL修改表的记录</h4><ul>
<li><p>语法:</p>
<ul>
<li>update 表名 set 列名=值,列名=值 [where 条件];</li>
</ul>
</li>
<li><p><strong>注意事项</strong></p>
<ul>
<li><p><strong>1.值的类型与列的类型一致。</strong></p>
</li>
<li><p><strong>2.值的最大长度不能超过列设置的最大长度。</strong></p>
</li>
<li><p><strong>3.字符串类型和日期类型添加单引号。</strong></p>
</li>
</ul>
</li>
<li><p><strong>修改某一列的所有值</strong></p>
</li>
</ul>
<p>update user set password = &#39;abc&#39;;</p>
<ul>
<li><strong>按条件修改数据</strong></li>
</ul>
<p>update user set password = &#39;xyz&#39; where username = &#39;bbb&#39;;</p>
<ul>
<li><strong>按条件修改多个列</strong></li>
</ul>
<p>update user set password=&#39;123&#39;,age=34 where username=&#39;aaa&#39;;</p>
<h4 id="SQL删除表的记录"><a href="#SQL删除表的记录" class="headerlink" title="SQL删除表的记录"></a>SQL删除表的记录</h4><ul>
<li><p>语法：</p>
<ul>
<li>delete from 表名 [where 条件];</li>
</ul>
</li>
<li><p><strong>注意事项</strong></p>
<ul>
<li><p><strong>1.删除表的记录，指的是删除表中的一行记录。</strong></p>
</li>
<li><p><strong>2.删除如果没有条件，默认是删除表中的所有记录。</strong></p>
</li>
</ul>
</li>
<li><p><strong>删除某一条记录</strong></p>
</li>
</ul>
<p>delete from user where id = 2;</p>
<ul>
<li><strong>删除表中的所有记录</strong></li>
</ul>
<p>delete from user;</p>
<ul>
<li><p><strong>删除表中的记录有两种做法:</strong></p>
<ul>
<li><p><strong>delete from user;</strong></p>
<ul>
<li><strong>删除所有记录，属于DML语句，一条记录一条记录删除。事务可以作用在DML语句上的</strong></li>
</ul>
</li>
<li><p><strong>truncate table user;</strong></p>
<ul>
<li><strong>删除所有记录，属于DDL语句，将表删除，然后重新创建一个结构一样的表。事务不能控制DDL的</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="SQL查看表的记录（重点）"><a href="#SQL查看表的记录（重点）" class="headerlink" title="SQL查看表的记录（重点）"></a>SQL查看表的记录（重点）</h4><ul>
<li><p><strong>基本查询</strong></p>
<ul>
<li><p><strong>语法:select [distinct] *|列名 from 表 [条件];</strong></p>
</li>
<li><p>环境的准备：</p>
</li>
</ul>
</li>
</ul>
<p>create table exam(</p>
<p>id int primary key auto_increment,</p>
<p>name varchar(20),</p>
<p>english int,</p>
<p>chinese int,</p>
<p>math int</p>
<p>);</p>
<p>insert into exam values (null,&#39;张三&#39;,85,74,91);</p>
<p>insert into exam values (null,&#39;李四&#39;,95,90,83);</p>
<p>insert into exam values (null,&#39;王五&#39;,85,84,59);</p>
<p>insert into exam values (null,&#39;赵六&#39;,75,79,76);</p>
<p>insert into exam values (null,&#39;田七&#39;,69,63,98);</p>
<p>insert into exam values (null,&#39;李老八&#39;,89,90,83);</p>
<ul>
<li>查询所有学生考试成绩信息</li>
</ul>
<p>select * from exam;</p>
<ul>
<li>查询所有学生的姓名和英语成绩</li>
</ul>
<p>select name,english from exam;</p>
<ul>
<li>查询英语成绩信息（不显示重复的值）</li>
</ul>
<p>select distinct english from exam;</p>
<ul>
<li>查看学生姓名和学生的总成绩</li>
</ul>
<p>select name,english+chinese+math from exam;</p>
<p>!</p>
<ul>
<li>别名查询</li>
</ul>
<p>select name,english+chinese+math as sum from exam;</p>
<ul>
<li><p><strong>条件查询</strong></p>
<ul>
<li><p><strong>使用where子句</strong></p>
<ul>
<li><p><strong>&gt; , &lt; , &gt;= , &lt;= , &lt;&gt; ,=</strong></p>
</li>
<li><p><strong>like:模糊查询</strong></p>
</li>
<li><p><strong>in:范围查询</strong></p>
</li>
<li><p><strong>条件关联:and , or ,not</strong></p>
</li>
</ul>
</li>
<li><p><strong>查询李四学生的成绩：</strong></p>
</li>
</ul>
</li>
</ul>
<p>select * from exam where name = &#39;李四&#39;;</p>
<ul>
<li><strong>查询名称叫李四学生并且英文大于90分</strong></li>
</ul>
<p>select * from exam where name = &#39;李四&#39; and english &gt; 90;</p>
<ul>
<li><strong>查询姓李的学生的信息</strong></li>
</ul>
<p>like可以进行模糊查询,在like子句中可以使用_或者%作为占位符。_只能代表一个字符，而%可以代表任意个字符。</p>
<p>* like ‘李_‘ ：名字中必须是两个字，而且是姓李的。</p>
<p>* like ‘李%’ ：名字中姓李的学生，李子后可以是1个或任意个字符。</p>
<p>* like ‘%四’ ：名字中以四结尾的。</p>
<p>* like ‘%王%’ ：只要名称中包含这个字就可以。</p>
<p>select * from exam where name like &#39;李%&#39;;</p>
<ul>
<li><strong>查询英语成绩是69,75,89学生的信息</strong></li>
</ul>
<p>select * from exam where english in (69,75,89);</p>
<ul>
<li><p><strong>排序查询</strong></p>
<ul>
<li><p><strong>使用order by 字段名称 asc/desc;</strong></p>
</li>
<li><p>查询学生信息，并且按照语文成绩进行排序：</p>
</li>
</ul>
</li>
</ul>
<p>select * from exam order by chinese;</p>
<ul>
<li>查询学生信息，并且按照语文成绩倒序排序：</li>
</ul>
<p>select * from exam order by chinese desc;</p>
<ul>
<li>查询学生信息，先按照语文成绩进行倒序排序，如果成绩相同再按照英语成绩升序排序</li>
</ul>
<p>select * from exam order by chinese desc,english asc;</p>
<ul>
<li>查询姓李的学生的信息，按照英语成绩降序排序</li>
</ul>
<p>select * from exam where name like &#39;李%&#39; order by english desc;</p>
<ul>
<li><p><strong>分组统计查询</strong></p>
<ul>
<li><p><strong>聚合函数使用</strong></p>
<ul>
<li><p><strong>sum();</strong></p>
<ul>
<li>获取所有学生的英语成绩的总和:</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>select sum(english) from exam;</p>
<ul>
<li>获取所有学生的英语成绩和数学成绩总和：</li>
</ul>
<p>select sum(english),sum(math) from exam;</p>
<ul>
<li>查询姓李的学生的英语成绩的总和</li>
</ul>
<p>select sum(english) from exam where name like &#39;李%&#39;;</p>
<ul>
<li>查询所有学生各科的总成绩：</li>
</ul>
<p>select sum(english)+sum(chinese)+sum(math) from exam;</p>
<p>select sum(english+chinese+math) from exam;</p>
<p>与上面的语句有什么不同？</p>
<p>* 上面的语句是按照列的方式统计，英语成绩总和+语文成绩总和+数学成绩总和。</p>
<p>* 下面的语句先计算英语+数学+语文然后再求和。</p>
<p>* 使用ifnull的函数</p>
<ul>
<li><p><strong>count();</strong></p>
<ul>
<li>获得学生的总数</li>
</ul>
</li>
</ul>
<p>select count(*) from exam;</p>
<ul>
<li>获得姓李的学生的个数</li>
</ul>
<p>select count(*) from exam where name like &#39;李%&#39;;</p>
<ul>
<li><p><strong>max();</strong></p>
<ul>
<li>获得数学成绩的最高分：</li>
</ul>
</li>
</ul>
<p>select max(math) from exam;</p>
<ul>
<li><p><strong>min();</strong></p>
<ul>
<li>获得语文成绩的最小值</li>
</ul>
</li>
</ul>
<p>select min(chinese) from exam;</p>
<ul>
<li><p><strong>avg();</strong></p>
<ul>
<li><strong>获取语文成绩的平均值</strong></li>
</ul>
</li>
</ul>
<p>select avg(chinese) from exam;</p>
<ul>
<li><p><strong>分组查询</strong></p>
<ul>
<li><p><strong>语法：使用group by 字段名称;</strong></p>
</li>
<li><p><strong>环境准备</strong></p>
</li>
</ul>
</li>
</ul>
<p>create table orderitem(</p>
<p>id int primary key auto_increment,</p>
<p>product varchar(20),</p>
<p>price double</p>
<p>);</p>
<p>insert into orderitem values (null,&#39;电视机&#39;,2999);</p>
<p>insert into orderitem values (null,&#39;电视机&#39;,2999);</p>
<p>insert into orderitem values (null,&#39;洗衣机&#39;,1000);</p>
<p>insert into orderitem values (null,&#39;洗衣机&#39;,1000);</p>
<p>insert into orderitem values (null,&#39;洗衣机&#39;,1000);</p>
<p>insert into orderitem values (null,&#39;冰箱&#39;,3999);</p>
<p>insert into orderitem values (null,&#39;冰箱&#39;,3999);</p>
<p>insert into orderitem values (null,&#39;空调&#39;,1999);</p>
<ul>
<li>按商品名称统计，每类商品所购买的个数：</li>
</ul>
<p>select product,count(*) from orderitem group by product;</p>
<ul>
<li>按商品名称统计，每类商品所花费的总金额：</li>
</ul>
<p>select product,sum(price) from orderitem group by product;</p>
<ul>
<li>按商品名称统计，统计每类商品花费的总金额在5000元以上的商品</li>
</ul>
<p><strong>***** where的子句后面不能跟着聚合函数。如果现在使用带有聚合函数的条件过滤（分组后条件过滤）需要使用一个关键字having</strong></p>
<p><strong>select product,sum(price) from orderitem group by product having sum(price) &gt; 5000;</strong></p>
<ul>
<li>按商品名称统计，统计每类商品花费的总金额在5000元以上的商品，并且按照总金额升序排序</li>
</ul>
<p>select product,sum(price) from orderitem group by product having sum(price) &gt; 5000 order by sum(price) asc;</p>
<ul>
<li><p><strong>总结</strong></p>
<ul>
<li><strong>S(select)… F(from)…W(where)…G(group by)…H(having)…O(order by);</strong></li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/MySQL-单表查询笔记/" data-id="cjycoezoz0002l47k3isj7dzx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-Redis" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Redis/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:05:10.740Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Redis/">Redis</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="增加数据"><a href="#增加数据" class="headerlink" title="增加数据"></a>增加数据</h2><p><strong>String :  set key value</strong>   </p>
<p>设定该Key持有指定的字符串Value</p>
<p><strong>List : lpush key value [value …]</strong></p>
<p>添加键和对应的多个值</p>
<p><strong>hash : hset key  field value</strong></p>
<p>为指定的Key设定Field/Value对</p>
<p><strong>Set:  sadd key member [member …]</strong></p>
<p>添加键和对应的值</p>
<p><strong>sortedSet: zadd key score member [score] [member]</strong></p>
<p>添加成员</p>
<h2 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h2><p><strong>String:    GET key   获取指定Key的Value</strong></p>
<p><strong>List : lrange key start stop      查询该键对应的值</strong></p>
<p><strong>Hash</strong>:  HMGET key field [field …]        获取和参数中指定Fields关联的一组Values。</p>
<p>    HGETALL key     获取该键包含的所有Field/Value<br>    HKEYS key     获取指定Key的所有Fields名<br>    HVALS key      返回指定Key的所有Values名。</p>
<p><strong>Set:  SMEMBERS key     获取与该Key关联的Set中所有的成员</strong></p>
<p><strong>SortedSe</strong>t:      ZRANGE key start stop [WITHSCORES]     根据索引获取成员<br>    ZRANGEBYSCORE key min max  根据分数获取成员</p>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><p><strong>String:  del key  删除key</strong></p>
<p><strong>List:  lrem key count value 删除指定键中前count个值等于value的元素</strong></p>
<p><strong>Hash</strong>: hdel key field [field …]       从指定Key的Hashes Value中删除参数中指定的多个字段，如果不存在的字段将被忽略。</p>
<p><strong>Set</strong>:  SREM key member [member …]     从与Key关联的Set中删除参数中指定的成员</p>
<p><strong>SortedSet:   ZREM key member [member …]     删除成员</strong></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他:"></a>其他:</h2><p>    SDIFF key [key …] 获取第一个key和后面所有key中不同的部分<br>    SINTER key [key …]  获取所有Keys关联的Sets中成员的交集<br>    SUNION key [key …]      获取所有Keys关联的Sets中成员的并集</p>
<p>    KEYS pattern     获取所有匹配pattern参数的Keys<br>    DEL key [key …]     删除指定的keys<br>    EXPIRE key seconds      为参数中指定的Key设定超时的秒数，在超过该时间后，Key被自动的删除<br>    PERSIST key 取消key的过期时间<br>    TTL key      获取该键所剩的超时描述</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/Redis/" data-id="cjycoezoe0000l47ko4jvm287" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-Search" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Search/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:05:08.925Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Search/">Searcher搜索引擎</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h1><h2 id="1-搜索引擎"><a href="#1-搜索引擎" class="headerlink" title="1. 搜索引擎"></a>1. 搜索引擎</h2><h3 id="1-1-什么是搜索引擎"><a href="#1-1-什么是搜索引擎" class="headerlink" title="1.1  什么是搜索引擎"></a>1.1  什么是搜索引擎</h3><p>​    搜索引擎是指根据一定的策略、运用特定的计算机程序从互联网上搜集信息，在对信息进行组织和处理后，为用户提供检索服务，将用户检索相关的信息展示给用户的系统。例如: 百度 谷歌</p>
<h4 id="1-2-搜索引擎基本的运行原理"><a href="#1-2-搜索引擎基本的运行原理" class="headerlink" title="1.2  搜索引擎基本的运行原理"></a>1.2  搜索引擎基本的运行原理</h4><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1563674656348.png" alt="1563674656348"></p>
<h4 id="1-3-原始数据库查询的缺陷"><a href="#1-3-原始数据库查询的缺陷" class="headerlink" title="1.3 原始数据库查询的缺陷"></a>1.3 原始数据库查询的缺陷</h4><ul>
<li>1)  慢, 当数据库中的数据量很庞大的时候, 整个的查询效率非常低, 无法及时返回内容</li>
<li>2) 搜索效果比较差, 只能根据用户输入的完整关键字的进行首尾的模糊匹配</li>
<li>3)  如果用户输入的关键字出现错别字, 或者多输入了内容, 可能就导致结果远离用户期望的内容</li>
</ul>
<h4 id="1-4-倒排索引技术-理解"><a href="#1-4-倒排索引技术-理解" class="headerlink" title="1.4 倒排索引技术  (理解)"></a>1.4 倒排索引技术  (理解)</h4><p>​    倒排索引, 又称为反向索引: 以字或者词,甚至是一句话一段话作为一个关键字进行索引, 每一个关键字都会对应着一个记录项, 记录项中记录了这个关键字出现在那些文档中, 已经在此文档的什么位置上                        </p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day06_search_lucene/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95.png" alt></p>
<p>为什么说倒排索引可以提升查询的效率和精准度呢?</p>
<p>​    倒排索引, 是将数据提前按照格式分词放好,建立索引, 当用户进行搜索, 将用户的关键字进行分词, 然后根据分词后的单词到索引库中寻找对应词条,根据词条, 查到对应所在的文档位置, 将其文档内容直接获取即可</p>
<p>整个查询过程 <strong>基于索引</strong>查询</p>
<h2 id="2-Lucene"><a href="#2-Lucene" class="headerlink" title="2. Lucene"></a>2. Lucene</h2><p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day06_search_lucene/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/1532265270996.png" alt></p>
<p>​    Lucene是Apache提供的一个开源的全文检索引擎工具包, 其本质就是一堆jar包而已, 而非一个完整的搜索引擎, 但是我们可以通过Lucene来构建一个搜索引擎</p>
<p>官方网址:  <a href="http://lucene.apache.org/" target="_blank" rel="noopener">http://lucene.apache.org/</a></p>
<h3 id="2-1-使用Lucene如何构建索引"><a href="#2-1-使用Lucene如何构建索引" class="headerlink" title="2.1 使用Lucene如何构建索引"></a>2.1 使用Lucene如何构建索引</h3><h4 id="2-1-1-第一步-导入相关的jar包-pom依赖"><a href="#2-1-1-第一步-导入相关的jar包-pom依赖" class="headerlink" title="2.1.1 第一步: 导入相关的jar包(pom依赖)"></a>2.1.1 第一步: 导入相关的jar包(pom依赖)</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-queries<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-test-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-analyzers-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-queryparser<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-highlighter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-第二步-书写写入索引的代码"><a href="#2-1-2-第二步-书写写入索引的代码" class="headerlink" title="2.1.2 第二步: 书写写入索引的代码"></a>2.1.2 第二步: 书写写入索引的代码</h4><p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day06_search_lucene/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E5%86%99%E5%85%A5%E7%B4%A2%E5%BC%95.jpg" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 索引写入相关的内容</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexWriterTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建 lucene用于写入索引的核心类: IndexWriter</span></span><br><span class="line">        Directory d = FSDirectory.open(<span class="keyword">new</span> File(<span class="string">"F:\\index"</span>));</span><br><span class="line">        Analyzer analyzer = <span class="keyword">new</span> StandardAnalyzer();</span><br><span class="line">        IndexWriterConfig conf = <span class="keyword">new</span> IndexWriterConfig(Version.LATEST,analyzer);</span><br><span class="line"></span><br><span class="line">        IndexWriter indexWriter = <span class="keyword">new</span> IndexWriter(d,conf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 添加原始文档数据</span></span><br><span class="line">        Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">        doc.add(<span class="keyword">new</span> LongField(<span class="string">"id"</span>,<span class="number">1</span>, Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> StringField(<span class="string">"title"</span>,<span class="string">"母爱满满！哈里王子梅根王妃母亲节晒宝宝脚丫"</span>, Field.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> TextField(<span class="string">"content"</span>,<span class="string">"哈里王子梅根王妃在社交媒体上发图文"</span>, Field.Store.YES));</span><br><span class="line"></span><br><span class="line">        indexWriter.addDocument(doc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 提交文档数据</span></span><br><span class="line">        indexWriter.commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 释放资源</span></span><br><span class="line">        indexWriter.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-Lucene的索引修改"><a href="#2-1-3-Lucene的索引修改" class="headerlink" title="2.1.3  Lucene的索引修改"></a>2.1.3  Lucene的索引修改</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 索引的修改</span></span><br><span class="line">   <span class="comment">//  修改后的数据都在文档的最后面,   先删除, 后添加</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateIndexTest</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">       <span class="comment">//1. 创建indexWriter对象</span></span><br><span class="line">       Directory d = FSDirectory.open(<span class="keyword">new</span> File(<span class="string">"F:\\index"</span>));</span><br><span class="line">       IndexWriterConfig conf = <span class="keyword">new</span> IndexWriterConfig(Version.LATEST,<span class="keyword">new</span> IKAnalyzer());</span><br><span class="line">       IndexWriter indexWriter = <span class="keyword">new</span> IndexWriter(d,conf);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//2. 创建一个修改后文档对象</span></span><br><span class="line"></span><br><span class="line">       Document doc = <span class="keyword">new</span> Document();</span><br><span class="line">       doc.add(<span class="keyword">new</span> StringField(<span class="string">"id"</span>,<span class="string">"6"</span>, Field.Store.YES));</span><br><span class="line">       doc.add(<span class="keyword">new</span> TextField(<span class="string">"title"</span>,<span class="string">"这是修改后的数据"</span>, Field.Store.YES));</span><br><span class="line"></span><br><span class="line">       <span class="comment">//3. 执行修改 : 在执行修改的时候, 不要使用id字段, 因为id字段在书写的时候使用的Long类型, long类型是要分词的</span></span><br><span class="line">       <span class="comment">//  如果想根据id来修改数据, 需要将id的类型更改为StringField(不分词)</span></span><br><span class="line">       indexWriter.updateDocument(<span class="keyword">new</span> Term(<span class="string">"title"</span>,<span class="string">"杭州"</span>),doc);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//4. 提交修改</span></span><br><span class="line">       indexWriter.commit();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//5. 释放资源</span></span><br><span class="line">       indexWriter.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-Lucene-的索引删除"><a href="#2-1-4-Lucene-的索引删除" class="headerlink" title="2.1.4  Lucene 的索引删除"></a>2.1.4  Lucene 的索引删除</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 索引的删除</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteIndexTest</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">       <span class="comment">//1. 创建indexWriter对象 :  增删改</span></span><br><span class="line">       Directory d = FSDirectory.open(<span class="keyword">new</span> File(<span class="string">"F:\\index"</span>));</span><br><span class="line">       IndexWriterConfig conf = <span class="keyword">new</span> IndexWriterConfig(Version.LATEST,<span class="keyword">new</span> IKAnalyzer());</span><br><span class="line">       IndexWriter indexWriter = <span class="keyword">new</span> IndexWriter(d,conf);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//2. 执行删除索引操作</span></span><br><span class="line">       <span class="comment">//indexWriter.deleteAll(); //删除所有</span></span><br><span class="line">       indexWriter.deleteDocuments(<span class="keyword">new</span> Term(<span class="string">"title"</span>,<span class="string">"修改"</span>));  <span class="comment">// 根据词条删除</span></span><br><span class="line">       <span class="comment">//indexWriter.deleteDocuments(query);  根据条件删除</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//3. 提交</span></span><br><span class="line">       indexWriter.commit();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//4. 释放资源</span></span><br><span class="line">       indexWriter.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-5-查询索引"><a href="#2-1-5-查询索引" class="headerlink" title="2.1.5 查询索引"></a>2.1.5 查询索引</h4><p><strong>查询解析器查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//索引查询的入门代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexSearcherTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span>  Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建lucene用于查询索引核心对象</span></span><br><span class="line">        IndexReader r  = DirectoryReader.open(FSDirectory.open(<span class="keyword">new</span> File(<span class="string">"F:\\index"</span>)));</span><br><span class="line">        IndexSearcher indexSearcher = <span class="keyword">new</span> IndexSearcher(r);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 添加查询的条件</span></span><br><span class="line">        <span class="comment">//2.1 通过查询解析器的方式来获取query对象</span></span><br><span class="line">        QueryParser queryParser = <span class="keyword">new</span> QueryParser(<span class="string">"content"</span>,<span class="keyword">new</span> IKAnalyzer());</span><br><span class="line">        <span class="comment">// 参数: 表示的是用户输入的内容</span></span><br><span class="line">        Query query = queryParser.parse(<span class="string">"蓝瘦香菇吊炸天"</span>);</span><br><span class="line">        <span class="comment">//3. 执行查询</span></span><br><span class="line">        <span class="comment">// 参数1: 查询的条件</span></span><br><span class="line">        <span class="comment">//参数2:  查询前几个</span></span><br><span class="line">        <span class="comment">// 返回值: 结果集</span></span><br><span class="line">        <span class="comment">//      主要包含二部分的内容:  1)  查询的结果集的得分数组   2) 查询的总条数</span></span><br><span class="line">        TopDocs topDocs = indexSearcher.search(query, Integer.MAX_VALUE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 获取数据</span></span><br><span class="line">        ScoreDoc[] scoreDocs = topDocs.scoreDocs; <span class="comment">// 得分文档的数组</span></span><br><span class="line">        <span class="keyword">int</span> totalHits = topDocs.totalHits; <span class="comment">//查询的总条数</span></span><br><span class="line">        <span class="comment">// ScoreDoc :得分文档对象, 包含二部分内容:  1)  文档的id  2) 文档的得分</span></span><br><span class="line">        <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">            <span class="keyword">float</span> score = scoreDoc.score; <span class="comment">//得分</span></span><br><span class="line">            <span class="keyword">int</span> docId = scoreDoc.doc; <span class="comment">//文档的id</span></span><br><span class="line"></span><br><span class="line">            Document document = indexSearcher.doc(docId);</span><br><span class="line">            String id = document.get(<span class="string">"id"</span>);</span><br><span class="line">            String title = document.get(<span class="string">"title"</span>);</span><br><span class="line">            String content = document.get(<span class="string">"content"</span>);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"文档的得分为:"</span> + score +<span class="string">" 文档的id:"</span>+id+<span class="string">" 文档的标题:"</span>+title+<span class="string">" 文档的内容:"</span>+ content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>组合查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多样化查询:  BooleanQuery  组合查询</span></span><br><span class="line">    <span class="comment">//   组合查询本身自己是没有任何的条件的, 将其他的条件组合在一块, 共同作用于着整个的查询</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *   MUST : 必须,    表示查询出来的结果必须是这个条件中的数据</span></span><br><span class="line"><span class="comment">     *   MUST_NOT:  不必须 , 表示查询出来的结果必须不能包含这个条件中的数据</span></span><br><span class="line"><span class="comment">     *   SHOULD:   应该 ,   表示查询出来的结果, 如果有这个条件中数据就显示, 没有就不显示, 对整个结果没有太大影响</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">booleanQueryTest</span><span class="params">()</span><span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        BooleanQuery query = <span class="keyword">new</span> BooleanQuery();</span><br><span class="line"></span><br><span class="line">        NumericRangeQuery numericRangeQuery = NumericRangeQuery.newLongRange(<span class="string">"id"</span>,<span class="number">2L</span>,<span class="number">3L</span>,<span class="keyword">true</span>,<span class="keyword">true</span>);</span><br><span class="line">        query.add(numericRangeQuery, BooleanClause.Occur.MUST);</span><br><span class="line"></span><br><span class="line">        TermQuery termQuery = <span class="keyword">new</span> TermQuery(<span class="keyword">new</span> Term(<span class="string">"title"</span>,<span class="string">"lucene"</span>));</span><br><span class="line">        query.add(termQuery, BooleanClause.Occur.MUST);</span><br><span class="line"></span><br><span class="line">        publicQuery(query);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-Solr"><a href="#3-Solr" class="headerlink" title="3. Solr"></a>3. Solr</h2><p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/assets/1557968128127.png" alt="1557968128127"></p>
<p>​    solr是一个企业级的搜索应用服务器, 如果想要连接solr需要通过发送http请求方法 , solr是基于lucene来来实现的.</p>
<h3 id="3-1-solr的目录介绍"><a href="#3-1-solr的目录介绍" class="headerlink" title="3.1 solr的目录介绍"></a>3.1 solr的目录介绍</h3><ul>
<li>solr的根目录</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E7%9A%84%E7%9B%AE%E5%BD%95%E4%BB%8B%E7%BB%8D.png" alt></p>
<ul>
<li>example的目录</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E7%9A%84example%E7%9B%AE%E5%BD%95.png" alt></p>
<h3 id="3-2-solr服务的启动"><a href="#3-2-solr服务的启动" class="headerlink" title="3.2  solr服务的启动"></a>3.2  solr服务的启动</h3><h4 id="3-2-1-solr的启动一-start-jar（了解）"><a href="#3-2-1-solr的启动一-start-jar（了解）" class="headerlink" title="3.2.1 solr的启动一: start.jar（了解）"></a>3.2.1 solr的启动一: start.jar（了解）</h4><p>启动步骤:</p>
<ul>
<li>1) 打开cmd窗口</li>
<li>2) 切换目录到solr的example的目录下</li>
<li>3) 执行 java -jar start.jar</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E7%9A%84%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F1.png" alt></p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E7%9A%84%E6%96%B9%E5%BC%8F%E4%B8%80%E5%90%AF%E5%8A%A8%E5%90%8E%E7%9A%84%E7%95%8C%E9%9D%A2.png" alt></p>
<p>注意:  由于jar包已经内置了一个web服务器(jetty) , 其默认的访问的为8983</p>
<h4 id="3-2-2-solr的启动二-solr-war"><a href="#3-2-2-solr的启动二-solr-war" class="headerlink" title="3.2.2 solr的启动二:  solr.war"></a>3.2.2 solr的启动二:  solr.war</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果想要部署solr.war, 需要先准备一个tomcat, 建议准备一个全新的tomcat, 不要使用原来已经添加其他项目的tomcat, 将这个全新的tomcat放置在一个没有中文和空格的目录下, 建议放置在solr的目录下</span><br></pre></td></tr></table></figure>

<p>需要保证: tomcat是可以正常启动的, 否则不要往下执行, 先解决tomcat的问题. </p>
<p>​    一般出现的问题闪退的原因:  JAVA_HOME配置有问题  </p>
<p>启动步骤:</p>
<ul>
<li>1) 首先打开example目录下的webapps目录下</li>
<li>2) 拷贝此目录下的solr.war , 将其复制到tomcat的webapps目录下</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E5%90%AF%E5%8A%A82--1.png" alt></p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E5%90%AF%E5%8A%A82--2.png" alt></p>
<ul>
<li>3) 启动tomcat, 将war包进行解压, 然后关闭tomcat并将war包删除或者更改后缀名即可<ul>
<li>将其原有war包更改的主要目的是防止再次解压, 导致原有的设置失效</li>
</ul>
</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E5%90%AF%E5%8A%A82--3.png" alt></p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E5%90%AF%E5%8A%A82--4.png" alt></p>
<ul>
<li>4) 将资料中&lt;&lt;tomcat运行solr所需要的jar包&gt;&gt;复制到tomcat中solr的web-inf下的lib目录中 ,classes目录复制到web-inf下</li>
</ul>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Csolr%E5%90%AF%E5%8A%A82--5.png" alt></p>
<ul>
<li>5)将example中solr的目录建议复制到和tomcat同级的目录下(方便管理)<ul>
<li>复制后, 建议将这个索引库目录名称更改为solr-home</li>
</ul>
</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E5%90%AF%E5%8A%A82--7.png" alt></p>
<ul>
<li>6) 打开tomcat的bin目录找到Catalina.bat文件, 将其右键打开</li>
<li>7) 将下列参数设置到此文件中即可<ul>
<li>参数 :   set “JAVA_OPTS=-Dsolr.solr.home=目录位置”  </li>
<li>注意: 目录位置就是刚刚复制过来的solr的目录</li>
</ul>
</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/solr%E5%90%AF%E5%8A%A82--8.png" alt></p>
<ul>
<li>8) 启动tomcat,访问localhost:8080/solr即可</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/assets/1557970335432.png" alt="1557970335432"></p>
<h3 id="3-3-solr的管理界面"><a href="#3-3-solr的管理界面" class="headerlink" title="3.3  solr的管理界面"></a>3.3  solr的管理界面</h3><ul>
<li>仪表盘</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E4%BB%AA%E8%A1%A8%E7%9B%98.png" alt></p>
<ul>
<li>日志窗口:  记录solr在启动过程中和启动后执行过程中的执行信息</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E6%97%A5%E5%BF%97%E7%AA%97%E5%8F%A3.png" alt></p>
<p>解决警告信息:</p>
<p>​    第一步: 将solr的安装包中依赖包的两个目录, 复制到solr的索引库中</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E8%AD%A6%E5%91%8A%E5%8E%BB%E6%8E%89%E7%AC%AC%E4%B8%80%E6%AD%A5.png" alt></p>
<p>​    第二步: 打开索引库中的collection1中conf目录, 将solrconfig.xml右键打开, 去掉两个../即可</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E8%AD%A6%E5%91%8A%E5%8E%BB%E6%8E%89%E7%AC%AC%E4%BA%8C%E6%AD%A5.png" alt></p>
<ul>
<li>core 窗口: 用于配置solr的索引库<ul>
<li>solr中支持配置和管理多个索引库, 就像数据库中有多个database是一样的</li>
</ul>
</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/core%E7%9A%84%E5%9B%BE%E8%A7%A3.png" alt></p>
<p>如何配置多个索引库呢?</p>
<p>​    简单方案:  将collection1复制一个,然后删除其data文件夹并修改core.properties配置文件即可</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AAcore%E7%AC%AC%E4%B8%80%E6%AD%A5.png" alt></p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AAcore%E7%AC%AC%E4%BA%8C%E6%AD%A5.png" alt></p>
<ul>
<li>core selector: core的选择器, 用来针对不同core进行操作的</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/core_selector.png" alt></p>
<p>针对core selector的详细讲解:</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/core_selector%E7%9A%84%E8%AF%A6%E8%A7%A3.png" alt></p>
<h4 id="3-3-1-使用solr的管理界面进行添加索引"><a href="#3-3-1-使用solr的管理界面进行添加索引" class="headerlink" title="3.3.1 使用solr的管理界面进行添加索引"></a>3.3.1 使用solr的管理界面进行添加索引</h4><p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E5%86%99%E5%85%A5%E7%B4%A2%E5%BC%95.png" alt></p>
<h4 id="3-3-2-使用solr的管理界面进行查询索引"><a href="#3-3-2-使用solr的管理界面进行查询索引" class="headerlink" title="3.3.2 使用solr的管理界面进行查询索引"></a>3.3.2 使用solr的管理界面进行查询索引</h4><p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E6%9F%A5%E8%AF%A2%E7%AA%97%E5%8F%A3%E8%AF%A6%E8%A7%A3.png" alt></p>
<blockquote>
<p>在进行查询的时候, 都是使用代码的形式进行查询索引的, 然后展示给用户的系统, 而solr提供的管理界面, 主要是为了方便程序员对solr进行管理和测试的, 比如query: 在代码中编写查询的代码后, 我们并不知道查询后可能会展示什么内容, 或者并不知道展示的内容是否正确, 使用管理界面测试一下, 看一下结果和代码的结果是否一样</p>
</blockquote>
<h3 id="3-4-solr的配置文件"><a href="#3-4-solr的配置文件" class="headerlink" title="3.4 solr的配置文件"></a>3.4 solr的配置文件</h3><p>core.properties: 设置索引库的名称</p>
<h4 id="3-4-1-solrConfig-xml-solr的核心配置文件-了解"><a href="#3-4-1-solrConfig-xml-solr的核心配置文件-了解" class="headerlink" title="3.4.1 solrConfig.xml : solr的核心配置文件(了解)"></a>3.4.1 solrConfig.xml : solr的核心配置文件(了解)</h4><p>​    solrconfig.xml 配置文件主要定义了 solr 的一些处理规则，包括索引数据的存放 位置，更新，删除，查询的一些规则配置, solr相关的优化的时候, 需要使用这个配置文件。</p>
<p>​    一般此文件不需要进行修改, 采取默认即可</p>
<h4 id="3-4-2-schema-xml-solr约束文件"><a href="#3-4-2-schema-xml-solr约束文件" class="headerlink" title="3.4.2 schema.xml: solr约束文件:"></a>3.4.2 schema.xml: solr约束文件:</h4><p>​    Solr中会提前对文档中的字段进行定义，并且在schema.xml中对这些字段的属性进行约束，例如：字段数据类型、字段是否索引、是否存储、是否分词等等</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"example"</span> <span class="attr">version</span>=<span class="string">"1.5"</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">   <span class="comment">&lt;!--  不能删除</span></span><br><span class="line"><span class="comment">   --&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_version_"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_root_"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 不删除</span></span><br><span class="line"><span class="comment">   --&gt;</span> </span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		field标签:  字段标签, </span></span><br><span class="line"><span class="comment">			作用: 用来定义索引库中的字段的, 在solr中字段需要提前定义好, 而在lucene中手动定义的</span></span><br><span class="line"><span class="comment">			name :  字段的名称</span></span><br><span class="line"><span class="comment">			type :  字段的类型</span></span><br><span class="line"><span class="comment">			indexed :  是否(保存)分词</span></span><br><span class="line"><span class="comment">			stored  : 是否保存原始数据</span></span><br><span class="line"><span class="comment">			required :  是否必须存在</span></span><br><span class="line"><span class="comment">			multiValued  : 是否是多值的, 如果为true, 表示当前这个字段是一个数组</span></span><br><span class="line"><span class="comment">			</span></span><br><span class="line"><span class="comment">		id字段默认是必须存在的, 也就是说在创建document的时候, 在文档中必须要有id字段</span></span><br><span class="line"><span class="comment">			id表示的文档的唯一标识, 在solr中需要程序员自己进行维护, 在lucene中是由lucene自己维护的</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">required</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> /&gt;</span> </span><br><span class="line">        </span><br><span class="line">  </span><br><span class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">  </span><br><span class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"text"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		dynamicField : 动态字段(动态域)</span></span><br><span class="line"><span class="comment">			作用 :  在solr中需要提前定义一些字段的, 但是不能够保证将所有的字段都提前的定义好,动态域中将可以帮助我们动态的生成一些字段</span></span><br><span class="line"><span class="comment">			</span></span><br><span class="line"><span class="comment">			假设, 在solr启动后, 想要使用docurl的字段, 但是这个字段并没有在schema文件中定义, 如果做?</span></span><br><span class="line"><span class="comment">				1) 将solr停机, 然后更改schema的文件, 添加一个新的字段</span></span><br><span class="line"><span class="comment">					但是服务器一般启动后, 是不允许随意的停机的</span></span><br><span class="line"><span class="comment">				2) 使用动态域字段 :  docurl_i		</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_i"</span>  <span class="attr">type</span>=<span class="string">"int"</span>    <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_is"</span> <span class="attr">type</span>=<span class="string">"int"</span>    <span class="attr">indexed</span>=<span class="string">"true"</span>  <span class="attr">stored</span>=<span class="string">"true"</span>  <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	     uniqueKey : 表示的文档的唯一主键是那个字段 , 默认是id字段, 当然也可以进行修改</span></span><br><span class="line"><span class="comment">				设置的这个唯一的字段, 类型必须是string, 字段是必须存在的, 不能是多值</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">uniqueKey</span>&gt;</span>id<span class="tag">&lt;/<span class="name">uniqueKey</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		copyField : 复制字段(复制域)	</span></span><br><span class="line"><span class="comment">			作用 :  主要是用于查询阶段使用的, 实现查询一个字段相当于查询多个字段</span></span><br><span class="line"><span class="comment">			source :  来源</span></span><br><span class="line"><span class="comment"> 			dest   :  目的地</span></span><br><span class="line"><span class="comment">			</span></span><br><span class="line"><span class="comment">	    以下这两个标签描述的意思:</span></span><br><span class="line"><span class="comment">			将content 和 title字段中的索引数据复制一份出来, 放置到text的字段中, 这样当查询text字段的时候, 就相当于查询title和content</span></span><br><span class="line"><span class="comment">		复制域中目的地的字段必须是一个多值的字段</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"content"</span> <span class="attr">dest</span>=<span class="string">"text"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"title"</span> <span class="attr">dest</span>=<span class="string">"text"</span>/&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		fieldType : 字段类型, </span></span><br><span class="line"><span class="comment">			作用:  定义字段类型的</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"string"</span> <span class="attr">class</span>=<span class="string">"solr.StrField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"boolean"</span> <span class="attr">class</span>=<span class="string">"solr.BoolField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"int"</span> <span class="attr">class</span>=<span class="string">"solr.TrieIntField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"float"</span> <span class="attr">class</span>=<span class="string">"solr.TrieFloatField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"long"</span> <span class="attr">class</span>=<span class="string">"solr.TrieLongField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"double"</span> <span class="attr">class</span>=<span class="string">"solr.TrieDoubleField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">class</span>=<span class="string">"solr.TrieDateField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>要求: 能够自己手动的添加字段即可, 能够根据需要添加一个复制域的标签</p>
<p>例如:  想要添加一个 docurl的字段, 这个字段的类型是string, 字段的需要进行分词的, 原始也需要保存, 不是一个多值的字段</p>
<p>例如: 娱乐头条中, 当查询新闻数据的时候, 一般需要根据那些字段来查询?</p>
<h4 id="3-4-3-引入ik分词器"><a href="#3-4-3-引入ik分词器" class="headerlink" title="3.4.3  引入ik分词器"></a>3.4.3  引入ik分词器</h4><ul>
<li>第一步: 导入ik相关的依赖包<ul>
<li>将三个文件放置在tomcat&gt;webapps&gt;solr&gt;WEB-INF&gt;lib下(此步骤在部署solr到tomcat中的时候, 就已经导入了)</li>
</ul>
</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E5%BC%95%E5%85%A5ik%E5%88%86%E8%AF%8D%E5%99%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AD%A5.png" alt></p>
<ul>
<li>第二步: 导入ik相关的配置文件(ik配置文件, 扩展词典和停止词典)<ul>
<li>将三个文件放置在tomcat&gt;webapps&gt;solr&gt;WEB-INF&gt;classes下(此步骤, 在部署solr到tomcat中的时候, 已经导入)</li>
</ul>
</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E5%BC%95%E5%85%A5ik%E5%88%86%E8%AF%8D%E5%99%A8%E7%9A%84%E7%AC%AC%E4%BA%8C%E6%AD%A5.png" alt></p>
<ul>
<li>第三步, 在schema.xml配置文件中自定义一个字段类型, 引入ik分词器</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ik"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/%E5%BC%95%E5%85%A5ik%E5%88%86%E8%AF%8D%E5%99%A8%E7%9A%84%E7%AC%AC%E4%B8%89%E6%AD%A5.png" alt></p>
<ul>
<li>第四步: 为对应的字段设置为text_ik类型即可</li>
</ul>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C%E5%BC%95%E5%85%A5ik%E5%88%86%E8%AF%8D%E5%99%A8%E7%9A%84%E7%AC%AC%E5%9B%9B%E6%AD%A5.png" alt></p>
<h3 id="3-5-solr的客户端操作-solrj"><a href="#3-5-solr的客户端操作-solrj" class="headerlink" title="3.5. solr的客户端操作: solrj"></a>3.5. solr的客户端操作: solrj</h3><p>​    solrj是Apache官方提供的一套java开发的, 用于操作solr服务的API, 通过这套API可以让java程序与solr服务进行交互, 让java程序可以直接操作solr服务进行增删改查</p>
<p>solrj的官网网址: <a href="https://wiki.apache.org/solr/Solrj" target="_blank" rel="noopener">https://wiki.apache.org/solr/Solrj</a></p>
<h4 id="3-5-1-solr的基本入门程序"><a href="#3-5-1-solr的基本入门程序" class="headerlink" title="3.5.1 solr的基本入门程序"></a>3.5.1 solr的基本入门程序</h4><ul>
<li>第一步: 导入相关的jar包</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.solr<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>solr-solrj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--日志的包, solrj执行需要一个日志包--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>编写入门程序(写入索引)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写入索引的入门代码(原生写入)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">indexWriterTest01</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建solrj连接solr的远程服务对象 : #表示的页面的路径 不带#号才是访问的接口路径</span></span><br><span class="line">        SolrServer solrServer = <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://localhost:8080/solr/collection1"</span>);</span><br><span class="line">        <span class="comment">//2. 添加文档数据</span></span><br><span class="line">        SolrInputDocument doc = <span class="keyword">new</span> SolrInputDocument();</span><br><span class="line">        doc.addField(<span class="string">"id"</span>,<span class="number">1</span>);</span><br><span class="line">        doc.addField(<span class="string">"title"</span>,<span class="string">"连休三天！端午节放假通知来了"</span>);</span><br><span class="line">        doc.addField(<span class="string">"content"</span>,<span class="string">"请广大市民提前安排好工作生活，节日期间注意安全，度过一个平安、祥和的节日假期。"</span>);</span><br><span class="line"></span><br><span class="line">        solrServer.add(doc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 提交数据</span></span><br><span class="line">        solrServer.commit();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-5-2-使用solrj写入索引-使用javabean进行写入"><a href="#3-5-2-使用solrj写入索引-使用javabean进行写入" class="headerlink" title="3.5.2 使用solrj写入索引(使用javabean进行写入)"></a>3.5.2 使用solrj写入索引(使用javabean进行写入)</h4><p>一个标准的javaBean都具备什么条件?</p>
<ul>
<li>1) 成员属性必须私有化</li>
<li>2) 必须为成员属性提供get 和 set方法</li>
<li>3) 必须提供无参的构造方法</li>
<li>4)  必须要实现序列化接口: 只要实现可这个接口, 那么这个对象支持网络io操作及持久化到磁盘的操作</li>
</ul>
<p>pojo类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class News implements Serializable &#123;</span><br><span class="line">    private String id;</span><br><span class="line">    private String title;</span><br><span class="line">    private String content;</span><br><span class="line">    private String docurl;</span><br><span class="line">   //  省略了 get  和  set方法  和 toString的方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>代码的实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接写入一个javaBean对象</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">indexWriterTest03</span><span class="params">()</span> <span class="keyword">throws</span>  Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建solrj连接solr的服务对象</span></span><br><span class="line">        SolrServer solrServer = <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://localhost:8080/solr/collection1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 添加文档数据</span></span><br><span class="line">        News news = <span class="keyword">new</span> News(<span class="string">"8"</span>,<span class="string">"国务院定了！11月底前在全国全面实施“携号转网”"</span>,<span class="string">"国务院总理李克强5月14日主持召开国务院常务会议，部署进一步推动网络提速降费，发挥扩内需稳就业惠民生多重效应"</span>,<span class="string">"http://baijiahao.baidu.com/s?id=1633615346318630206"</span>);</span><br><span class="line"></span><br><span class="line">        solrServer.addBean(news);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 提交数据</span></span><br><span class="line">        solrServer.commit();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/assets/1557980015574.png" alt="1557980015574"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">出现错误的原因: solr并不知道在pojo中那个字段是solr的字段, 所以solr报错显示没有定义字段错误</span><br><span class="line">	解决方案: 告诉solr那个是你的字段</span><br><span class="line">		添加一个字段的注解即可 :  @Field</span><br><span class="line">如果字段的值 和 solr中字段不匹配, 可以在注解后面添加指定的字段值, 标识将pojo中属性放置到这个字段中</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1557980446558.png" alt="1557980446558"></p>
<h4 id="3-5-3-删除索引"><a href="#3-5-3-删除索引" class="headerlink" title="3.5.3 删除索引"></a>3.5.3 删除索引</h4><p>修改索引: 只要保证id一致, 就是修改索引的操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除索引</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delIndexTest04</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建solrj连接solr的而服务对象</span></span><br><span class="line">        SolrServer solrServer = <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://localhost:8080/solr/collection1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 添加删除的条件</span></span><br><span class="line">        <span class="comment">//solrServer.deleteById("change.me");  根据id删除</span></span><br><span class="line">        <span class="comment">//solrServer.deleteByQuery("*:*"); //删除所有</span></span><br><span class="line">        solrServer.deleteByQuery(<span class="string">"id:1"</span>); <span class="comment">//删除所有</span></span><br><span class="line">        <span class="comment">//3. 执行删除</span></span><br><span class="line"></span><br><span class="line">        solrServer.commit();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-5-4-查询操作"><a href="#3-5-4-查询操作" class="headerlink" title="3.5.4 查询操作"></a>3.5.4 查询操作</h4><h5 id="3-5-4-1-查询入门代码-原始"><a href="#3-5-4-1-查询入门代码-原始" class="headerlink" title="3.5.4.1 查询入门代码(原始)"></a>3.5.4.1 查询入门代码(原始)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1) 查询索引的入门代码(原生)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">indexSearcherTest01</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">    <span class="comment">//1. 创建solrj连接solr的服务对象</span></span><br><span class="line">    SolrServer solrServer = <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://localhost:8080/solr/collection1"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 封装查询的条件</span></span><br><span class="line">    SolrQuery query = <span class="keyword">new</span> SolrQuery(<span class="string">"*:*"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. 执行查询</span></span><br><span class="line">    QueryResponse response = solrServer.query(query);</span><br><span class="line">    <span class="comment">//4. 获取数据</span></span><br><span class="line">    SolrDocumentList documentList = response.getResults();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (SolrDocument document : documentList) &#123;</span><br><span class="line">        String id = (String) document.get(<span class="string">"id"</span>);</span><br><span class="line">        String content = (String) document.get(<span class="string">"content"</span>);</span><br><span class="line">        ArrayList&lt;String&gt; title = (ArrayList&lt;String&gt; ) document.get(<span class="string">"title"</span>);</span><br><span class="line">        String docurl_i = (String) document.get(<span class="string">"docurl_i"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(id+<span class="string">"  "</span>+title+<span class="string">"   "</span>+content+<span class="string">"  "</span>+ docurl_i);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-5-4-2-返回javaBean"><a href="#3-5-4-2-返回javaBean" class="headerlink" title="3.5.4.2 返回javaBean"></a>3.5.4.2 返回javaBean</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.  查询索引, 返回javaBean对象</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">indexSearcherTest02</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建solrj 连接solr的服务对象</span></span><br><span class="line">        SolrServer solrServer  =  <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://localhost:8080/solr/collection1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 封装查询条件</span></span><br><span class="line">        SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery(<span class="string">"*:*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 执行查询</span></span><br><span class="line">        QueryResponse response = solrServer.query(solrQuery);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 获取数据  : 采用的第三种方式来解决数据无法转换的问题</span></span><br><span class="line">        ArrayList&lt;News&gt; newsArrayList = <span class="keyword">new</span> ArrayList&lt;News&gt;();</span><br><span class="line">        SolrDocumentList documentList = response.getResults();</span><br><span class="line">        <span class="keyword">for</span> (SolrDocument document : documentList) &#123;</span><br><span class="line">            News news = <span class="keyword">new</span> News();</span><br><span class="line"></span><br><span class="line">            String id = (String) document.get(<span class="string">"id"</span>);</span><br><span class="line">            news.setId(id);</span><br><span class="line">            String content = (String) document.get(<span class="string">"content"</span>);</span><br><span class="line">            news.setContent(content);</span><br><span class="line">            ArrayList&lt;String&gt; title = (ArrayList&lt;String&gt; ) document.get(<span class="string">"title"</span>);</span><br><span class="line">            news.setTitle(title.get(<span class="number">0</span>));</span><br><span class="line">            String docurl_i = (String) document.get(<span class="string">"docurl_i"</span>);</span><br><span class="line">            news.setDocurl(docurl_i);</span><br><span class="line"></span><br><span class="line">            newsArrayList.add(news);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(newsArrayList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day07_search_solr/%E7%AC%94%E8%AE%B0/assets/1557990116016.png" alt="1557990116016"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">原因: 不能将一个集合类型的数据转换成一个字符串</span><br><span class="line"></span><br><span class="line">解决方案:</span><br><span class="line">	1) schema.xml中配置信息: 将多值的字段更改为单值字段</span><br><span class="line">		注意: 一旦将约束文件修改了, 建议将数据全部清空, 重新添加, 所以在添加数据之前, 一定要确认配置文件是没有问题的</span><br><span class="line">	2) 将javaBean中指定的字段更改为对应的类型即可</span><br><span class="line">	3) 手动人为封装即可(推荐使用)</span><br></pre></td></tr></table></figure>

<h5 id="3-5-4-2-复杂查询"><a href="#3-5-4-2-复杂查询" class="headerlink" title="3.5.4.2 复杂查询"></a>3.5.4.2 复杂查询</h5><ul>
<li>抽取一个公共的查询的方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽取一个公共的查询的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">publicQuery</span><span class="params">(SolrQuery query)</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建 solrj连接solr的服务对象</span></span><br><span class="line">        SolrServer solrServer  = <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://localhost:8080/solr/collection1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 封装查询的条件</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 执行查询</span></span><br><span class="line"></span><br><span class="line">        QueryResponse response = solrServer.query(query);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 获取数据</span></span><br><span class="line">        List&lt;News&gt; newsList = response.getBeans(News.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (News news : newsList) &#123;</span><br><span class="line">            System.out.println(news);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在创建SolrQuery时，我们填写的Query语句，可以有以下高级写法：</p>
<p>查询语句中如果有特殊字符，需要转义，可以使用：  ” ”</p>
<p>1、匹配所有文档：*:* （通配符？和 * ：“*”表示匹配任意字符；“?”表示匹配出现的位置）</p>
<p>2、布尔操作：AND、OR和NOT布尔操作（推荐使用大写，区分普通字段）</p>
<p>3、子表达式查询（子查询）：可以使用“()”构造子查询。 比如：(query1 AND query2) OR (query3 AND query4)</p>
<p>4、相似度查询：</p>
<p>（1）默认相似度查询：title:appla~，此时默认编辑距离是2</p>
<p>（2）指定编辑距离的相似度查询：对模糊查询可以设置编辑距离，可选0<del>2的整数：title:appla</del>1。</p>
<p>5、范围查询（Range Query）：solre支持对数字、日期甚至文本的范围查询，并且两端范围。结束的范围可以使用“*”通配符。</p>
<p>（1）日期范围（ISO-8601 时间GMT）：birthday:[1990-01-01T00:00:00.000Z TO 1999-12-31T24:59:99.999Z]</p>
<p>（2）数字：age:[2000 TO *] </p>
<p>（3）文本：content:[a TO a]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复杂查询:</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">complexQueryTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1.  通配符查询 :  *   ?</span></span><br><span class="line">        <span class="comment">// SolrQuery query = new SolrQuery("content:luce*");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 相似度查询   和 lucene的模糊查询    最大编辑次数 2次</span></span><br><span class="line">        <span class="comment">// 可以在~的后面修改最大的编辑次数范围 0~2 , 如果编写的范围不是这个范围之内的数字, 那么solr修改为默认值 2</span></span><br><span class="line">        <span class="comment">// SolrQuery query = new SolrQuery("content:lucene~");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 范围查询 :    对 数字, 文本, 日期进行范围查询</span></span><br><span class="line">        <span class="comment">// 格式 :  字段名称 :  [min TO MAX]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据id查询, 是文本范围呢?  还是数字范围 ?     是文本范围, 因为id类似是字符串</span></span><br><span class="line">        <span class="comment">// 文本范围:  按照字典的顺序进行排列</span></span><br><span class="line">        <span class="comment">// 字典顺序 :   1 2 3 4 5 6 7 8  9 10  11 12  13   22  33  44  55</span></span><br><span class="line">        <span class="comment">//      按照字典顺序:从小到大  1 10 11 12 13  2 22  3 33 4 44  5  55  6 7 8  9</span></span><br><span class="line">        <span class="comment">//  例如: 手机通信录, 微信通信录</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 日期范围:  在solr中对于日期的格式是有明确规定的, 在solr中采用日期的格式为国际通用时间UTC(国际协调时间)格式</span></span><br><span class="line">        <span class="comment">//  UTC格式 :  yyyy-MM-dd'T'HH:mm:ss'Z'</span></span><br><span class="line">        <span class="comment">//  国际时间 和 中国时间  是有时间差 :  8个小时, 中国属于东八区  和大于国际时间八个小时</span></span><br><span class="line">        <span class="comment">// 所以当向solr中存储一个日期类型的值:  日期的时间差的问题, 建议转换成国内时间</span></span><br><span class="line">        <span class="comment">//  如果拿到的时候, 本身就是国内时间值, 采用字符串的形式写入到solr的索引库, 那么solr索引库不会将其-8小时的</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//  SolrQuery query = new SolrQuery("id:[1 TO 5]");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.  布尔操作  和  lucene中BooleanQuery 是类似的</span></span><br><span class="line">        <span class="comment">/**  SOLR      LUCENE</span></span><br><span class="line"><span class="comment">         *   AND       MUST</span></span><br><span class="line"><span class="comment">         *   NOT       MUST_NOT</span></span><br><span class="line"><span class="comment">         *   OR        SHOULD</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// 5 子表达式 :  布尔查询中派生出来查询的方式  id:[2 TO 5] AND (content:lucene OR title:5)</span></span><br><span class="line">        SolrQuery query = <span class="keyword">new</span> SolrQuery(<span class="string">"id:[2 TO 5] AND (content:lucene OR title:5) NOT content:3"</span>);  <span class="comment">// 5 2 3 4 7</span></span><br><span class="line"></span><br><span class="line">        publicQuery(query);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SolrQuery :  将这个对象可以看做是整个搜索的界面对象</p>
<p>​    所以整个查询的界面中所有的参数都可以通过SolrQuery来封装查询处理</p>
<p>​    支持复杂的查询方式 </p>
</blockquote>
<h3 id="3-6-solr的高级"><a href="#3-6-solr的高级" class="headerlink" title="3.6. solr的高级"></a>3.6. solr的高级</h3><h4 id="3-6-1-solr的高亮"><a href="#3-6-1-solr的高亮" class="headerlink" title="3.6.1 solr的高亮"></a>3.6.1 solr的高亮</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// solr的高亮</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highlighterTest01</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建solrj连接solr的服务对象</span></span><br><span class="line">        SolrServer solrServer = <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://localhost:8080/solr/collection1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 封装查询的条件 : SolrQuery</span></span><br><span class="line">        SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery(<span class="string">"content:solr是apache节日期间"</span>);</span><br><span class="line">        <span class="comment">//2.1 高亮的参数</span></span><br><span class="line">        solrQuery.setHighlight(<span class="keyword">true</span>); <span class="comment">//开启高亮</span></span><br><span class="line">        solrQuery.addHighlightField(<span class="string">"title"</span>);</span><br><span class="line">        solrQuery.addHighlightField(<span class="string">"content"</span>);</span><br><span class="line">        solrQuery.setHighlightSimplePre(<span class="string">"&lt;font color='red'&gt;"</span>);</span><br><span class="line">        solrQuery.setHighlightSimplePost(<span class="string">"&lt;/font&gt;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 执行查询</span></span><br><span class="line">        QueryResponse response = solrServer.query(solrQuery);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 获取数据</span></span><br><span class="line">        List&lt;News&gt; newsList = response.getBeans(News.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 获取高亮</span></span><br><span class="line">        <span class="comment">// 最外层的MAP:  KEY  高亮的文档的id值</span></span><br><span class="line">        <span class="comment">//  内层的map : key  表示的高亮的字段</span></span><br><span class="line">        <span class="comment">//   list集合:  存储对应高亮字段的高亮的内容, 一般来说list集合中只有一个值</span></span><br><span class="line">        Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; highlighting = response.getHighlighting();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (News news : newsList) &#123;</span><br><span class="line"></span><br><span class="line">            String id = news.getId();</span><br><span class="line">            Map&lt;String, List&lt;String&gt;&gt; listMap = highlighting.get(id);</span><br><span class="line">            List&lt;String&gt; list = listMap.get(<span class="string">"title"</span>);</span><br><span class="line">            <span class="keyword">if</span>(list != <span class="keyword">null</span>  &amp;&amp; list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">// 表示有title的高亮</span></span><br><span class="line">                news.setTitle(list.get(<span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            list = listMap.get(<span class="string">"content"</span>);</span><br><span class="line">            <span class="keyword">if</span>(list != <span class="keyword">null</span>  &amp;&amp; list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">// 表示有title的高亮</span></span><br><span class="line">                news.setContent(list.get(<span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(news);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-6-2-solr的排序"><a href="#3-6-2-solr的排序" class="headerlink" title="3.6.2 solr的排序"></a>3.6.2 solr的排序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sortTest02</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建solrj连接solr的服务对象</span></span><br><span class="line">        SolrServer solrServer = <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://localhost:8080/solr/collection1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 封装查询的条件 : SolrQuery</span></span><br><span class="line">        SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery(<span class="string">"content:solr是apache节日期间"</span>);</span><br><span class="line">        <span class="comment">//2.1 高亮的参数</span></span><br><span class="line">        solrQuery.setHighlight(<span class="keyword">true</span>); <span class="comment">//开启高亮</span></span><br><span class="line">        solrQuery.addHighlightField(<span class="string">"title"</span>);</span><br><span class="line">        solrQuery.addHighlightField(<span class="string">"content"</span>);</span><br><span class="line">        solrQuery.setHighlightSimplePre(<span class="string">"&lt;font color='red'&gt;"</span>);</span><br><span class="line">        solrQuery.setHighlightSimplePost(<span class="string">"&lt;/font&gt;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.2  添加排序的条件</span></span><br><span class="line">        solrQuery.setSort(<span class="string">"id"</span>, SolrQuery.ORDER.asc);</span><br><span class="line">        <span class="comment">//3. 执行查询</span></span><br><span class="line">        QueryResponse response = solrServer.query(solrQuery);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 获取数据</span></span><br><span class="line">        List&lt;News&gt; newsList = response.getBeans(News.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 获取高亮</span></span><br><span class="line">        <span class="comment">// 最外层的MAP:  KEY  高亮的文档的id值</span></span><br><span class="line">        <span class="comment">//  内层的map : key  表示的高亮的字段</span></span><br><span class="line">        <span class="comment">//   list集合:  存储对应高亮字段的高亮的内容, 一般来说list集合中只有一个值</span></span><br><span class="line">        Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; highlighting = response.getHighlighting();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (News news : newsList) &#123;</span><br><span class="line"></span><br><span class="line">            String id = news.getId();</span><br><span class="line">            Map&lt;String, List&lt;String&gt;&gt; listMap = highlighting.get(id);</span><br><span class="line">            List&lt;String&gt; list = listMap.get(<span class="string">"title"</span>);</span><br><span class="line">            <span class="keyword">if</span>(list != <span class="keyword">null</span>  &amp;&amp; list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">// 表示有title的高亮</span></span><br><span class="line">                news.setTitle(list.get(<span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            list = listMap.get(<span class="string">"content"</span>);</span><br><span class="line">            <span class="keyword">if</span>(list != <span class="keyword">null</span>  &amp;&amp; list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">// 表示有title的高亮</span></span><br><span class="line">                news.setContent(list.get(<span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(news);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-6-3-solr的分页"><a href="#3-6-3-solr的分页" class="headerlink" title="3.6.3 solr的分页"></a>3.6.3 solr的分页</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分页</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pageTest03</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> page = <span class="number">3</span>; <span class="comment">//当前页</span></span><br><span class="line">        <span class="keyword">int</span> pageSize = <span class="number">2</span>; <span class="comment">// 每页的条数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建solrj连接solr的服务对象</span></span><br><span class="line">        SolrServer solrServer = <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://localhost:8080/solr/collection1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 封装查询的条件 : SolrQuery</span></span><br><span class="line">        SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery(<span class="string">"content:solr是apache节日期间"</span>);</span><br><span class="line">        <span class="comment">//2.1 高亮的参数</span></span><br><span class="line">        solrQuery.setHighlight(<span class="keyword">true</span>); <span class="comment">//开启高亮</span></span><br><span class="line">        solrQuery.addHighlightField(<span class="string">"title"</span>);</span><br><span class="line">        solrQuery.addHighlightField(<span class="string">"content"</span>);</span><br><span class="line">        solrQuery.setHighlightSimplePre(<span class="string">"&lt;font color='red'&gt;"</span>);</span><br><span class="line">        solrQuery.setHighlightSimplePost(<span class="string">"&lt;/font&gt;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.2  添加排序的条件</span></span><br><span class="line">        solrQuery.setSort(<span class="string">"id"</span>, SolrQuery.ORDER.asc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.3 封装分页的条件</span></span><br><span class="line">        solrQuery.setStart( (page-<span class="number">1</span>)*pageSize );</span><br><span class="line">        solrQuery.setRows(pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 执行查询</span></span><br><span class="line">        QueryResponse response = solrServer.query(solrQuery);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 获取数据</span></span><br><span class="line">        List&lt;News&gt; newsList = response.getBeans(News.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 获取高亮</span></span><br><span class="line">        <span class="comment">// 最外层的MAP:  KEY  高亮的文档的id值</span></span><br><span class="line">        <span class="comment">//  内层的map : key  表示的高亮的字段</span></span><br><span class="line">        <span class="comment">//   list集合:  存储对应高亮字段的高亮的内容, 一般来说list集合中只有一个值</span></span><br><span class="line">        Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; highlighting = response.getHighlighting();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (News news : newsList) &#123;</span><br><span class="line"></span><br><span class="line">            String id = news.getId();</span><br><span class="line">            Map&lt;String, List&lt;String&gt;&gt; listMap = highlighting.get(id);</span><br><span class="line">            List&lt;String&gt; list = listMap.get(<span class="string">"title"</span>);</span><br><span class="line">            <span class="keyword">if</span>(list != <span class="keyword">null</span>  &amp;&amp; list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">// 表示有title的高亮</span></span><br><span class="line">                news.setTitle(list.get(<span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            list = listMap.get(<span class="string">"content"</span>);</span><br><span class="line">            <span class="keyword">if</span>(list != <span class="keyword">null</span>  &amp;&amp; list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">// 表示有title的高亮</span></span><br><span class="line">                news.setContent(list.get(<span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(news);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>总结: </p>
<ul>
<li>1) solr的基本概念:  solr是apache官方提供的一个企业级的全文搜索应用服务器, 连接solr服务器需要发送http请求, solr的底层是lucene</li>
<li>2) solr的部署 :<ul>
<li>2.1) solr的下载 : 1) 通过官网(只能下载最新版本) 2) 下载历史的版本 3) 使用资料提供好的</li>
<li>2.2) solr的目录的结构 : </li>
<li>2.3) solr的部署:  <ul>
<li>2.3.1)  一种采用start.jar 的方式部署(最简单的方式),内置了jetty的服务器(8983)</li>
<li>2.3.2) 采用 solr.war方式进行部署(步骤比较多), 部署在tomcat中  (需要参考文档部署成功)</li>
</ul>
</li>
</ul>
</li>
<li>3) solr的管理界面 :  会操作即可<ul>
<li>3.1) 检测某一个字段的分词效果</li>
<li>3.2) 使用管理界面能够添加索引和修改索引</li>
<li>3.3) 使用管理界面可以查询索引数据</li>
<li>3.4) 查看某一个字段在索引库中分词内容</li>
</ul>
</li>
<li>4) solr的配置文件 :<ul>
<li>4.1) core.properties:  配置索引库的名称</li>
<li>4.2) solrConfig.xml:  对solr的服务器进行相关的配置</li>
<li>4.3) <strong>schema.xml</strong> : 对solr的索引库进行相关的配置</li>
</ul>
</li>
<li>5) solr的客户端操作:solrj的操作   ——-会操作, 尽可能不用查看文档内容<ul>
<li>使用solrj完成 对solr索引库的CURD操作</li>
<li>使用solrj完成对solr高级的操作: 高亮, 排序, 分页</li>
</ul>
</li>
</ul>
<p>常见错误:</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1563685934033.png" alt="1563685934033"></p>
<hr>
<h2 id="4-solrCloud"><a href="#4-solrCloud" class="headerlink" title="4.solrCloud"></a>4.solrCloud</h2><p>​    SolrCloud(solr 云)是Solr提供的分布式搜索方案，当你需要大规模，容错，分布式索引和检索能力时使用 SolrCloud。当一个系统的索引数据量少的时候是不需要使用SolrCloud，当<strong>索引量很大</strong>，<strong>搜索请求并发很高</strong>，这时需要使用SolrCloud来满足这些需求。</p>
<h3 id="1solrCloud的结构"><a href="#1solrCloud的结构" class="headerlink" title="1solrCloud的结构"></a>1solrCloud的结构</h3><p>​    SolrCloud为了降低单机的处理压力，需要由多台服务器共同来完成索引和搜索任务。实现的思路是将索引数据进行Shard（分片）拆分，每个分片由多台的服务器共同完成，当一个索引或搜索请求过来时会分别从不同的Shard的服务器中操作索引。</p>
<p>​    SolrCloud需要Solr基于Zookeeper部署，Zookeeper是一个集群管理软件，由于SolrCloud需要由多台服务器组成，由zookeeper来进行协调管理。</p>
<p>下图是一个SolrCloud应用的例子：</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1533630926299.png" alt="1533630926299"></p>
<ul>
<li>物理结构:<ul>
<li>指定就是三台solr服务器(直白一点就是三个部署了solr的tomcat)<ul>
<li>每个tomcat中都有两个core(索引库)</li>
</ul>
</li>
</ul>
</li>
<li>逻辑结构<ul>
<li>我们把整个集群看做了一个整体(一个大的索引库), 在这个索引库下有两个分片(也就是把索引库分成两部分), 每一个分片都有三个节点(对应就是物理结果中各个tomcat的索引库),其中一个为主节点,两个备份节点</li>
</ul>
</li>
</ul>
<p>整体部署的结构图:</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1533649208319.png" alt="1533649208319"></p>
<h3 id="2-solr集群中数据的读取及分裂流程"><a href="#2-solr集群中数据的读取及分裂流程" class="headerlink" title="2. solr集群中数据的读取及分裂流程"></a>2. solr集群中数据的读取及分裂流程</h3><ul>
<li>写数据的流程</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1558141754746.png" alt="1558141754746"></p>
<blockquote>
<p>写入的流程中: 写入索引的节点是每个分片的主节点</p>
<p>请问: 如果能够让分片中数据保存均衡呢? </p>
<p>​    1) 你一下我一下(轮询)</p>
<p>​    2) hash取模计算法 :  先对数据进行hash取值, 得到一个int类型的hash值, 除于当前分片的数量, 对其取余:  0~分片的数量-1 ,  得到那个结果,  将其保存在对应编号的分片中即可</p>
<p>​    随着数量量越大, 均匀分配越好</p>
</blockquote>
<ul>
<li>读数据</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1558142487391.png" alt="1558142487391"></p>
<blockquote>
<p>读数据过程, 不需要master程序参与的, 由slave节点完成读的操作</p>
<p>在solrCloud中, 读写是分离的</p>
</blockquote>
<ul>
<li>副本分裂</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1558144177890.png" alt="1558144177890"></p>
<blockquote>
<p>如果想要删除一个分片, 必须要将这个分片进行分裂, 因为如果不分裂, 那么这个分片中是有整个索引库中一部分的数据的, 不允许删除</p>
</blockquote>
<h3 id="3-solrCloud相关的管理命令"><a href="#3-solrCloud相关的管理命令" class="headerlink" title="3. solrCloud相关的管理命令"></a>3. solrCloud相关的管理命令</h3><h4 id="3-1-创建新集群-创建一个索引库"><a href="#3-1-创建新集群-创建一个索引库" class="headerlink" title="3.1 创建新集群(创建一个索引库)"></a>3.1 创建新集群(创建一个索引库)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.72.141:8080/solr/admin/collections?action=CREATE&amp;name=collection2&amp;numShards=2&amp;replicationFactor=3&amp;maxShardsPerNode=8&amp;property.schema=schema.xml&amp;property.config=solrconfig.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">接口参数说明:</span><br><span class="line"></span><br><span class="line">action: 表示执行的操作 CREATE 创建</span><br><span class="line">name: 新集群的名称</span><br><span class="line">numShards: 分片数</span><br><span class="line">replicationFactor: 每个分片的节点数</span><br><span class="line">maxShardsPerNode: 设置每个分片的最大节点数, 默认为1</span><br><span class="line">property.schema: 指定使用的schema文件   (注意, 此文件必须在zookeeper上存在)</span><br><span class="line">property.config: 指定使用的solrConfig文件 (注意, 此文件必须在zookeeper上存在)</span><br></pre></td></tr></table></figure>

<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1533636808020.png" alt="1533636808020"></p>
<h4 id="3-2-删除core命令"><a href="#3-2-删除core命令" class="headerlink" title="3.2 删除core命令"></a>3.2 删除core命令</h4><blockquote>
<p>会将真实的索引库的数据删除, 这个命令慎用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.72.141:8080/solr/admin/collections?action=DELETE&amp;name=collection1</span><br></pre></td></tr></table></figure>

<h4 id="3-3-查询所有的Core"><a href="#3-3-查询所有的Core" class="headerlink" title="3.3 查询所有的Core"></a>3.3 查询所有的Core</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.72.141:8080/solr/admin/collections?action=LIST</span><br></pre></td></tr></table></figure>

<h4 id="3-4-显示core的状态"><a href="#3-4-显示core的状态" class="headerlink" title="3.4 显示core的状态"></a>3.4 显示core的状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.72.141:8080/solr/admin/collections?action=clusterstatus</span><br></pre></td></tr></table></figure>

<h4 id="3-5-分裂shard-扩展容量"><a href="#3-5-分裂shard-扩展容量" class="headerlink" title="3.5 分裂shard(扩展容量)"></a>3.5 分裂shard(扩展容量)</h4><p>分裂: 就是将某个分片分成两个分片</p>
<p>​    注意: 一旦分裂后, 虽然原来的分片还可以提供服务, 但是已经不再保存数据, 会将数据保存到新的分裂后的分片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.72.141:8080/solr/admin/collections?action=SPLITSHARD&amp;collection=collection2&amp;shard=shard1</span><br><span class="line"></span><br><span class="line">参数说明:</span><br><span class="line">shard: 指定要分裂的分片</span><br></pre></td></tr></table></figure>

<h4 id="3-6-删除某个分片"><a href="#3-6-删除某个分片" class="headerlink" title="3.6 删除某个分片"></a>3.6 删除某个分片</h4><blockquote>
<p>只是一个逻辑删除, 不会真正的将分片直接删除的, </p>
<p>如果要将分片数据全部删除, 需要手动一个个删除</p>
</blockquote>
<p>注意: 删除的分片必须是已经被分裂的, 或者是已经无法提供服务的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.72.141:8080/solr/admin/collections?action=DELETESHARD&amp;shard=shard2&amp;collection=collection2</span><br></pre></td></tr></table></figure>

<h3 id="4-使用solrj连接集群-完成基本的索引库操作"><a href="#4-使用solrj连接集群-完成基本的索引库操作" class="headerlink" title="4. 使用solrj连接集群, 完成基本的索引库操作"></a>4. 使用solrj连接集群, 完成基本的索引库操作</h3><h4 id="4-1-导入相关的pom依赖"><a href="#4-1-导入相关的pom依赖" class="headerlink" title="4.1 导入相关的pom依赖"></a>4.1 导入相关的pom依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.solr<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>solr-solrj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-编写代码-完成CURD"><a href="#4-2-编写代码-完成CURD" class="headerlink" title="4.2 编写代码,完成CURD"></a>4.2 编写代码,完成CURD</h4><ul>
<li>添加(修改)索引</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 添加索引数据 :</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">indexWriterTest</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">       <span class="comment">//1.创建一个solrj连接solrCloud的服务对象</span></span><br><span class="line">       <span class="comment">// 如果想要使用 node01 : 2181 这种方式, 必须保证, node01 是在本地Windows环境下的hosts文件中配置上</span></span><br><span class="line">       <span class="comment">// 验证是否配置:  打开cmd  执行: ping node01</span></span><br><span class="line">       String zkHost = <span class="string">"node01:2181,node02:2181,node03:2181"</span>;</span><br><span class="line">       CloudSolrServer solrServer = <span class="keyword">new</span> CloudSolrServer(zkHost);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//2. 设置相关的参数:    一个必须, 两个可选</span></span><br><span class="line">       solrServer.setDefaultCollection(<span class="string">"collection2"</span>); <span class="comment">// 默认连接那个索引库</span></span><br><span class="line">       <span class="comment">// zookeeper会帮助我们分配一个(不是很繁忙的节点)solrCloud的节点供我们使用,</span></span><br><span class="line">       solrServer.setZkConnectTimeout(<span class="number">5000</span>); <span class="comment">//  从zookeeper中获取连接的超时时间</span></span><br><span class="line">       solrServer.setZkClientTimeout(<span class="number">5000</span>);  <span class="comment">// 连接zookeeper的超时时间</span></span><br><span class="line">       <span class="comment">//3. 从zookeeper中获取连接</span></span><br><span class="line">       solrServer.connect();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//4. 执行添加数据的操作:</span></span><br><span class="line">       SolrInputDocument doc = <span class="keyword">new</span> SolrInputDocument();</span><br><span class="line">       doc.addField(<span class="string">"id"</span>,<span class="number">1</span>);</span><br><span class="line">       doc.addField(<span class="string">"title"</span>,<span class="string">"世界上最傻的焊接工"</span>);</span><br><span class="line">       doc.addField(<span class="string">"content"</span>,<span class="string">"其实还有比你更傻的, 把自己缝在被罩了"</span>);</span><br><span class="line">       solrServer.add(doc);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//5. 提交数据</span></span><br><span class="line">       solrServer.commit();</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除索引</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除索引</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">delIndexTest</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建一个solrj连接solrCloud的服务对象</span></span><br><span class="line">        String zkHost = <span class="string">"192.168.72.141:2181,192.168.72.142:2181,192.168.72.143:2181"</span>;</span><br><span class="line">        CloudSolrServer solrServer = <span class="keyword">new</span> CloudSolrServer(zkHost);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.1 设置相关的参数: 1个必须 两个可选</span></span><br><span class="line">        solrServer.setDefaultCollection(<span class="string">"collection2"</span>);</span><br><span class="line"></span><br><span class="line">        solrServer.setZkClientTimeout(<span class="number">5000</span>);</span><br><span class="line">        solrServer.setZkConnectTimeout(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.2 获取连接</span></span><br><span class="line">        solrServer.connect();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 添加删除的条件</span></span><br><span class="line">        solrServer.deleteById(<span class="string">"1"</span>);</span><br><span class="line">       <span class="comment">// solrServer.deleteByQuery("id:1");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 提交执行</span></span><br><span class="line">        solrServer.commit();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>查询索引</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询索引</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">indexSearcherTest</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建一个solrj连接solrCloud的服务对象</span></span><br><span class="line">        String zkHost = <span class="string">"node01:2181,node02:2181,node03:2181"</span>;</span><br><span class="line">        CloudSolrServer solrServer = <span class="keyword">new</span> CloudSolrServer(zkHost);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.1 设置相关的参数: 1个必须 两个可选</span></span><br><span class="line">        solrServer.setDefaultCollection(<span class="string">"collection2"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.2 获取连接</span></span><br><span class="line">        solrServer.connect();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 封装查询的条件</span></span><br><span class="line">        SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery(<span class="string">"*:*"</span>);</span><br><span class="line">        <span class="comment">//3. 执行查询</span></span><br><span class="line">        QueryResponse response = solrServer.query(solrQuery);</span><br><span class="line">        <span class="comment">//4. 获取数据</span></span><br><span class="line">        SolrDocumentList documentList = response.getResults();</span><br><span class="line">        <span class="keyword">for</span> (SolrDocument document : documentList) &#123;</span><br><span class="line"></span><br><span class="line">            String id = (String) document.get(<span class="string">"id"</span>);</span><br><span class="line">            String title = (String) document.get(<span class="string">"title"</span>);</span><br><span class="line">            String content = (String) document.get(<span class="string">"content"</span>);</span><br><span class="line"></span><br><span class="line">            System.out.println(id+<span class="string">"   "</span>+ title +<span class="string">"   "</span>+ content);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-搜索门户与solr服务的架构"><a href="#5-搜索门户与solr服务的架构" class="headerlink" title="5. 搜索门户与solr服务的架构"></a>5. 搜索门户与solr服务的架构</h3><p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1541863320833.png" alt="1541863320833"></p>
<p>如何实现系统通信:</p>
<p>​       1、Web-service：效率不高基于soap协议。项目中不推荐使用。 (http + xml)</p>
<p>​       2、使用restful形式的服务：http+json。很多项目中应用。如果服务太多，服务之间调用关系混乱，需要治疗服务。</p>
<p>​       3、使用dubbo。使用rpc协议进行远程调用，直接使用socket通信。传输效率高，并且可以统计出系统之间的调用关系、调用次数。<strong>分布式项目中经常采用此种方式</strong></p>
<h2 id="5-dubbox框架"><a href="#5-dubbox框架" class="headerlink" title="5.dubbox框架"></a>5.dubbox框架</h2><p>​    Dubbox 是一个分布式服务框架，其前身是阿里巴巴开源项目Dubbo ，被国内电商及互联网项目中使用，后期阿里巴巴停止了该项目的维护，当当网便在Dubbo基础上进行优化，并继续维护，为了与原有的Dubbo区分，故将其命名为<strong>Dubbox</strong>。 2016年阿里重新将dubbo进行了维护, 并在2017将dubbo贡献给apache, 目前已经成为apache的顶级的项目</p>
<p>​    Dubbox 致力于提供高性能和透明化的RPC远程服务调用方案</p>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1541863595545.png" alt="1541863595545"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">节点角色说明：</span><br><span class="line">	Provider: 暴露服务的服务提供方。</span><br><span class="line">	Consumer: 调用远程服务的服务消费方。</span><br><span class="line">	Registry: 服务注册与发现的注册中心。</span><br><span class="line">	Monitor: 统计服务的调用次调和调用时间的监控中心。</span><br><span class="line">	Container: 服务运行容器。</span><br><span class="line">调用关系说明：</span><br><span class="line">	0. 服务容器负责启动，加载，运行服务提供者。</span><br><span class="line">	1. 服务提供者在启动时，向注册中心注册自己提供的服务。</span><br><span class="line">	2. 服务消费者在启动时，向注册中心订阅自己所需的服务。</span><br><span class="line">	3. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</span><br><span class="line">	4. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</span><br><span class="line">	5. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</span><br></pre></td></tr></table></figure>

<h3 id="5-1-dubbox的基本使用"><a href="#5-1-dubbox的基本使用" class="headerlink" title="5.1 dubbox的基本使用"></a>5.1 dubbox的基本使用</h3><p>​    dubbox官方推荐使用zookeeper作为dubbox的注册中心, 负责服务地址的注册与查找,服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小。</p>
<blockquote>
<p>需注意, dubbox并没有在maven的中央仓库中存在, 需要手动将Dubbox的jar包安装到我的本地仓库中。</p>
<p>先将dubbo-2.8.4.jar包放到e:\setup, 然后输入命令</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1) 查看maven的环境变量是否存在:  打开cmd  执行 mvn -version</span><br><span class="line">2) 执行下列的命令即可</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file -Dfile=e:\setup\dubbo-2.8.4.jar -DgroupId=com.alibaba -DartifactId=dubbo -Dversion=2.8.4 -Dpackaging=jar</span><br></pre></td></tr></table></figure>

<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1546412674865.png" alt="1546412674865"></p>
<ul>
<li>1) 创建一个父工程: gossip-dubboxDemo-parent<ul>
<li>在父工程中添加如下依赖</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 集中定义依赖版本号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.2.4.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>2.8.4<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">zookeeper.version</span>&gt;</span>3.4.7<span class="tag">&lt;/<span class="name">zookeeper.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">zkclient.version</span>&gt;</span>0.1<span class="tag">&lt;/<span class="name">zkclient.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.2.8<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.spring.version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">mybatis.spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.0.9<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">freemarker.version</span>&gt;</span>2.3.23<span class="tag">&lt;/<span class="name">freemarker.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">solrj.version</span>&gt;</span>4.10.2<span class="tag">&lt;/<span class="name">solrj.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javassist.version</span>&gt;</span>3.11.0.GA<span class="tag">&lt;/<span class="name">javassist.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- spring 相关的依赖包 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- mybatis 相关的依赖包 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- springmvc的相关依赖包 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 数据库的相关依赖包 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 连接池 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 日志相关的依赖包 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--json相关的依赖--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--solr相关依赖--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.solr<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>solr-solrj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;solrj.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--测试相关--&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--dubbox相关依赖--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;dubbo.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--zookeeper相关依赖--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;zookeeper.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.sgroschupf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;zkclient.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;javassist.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>2) 创建服务提供者: dubboxdemo-service  (war工程)</p>
<ul>
<li>2.1) 添加如下内容依赖:</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- Spring --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>	</span><br><span class="line">		<span class="comment">&lt;!-- dubbo相关 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>			</span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.sgroschupf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>		</span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span>  </span><br><span class="line">	  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">	      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">	          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">	          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">	          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">	          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">	              <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span>  </span><br><span class="line">	              <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span>  </span><br><span class="line">	          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">	      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">	      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="comment">&lt;!-- 指定端口 --&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">port</span>&gt;</span>8081<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">					<span class="comment">&lt;!-- 请求路径 --&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">	  	  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2.2) 在工程的webapps下创建WEB-INF文件夹，找到web.xml,添加如下内容</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载spring容器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span>		</span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2.3) 创建一个业务的接口<ul>
<li>创建包:com.cyannote.dubboxdemo.service,用于存放业务接口</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.dubboxdemo.service;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 业务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>2.4) 创建业务实现类<ul>
<li>创建包com.cyannote.dubboxdemo.service.impl ，用于存放业务实现类。创建业务实现类：</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.dubboxdemo.service.impl;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.dubbodemo.service.UserService;</span><br><span class="line"><span class="comment">//注意：Service注解与原来不同，需要引入com.alibaba包下的</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"itcast"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>2.5) 编写配置文件<ul>
<li>在resources下创建applicationContext-service.xml ,内容如下：</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span> <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubboxdemo-service"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">"zookeeper"</span> <span class="attr">address</span>=<span class="string">"192.168.72.141:2181,192.168.72.142:2181,192.168.72.143:2181"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注意：dubbo:annotation用于扫描@Service注解。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">"com.cyannote.dubboxdemo.service"</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2.6) 测试运行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tomcat7:run</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.服务消费者开发</p>
<ul>
<li>3.1) 创建Maven工程（WAR）dubboxdemo-web ，在pom.xml引入依赖 ，同“dubboxdemo-service”工程。区别就是把tomcat插件的运行端口改为8082 。</li>
<li>3.2) 在webapps下WEB-INF 目录，找到web.xml,添加如下内容</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 解决post乱码 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>		</span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>		</span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>  	</span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载--&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext-web.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>3.3) 拷贝业务接口<ul>
<li>将“dubboxdemo-service”工程的cn.itcast.dubboxdemo.service 包以及下面的接口拷贝至此工程。</li>
</ul>
</li>
<li>3.4) 编写Controller : 包名:  cn.itcast.dubboxdemo.controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.dubboxdemo.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.dubbodemo.service.UserService;</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Reference</span></span><br><span class="line">	<span class="keyword">private</span> UserService userService;	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/showName"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">showName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userService.getName();</span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>3.5) 编写spring配置文件<ul>
<li>在src/main/resources下创建applicationContext-web.xml</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span> <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.StringHttpMessageConverter"</span>&gt;</span>  </span><br><span class="line">				<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 引用dubbo 服务 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubboxdemo-web"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">"zookeeper"</span> <span class="attr">address</span>=<span class="string">"192.168.72.141:2181,192.168.72.142:2181,192.168.72.143:2181"</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">"com.cyannote.dubboxdemo.controller"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>3.6) 测试运行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tomcat7:run</span><br><span class="line"></span><br><span class="line">在浏览器输入http://localhost:8082/user/showName.do，查看浏览器输出结果</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="F:/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/%E5%A8%B1%E4%B9%90%E5%A4%B4%E6%9D%A1/day08_search_solrCloud/%E7%AC%94%E8%AE%B0/assets/1558167764563.png" alt="1558167764563"></p>
<p>使用步骤:</p>
<p>1) 导包:  spring +dubbox+zookeeper</p>
<p>2) 添加spring的配置文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:application name=&quot;dubboxdemo-web&quot; /&gt;</span><br><span class="line">&lt;dubbo:registry protocol=&quot;zookeeper&quot; address=&quot;192.168.72.141:2181,192.168.72.142:2181,192.168.72.143:2181&quot;/&gt;</span><br><span class="line">&lt;!--只需要更改扫描包的位置--&gt;</span><br><span class="line">&lt;dubbo:annotation package=&quot;com.cyannote.dubboxdemo.controller&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>3) 在服务端添加 @service注解, 在web端添加@Reference</p>
<p>总结: </p>
<ul>
<li>solrCloud :   <ul>
<li>1) 为什么要使用solrCloud: 搜索高并发 , 索引量大</li>
<li>2) 如果部署solrCloud需要先部署一个zookeeper<ul>
<li>zookeeper: 是一个集群的管理工具, 在solrCloud中主要用来管理配置文件, 集群状态, solrCloud主节点选举</li>
</ul>
</li>
<li>3) 能够将zookeeper集群 和 solrCloud的集群搭建成功</li>
<li>4) 使用solrCloud的管理命令创建一个新的索引库(符合结构规定)</li>
<li>5) 使用solrj完成对solrCloud的操作</li>
</ul>
</li>
<li>dubbox:<ul>
<li>基本使用</li>
<li>理解: 为什么要使用dubbox</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/Search/" data-id="cjycoezq00004l47ktx50649o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-XML学习笔记" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/XML学习笔记/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:05:06.452Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/XML学习笔记/">xml笔记</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><p>内容:</p>
<p>​    1:了解XML语法 以及能够读懂常规定义的xml文件</p>
<p>​    2:要学习如何对XML文档进行解析</p>
<hr>
<p>## </p>
<h2 id="1-XML概述"><a href="#1-XML概述" class="headerlink" title="1.XML概述"></a>1.XML概述</h2><h3 id="1-1-XML简介"><a href="#1-1-XML简介" class="headerlink" title="1.1 XML简介"></a>1.1 XML简介</h3><p> <strong>XML</strong>:        eXtensible Markup Language：可扩展标记型语言<br>    标记型语言：html是标记型语言, 也是使用标签来操作<br>    可扩展：html里面的标签是固定，每个标签都有特定的含义 </p>
<p>而XML标签可以自己定义,可以写中文的标签 <person>&lt;/person、&lt;猫&gt;&lt;/猫&gt;</person></p>
<ul>
<li><p>xml用途</p>
<p>  html是用于显示数据，xml也可以显示数据（不是主要功能）<br>  xml主要功能，为了存储数据</p>
</li>
<li><p>xml是w3c组织发布的技术</p>
</li>
</ul>
<ul>
<li><p>xml的应用</p>
<p>1)不同的系统之间传输数据</p>
</li>
</ul>
<p>​       2)  用来表示生活中有关系的数据</p>
<p>​        3 )经常用在文件配置</p>
<p>​            比如现在连接数据库 肯定知道数据库的用户名和密码，数据名称 </p>
<p>​            如果修改数据库的信息，不需要修改源代码，只要修改配置文件就可以了</p>
<h3 id="1-2-XML的语法"><a href="#1-2-XML的语法" class="headerlink" title="1.2 XML的语法"></a>1.2 XML的语法</h3><ul>
<li><p><strong>Xml文件的组成部分</strong></p>
<ol>
<li><p><strong>文档声明</strong></p>
<?xml version=*'1.0'* encoding=*'UTF-8'*?>

<p>​    xml表示标签的名字</p>
<p>​    version表示当前文件的版本号</p>
<p>​    encoding表示当前编码, 需要跟文件的编码产生对应关系</p>
</li>
</ol>
</li>
</ul>
<pre><code>​    ps: standalone表示标记此文档是否独立</code></pre><ol start="2">
<li><p><strong>元素</strong></p>
<p>  xml中的元素其实就是一个个的标签<br>   标签分为两种 </p>
<pre><code>  a: 包含标签体
    理解: 尖括号全部成对儿出现, 所有的数据都用一对儿尖括号存储
b: 不包含标签体
    理解: 只有最外层的一个尖括号,括号用/标识结束, 内部的数据都用属性来编写</code></pre><p><strong>注意事项</strong>:</p>
<p>严格区分大小写；</p><p></p><p><br> 不能以字母或下划线开头；abc _abc</p>
<p>不能以xml(或XML、Xml等)开头—-W3C保留日后使用；</p>
<p>名称字符之间不能有空格或制表符；</p>
<p>名称字符之间不能使用冒号 : (有特殊用途)</p>
</li>
<li><p><strong>元素的属性</strong></p>
<p>一个元素可以有多个属性，每个属性都有它自己的名称和取值。<br> 属性值一定要用引号(单引号或双引号)引起来。<br> 属性名称的命名规范与元素的命名规范相同<br>元素中的属性是不允许重复的</p>
</li>
<li><p><strong>注释</strong></p>
<p>格式:</p>
<p>​         &lt;!—被注释的内容 – &gt;</p>
<p><strong>注意:</strong> <strong>注释不能嵌套定义</strong></p>
</li>
<li><p><strong>CDATA区</strong></p>
<p>为什么要使用CDATA区域?</p>
<p>​         如果我们在标签中写入的内容, 想要带有标签的标记符号的话, 就需要对这段内容进行转义</p>
</li>
</ol>
<ol start="6">
<li><p><strong>特殊字符</strong></p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1559027717338.png" alt="1559027717338"></p>
<p>注意:</p>
<p>​         这种转移可以达到效果, 但是如果操作的数据过多, 编写起来会非常痛苦, 所以, 可以使用CDATA区来解决此问题</p>
</li>
<li><p><strong>处理指令</strong>(PI:Processing Instruction)：了解</p>
</li>
</ol>
<h2 id="2-XML约束"><a href="#2-XML约束" class="headerlink" title="2.XML约束"></a>2.XML约束</h2><p>为什么要有约束?</p>
<p>XML都是用户自定义的标签，若出现小小的错误，软件程序将不能正确地获取文件中的内容而报错。(如：Tomcat)<br>XML技术中，可以编写一个文档来约束一个XML的书写规范，这个文档称之为约束</p>
<h3 id="2-1-DTD约束"><a href="#2-1-DTD约束" class="headerlink" title="2.1 DTD约束"></a>2.1 DTD约束</h3><ul>
<li><p><strong>如何使用DTD约束文件?</strong></p>
<p>1)    编写DTD文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!ELEMENT 书架(书+)&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;!ELEMENT 书 (书名,作者,售价)&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;!ELEMENT 书名 (#PCDATA)&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;!ELEMENT 作者 (#PCDATA)&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;!ELEMENT 售价 (#PCDATA)&gt;</span><br></pre></td></tr></table></figure>

<p>2)     在xml文件中引入DTD文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 书架 SYSTEM &quot;book.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>

<p> 引入了写好的DTD文件后, 格式就必须跟DTD文件保持一致</p>
</li>
<li><p><strong>DTD的细节</strong></p>
<p>1)<strong>语法细节</strong></p>
<p>在DTD文档中使用ELEMENT关键字来声明一个XML元素。</p>
<p>•        语法：<!ELEMENT 元素名称 使用规则></p>
<p>使用规则：</p>
<p>•        (#PCDATA):指示元素的主体内容只能是普通的文本.(Parsed Character Data)</p>
<p>•        EMPTY：用于指示元素的主体为空。比如<br></p>
<p>•        ANY:用于指示元素的主体内容为任意类型。</p>
<p>•        (子元素)：指示元素中包含的子元素</p>
<p>•        定义子元素及描述它们的关系:</p>
<p>–       如果子元素用逗号分开，说明必须按照声明顺序去编写XML文档。</p>
<p>•        如: &lt;!ELEMENT FILE (TITLE,AUTHOR,EMAIL)</p>
<p>–       如果子元素用”|”分开，说明任选其一。</p>
<p>•        如:&lt;!ELEMENT FILE (TITLE|AUTHOR|EMAIL)</p>
<p>–       用+、*、？来表示元素出现的次数</p>
<p>•        如果元素后面没有+*?:表示必须且只能出现一次</p>
<p>•        +:表示至少出现一次，一次或多次</p>
<p>•        *：表示可有可无，零次、一次或多次</p>
<p>•        ?:表示可以有也可以无，有的话只能有一次。零次或一次</p>
</li>
</ul>
<p>2)<strong>定义属性</strong></p>
<p>•        在DTD文档中使用ATTLIST关键字来为一个元素声明属性。</p>
<p>•        语法：</p>
<p>​                  &lt;!ATTLIST 元素名</p>
<p>​                          属性名1 属性值类型 设置说明</p>
<p>​                          属性名2 属性值类型 设置说明</p>
<p>​                          …</p>
<p>​                  &gt;</p>
<p>•        属性值类型：</p>
<p>–       CDATA：表示属性的取值为普通的文本字符串</p>
<p>–       ENUMERATED (DTD没有此关键字)：表示枚举，只能从枚举列表中任选其一，如(鸡肉|牛肉|猪肉|鱼肉)</p>
<p>–       ID:表示属性的取值不能重复</p>
<p>•        设置说明</p>
<p>–       #REQUIRED：表示该属性必须出现</p>
<p>–       #IMPLIED：表示该属性可有可无</p>
<p>–       #FIXED:表示属性的取值为一个固定值。语法：#FIXED “固定值”</p>
<p>直接值：表示属性的取值为该默认值</p>
<h3 id="2-2-Schema约束"><a href="#2-2-Schema约束" class="headerlink" title="2.2 Schema约束"></a>2.2 Schema约束</h3><p><strong>Schema约束自身就是一个XML文件，但它的扩展名通常为.xsd</strong></p>
<p>一个XML Schema文档通常称之为<strong>模式文档</strong>(约束文档)，遵循这个文档书写的xml文件称之为<strong>实例文档</strong>。\</p>
<p>XML Schema对<strong>名称空间</strong>支持得非常好</p>
<p>理解:</p>
<p>​         名称空间: 相当于package                    </p>
<p>​        约束文档: 编写好的Person类            </p>
<p>​         实例文档: 通过Person类创建对象</p>
<p><strong>使用Schema约束文件</strong></p>
<p>​         &lt;约束文件根标签名    xmlns=”绑定名称空间地址”</p>
<p>​                  xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance&quot;//名称空间实例" target="_blank" rel="noopener">http://www.w3.org/2001/XMLSchema-instance&quot;//名称空间实例</a></p>
<p>​                  xsi:schemaLocation=”绑定名称空间地址 约束文件路径”&gt;</p>
<hr>
<h2 id="3-XML解析"><a href="#3-XML解析" class="headerlink" title="3. XML解析"></a>3. XML解析</h2><h3 id="3-1-XML解析的两种方式"><a href="#3-1-XML解析的两种方式" class="headerlink" title="3.1 XML解析的两种方式"></a>3.1 XML解析的两种方式</h3><p><strong>DOM</strong>: 将整棵树一口气全部加载到内存当中, 我们可以非常方便的操作任意的标签和属性.<br>但是, 如果整棵树特别大的时候, 会出现内存溢出的问题</p>
<p>节点: 标签、属性、文本、甚至是换行都称之为节点</p>
<p><strong>SAX</strong>: 一个节点一个节点的进行解析</p>
<h3 id="3-2-DOM4J的方法概述"><a href="#3-2-DOM4J的方法概述" class="headerlink" title="3.2 DOM4J的方法概述"></a>3.2 DOM4J的方法概述</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取Document对象</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Document <span class="title">getDocument</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//创建SAX解析对象</span></span><br><span class="line">    SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">    <span class="comment">//解析XML文件,获得Document对象</span></span><br><span class="line">    Document document = reader.read(<span class="keyword">new</span> FileReader(<span class="string">"src/com/itheima/city.xml"</span>));<span class="comment">//传入xml文件路径</span></span><br><span class="line">    <span class="keyword">return</span> document;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Dom4J的常用方法：</span><br><span class="line">Document</span><br><span class="line"> <span class="function">Element <span class="title">getRootElement</span><span class="params">()</span> :获取根元素对象（根标签）</span></span><br><span class="line"><span class="function">Element</span></span><br><span class="line"><span class="function">	List <span class="title">elements</span><span class="params">()</span> ：获取所有的子元素</span></span><br><span class="line"><span class="function">List <span class="title">elements</span><span class="params">(String name)</span>：根据指定的元素名称来获取相应的所有的子元素</span></span><br><span class="line"><span class="function">Element <span class="title">element</span><span class="params">(String name)</span>：根据指定的元素名称来获取子元素对象,如果元素名称重复，则获取第一个元素 </span></span><br><span class="line"><span class="function">String	<span class="title">elementText</span><span class="params">(String name)</span> ：根据指定的子元素名称，来获取子元素中的文本</span></span><br><span class="line"><span class="function">String	<span class="title">getText</span><span class="params">()</span> ：获取当前元素对象的文本</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setText</span><span class="params">(String text)</span>：设置当前元素对象的文本</span></span><br><span class="line"><span class="function">String	<span class="title">attributeValue</span><span class="params">(String name)</span>：根据指定的属性名称获取其对应的值</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Element <span class="title">addAttribute</span><span class="params">(String name,String value)</span>：根据指定的属性名称和值进行添加或者修改BeanUtils的常用方法</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将修改后的数据戏写入xml文件</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write2XML</span><span class="params">(Document document)</span> <span class="keyword">throws</span> Exception,FileNotFoundException </span>&#123;</span><br><span class="line">    OutputFormat format = OutputFormat.createPrettyPrint();</span><br><span class="line">    XMLWriter writer = <span class="keyword">new</span> XMLWriter(<span class="keyword">new</span> FileOutputStream(<span class="string">"src/com/itheima/city.xml"</span>), format);</span><br><span class="line">    writer.write(document);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/XML学习笔记/" data-id="cjycoezov0001l47k34yupy18" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-SpringMVC以及SSM整合" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/SpringMVC以及SSM整合/" class="article-date">
  <time class="post-time" datetime="2019-07-21T08:00:16.743Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/SpringMVC以及SSM整合/">SpringMVC&amp;SSM整合</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><h2 id="1-SpringMVC的基本概念"><a href="#1-SpringMVC的基本概念" class="headerlink" title="1.SpringMVC的基本概念"></a>1.SpringMVC的基本概念</h2><h3 id="1-1-关于三层架构和mvc"><a href="#1-1-关于三层架构和mvc" class="headerlink" title="1.1 关于三层架构和mvc"></a>1.1 关于三层架构和mvc</h3><h4 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a><strong>三层架构</strong></h4><p>在B/S架构中，系统标准的三层架构包括：表现层、业务层、持久层。</p>
<p><strong>表现层：</strong><br>也就是我们常说的web层。它负责接收客户端请求，向客户端响应结果，通常客户端使用http协议请求web层，web需要接收http请求，完成http响应。<br>表现层包括展示层和控制层：控制层负责接收请求，展示层负责结果的展示。<br>表现层依赖业务层，接收到客户端请求一般会调用业务层进行业务处理，并将处理结果响应给客户端。<br>表现层的设计一般都使用MVC模型。（MVC是表现层的设计模型，和其他层没有关系）<br><strong>业务层：</strong><br>也就是我们常说的service层。它负责业务逻辑处理，和我们开发项目的需求息息相关。web层依赖业务层，但是业务层不依赖web层。<br>业务层在业务处理时可能会依赖持久层，如果要对数据持久化需要保证事务一致性。（也就是我们说的，事务应该放到业务层来控制）<br><strong>持久层：</strong><br>也就是我们是常说的dao层。负责数据持久化，包括数据层即数据库和数据访问层，数据库是对数据进行持久化的载体，数据访问层是业务层和持久层交互的接口，业务层需要通过数据访问层将数据持久化到数据库中。通俗的讲，持久层就是和数据库交互，对数据库表进行增删改查的。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562656075485.jpg" alt="img"></p>
<h4 id="mvc模型"><a href="#mvc模型" class="headerlink" title="mvc模型"></a>mvc模型</h4><p>mvc全名是Model view Controller,是模型(model)-视图(view)-控制器(Controller)的缩写,是一种用于设计创建Web应用程序表现层的模式.MVC中每个部分各司其职：</p>
<p>Model（模型）：<br>通常指的就是我们的数据模型。作用一般情况下用于封装数据。<br>View（视图）：<br>通常指的就是我们的jsp或者html。作用一般就是展示数据的。<br>通常视图是依据模型数据创建的。<br>Controller（控制器）：<br>是应用程序中处理用户交互的部分。作用一般就是处理程序逻辑的。 </p>
<h3 id="1-2-SpringMVC概述"><a href="#1-2-SpringMVC概述" class="headerlink" title="1.2 SpringMVC概述"></a>1.2 SpringMVC概述</h3><h4 id="SpringMVC是什么"><a href="#SpringMVC是什么" class="headerlink" title="SpringMVC是什么?"></a>SpringMVC是什么?</h4><p>SpringMVC是一种基于Java的实现MVC设计模型的请求驱动类型的轻量级Web框架，属于 Spring FrameWork 的后续产品，已经融合在Spring Web Flow里面。Spring 框架提供了构建 Web 应用程序的全功能 MVC 模块。使用 Spring 可插入的 MVC 架构，从而在使用Spring进行WEB开发时，可以选择使用 Spring 的 Spring MVC 框架或集成其他MVC开发框架，如Struts1，Xwork、Struts2等。 </p>
<p>它通过一套注解，让一个简单的Java，而无须实现任何接口。同时它还支持编程风格的请求。</p>
<h4 id="SpringMVC在三层架构中的位置"><a href="#SpringMVC在三层架构中的位置" class="headerlink" title="SpringMVC在三层架构中的位置"></a>SpringMVC在三层架构中的位置</h4><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562656700233.jpg" alt="img"></p>
<h4 id="SpringMVC的优势"><a href="#SpringMVC的优势" class="headerlink" title="SpringMVC的优势"></a>SpringMVC的优势</h4><p>1、清晰的角色划分： </p>
<p>​    前端控制器（DispatcherServlet） </p>
<p>​    请求到处理器映射器（HandlerMapping） </p>
<p>​    处理器适配器（HandlerAdapter） </p>
<p>​    视图解析器（ViewResolver） </p>
<p>​    处理器或页面控制器（Controller） </p>
<p>​    验证器（ Validator） </p>
<p>​    命令对象（Command 请求参数绑定到的对象就叫命令对象） </p>
<p>​    表单对象（Form Object 提供给表单展示和提交到的对象就叫表单对象）。 </p>
<p>2、分工明确，而且扩展点相当灵活，可以很容易扩展，虽然几乎不需要。 </p>
<p>3、由于命令对象就是一个POJO，无需继承框架特定API，可以使用命令对象直接作为业务对象。 </p>
<p>4、和Spring 其他框架无缝集成，是其它Web框架所不具备的。 </p>
<p>5、可适配，通过HandlerAdapter可以支持任意的类作为处理器。 </p>
<p>6、可定制性，HandlerMapping、ViewResolver等能够非常简单的定制。 </p>
<p>7、功能强大的数据验证、格式化、绑定机制。 </p>
<p>8、利用Spring提供的Mock对象能够非常简单的进行Web层单元测试。 </p>
<p>9、本地化、主题的解析的支持，使我们更容易进行国际化和主题的切换。 </p>
<p>10、强大的JSP标签库，使JSP编写更容易。 </p>
<p>………………还有比如风格的支持、简单的文件上传、约定大于配置的契约式编程支持、基于注解的零配置支持等等</p>
<h4 id="SpringMVC和Struts2的优劣分析"><a href="#SpringMVC和Struts2的优劣分析" class="headerlink" title="SpringMVC和Struts2的优劣分析"></a>SpringMVC和Struts2的优劣分析</h4><p><strong>共同点：</strong> </p>
<p>它们都是表现层框架，都是基于MVC模型编写的。 </p>
<p>它们的底层都离不开原始ServletAPI（HttpServletRequest、HttpServletResponse…）。 </p>
<p>它们处理请求的机制都是一个核心控制器。 </p>
<p><strong>区别：</strong> </p>
<p>Spring MVC 的入口是 Servlet, 而 Struts2 是 Filter </p>
<p>Spring MVC 是基于方法设计的，而Struts2是基于类，Struts2每次执行都会创建一个动作类。所以Spring MVC 会稍微比 Struts2 快些。 </p>
<p>Spring MVC 使用更加简洁,同时还支持 JSR303, 处理 ajax 的请求更方便 ，而struts2处理ajax的时候，需要导入一个struts2的插件包，并通过返回类型指定ajax的json数据。</p>
<p>(JSR303 是一套JavaBean参数校验的标准，它定义了很多常用的校验注解，我们可以直接将这些注解加在我们JavaBean的属性上面，就可以在需要校验的时候进行校验了。) （回去之后，有兴趣可以搜一下springMVC校验机制）</p>
<p>Struts2 的表达式使页面的开发效率相比更高些，但执行效率并没有比提升，尤其是的表单标签，远没有执行效率高。 </p>
<h2 id="2-SpringMVC的执行流程"><a href="#2-SpringMVC的执行流程" class="headerlink" title="2.SpringMVC的执行流程"></a>2.SpringMVC的执行流程</h2><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562657080272.jpg" alt="img"></p>
<h2 id="3-请求参数绑定和常用注解"><a href="#3-请求参数绑定和常用注解" class="headerlink" title="3.请求参数绑定和常用注解"></a>3.请求参数绑定和常用注解</h2><h3 id="3-1-请求参数绑定"><a href="#3-1-请求参数绑定" class="headerlink" title="3.1 请求参数绑定"></a>3.1 请求参数绑定</h3><p>（1）绑定机制</p>
<p>​        【1】表单提交的数据都是k=v格式的 username=haha&amp;password=123</p>
<p>​        【2】SpringMVC的参数绑定过程是把表单提交的请求参数，作为控制器中方法的参数进行绑定的</p>
<p>​        【3】要求：提交表单的name和参数的名称是相同的</p>
<p>（2）支持的数据类型</p>
<p>​        【1】基本数据类型和字符串类型</p>
<p>​                （1）提交表单的name和参数的名称是相同的</p>
<p>​                （2）区分大小写</p>
<p>​        【2】实体类型（JavaBean）</p>
<p>​                （1）提交表单的name和JavaBean中的属性名称需要一致</p>
<p>​                （2）如果一个JavaBean类中包含其他的引用类型，那么表单的name属性需要编写成：对象.属性 例如：address.name</p>
<p>​        【3】集合数据类型（List、map集合等）</p>
<p>​                    （1）JSP页面编写方式：list[0].属性</p>
<p>​                    （2）JSP页面编写方式：map[‘one’].属性</p>
<h3 id="3-2-自定义类型转换器"><a href="#3-2-自定义类型转换器" class="headerlink" title="3.2 自定义类型转换器"></a>3.2 自定义类型转换器</h3><p>（1）表单提交的任何数据类型全部都是字符串类型，但是后台定义Integer类型，数据也可以封装上，说明SpringMVC框架内部会默认进行数据类型转换。</p>
<p>（2）如果想自定义数据类型转换，可以实现Converter的接口</p>
<p>默认支持的日期格式是：2010/11/12，如果输入2010-11-12呢？则会报错，怎么办呢？</p>
<p>【1】自定义类型转换器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把字符串转换成日期的转换器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringToDateConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 进行类型转换的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断</span></span><br><span class="line">        <span class="keyword">if</span>(source == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"参数不能为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">            <span class="comment">// 解析字符串</span></span><br><span class="line">            Date date = df.parse(source);</span><br><span class="line">            <span class="keyword">return</span> date;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"类型转换错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>【2】注册自定义类型转换器，在springmvc.xml配置文件中编写配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册自定义类型转换器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"conversionService"</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ConversionServiceFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.cyannote.utils.StringToDateConverter"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置spring开启注解mvc的支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"conversionService"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-常用注解"><a href="#3-3-常用注解" class="headerlink" title="3.3 常用注解"></a>3.3 常用注解</h3><h4 id="RequestParam注解"><a href="#RequestParam注解" class="headerlink" title="@RequestParam注解"></a>@RequestParam注解</h4><p>作用： </p>
<p>把请求中指定名称的参数给控制器中的形参赋值。 </p>
<p>属性： </p>
<p>value：请求参数中的名称。 </p>
<p>required：请求参数中是否必须提供此参数。默认值：true。表示必须提供，如果不提供将报错。 </p>
<p>defaultValue：表示默认值，如果不传递值</p>
<h4 id="RequestBody注解"><a href="#RequestBody注解" class="headerlink" title="@RequestBody注解"></a>@RequestBody注解</h4><p>作用：<br>1：@RequestBody主要用来接收前端传递给后端的json字符串中的数据的(请求体中的数据的)<br>2：用于获取请求体内容。直接使用得到是key=value&amp;key=value…结构的数据。 get请求方式不适用。</p>
<p>属性：<br>required：是否必须有请求体。默认值是:true。<br>当取值为true时,get请求方式会报错。<br>如果取值为false，get请求得到是null。</p>
<h4 id="ResponseBody响应json数据"><a href="#ResponseBody响应json数据" class="headerlink" title="@ResponseBody响应json数据"></a>@ResponseBody响应json数据</h4><p>使用@RequestBody获取请求体数据</p>
<p>response.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(function()&#123;</span><br><span class="line">        $(<span class="string">"#btn"</span>).click(function()&#123;</span><br><span class="line"><span class="comment">//          alert("ok");</span></span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                url:<span class="string">"user/testJson"</span>,</span><br><span class="line">                contentType:<span class="string">"application/json;charset=UTF-8"</span>,</span><br><span class="line">                data:<span class="string">'&#123;"username":"tom","password":"123","age":30&#125;'</span>,</span><br><span class="line">                dataType:<span class="string">"json"</span>,</span><br><span class="line">                type:<span class="string">"post"</span>,</span><br><span class="line">                success:function(data)&#123;</span><br><span class="line">                    alert(data);</span><br><span class="line">                    alert(data.addressName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在springmvc.xml中使用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--去掉所有的静态资源，让DispatchServlet不能拦截静态资源--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:default-servlet-handler</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用@ResponseBody注解将JavaBean对象转换成Json返回</p>
<p>UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取请求体的数据，响应数据Json</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testJson"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">User <span class="title">testJson</span><span class="params">(@RequestBody User user)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 请求user</span></span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="comment">// 响应u</span></span><br><span class="line">    User u = <span class="keyword">new</span> User();</span><br><span class="line">    u.setUsername(<span class="string">"张三"</span>);</span><br><span class="line">    u.setPassword(<span class="string">"123"</span>);</span><br><span class="line">    u.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PathVariable注解"><a href="#PathVariable注解" class="headerlink" title="@PathVariable注解"></a><strong>@PathVari</strong>ab<strong>le注解</strong></h4><p>使用说明<br>作用：<br>用于绑定url中的占位符。例如：请求url中 /delete/{id}/{name}，这个{id},{name}就是url占位符。<br>传统方式：/delete?id=3&amp;name=zhangsan<br>rest风格：/delete/3/zhangsan<br>url支持占位符是spring3.0之后加入的。是springmvc支持restful风格URL的一个重要标志。<br>属性：<br>value：用于指定url中占位符名称。<br>required：是否必须提供占位符。 </p>
<h4 id="RequestHeader注解"><a href="#RequestHeader注解" class="headerlink" title="@RequestHeader注解"></a>@RequestHeader注解</h4><p>作用： </p>
<p>用于获取请求消息头。 </p>
<p>属性： </p>
<p>value：提供消息头名称 </p>
<p>required：是否必须有此消息头 </p>
<p>注： </p>
<p>在实际开发中一般不怎么用。</p>
<h4 id="CookieValue-注解"><a href="#CookieValue-注解" class="headerlink" title="@CookieValue 注解"></a>@CookieValue 注解</h4><p>作用： </p>
<p>用于把指定cookie名称的值传入控制器方法参数。 </p>
<p>属性： </p>
<p>value：指定cookie的名称。 </p>
<p>required：是否必须有此。 </p>
<h4 id="ModelAttribute注解"><a href="#ModelAttribute注解" class="headerlink" title="@ModelAttribute注解"></a>@ModelAttribute注解</h4><p>作用： </p>
<p>该注解是SpringMVC4.3版本以后新加入的。它可以用于修饰方法和参数。 </p>
<p>出现在方法上，表示当前方法会在控制器的方法执行之前，先执行。它可以修饰没有返回值的方法，也可以修饰有具体返回值的方法。 </p>
<p>出现在参数上，获取指定的数据给参数赋值。 </p>
<p>属性： </p>
<p>value：用于获取数据的key。key可以是POJO的属性名称，也可以是map结构的key。 </p>
<p>应用场景： </p>
<p>当表单提交数据不是完整的实体类数据时，保证没有提交数据的字段使用数据库对象原来的数据。 </p>
<p>​        <strong>基于POJO属性的基本使用</strong></p>
<p>anno.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;测试@ModelAttribute注解&lt;/h3&gt;</span><br><span class="line">需求： 修改用户信息，要求用户的日期不能修改 jsp的代码：</span><br><span class="line">&lt;!-- 修改用户信息 --&gt;</span><br><span class="line">&lt;form action=<span class="string">"anno/testModelAttribute"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    用户名称：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span> &gt;&lt;br/&gt;</span><br><span class="line">    用户年龄：&lt;input type=<span class="string">"text"</span> name=<span class="string">"age"</span> &gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"保存"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>AnnoController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ModelAttribute的用法</span></span><br><span class="line"><span class="meta">@ModelAttribute</span> <span class="comment">// 在执行的方法之前运行</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showModel</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"执行了showModel方法"</span>+user);</span><br><span class="line">user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * 模拟修改用户方法 * <span class="doctag">@param</span> user * <span class="doctag">@return</span> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testModelAttribute"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testModelAttribute</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"控制器中处理请求的方法：修改用户："</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>基于Map的应用场景：ModelAttribute修饰方法不带返回值</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute</span> <span class="comment">// 在执行的方法之前运行</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showModel</span><span class="params">(String username, Map&lt;String,User&gt; maps)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//模拟去数据库查询</span></span><br><span class="line">    User user = findUserByName(username);</span><br><span class="line">    maps.put(<span class="string">"abc"</span>,user);</span><br><span class="line">    System.out.println(<span class="string">"执行了showModel方法"</span>+user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * 模拟修改用户方法 * <span class="doctag">@param</span> user */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testModelAttribute"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testModelAttribute</span><span class="params">(@ModelAttribute(value = <span class="string">"abc"</span>)</span> User user) </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"控制器中处理请求的方法：修改用户："</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * 模拟去数据库查询 * <span class="doctag">@param</span> username * <span class="doctag">@return</span> User*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> User <span class="title">findUserByName</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(username);</span><br><span class="line">    user.setAge(<span class="number">19</span>);</span><br><span class="line">    user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SessionAttributes注解"><a href="#SessionAttributes注解" class="headerlink" title="@SessionAttributes注解"></a><strong>@SessionAttribute</strong>s<strong>注解</strong></h4><p>作用： </p>
<p>用于多次执行控制器方法间的参数共享。 放置到类的上面。</p>
<p>属性： </p>
<p>value：用于指定存入的属性名称 </p>
<p>type：用于指定存入的数据类型。 </p>
<p>相当于将数据存放到Session中。</p>
<h3 id="3-4-REST风格URL"><a href="#3-4-REST风格URL" class="headerlink" title="3.4 REST风格URL"></a>3.4 REST风格URL</h3><p><strong>REST</strong>（英文：Representational  State Transfer，简称REST，说的意思是：表现层状态转变，或者叫做 “表述性状态转移”）描述了一个架构样式的网络系统，REST相比于SOAP（Simple Object  Access protocol，简单对象访问协议）以及XML-RPC更加简单明了，无论是对URL的处理还是对Payload的编码，REST都倾向于用更加简单轻量的方法设计和实现。值得注意的是REST并没有一个明确的标准，而更像是一种设计的风格。 </p>
<p>它本身并没有什么实用性，其核心价值在于如何设计出符合REST风格的网络接口。</p>
<p><strong>restful的优点</strong><br>它结构清晰、符合标准、易于理解、扩展方便，所以正得到越来越多网站的采用。<br><strong>restful的特性：</strong><br>资源（Resources）：网络上的一个实体，或者说是网络上的一个具体信息。<br>它可以是一段文本、一张图片、一首歌曲、一种服务，总之就是一个具体的存在。可以用一个URI（统一资源定位符）指向它，每种资源对应一个特定的 URI 。要获取这个资源，访问它的URI就可以，因此 URI 即为每一个资源的独一无二的识别符。 </p>
<p><strong>表现层</strong>（Representation）：把资源具体呈现出来的形式，叫做它的表现层 （Representation）。<br>比如，文本可以用 txt 格式表现，也可以用 HTML 格式、XML 格式、JSON 格式表现，甚至可以采用二进制格式。<br><strong>状态转化</strong>（State Transfer）：每发出一个请求，就代表了客户端和服务器的一次交互过程。<br>HTTP协议，是一个无状态协议，即所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生“状态转化”（State Transfer）。而这种转化是建立在表现层之上的，所以就是 “表现层状态转化”。具体说，就是 HTTP 协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。它们分别对应四种基本操作：GET 用来获取资源，POST 用来新建资源，PUT 用来更新资源，DELETE 用来删除资源。</p>
<p>传统的实例：唯一的URL地址（统一资源定位符），找到对应的资源</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1562658993659.png" alt="1562658993659"></p>
<p>restful的示例： URI（统一资源标识符）</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1562659031196.png" alt="1562659031196"></p>
<p><strong>基于HiddentHttpMethodFilter的示例(REST风格代码)</strong></p>
<p>作用：<br>由于浏览器 form 表单只支持 GET 与 POST 请求，而DELETE、PUT 等 method 并不支持，Spring3.0 添加了一个过滤器，可以将浏览器请求改为指定的请求方式，发送给我们的控制器方法，使得支持 GET、POST、PUT 与DELETE 请求。<br>使用方法：<br>第一步：在web.xml中配置该过滤器。 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：请求方式必须使用post请求。 </p>
<p>第三步：按照要求提供_method请求参数，该参数的取值就是我们需要的请求方式。 </p>
<p>源码分析：</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562659232324.jpg" alt="img"></p>
<p>案例：</p>
<p>anno.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--resfful风格：jsp中示例代码：--&gt;</span><br><span class="line">&lt;!-- 保存 --&gt;</span><br><span class="line">&lt;form action=<span class="string">"anno/testPathVariable"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    用户名称：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>&gt;&lt;br/&gt;</span><br><span class="line">    &lt;!-- &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_method"</span> value=<span class="string">"POST"</span>&gt; --&gt;</span><br><span class="line">    &lt;input type="submit" value="保存"&gt;&lt;/form&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">&lt;!-- 更新 --&gt;</span><br><span class="line">&lt;form action=<span class="string">"anno/testPathVariable"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    用户名称：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_method"</span> value=<span class="string">"PUT"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"更新"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">&lt;!-- 删除 --&gt;</span><br><span class="line">&lt;form action=<span class="string">"anno/testPathVariable/1"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_method"</span> value=<span class="string">"DELETE"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"删除"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">&lt;!-- 查询一个 --&gt;</span><br><span class="line">&lt;form action=<span class="string">"anno/testPathVariable/1"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_method"</span> value=<span class="string">"GET"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"查询"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;hr/&gt;</span><br></pre></td></tr></table></figure>

<p>AnnoController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求参数</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/testPathVariable"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Hello SpringMVC!!，测试@PathVariable，新增-请求方式Post"</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;<span class="comment">// 响应结果</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 请求参数</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/testPathVariable"</span>,method = RequestMethod.PUT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Hello SpringMVC!!，测试@PathVariable，更新-请求方式Put"</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;<span class="comment">// 响应结果</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 请求参数</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/testPathVariable/&#123;uid&#125;"</span>,method = RequestMethod.DELETE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(@PathVariable(value = <span class="string">"uid"</span>)</span> Integer id)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Hello SpringMVC!!，测试@PathVariable，删除-请求方式Delete"</span>);</span><br><span class="line">    System.out.println(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;<span class="comment">// 响应结果</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 请求参数</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/testPathVariable/&#123;uid&#125;"</span>,method = RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findById</span><span class="params">(@PathVariable(value = <span class="string">"uid"</span>)</span> Integer id)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Hello SpringMVC!!，测试@PathVariable，查询一个-请求方式Get"</span>);</span><br><span class="line">    System.out.println(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;<span class="comment">// 响应结果</span></span><br></pre></td></tr></table></figure>

<p>测试结果：</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562659437984.jpg" alt="img"></p>
<h2 id="4-SpringMVC实现文件上传"><a href="#4-SpringMVC实现文件上传" class="headerlink" title="4.SpringMVC实现文件上传"></a>4.SpringMVC实现文件上传</h2><h3 id="4-1文件上传的三要素"><a href="#4-1文件上传的三要素" class="headerlink" title="4.1文件上传的三要素"></a>4.1文件上传的三要素</h3><p>A form表单的enctype取值必须是：multipart/form-data （支持二进制数据）</p>
<p>(默认值是:application/x-www-form-urlencoded) （支持传递参数，例如：?username=zhangsan&amp;age=18）</p>
<p>enctype:是表单请求正文的类型 </p>
<p>B method属性取值必须是Post </p>
<p>C 提供一个文件选择域<code>&lt;input type=&quot;file&quot; /&gt;</code></p>
<h3 id="4-2-SpringMVC传统方式文件上传"><a href="#4-2-SpringMVC传统方式文件上传" class="headerlink" title="4.2 SpringMVC传统方式文件上传"></a>4.2 SpringMVC传统方式文件上传</h3><p><strong>web.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">"2.4"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--核心控制器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--post请求中文乱码过滤--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>springmvc.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/pages/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注解驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置静态资源不过滤--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:default-servlet-handler</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.cyannote"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置文件解析器对象,要求id名称必须为multipartResolver--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>UploadController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cyannote.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****</span></span><br><span class="line"><span class="comment"> *  author:tan</span></span><br><span class="line"><span class="comment"> *  data:2019-07-09 16:54</span></span><br><span class="line"><span class="comment"> *  description:</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(path = <span class="string">"/upload"</span>)</span><br><span class="line">    <span class="comment">//MultipartFile对象名应与file的name值一致</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(HttpServletRequest request, MultipartFile upload)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"springMVC的上传文件..."</span>);</span><br><span class="line">        <span class="comment">//获取到项目根目录的upload文件夹绝对路径</span></span><br><span class="line">        String path = request.getSession().getServletContext().getRealPath(<span class="string">"/upload"</span>);</span><br><span class="line">        <span class="comment">//创建file对象</span></span><br><span class="line">        File file  = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="comment">//判断是否存在</span></span><br><span class="line">        <span class="keyword">if</span>(!file.exists())&#123;</span><br><span class="line">            file.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取文件名</span></span><br><span class="line">        String filename = upload.getOriginalFilename();</span><br><span class="line">        <span class="comment">//生成唯一标识</span></span><br><span class="line">        String uuid = UUID.randomUUID().toString().replace(<span class="string">"-"</span>,<span class="string">""</span>).toUpperCase();</span><br><span class="line">        filename = uuid + <span class="string">"_"</span> + filename;</span><br><span class="line">        <span class="comment">//使用upload对象中方法就直接上传文件</span></span><br><span class="line">        upload.transferTo(<span class="keyword">new</span> File(file,filename));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"succuss"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>index.jsp</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;文件上传&lt;/h1&gt;</span><br><span class="line">&lt;form method=<span class="string">"post"</span> action=<span class="string">"user/upload"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">"upload"</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>success.jsp</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;上传成功!&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-springmvc跨服务器方式的文件上传"><a href="#4-3-springmvc跨服务器方式的文件上传" class="headerlink" title="4.3 springmvc跨服务器方式的文件上传"></a>4.3 springmvc跨服务器方式的文件上传</h3><p>分服务器的目的:</p>
<p>在实际开发中，我们会有很多处理不同功能的服务器。例如： </p>
<p>应用服务器：负责部署我们的应用 （源码）</p>
<p>数据库服务器：运行我们的数据库 </p>
<p>缓存和消息服务器：负责处理大并发访问的缓存和消息 </p>
<p>文件服务器：负责存储用户上传文件的服务器。</p>
<p>图片服务器：负责存储用户上传的图片的信息。 </p>
<p><strong>(</strong>注意：此处说的不是服务器集群） </p>
<p>分服务器处理的目的是让服务器各司其职，从而提高我们项目的运行效率。</p>
<p><strong>第一步创建工程</strong><br><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1562663904901.png" alt="1562663904901"></p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1562664098090.png" alt="1562664098090"></p>
<p>pom.xml添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.jersey<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jersey-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.jersey<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jersey-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>UploadController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跨服务器上传</span></span><br><span class="line">   <span class="meta">@RequestMapping</span>(path = <span class="string">"/upload2"</span>)</span><br><span class="line">   <span class="comment">//MultipartFile对象名应与file的name值一致</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(MultipartFile upload)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"跨服务器上传文件..."</span>);</span><br><span class="line">       <span class="comment">//获取到项目根目录的upload文件夹绝对路径</span></span><br><span class="line">       String path = <span class="string">"http://localhost:9090/upload/"</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取文件名</span></span><br><span class="line">       String filename = upload.getOriginalFilename();</span><br><span class="line">       <span class="comment">//生成唯一标识</span></span><br><span class="line">       String uuid = UUID.randomUUID().toString().replace(<span class="string">"-"</span>,<span class="string">""</span>).toUpperCase();</span><br><span class="line">       filename = uuid + <span class="string">"_"</span> + filename;</span><br><span class="line">       <span class="comment">//上传文件</span></span><br><span class="line">       <span class="comment">//创建客户端对象</span></span><br><span class="line">       Client client = Client.create();</span><br><span class="line">       filename = path+filename;</span><br><span class="line">       <span class="comment">//连接图片服务器</span></span><br><span class="line">       WebResource webResource = client.resource(filename);</span><br><span class="line">       <span class="comment">//上传文件</span></span><br><span class="line">       webResource.put(upload.getBytes());</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"succuss"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>注意：如果抛出异常：returned a response status of 403 Forbidden</p>
<p>需要在这个存储图片的项目所在的tomcat中配置可写操作。具体的是在Tomcat目录下的conf文件夹下的web.xml中加入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-SpringMVC的异常处理"><a href="#4-4-SpringMVC的异常处理" class="headerlink" title="4.4 SpringMVC的异常处理"></a>4.4 SpringMVC的异常处理</h3><p>第一步:编写自定义异常类</p>
<p>创建包com.cyannote.exception，创建类SysException.java。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义异常类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 异常提示信息</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SysException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步:自定义异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编写异常处理器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysExceptionResolver</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 跳转到具体的错误页面的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, @Nullable Object o, Exception e)</span> </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        SysException se = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 获取到异常对象</span></span><br><span class="line">        <span class="keyword">if</span>(e <span class="keyword">instanceof</span> SysException) &#123;</span><br><span class="line">            se = (SysException) e;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            se = <span class="keyword">new</span> SysException(<span class="string">"请联系管理员"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        <span class="comment">// 存入错误的提示信息</span></span><br><span class="line">        mv.addObject(<span class="string">"message"</span>, se.getMessage());</span><br><span class="line">        <span class="comment">// 跳转的Jsp页面</span></span><br><span class="line">        mv.setViewName(<span class="string">"error"</span>);<span class="comment">// 跳转到WEB-INF/pages/error.jsp</span></span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：配置异常处理器（跳转到错误提示页面）</p>
<p>springmvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置异常处理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sysExceptionResolver"</span> <span class="attr">class</span>=<span class="string">"com.itheima.exception.SysExceptionResolver"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>第四步：修改UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义异常处理</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path=<span class="string">"/testException"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testException</span><span class="params">()</span> <span class="keyword">throws</span> SysException</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"执行了testException方法！"</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 在控制台打印</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> SysException(<span class="string">"服务器繁忙，稍后再试..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第五步：指定error.jsp错误页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> isELIgnored=<span class="string">"false"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;访问失败&lt;/h1&gt;</span><br><span class="line">$&#123;message&#125;&lt;br&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="4-5-SpringMVC中的拦截器"><a href="#4-5-SpringMVC中的拦截器" class="headerlink" title="4.5  SpringMVC中的拦截器"></a>4.5  SpringMVC中的拦截器</h4><p>Spring MVC 的处理器拦截器类似于Servlet开发中的过滤器Filter，用于对处理器（Controller）进行预处理和后处理。<br>用户可以自己定义一些拦截器来实现特定的功能（权限控制、日志处理等）。<br>谈到拦截器，还要向大家提一个词——拦截器链（Interceptor Chain）。拦截器链就是将拦截器按一定的顺序联结成一条链。在访问被拦截的方法或字段时，拦截器链中的拦截器就会按其之前定义的顺序被调用。<br>说到这里，可能大家脑海中有了一个疑问，这不是我们之前学的过滤器吗？是的它和过滤器是有几分相似，但是也有区别，接下来我们就来说说他们的区别：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">过滤器和拦截器的区别：</span><br><span class="line">区别1：</span><br><span class="line">过滤器是servlet规范中的一部分，任何java web工程都可以使用。 </span><br><span class="line">拦截器是SpringMVC框架自己的，只有使用了SpringMVC框架的工程才能用。 </span><br><span class="line">区别2：</span><br><span class="line">过滤器在url-pattern中配置了/*之后，可以对所有要访问的资源拦截。 </span><br><span class="line">拦截器它是只会拦截访问的控制器方法（只会拦截Controller） </span><br><span class="line">核心控制器设置成/，表示拦截所有请求</span><br><span class="line">核心控制器设置成*.do（*.action），表示拦截.do结尾的url请求</span><br></pre></td></tr></table></figure>

<p>它也是AOP思想的具体应用。 </p>
<p>我们要想自定义拦截器， 要求必须实现：<strong>HandlerInterceptor</strong></p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image001-1562669886036.png" alt="img"></p>
<p>第一步:自定义拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor1</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * controller方法执行前，进行拦截的方法</span></span><br><span class="line"><span class="comment">     * return true放行</span></span><br><span class="line"><span class="comment">     * return false拦截</span></span><br><span class="line"><span class="comment">     *   可以使用转发或者重定向直接跳转到指定的页面。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"访问Controller类之前执行..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步:配置拦截器<br>在springmvc.xml中配置拦截器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置拦截器类--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 哪些方法进行拦截 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/user/*"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--哪些方法不进行拦截--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mvc:exclude-mapping path="/user/save"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注册拦截器对象 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.itheima.interceptor.MyInterceptor1"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-SSM整合"><a href="#5-SSM整合" class="headerlink" title="5.SSM整合"></a>5.SSM整合</h2><h3 id="5-1搭建整合环境"><a href="#5-1搭建整合环境" class="headerlink" title="5.1搭建整合环境"></a>5.1搭建整合环境</h3><p><strong>整合说明</strong>:整合说明：SSM整合可以使用多种方式，咱们会选择XML（第三方对象） + 注解（自己new的对象）的方式</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562670159853.jpg" alt="img"></p>
<p>整合思路:</p>
<p>（1）：先搭建整合的环境</p>
<p>（2）：先把Spring的配置搭建完成</p>
<p>（3）：再使用Spring整合SpringMVC框架</p>
<p>（4）：最后使用Spring整合MyBatis框架</p>
<h3 id="5-2-登陆注册案例"><a href="#5-2-登陆注册案例" class="headerlink" title="5.2 登陆注册案例"></a>5.2 登陆注册案例</h3><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5C1562673826620.png" alt="1562673826620"></p>
<h4 id="第一步-创建实体类-创建User-java"><a href="#第一步-创建实体类-创建User-java" class="headerlink" title="第一步:创建实体类 创建User.java"></a>第一步:创建实体类 创建User.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span>  <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String number;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="keyword">private</span> String qq;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(String number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMobile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mobile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMobile</span><span class="params">(String mobile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mobile = mobile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQq</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qq;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQq</span><span class="params">(String qq)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.qq = qq;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"number='"</span> + number + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", password='"</span> + password + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", mobile='"</span> + mobile + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", qq='"</span> + qq + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", email='"</span> + email + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第二步-创建接口UserDao-java"><a href="#第二步-创建接口UserDao-java" class="headerlink" title="第二步:创建接口UserDao.java"></a>第二步:创建接口UserDao.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//登陆</span></span><br><span class="line">    <span class="meta">@Select</span>(value = <span class="string">"select * from user where number = #&#123;number&#125; and password = #&#123;password&#125;"</span>)</span><br><span class="line">    <span class="function">User <span class="title">findByNameAndPassword</span><span class="params">(User user)</span></span>;</span><br><span class="line">    <span class="comment">//注册</span></span><br><span class="line">    <span class="meta">@Insert</span>(value = <span class="string">"insert into user (number,name,password,mobile,qq,email) values (#&#123;number&#125;,#&#123;name&#125;,#&#123;password&#125;,#&#123;mobile&#125;,#&#123;qq&#125;,#&#123;email&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第三步-创建接口UserService-java及其实现类UserServiceImpl-java"><a href="#第三步-创建接口UserService-java及其实现类UserServiceImpl-java" class="headerlink" title="第三步:创建接口UserService.java及其实现类UserServiceImpl.java"></a>第三步:创建接口UserService.java及其实现类UserServiceImpl.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//登陆</span></span><br><span class="line">    <span class="function">User <span class="title">findByNameAndPassword</span><span class="params">(User user)</span></span>;</span><br><span class="line">    <span class="comment">//注册</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findByNameAndPassword</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findByNameAndPassword(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第四步-创建UserController-java和IndexController-java"><a href="#第四步-创建UserController-java和IndexController-java" class="headerlink" title="第四步:创建UserController.java和IndexController.java"></a>第四步:创建UserController.java和IndexController.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(path = <span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(User user, HttpServletRequest request)</span></span>&#123;</span><br><span class="line">        User u = userService.findByNameAndPassword(user);</span><br><span class="line">        <span class="keyword">if</span> (u==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:/login.html"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            request.getSession().setAttribute(<span class="string">"user"</span>,u);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:/index/welcome"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(path = <span class="string">"/save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = userService.saveUser(user);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:/login.html"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:/register.html"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/index"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(path = <span class="string">"/welcome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">welcome</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第五步-创建拦截器"><a href="#第五步-创建拦截器" class="headerlink" title="第五步:创建拦截器"></a>第五步:创建拦截器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//判断Session中是否存有用户信息</span></span><br><span class="line">        Object user = request.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//没有登录</span></span><br><span class="line">            response.sendRedirect(request.getContextPath()+<span class="string">"/login.html"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第六步-配置web-xml"><a href="#第六步-配置web-xml" class="headerlink" title="第六步:配置web.xml"></a>第六步:配置web.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">"2.4"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--核心控制器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--post请求乱码过滤--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="第七步-配置springmvc-xml和applicationContext-xml"><a href="#第七步-配置springmvc-xml和applicationContext-xml" class="headerlink" title="第七步:配置springmvc.xml和applicationContext.xml"></a>第七步:配置springmvc.xml和applicationContext.xml</h4><p>springmvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--导入applicationContext-service.xml--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"applicationContext-service.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--开启包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.cyannote"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注解驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/pages/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--静态资源不过滤--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:default-servlet-handler</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定拦截路径--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--不拦截--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/*.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:exclude-mapping</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/user/login"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:exclude-mapping</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/user/save"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:exclude-mapping</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/css/**"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:exclude-mapping</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/img/**"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:exclude-mapping</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/plugins/**"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:exclude-mapping</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.cyannote.interceptor.LoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>applicationContext-dao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///test03"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"abc"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--sqlSessionFactory--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启dao包映射扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mapperScanner"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.cyannote.dao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>applicationContext-service.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载applicationContext-dao.xml--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"applicationContext-dao.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"TransactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--事务注解扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"TransactionManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="第八步-页面"><a href="#第八步-页面" class="headerlink" title="第八步:页面"></a>第八步:页面</h4><p>login.html</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;form <span class="class"><span class="keyword">class</span></span>=<span class="string">"sui-form"</span> action=<span class="string">"/user/login"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">   &lt;div class="input-prepend"&gt;&lt;span class="add-on loginname"&gt;&lt;/span&gt;</span><br><span class="line">      &lt;input id=<span class="string">"prependedInput"</span> type=<span class="string">"text"</span> name=<span class="string">"number"</span> placeholder=<span class="string">"邮箱/用户名/手机号"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"span2 input-xfat"</span>&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">   &lt;div class="input-prepend"&gt;&lt;span class="add-on loginpwd"&gt;&lt;/span&gt;</span><br><span class="line">      &lt;input id=<span class="string">"prependedInput"</span> type=<span class="string">"password"</span> name=<span class="string">"password"</span> placeholder=<span class="string">"请输入密码"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"span2 input-xfat"</span>&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">   &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"setting"</span>&gt;</span><br><span class="line">      &lt;label class="checkbox inline"&gt;&lt;input name="m1" type="checkbox" value="2" checked=""&gt;自动登录&lt;/label&gt;</span><br><span class="line">      &lt;span class="forget"&gt;忘记密码？&lt;/span&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">   &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"logined"</span>&gt;</span><br><span class="line">      &lt;button class="sui-btn btn-block btn-xlarge btn-danger" type="submit"&gt;登&amp;nbsp;&amp;nbsp;录&lt;/button&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>在index.jsp中获取登录信息</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Sidebar toggle button--&gt;</span><br><span class="line">&lt;a href=<span class="string">"#"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"sidebar-toggle"</span> data-toggle=<span class="string">"offcanvas"</span> role=<span class="string">"button"</span>&gt;</span><br><span class="line">   &lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">欢迎你：$&#123;sessionScope.user.number&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/SpringMVC以及SSM整合/" data-id="cjyco8lgn0000ao7k6ictu81e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-Spring" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Spring/" class="article-date">
  <time class="post-time" datetime="2019-07-21T07:57:55.909Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Spring/">Spring笔记</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="1-Spring概述"><a href="#1-Spring概述" class="headerlink" title="1.Spring概述"></a>1.Spring概述</h2><h3 id="1-1-spring是什么"><a href="#1-1-spring是什么" class="headerlink" title="1.1 spring是什么"></a>1.1 spring是什么</h3><p>Spring是分层的Java SE/EE应用full-stack轻量级开源框架,以IOC(Inverse Of Control:反转控制)和AOP(Aspect Oriented Programming:面向切面编程)为内核,提供了展示层Spring MVC和持久层 Spring JDBC以及业务层事务管理等众多的企业级应用技术,还能整合开源世界众多著名的第三方框架和类库,逐渐成为使用最多的Java EE企业级应用开源框架.</p>
<p>什么是一站式开发:</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562120940744.jpg" alt="img"></p>
<h3 id="1-2-Spring的优势"><a href="#1-2-Spring的优势" class="headerlink" title="1.2 Spring的优势"></a>1.2 Spring的优势</h3><p><strong>1.方便解耦,简化开发(工厂模式)</strong></p>
<p>​        通过Spring提供的Ioc容器,可以将对象间的依赖关系交由spring进行控制,避免硬编码所造成的过度程序耦合.用户也不必再为单例模式类,属性文件解析等很底层的需求编写代码,可以更专注于上层的应用.</p>
<p><strong>2.Aop编程的支持(jdk动态代理,cglib动态代理)</strong></p>
<p>​        通过Spring的AOP功能,方便进行面向切面的编程,许多不容易用传统OOP(面向对象编程)实现的功能可以通过AOP轻松应付.</p>
<p>​        声明式事务的支持可以将我们从单调烦闷的事务管理代码中解脱出来，通过声明式方式灵活的进行事务的管理，提高开发效率和质量。</p>
<p><strong>3.方便程序的测试(和Junit整合)</strong></p>
<p>​        可以用非容器依赖的编程方式进行几乎所有的测试工作，测试不再是昂贵的操作，而是随手可做的事情。</p>
<p><strong>4.方便集成各种优秀框架</strong></p>
<p>​        Spring可以降低各种框架的使用难度，提供了对各种优秀框架（Struts、Hibernate、Mybatis、Hessian、Quartz、ActivityMQ、Redis等）的直接支持。</p>
<p><strong>5.降低JavaEE API的使用难度 （SSM整合）</strong></p>
<p>​        Spring对JavaEE API（如JDBC、JavaMail、远程调用等）进行了薄薄的封装层，使这些API的使用难度大为降低。</p>
<h3 id="1-3-Spring的体系结构"><a href="#1-3-Spring的体系结构" class="headerlink" title="1.3 Spring的体系结构"></a>1.3 Spring的体系结构</h3><p> <img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image001-1562121597174.png" alt="img"></p>
<h2 id="2-IOC"><a href="#2-IOC" class="headerlink" title="2.IOC"></a>2.IOC</h2><h3 id="2-1-什么是程序的耦合"><a href="#2-1-什么是程序的耦合" class="headerlink" title="2.1 什么是程序的耦合"></a>2.1 什么是程序的耦合</h3><p>​        耦合性(Coupling)，也叫耦合度，是对模块间关联程度的度量。耦合的强弱取决于模块间接口的复杂性、调用模块的方式以及通过界面传送数据的多少。模块间的耦合度是指模块之间的依赖关系，包括控制关系、调用关系、数据传递关系。模块间联系越多，其耦合性越强，同时表明其独立性越差( 降低耦合性，可以提高其独立性)。</p>
<p>​        <strong>在软件工程中，耦合指的就是就是对象之间的依赖性。</strong>对象之间的耦合越高，维护成本越高。因此对象的设计应使类和构件之间的耦合最小。软件设计中通常用耦合度和内聚度作为衡量模块独立程度的标准。划分模块的一个准则就是<strong>高内聚低耦合</strong>。</p>
<ul>
<li><p>解决程序耦合的思路一:    <strong>反射</strong></p>
<p>此时的好处是，我们的类中不再依赖具体的驱动类，此时就算删除mysql的驱动jar包，依然可以编译（运行就不要想了，没有驱动不可能运行成功的）。 </p>
<p>同时，也产生了一个新的问题，mysql驱动的全限定类名字符串是在java类中写死的，一旦要改还是要修改源码。 </p>
<p>解决这个问题也很简单，使用配置文件配置（xml或者是properties）。</p>
</li>
<li><p>解决程序耦合的思路二: <strong>工厂模式解耦</strong></p>
<p>在实际开发中我们可以把三层的对象都使用配置文件配置起来，当启动服务器应用加载的时候，让一个类中的方法通过读取配置文件，把这些对象同时创建出来并存起来。在接下来的使用的时候，直接拿过来用就好了。 </p>
<p>那么，这个读取配置文件，创建和获取三层对象的类就是工厂。</p>
</li>
</ul>
<h3 id="2-2-控制反转-Inversion-Of-Control"><a href="#2-2-控制反转-Inversion-Of-Control" class="headerlink" title="2.2 控制反转-Inversion Of Control"></a>2.2 控制反转-Inversion Of Control</h3><p>​        原来： 我们在获取对象时，都是采用new的方式.是主动的</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562122177241.jpg" alt="img"></p>
<p>现在： 我们获取对象时，同时跟工厂要，有工厂为我们查找或者创建对象。是被动的。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562122204168.jpg" alt="img"></p>
<p>​    在应用加载时，创建一个Map，用于存放三层对象。 我们把这个map称之为容器。 工厂就是负责给我们从容器中获取指定对象的类。这时候我们获取对象的方式发生了改变。而<strong>不是我们在程序中去new对象，而是通过工厂去创建对象，并且通过工厂去获取对象。</strong></p>
<p>​    <strong>这种被动接收的方式获取对象的思想就是控制反转（IOC），它是spring框架的核心之一。</strong></p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image001-1562122285744.png" alt="img"></p>
<p>明确ioc的作用： <strong>削减计算机程序的耦合(解除我们代码中的依赖关系)，将对象的创建和调用都交给spring容器去处理。</strong></p>
<h3 id="2-3-IOC读取配置文件"><a href="#2-3-IOC读取配置文件" class="headerlink" title="2.3 IOC读取配置文件"></a>2.3 IOC读取配置文件</h3><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562122682602.jpg" alt="img"></p>
<p><strong>【BeanFactory 和ApplicationContext 的区别 】</strong></p>
<p>​        BeanFactory 才是Spring 容器中的顶层接口。</p>
<p>​        ApplicationContext 是它的子接口。</p>
<p>​        BeanFactory 和ApplicationContext 的区别：</p>
<p>​        创建的方式都表示单例对象。</p>
<p>​        创建对象的时间点不一样。</p>
<p>​        ApplicationContext：只要一读取配置文件，默认情况下就会创建对象。（立即加载）</p>
<p>​        BeanFactory：什么时候使用什么时候创建对象。（延迟加载）</p>
<p><strong>【ApplicationContext 接口的实现类】</strong></p>
<p>（1）ClassPathXmlApplicationContext：它是从类的根路径下加载配置文件 推荐使用这种 </p>
<p>（2）FileSystemXmlApplicationContext： </p>
<p>它是从磁盘路径上加载配置文件，配置文件可以在磁盘的任意位置。 </p>
<p>（3）AnnotationConfigApplicationContext:</p>
<p>使用注解配置容器对象时，需要使用此类来创建spring 容器。它用来读取注解。 </p>
<p><strong>【id和name的配置】</strong></p>
<p><strong>id</strong>中不能出现特殊字符（容器中的唯一标识），name中可以出现特殊的字符（表示引用）。可以指定多个name，之间可以用分号（“；”）、空格（“ ”）或逗号（“，”）分隔开，如果没有指定id，那么第一个name为标识符，其余的为别名； 若指定了id属性，则id为标识符，所有的name均为别名。如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"alias1 alias2;alias3,alias4"</span> <span class="attr">id</span>=<span class="string">"hello1"</span> <span class="attr">class</span>=<span class="string">"com.zyh.spring3.hello.HelloWorld"</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>此时，hello1为标识符，而alias1，alias2，alias3，alias4为别名，它们都可以作为的键值；</p>
<p><strong>【实例化Beand三种方式】</strong></p>
<p>第一种：<strong>采用无参数的构造方法方式实例化（用的最多）</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--创建Bean的三种方式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 第一种方式：使用默认构造函数创建。</span></span><br><span class="line"><span class="comment">        在spring的配置文件中使用bean标签，配以id和class属性之后，且没有其他属性和标签时。</span></span><br><span class="line"><span class="comment">        采用的就是默认构造函数创建bean对象，此时如果类中没有默认构造函数，则对象无法创建。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.service.impl.AccountServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二种：<strong>采用静态工厂实例化的方式</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第二种方式：使用工厂中的静态方法创建对象（使用某个类中的静态方法创建对象，并存入spring容器) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.factory.StaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三种：<strong>采用实例工厂（非静态的）实例化的方式</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第三种方式： 使用普通工厂中的方法创建对象（使用某个类中的方法创建对象，并存入spring容器） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"instanceFactory"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.factory.InstanceFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">factory-bean</span>=<span class="string">"instanceFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>【Bean的作用访问的配置：scope的配置】</strong></p>
<p>Spring创建这个类的时候，默认采用的单例的模式进行创建的。如果想去改变单例模式，需要通过scope进行配置。<br>Scope属性中有以下几个取值:<br>    singleton            ：默认值，单例的。<br>    prototype            ：多例的。<br>    request            ：应用在web应用中，将创建的对象存入到request域中。<br>    session            ：应用在web应用中，将创建的对象存入到session域中。<br>    globalsession        ：应用在集群环境下使用。将创建的对象存入到全局的session中。</p>
<p><strong>总结：开发场景</strong></p>
<p>单例（常用）：一般创建对象单例（例如Service对象、Dao对象，数据源的对象…）</p>
<p>多例：如果spring创建数据库连接对象Connection（每个线程使用的数据库连接对象是不同的，保证线程安全）</p>
<p>​      Struts2（本身多实例，多线程），如果spring创建struts2的对象，一定是多例（了解）</p>
<h3 id="2-4-Bean的生命周期"><a href="#2-4-Bean的生命周期" class="headerlink" title="2.4 Bean的生命周期"></a>2.4 Bean的生命周期</h3><p>单例对象<br>    出生：当容器创建时对象出生<br>    活着：只要容器还在，对象一直活着<br>    死亡：容器销毁，对象消亡<br>    总结：单例对象的生命周期和容器相同<br>多例对象<br>    出生：当我们使用对象时spring框架为我们创建<br>    活着：对象只要是在使用过程中就一直活着。<br>    死亡：当对象长时间不用，且没有别的对象引用时，由Java的垃圾回收器回收<br>    总结：多例对象的生命周期和对象是否被使用有关。与容器是否被销毁无关。</p>
<h3 id="2-5-Spring的依赖注入（DI"><a href="#2-5-Spring的依赖注入（DI" class="headerlink" title="2.5 Spring的依赖注入（DI)"></a><strong>2.5 Spring的依赖注入（DI)</strong></h3><p>依赖注入：Dependency Injection。它是spring框架核心ioc的具体实现。<br>我们的程序在编写时，通过控制反转，把对象的创建交给了spring，但是代码中不可能出现没有依赖的情况。ioc解耦只是降低他们的依赖关系，但不会消除。例如：我们的业务层仍会调用持久层的方法。</p>
<p>那这种业务层和持久层的依赖关系，在使用spring之后，就让spring来维护了。<br>简单的说，就是坐等框架把持久层对象传入业务层，而不用我们自己去获取。 这就是依赖注入。</p>
<hr>
<p><strong>能注入的数据:有三类</strong></p>
<p>(1)基本类型和String类型(值的注入)</p>
<p>(2)其他bean对象类型(在配置文件中或注解配置过的bean)[对象的注入]</p>
<p>(3)复杂类型/集合类型(集合的注入)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 复杂类型的注入/集合类型的注入</span></span><br><span class="line"><span class="comment">    用于给List结构集合注入的标签：</span></span><br><span class="line"><span class="comment">        list array set</span></span><br><span class="line"><span class="comment">    用于个Map结构集合注入的标签:</span></span><br><span class="line"><span class="comment">        map  props</span></span><br><span class="line"><span class="comment">    结构相同，标签可以互换</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService3"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.service.impl.AccountServiceImpl3"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数组--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--在spring的集合注入中，array，list，set是可以通用的--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arrays"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>22<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"date"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--map集合--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key001"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>赵六<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key002"</span> <span class="attr">value</span>=<span class="string">"23"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key003"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"date"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--properties集合，和map集合很相似，也是键值对，键和值只能是String--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集合属性的应用场景：初始化系统中使用常量--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"driver"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"url"</span>&gt;</span>jdbc:mysql:///itcastspring<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>能注入的方式:有三种</strong></p>
<p>构造函数注入：<em>使用的标签:constructor-arg标签出现的位置：bean标签的内部</em></p>
<p>set方法注入 ：<em>涉及的标签：property    出现的位置：bean标签的内部*</em>【推荐使用】***</p>
<p>使用p名称空间注入数据（<strong>本质还是调用set方法</strong>）</p>
<p>引入名称空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>用p名称空间完成属性注入</strong></p>
<p>语法：普通属性   p:属性名=””         对象类型  p:属性名-ref=””</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   使用p空间完成注入</span></span><br><span class="line"><span class="comment">   语法：普通属性    p:属性名=””      对象类型  p:属性名-ref=””</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService2"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.service.impl.AccountServiceImpl2"</span> <span class="attr">p:name</span>=<span class="string">"小刚"</span> <span class="attr">p:age</span>=<span class="string">"25"</span> <span class="attr">p:birthday-ref</span>=<span class="string">"now"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 配置一个日期对象 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"now"</span> <span class="attr">class</span>=<span class="string">"java.util.Date"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>这里注意：需要对属性提供set</strong>方法，方可实现注入。</p>
<h3 id="2-6-基于注解的ioc配置"><a href="#2-6-基于注解的ioc配置" class="headerlink" title="2.6 基于注解的ioc配置"></a>2.6 基于注解的ioc配置</h3><h4 id="2-6-1-注解配置-控制反转ioc"><a href="#2-6-1-注解配置-控制反转ioc" class="headerlink" title="2.6.1 注解配置-控制反转ioc"></a>2.6.1 注解配置-控制反转ioc</h4><p>用于创建对象的</p>
<p>​    他们的作用就和在XML配置文件中编写一个<bean>标签实现的功能是一样的.</bean></p>
<p>（1）@Component:<br>    作用：用于把当前类对象存入spring容器中<br>    属性：</p>
<p>​    value：用于指定bean的id。当我们不写时，它的默认值是当前类名，且首字母改小写。<br>（2）Spring中提供了@Component的衍生注解：<br>​    @Controller        ：用来修饰WEB层类（控制层）（springMVC延用了该注解）<br>​    @Service        ：用来修饰service层类（业务层）<br>​    @Repository        ：用来修饰DAO层类（持久层）<br>以上三个注解他们的作用和属性与Component是一模一样。<br>​    他们三个是spring框架为我们提供明确的三层使用的注解，使我们的三层对象更加清晰。</p>
<p><strong>配置创建容器时要扫描的包</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.cyannote"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-6-2-注解配置-依赖注入di"><a href="#2-6-2-注解配置-依赖注入di" class="headerlink" title="2.6.2 注解配置-依赖注入di"></a>2.6.2 注解配置-依赖注入di</h4><p>用于注入数据的</p>
<p>​    它们的作用就和在xml配置文件中的bean标签中写一个<property>标签的作用是一样的</property></p>
<p>  @Autowired:<br>基于spring</p>
<p>作用：自动按照类型注入。只要容器中有唯一的一个bean对象类型和要注入的变量类型匹配，就可以注入成功<br>        如果ioc容器中没有任何bean的类型和要注入的变量类型匹配，则报错。<br>        如果Ioc容器中有多个类型匹配时：<br>先按照类型匹配，如果不能匹配上，会按照属性的名称进行匹配<br>    出现位置：<br>        可以是变量上，也可以是set方法上<br>    细节：<br>        在使用注解注入时，set方法就不是必须的了。<br>    @Qualifier:<br>    配合@Autowired注解一起使用<br>作用：在按照类型注入的基础之上再按照名称注入。<br>    属性：<br>        value：用于指定注入bean的id。<br>    @Resource<br>    JSR-250标准（基于jdk）<br>作用：直接按照bean的id名称注入。如果id属性不存在，可以再按照类型注入。它可以独立使用<br>    属性：<br>        name：用于指定bean的id，如果指定name，只能按照bean的id注入，不能按照类型注入。<br>    注意：<br>以上三个注入都只能注入其他bean类型的数据，而基本类型和String类型无法使用上述注解实现（使用@Value）。</p>
<p>【原理图】</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562138553642.jpg" alt="img"></p>
<p> @Value<br>        作用：用于注入基本类型和String类型的数据<br>        属性：<br>            value：用于指定数据的值。使用${表达式}可以读取配置文件（.properties文件）的信息（一会讲…）<br>在AccountServiceImpl.java中配置：</p>
<h4 id="2-6-3注解配置-作用域"><a href="#2-6-3注解配置-作用域" class="headerlink" title="2.6.3注解配置-作用域"></a>2.6.3注解配置-作用域</h4><p>他们的作用就和在bean标签中使用scope属性实现的功能是一样的<br>    @Scope<br>    作用：用于指定bean的作用范围<br>    属性：<br>        value：指定范围的取值。常用取值：singleton prototype</p>
<h2 id="3-AOP"><a href="#3-AOP" class="headerlink" title="3.AOP"></a>3.AOP</h2><h3 id="3-1-什么是AOP"><a href="#3-1-什么是AOP" class="headerlink" title="3.1 什么是AOP"></a>3.1 什么是AOP</h3><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image001-1562155494906.png" alt="img"></p>
<p>AOP (Aspect Oriented Programing) 称为：面向切面编程，它是一种编程思想。</p>
<p>AOP采取<strong>横向抽取机制</strong>，取代了<strong>传统纵向继承</strong>体系重复性代码的编写方式（应用场景：例如性能监视、事务管理、安全检查、缓存、日志记录等）。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562155528338.jpg" alt="img"></p>
<h3 id="3-2-AOP的作用"><a href="#3-2-AOP的作用" class="headerlink" title="3.2 AOP的作用"></a>3.2 AOP的作用</h3><p>l  权限校验</p>
<p>l  日志记录</p>
<p>l  性能检测</p>
<p>l  缓存技术</p>
<p>l  事务管理</p>
<h3 id="3-3-AOP底层实现"><a href="#3-3-AOP底层实现" class="headerlink" title="3.3 AOP底层实现"></a>3.3 AOP底层实现</h3><p>代理机制。<br>2个：spring的aop的底层原理<br> 1：JDK代理（要求目标对象面向接口）（spring默认的代理方式是JDK代理）<br> 2：CGLIB代理（面向接口、面向类）</p>
<h3 id="3-4-AOP的相关术语"><a href="#3-4-AOP的相关术语" class="headerlink" title="3.4 AOP的相关术语"></a>3.4 AOP的相关术语</h3><p><strong>Joinpoint(连接点): （方法）</strong><br>        所谓连接点是指那些被拦截到的点。在spring中,这些点指的是方法,因为spring只支持方法类型的连接点。<br><strong>Pointcut(切入点): （方法）</strong><br>        所谓切入点是指我们要对哪些Joinpoint进行拦截的定义。<br><strong>Advice(通知/增强): （方法）</strong><br>        所谓通知是指拦截到Joinpoint之后所要做的事情就是通知。<br>通知的类型：前置通知,后置通知,异常通知,最终通知,环绕通知。<br>Target(目标对象):<br>        代理的目标对象。<br>Weaving(织入): （了解）<br>        是指把增强应用到目标对象来创建新的代理对象的过程。<br>        spring采用动态代理织入，而AspectJ采用编译期织入和类装载期织入。<br><strong>Proxy（代理）:</strong><br>        一个类被AOP织入增强后，就产生一个结果代理类。<br><strong>Aspect(切面): （类）</strong><br>        是切入点和通知（引介）的结合。<br>Introduction(引介): （不用了解）<br>        引介是一种特殊的通知在不修改类代码的前提下, Introduction可以在运行期为类动态地添加一些方法或Field。</p>
<h3 id="3-5-Aop的五种通知类型"><a href="#3-5-Aop的五种通知类型" class="headerlink" title="3.5 Aop的五种通知类型"></a>3.5 Aop的五种通知类型</h3><p>前置通知、后置通知、异常通知、最终通知、环绕通知。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image001-1562158772309.png" alt="img"></p>
<h2 id="4-Spring中的事务控制"><a href="#4-Spring中的事务控制" class="headerlink" title="4.Spring中的事务控制"></a>4.Spring中的事务控制</h2><h3 id="4-1-Spring事务控制我们要明确"><a href="#4-1-Spring事务控制我们要明确" class="headerlink" title="4.1 Spring事务控制我们要明确"></a>4.1 Spring事务控制我们要明确</h3><p>第一：JavaEE体系进行分层开发，事务处理位于业务层，Spring提供了分层设计业务层的事务处理解决方案。 </p>
<p>第二：spring框架为我们提供了一组事务控制的接口 。具体在后面的第二小节介绍。这组接口是在spring-tx-5.0.2.RELEASE.jar中。 </p>
<p>第三：spring的事务控制都是基于AOP的，它既可以使用编程的方式实现，也可以使用配置的方式（声明式）实现。重点是使用配置（声明式事务处理）的方式实现。 </p>
<h3 id="4-2-编程式事务控制"><a href="#4-2-编程式事务控制" class="headerlink" title="4.2 编程式事务控制"></a>4.2 编程式事务控制</h3><p>xml配置文件:</p>
<p>配置事务管理器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一：配置事务管理器=============== --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置事务管理模板</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 二：配置事务管理的模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">ref</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在业务层注入事务管理模板</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置账户的业务层--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.service.impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionTemplate"</span> <span class="attr">ref</span>=<span class="string">"transactionTemplate"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>改写业务层的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入事务管理的模板</span></span><br><span class="line">    <span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransactionTemplate</span><span class="params">(TransactionTemplate transactionTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transactionTemplate = transactionTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountById</span><span class="params">(Integer accountId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountDao.findAccountById(accountId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(<span class="keyword">final</span> String sourceName, <span class="keyword">final</span> String targetName, <span class="keyword">final</span> Float money)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"transfer...."</span>);</span><br><span class="line">        transactionTemplate.execute(<span class="keyword">new</span> TransactionCallbackWithoutResult() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doInTransactionWithoutResult</span><span class="params">(TransactionStatus transactionStatus)</span> </span>&#123;</span><br><span class="line">                System.out.println(transactionStatus.isNewTransaction() +  <span class="string">"     "</span>+transactionStatus.isCompleted());</span><br><span class="line">                <span class="comment">//2.1根据名称查询转出账户</span></span><br><span class="line">                Account source = accountDao.findAccountByName(sourceName);</span><br><span class="line">                <span class="comment">//2.2根据名称查询转入账户</span></span><br><span class="line">                Account target = accountDao.findAccountByName(targetName);</span><br><span class="line">                <span class="comment">//2.3转出账户减钱</span></span><br><span class="line">                source.setMoney(source.getMoney()-money);</span><br><span class="line">                <span class="comment">//2.4转入账户加钱</span></span><br><span class="line">                target.setMoney(target.getMoney()+money);</span><br><span class="line">                <span class="comment">//2.5更新转出账户</span></span><br><span class="line">                accountDao.updateAccount(source);</span><br><span class="line"></span><br><span class="line"><span class="comment">//                int i=1/0;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//2.6更新转入账户</span></span><br><span class="line">                accountDao.updateAccount(target);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-声明式事务处理"><a href="#4-3-声明式事务处理" class="headerlink" title="4.3 声明式事务处理"></a>4.3 声明式事务处理</h3><p><strong>配置文件</strong></p>
<ul>
<li><p>配置事务管理器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一：配置事务管理器 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置事务通知</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 二：配置事务的通知--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置aop</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 三：配置aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切入点表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pc"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.cyannote.service..*.*(..))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:pointcut</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--建立切入点表达式和事务通知的对应关系 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注解方式</strong></p>
</li>
</ul>
<p>配置AccountServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span>(readOnly = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountById</span><span class="params">(Integer accountId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountDao.findAccountById(accountId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Transactional</span>(readOnly = <span class="keyword">false</span>,propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">( String sourceName,  String targetName,  Float money)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"transfer...."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.1根据名称查询转出账户</span></span><br><span class="line">        Account source = accountDao.findAccountByName(sourceName);</span><br><span class="line">        <span class="comment">//2.2根据名称查询转入账户</span></span><br><span class="line">        Account target = accountDao.findAccountByName(targetName);</span><br><span class="line">        <span class="comment">//2.3转出账户减钱</span></span><br><span class="line">        source.setMoney(source.getMoney() - money);</span><br><span class="line">        <span class="comment">//2.4转入账户加钱</span></span><br><span class="line">        target.setMoney(target.getMoney() + money);</span><br><span class="line">        <span class="comment">//2.5更新转出账户</span></span><br><span class="line">        accountDao.updateAccount(source);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.6更新转入账户</span></span><br><span class="line">        accountDao.updateAccount(target);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结</p>
<p>Spring整体的总结：</p>
<p>总结：<br>1：IOC DI（xml和注解）<br>2：AOP（5种通知）（xml和注解）<br>3：声明式事务处理（xml和注解）</p>
<ul>
<li>DBUtils（第三方提供的）</li>
<li>JDBCTemplate（是spring提供的）</li>
<li>Mybatis（</li>
</ul>
<p>4：spring3的新特性（纯注解开发）<br>@Configuration<br>@ConnectionScan<br>@Import<br>@Bean</p>
<p>自己创建的对象：使用注解<br>第三方创建的对象（数据源…）：使用配置文件</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/Spring/" data-id="cjyco5lfp0000ow7k3ibol0ak" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-文件上传和下载" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/文件上传和下载/" class="article-date">
  <time class="post-time" datetime="2019-06-10T01:07:23.295Z" itemprop="datePublished">
    <span class="post-month">6月</span><br>
    <span class="post-day">10</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/文件上传和下载/">文件上传和下载</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="文件上传和下载"><a href="#文件上传和下载" class="headerlink" title="文件上传和下载"></a>文件上传和下载</h1><h2 id="1-文件上传"><a href="#1-文件上传" class="headerlink" title="1.文件上传"></a>1.文件上传</h2><p>导包:commons-fileupload .jar        commons-io  .jar</p>
<h3 id="1-1文件上传表单的三个要素"><a href="#1-1文件上传表单的三个要素" class="headerlink" title="1.1文件上传表单的三个要素"></a>1.1文件上传表单的三个要素</h3><ol>
<li>表单的提交的方式需要是POST</li>
<li>表单中需要有&lt;input type=”file”素，需要有name属性和值。</li>
<li>表单enctype=”multipart/form-data”</li>
</ol>
<h3 id="1-2文件上传的步骤"><a href="#1-2文件上传的步骤" class="headerlink" title="1.2文件上传的步骤"></a>1.2文件上传的步骤</h3><ol>
<li><p>创建磁盘文件项工厂</p>
<p>DiskFileItemFactory  df = new DiskFileItemFactory();</p>
</li>
<li><p>创建核心文件解析类</p>
<p>ServletFileUpload sf = new ServletFileUpload(df);</p>
</li>
<li><p>解析请求</p>
<p>list<fileitem>  list =  sf.parseRequest(request);</fileitem></p>
</li>
<li><p>遍历集合,判断请求项 for(FileItem f:list)</p>
<ol>
<li><p>若不是普通项 ! f.isFormItem()</p>
<p>获取文件名,  f.getName()</p>
<p>获取文件内容(输入流)f.getInputStream()</p>
<p>创建输出流 getServletContext.getRealPath(“存储路径”) ; OutPutStream os = new fileOutPutStream(realPath+”\“+filename);</p>
<p>IO流写入文件</p>
</li>
<li><p>普通项</p>
<p>获取参数名 f.getFileName()</p>
<p>获取内容 f.getString();//可传入编码格式解决中文乱码问题</p>
</li>
</ol>
</li>
</ol>
<h3 id="1-3-文件上传的Servlet"><a href="#1-3-文件上传的Servlet" class="headerlink" title="1.3 文件上传的Servlet"></a>1.3 文件上传的Servlet</h3><p>//1.创建磁盘文件项工厂DiskFileItemFactory</p>
<p>//创建一个核心的解析类ServletFileUpload</p>
<p>//利用核心类解析Request,解析后会得到多个部分,返回一个list集合 parseRequest</p>
<p>//遍历list集合,得到代表每个部分的文件项的对象.根据文件项判断是否为文件上传项</p>
<p>isFormItem()</p>
<p>文件上传的API</p>
<h3 id="1-4-DiskFileItemFactory-磁盘文件项工厂"><a href="#1-4-DiskFileItemFactory-磁盘文件项工厂" class="headerlink" title="1.4  DiskFileItemFactory:磁盘文件项工厂"></a>1.4  DiskFileItemFactory:磁盘文件项工厂</h3><p>sizeThreshold 设置文件上传的缓冲区大小,默认10kb</p>
<p>Repository 临时文件存放路径</p>
<h3 id="1-5-ServletFileUpload-核心解析类"><a href="#1-5-ServletFileUpload-核心解析类" class="headerlink" title="1.5  ServletFileUpload:核心解析类"></a>1.5  ServletFileUpload:核心解析类</h3><p>FileItemFactory</p>
<p>isMutipartContent:判断恩仇type属性是否为multipart/form-data</p>
<p>parseRequest:解析request对象,返回一个list集合(每个部分的文件对象)</p>
<p>setFileSizeMax:设置单个文件的大小</p>
<p>setSizeMax:设置上传文件的总大小 </p>
<p>setHeaderEncoding :设置中文文件名乱码的问题</p>
<p>setProgressListener:设置监听文件上传的进度</p>
<h3 id="1-6-FileItem"><a href="#1-6-FileItem" class="headerlink" title="1.6  FileItem"></a><strong>1.6  FileItem</strong></h3><p>isFormField:是否为普通项</p>
<p>getFieldName:获得普通项名字</p>
<p>getString:获得普通项内容</p>
<p>getName获得文件上传项名称</p>
<p>getInputStream:获得上传项内容</p>
<h3 id="1-7-getSize获得上传文件大小"><a href="#1-7-getSize获得上传文件大小" class="headerlink" title="1.7  getSize获得上传文件大小"></a>1.7  getSize获得上传文件大小</h3><p>getContentType:获得上传文件格式</p>
<p>delete删除临时文件</p>
<p>//相同文件名文件上传解决办法</p>
<p>UUID.randomUUID().toString().relplace(“-“,””)+fliename.substring(filename.lastIndexOf(“.”));</p>
<p>//同一文件夹文件过多解决</p>
<h3 id="文件上传代码"><a href="#文件上传代码" class="headerlink" title="文件上传代码"></a>文件上传代码</h3><p><strong>downloadServlet</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.OutputStream;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">import org.apache.commons.fileupload.FileItem;</span><br><span class="line">import org.apache.commons.fileupload.FileUploadException;</span><br><span class="line">import org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line">import org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line">import com.itheima.utils.UUIDUtils;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 上传Servlet</span><br><span class="line"> */</span><br><span class="line">public class uploadServlet extends HttpServlet &#123;</span><br><span class="line">	protected void doGet(HttpServletRequest request,</span><br><span class="line">			HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		doPost(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	protected void doPost(HttpServletRequest request,</span><br><span class="line">			HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			// request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">			// 1.创建磁盘文件项工厂</span><br><span class="line">			DiskFileItemFactory fileitemfactory = new DiskFileItemFactory();</span><br><span class="line">			// 设置文件缓冲区大小</span><br><span class="line">			fileitemfactory.setSizeThreshold(1024 * 1024 * 3);</span><br><span class="line">			// 设置临时文件路径</span><br><span class="line">			String path = getServletContext().getRealPath(&quot;/temp&quot;);</span><br><span class="line">			fileitemfactory.setRepository(new File(path));</span><br><span class="line">			// 2.创建核心解析类</span><br><span class="line">			ServletFileUpload si = new ServletFileUpload(fileitemfactory);</span><br><span class="line">			// 解决中文文件名乱码问题</span><br><span class="line">			si.setHeaderEncoding(&quot;UTF-8&quot;);</span><br><span class="line">			// 3.解析请求</span><br><span class="line">			List&lt;FileItem&gt; parseRequest = si.parseRequest(request);</span><br><span class="line">			// 4. 判断文件上传项</span><br><span class="line">            for (FileItem fileItem : parseRequest) &#123;</span><br><span class="line">                if (fileItem.isFormField()) &#123;</span><br><span class="line">                    // 基础项</span><br><span class="line">                    String name = f.getFieldName();</span><br><span class="line">                    // String content = f.getString();</span><br><span class="line">                    // 解决获取普通项内容乱码的问题</span><br><span class="line">                    String content = f.getString(&quot;UTF-8&quot;);</span><br><span class="line">                    System.out.println(name + &quot;---&quot; + content);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // 文件上传项</span><br><span class="line">                    // 获取文件名</span><br><span class="line">                    String filename = fileItem.getName();</span><br><span class="line">                    // 解决文件名重复的问题,UUID</span><br><span class="line">                   filename = UUIDUtils.getUUID(filename);</span><br><span class="line">                    // 处理ie浏览器文件名带路径的问题</span><br><span class="line">                    if (filename.lastIndexOf(&quot;\\&quot;) != -1) &#123;</span><br><span class="line">                        filename = filename.substring(filename</span><br><span class="line">                                                      .lastIndexOf(&quot;\\&quot;) + 1);</span><br><span class="line">                    &#125;</span><br><span class="line">                    // 获取文件内容</span><br><span class="line">                    InputStream is = fileItem.getInputStream();</span><br><span class="line">                    // 获取上传路径</span><br><span class="line">                    String realPath = getServletContext().getRealPath(</span><br><span class="line">                        &quot;/upload&quot;);</span><br><span class="line">                    // 创建输出流</span><br><span class="line">                    String path2 = UUIDUtils.getPath(filename);</span><br><span class="line">                    String path3 = realPath + path2;</span><br><span class="line">                    File file = new File(path3);</span><br><span class="line">                    if (!file.exists()) &#123;</span><br><span class="line">                        file.mkdirs();</span><br><span class="line">                    &#125;</span><br><span class="line">                    OutputStream os = new FileOutputStream(path3 + &quot;\\&quot;</span><br><span class="line">                                                           + filename);</span><br><span class="line">                    // 上传</span><br><span class="line">                    int len;</span><br><span class="line">                    byte[] b = new byte[1024];</span><br><span class="line">                    while ((len = is.read(b)) != -1) &#123;</span><br><span class="line">                        os.write(b, 0, len);</span><br><span class="line">                    &#125;</span><br><span class="line">                    // 关闭流</span><br><span class="line">                    is.close();</span><br><span class="line">                    os.close();</span><br><span class="line">                    // 删除临时文件</span><br><span class="line">                    fileItem.delete();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">		&#125; catch (FileUploadException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>upload.jsp</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">	pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">	function add() &#123;</span><br><span class="line">		document.getElementById(&quot;div1&quot;).innerHTML += &quot;&lt;div&gt;&lt;input type=&apos;file&apos; name=&apos;updowm&apos;&gt;&lt;input type=&apos;button&apos; value=&apos;删除&apos; onclick=&apos;del(this)&apos;&gt;&lt;/div&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	function del(who) &#123;</span><br><span class="line">		who.parentNode.parentNode.removeChild(who.parentNode);</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;上传页面&lt;/h1&gt;</span><br><span class="line">	&lt;form action=&quot;$&#123;pageContext.request.contextPath &#125;/uploadServlet&quot;</span><br><span class="line">		method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;button&quot; value=&quot;添加&quot; onclick=&quot;add()&quot;&gt;&lt;input</span><br><span class="line">			type=&quot;submit&quot; value=&quot;上传&quot;&gt;&lt;br&gt;</span><br><span class="line">		&lt;div id=&quot;div1&quot;&gt;&lt;/div&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-文件下载"><a href="#2-文件下载" class="headerlink" title="2.文件下载"></a>2.文件下载</h2><h3 id="2-1-文件下载流程"><a href="#2-1-文件下载流程" class="headerlink" title="2.1 文件下载流程"></a>2.1 文件下载流程</h3><ol>
<li><p>获取数据</p>
<p>String filename = request.getParameter(“filename”);</p>
</li>
<li><p>设置两个头和一个输入流</p>
<ol>
<li><p>设置两个头</p>
<p>设置Content-Type</p>
<p>response.setContentType(“getServletContext().getMimeType(filename)”);</p>
<p>设置Content-Disposition</p>
<p>response.setHeader(“Content-Disposition”,”attachment;filename=”+filename)</p>
</li>
<li><p>设置输入流</p>
<p>String path=getServletContext().getRealPath(“/download”);</p>
<p>InputStream is = new FileInputStream(path+”/“+filename);</p>
</li>
</ol>
</li>
<li><p>获取输出流</p>
<p>​        OutPutStream os = response.getOutputStream();</p>
</li>
</ol>
<h3 id="2-2文件下载代码"><a href="#2-2文件下载代码" class="headerlink" title="2.2文件下载代码"></a>2.2文件下载代码</h3><p><strong>downloadServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.DownloadEncodingUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件下载Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">downloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 获取数据</span></span><br><span class="line">		String filename = request.getParameter(<span class="string">"filename"</span>);</span><br><span class="line">		<span class="comment">// 解决文件名中文乱码问题</span></span><br><span class="line">		filename = <span class="keyword">new</span> String(filename.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">		<span class="comment">// 设置两个头,一个流</span></span><br><span class="line">		<span class="comment">// 设置ContentType</span></span><br><span class="line">		response.setContentType(getServletContext().getMimeType(filename));</span><br><span class="line">		<span class="comment">// 设置输入流</span></span><br><span class="line">		String realPath = getServletContext().getRealPath(<span class="string">"/download"</span>);</span><br><span class="line">		InputStream is = <span class="keyword">new</span> FileInputStream(realPath + <span class="string">"/"</span> + filename);</span><br><span class="line">		System.out.println(filename);</span><br><span class="line">		<span class="comment">// 解决不同浏览器文件名中文显示问题</span></span><br><span class="line">		String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">		<span class="keyword">if</span> (agent.contains(<span class="string">"Firefox"</span>)) &#123;</span><br><span class="line">			<span class="comment">// 火狐浏览器</span></span><br><span class="line">			filename = DownloadEncodingUtils.base64EncodeFileName(filename);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			filename = URLEncoder.encode(filename, <span class="string">"UTF-8"</span>);</span><br><span class="line">			filename = filename.replace(<span class="string">"+"</span>, <span class="string">" "</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 设置Content-Disposition</span></span><br><span class="line">		System.out.println(filename);</span><br><span class="line">		response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span></span><br><span class="line">				+ filename);</span><br><span class="line">		<span class="comment">// 获取输出流</span></span><br><span class="line">		ServletOutputStream os = response.getOutputStream();</span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">while</span> ((len = is.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">			os.write(b, <span class="number">0</span>, len);</span><br><span class="line">		&#125;</span><br><span class="line">		is.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>download.jsp</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;文件下载&lt;/h1&gt;</span><br><span class="line">	&lt;a href="$&#123;pageContext.request.contextPath &#125;/download/psb.jpg"&gt;psb.jpg&lt;/a&gt;</span><br><span class="line">	&lt;h3&gt;手动下载&lt;/h3&gt;</span><br><span class="line">	&lt;a</span><br><span class="line">		href="$&#123;pageContext.request.contextPath &#125;/downloadServlet?filename=psb.jpg"&gt;psb.jpg&lt;/a&gt;</span><br><span class="line">	&lt;br&gt;</span><br><span class="line">	&lt;a</span><br><span class="line">		href="$&#123;pageContext.request.contextPath &#125;/downloadServlet?filename=中文.jpg"&gt;中文.jpg&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-文件列表下载"><a href="#2-3-文件列表下载" class="headerlink" title="2.3 文件列表下载"></a>2.3 文件列表下载</h3><p><strong>multiDownloadServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.DownloadEncodingUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class multidownloadServlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">multidownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String path = request.getParameter(<span class="string">"path"</span>);</span><br><span class="line">		path = <span class="keyword">new</span> String(path.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">		File file = <span class="keyword">new</span> File(path);</span><br><span class="line">		String filename = file.getName();</span><br><span class="line">		<span class="comment">// 设置两个头,一个流</span></span><br><span class="line">		response.setContentType(getServletContext().getMimeType(filename));</span><br><span class="line">		InputStream is = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">		<span class="comment">// 处理中文名</span></span><br><span class="line">		String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">		<span class="keyword">if</span> (agent.contains(<span class="string">"Firefox"</span>)) &#123;</span><br><span class="line">			filename = DownloadEncodingUtils.base64EncodeFileName(filename);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			filename = URLEncoder.encode(filename, <span class="string">"UTF-8"</span>);</span><br><span class="line">			filename = filename.replace(<span class="string">"+"</span>, <span class="string">" "</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attach;filename="</span> + filename);</span><br><span class="line">		ServletOutputStream os = response.getOutputStream();</span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">while</span> ((len = is.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">			os.write(b, <span class="number">0</span>, len);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//关闭流</span></span><br><span class="line">		is.close();</span><br><span class="line">		os.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>multiDownload.jsp</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.io.File"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.util.LinkedList"</span>%&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;多文件下载&lt;/h1&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		<span class="comment">//创建队列</span></span><br><span class="line">		Queue&lt;File&gt; queue = <span class="keyword">new</span> LinkedList&lt;File&gt;();</span><br><span class="line">		<span class="comment">//创建根节点</span></span><br><span class="line">		File root = <span class="keyword">new</span> File(</span><br><span class="line">				<span class="string">"F:\\java基础增强\\javaweb_day19(文件上传和下载)\\资料\\下载资料列表"</span>);</span><br><span class="line">		<span class="comment">//根节点入队</span></span><br><span class="line">		queue.offer(root);</span><br><span class="line">		<span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">			<span class="comment">//出队</span></span><br><span class="line">			File file = queue.poll();</span><br><span class="line">			<span class="comment">//获取出队元素的所有子元素</span></span><br><span class="line">			File[] files = file.listFiles();</span><br><span class="line">			<span class="comment">//遍历子元素</span></span><br><span class="line">			<span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">				<span class="keyword">if</span> (f.isFile()) &#123;</span><br><span class="line">					<span class="comment">//为标准文件,则输出</span></span><br><span class="line">	%&gt;</span><br><span class="line">	&lt;h3&gt;</span><br><span class="line">		&lt;a</span><br><span class="line">			href="$&#123;pageContext.request.contextPath &#125;/multidownloadServlet?path=&lt;%=f.getCanonicalPath()%&gt;"&gt;&lt;%=f.getName()%&gt;&lt;/a&gt;</span><br><span class="line">	&lt;/h3&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="comment">//不是标准文件,则入队</span></span><br><span class="line">					queue.offer(f);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="日历对象-Calendar"><a href="#日历对象-Calendar" class="headerlink" title="日历对象 Calendar"></a>日历对象 Calendar</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Calendar cal = Calendar.getInstance();</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/文件上传和下载/" data-id="cjwqj8oqd0000s47kx4xz3d2h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-hello-world" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/hello-world/" class="article-date">
  <time class="post-time" datetime="2019-06-09T11:40:15.735Z" itemprop="datePublished">
    <span class="post-month">6月</span><br>
    <span class="post-day">09</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/hello-world/">Hello World</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/hello-world/" data-id="cjwqj8ora0001s47k3s4m8h3k" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; pre</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Hexo</h1>
    <h2 class="blog-subtitle"></h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/source/plugin/img/avatar.jpg">
    <h2 class="author">inverse</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>19</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>0</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/cyannote" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2018 - 2019 inverse<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title class="menuItem">首页</a>
          
            <a href="/tags" title class="menuItem">标签</a>
          
            <a href="/categories" title class="menuItem">分类</a>
          
            <a href="/archives" title class="menuItem">归档</a>
          
            <a href="/xxxxxxxxx" title class="menuItem">xxx</a>
          
            <a href="/xxxxxxx" title class="menuItem">xxxx</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>