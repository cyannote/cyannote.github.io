<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://cyannote.github.io.git/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/source/plugin/img/avatar.jpg">
    <h2 class="author">inverse</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>33</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>0</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-Spring" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Spring/" class="article-date">
  <time class="post-time" datetime="2019-07-21T07:57:55.909Z" itemprop="datePublished">
    <span class="post-month">7月</span><br>
    <span class="post-day">21</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Spring/">Spring笔记</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="1-Spring概述"><a href="#1-Spring概述" class="headerlink" title="1.Spring概述"></a>1.Spring概述</h2><h3 id="1-1-spring是什么"><a href="#1-1-spring是什么" class="headerlink" title="1.1 spring是什么"></a>1.1 spring是什么</h3><p>Spring是分层的Java SE/EE应用full-stack轻量级开源框架,以IOC(Inverse Of Control:反转控制)和AOP(Aspect Oriented Programming:面向切面编程)为内核,提供了展示层Spring MVC和持久层 Spring JDBC以及业务层事务管理等众多的企业级应用技术,还能整合开源世界众多著名的第三方框架和类库,逐渐成为使用最多的Java EE企业级应用开源框架.</p>
<p>什么是一站式开发:</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562120940744.jpg" alt="img"></p>
<h3 id="1-2-Spring的优势"><a href="#1-2-Spring的优势" class="headerlink" title="1.2 Spring的优势"></a>1.2 Spring的优势</h3><p><strong>1.方便解耦,简化开发(工厂模式)</strong></p>
<p>​        通过Spring提供的Ioc容器,可以将对象间的依赖关系交由spring进行控制,避免硬编码所造成的过度程序耦合.用户也不必再为单例模式类,属性文件解析等很底层的需求编写代码,可以更专注于上层的应用.</p>
<p><strong>2.Aop编程的支持(jdk动态代理,cglib动态代理)</strong></p>
<p>​        通过Spring的AOP功能,方便进行面向切面的编程,许多不容易用传统OOP(面向对象编程)实现的功能可以通过AOP轻松应付.</p>
<p>​        声明式事务的支持可以将我们从单调烦闷的事务管理代码中解脱出来，通过声明式方式灵活的进行事务的管理，提高开发效率和质量。</p>
<p><strong>3.方便程序的测试(和Junit整合)</strong></p>
<p>​        可以用非容器依赖的编程方式进行几乎所有的测试工作，测试不再是昂贵的操作，而是随手可做的事情。</p>
<p><strong>4.方便集成各种优秀框架</strong></p>
<p>​        Spring可以降低各种框架的使用难度，提供了对各种优秀框架（Struts、Hibernate、Mybatis、Hessian、Quartz、ActivityMQ、Redis等）的直接支持。</p>
<p><strong>5.降低JavaEE API的使用难度 （SSM整合）</strong></p>
<p>​        Spring对JavaEE API（如JDBC、JavaMail、远程调用等）进行了薄薄的封装层，使这些API的使用难度大为降低。</p>
<h3 id="1-3-Spring的体系结构"><a href="#1-3-Spring的体系结构" class="headerlink" title="1.3 Spring的体系结构"></a>1.3 Spring的体系结构</h3><p> <img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image001-1562121597174.png" alt="img"></p>
<h2 id="2-IOC"><a href="#2-IOC" class="headerlink" title="2.IOC"></a>2.IOC</h2><h3 id="2-1-什么是程序的耦合"><a href="#2-1-什么是程序的耦合" class="headerlink" title="2.1 什么是程序的耦合"></a>2.1 什么是程序的耦合</h3><p>​        耦合性(Coupling)，也叫耦合度，是对模块间关联程度的度量。耦合的强弱取决于模块间接口的复杂性、调用模块的方式以及通过界面传送数据的多少。模块间的耦合度是指模块之间的依赖关系，包括控制关系、调用关系、数据传递关系。模块间联系越多，其耦合性越强，同时表明其独立性越差( 降低耦合性，可以提高其独立性)。</p>
<p>​        <strong>在软件工程中，耦合指的就是就是对象之间的依赖性。</strong>对象之间的耦合越高，维护成本越高。因此对象的设计应使类和构件之间的耦合最小。软件设计中通常用耦合度和内聚度作为衡量模块独立程度的标准。划分模块的一个准则就是<strong>高内聚低耦合</strong>。</p>
<ul>
<li><p>解决程序耦合的思路一:    <strong>反射</strong></p>
<p>此时的好处是，我们的类中不再依赖具体的驱动类，此时就算删除mysql的驱动jar包，依然可以编译（运行就不要想了，没有驱动不可能运行成功的）。 </p>
<p>同时，也产生了一个新的问题，mysql驱动的全限定类名字符串是在java类中写死的，一旦要改还是要修改源码。 </p>
<p>解决这个问题也很简单，使用配置文件配置（xml或者是properties）。</p>
</li>
<li><p>解决程序耦合的思路二: <strong>工厂模式解耦</strong></p>
<p>在实际开发中我们可以把三层的对象都使用配置文件配置起来，当启动服务器应用加载的时候，让一个类中的方法通过读取配置文件，把这些对象同时创建出来并存起来。在接下来的使用的时候，直接拿过来用就好了。 </p>
<p>那么，这个读取配置文件，创建和获取三层对象的类就是工厂。</p>
</li>
</ul>
<h3 id="2-2-控制反转-Inversion-Of-Control"><a href="#2-2-控制反转-Inversion-Of-Control" class="headerlink" title="2.2 控制反转-Inversion Of Control"></a>2.2 控制反转-Inversion Of Control</h3><p>​        原来： 我们在获取对象时，都是采用new的方式.是主动的</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562122177241.jpg" alt="img"></p>
<p>现在： 我们获取对象时，同时跟工厂要，有工厂为我们查找或者创建对象。是被动的。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562122204168.jpg" alt="img"></p>
<p>​    在应用加载时，创建一个Map，用于存放三层对象。 我们把这个map称之为容器。 工厂就是负责给我们从容器中获取指定对象的类。这时候我们获取对象的方式发生了改变。而<strong>不是我们在程序中去new对象，而是通过工厂去创建对象，并且通过工厂去获取对象。</strong></p>
<p>​    <strong>这种被动接收的方式获取对象的思想就是控制反转（IOC），它是spring框架的核心之一。</strong></p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image001-1562122285744.png" alt="img"></p>
<p>明确ioc的作用： <strong>削减计算机程序的耦合(解除我们代码中的依赖关系)，将对象的创建和调用都交给spring容器去处理。</strong></p>
<h3 id="2-3-IOC读取配置文件"><a href="#2-3-IOC读取配置文件" class="headerlink" title="2.3 IOC读取配置文件"></a>2.3 IOC读取配置文件</h3><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562122682602.jpg" alt="img"></p>
<p><strong>【BeanFactory 和ApplicationContext 的区别 】</strong></p>
<p>​        BeanFactory 才是Spring 容器中的顶层接口。</p>
<p>​        ApplicationContext 是它的子接口。</p>
<p>​        BeanFactory 和ApplicationContext 的区别：</p>
<p>​        创建的方式都表示单例对象。</p>
<p>​        创建对象的时间点不一样。</p>
<p>​        ApplicationContext：只要一读取配置文件，默认情况下就会创建对象。（立即加载）</p>
<p>​        BeanFactory：什么时候使用什么时候创建对象。（延迟加载）</p>
<p><strong>【ApplicationContext 接口的实现类】</strong></p>
<p>（1）ClassPathXmlApplicationContext：它是从类的根路径下加载配置文件 推荐使用这种 </p>
<p>（2）FileSystemXmlApplicationContext： </p>
<p>它是从磁盘路径上加载配置文件，配置文件可以在磁盘的任意位置。 </p>
<p>（3）AnnotationConfigApplicationContext:</p>
<p>使用注解配置容器对象时，需要使用此类来创建spring 容器。它用来读取注解。 </p>
<p><strong>【id和name的配置】</strong></p>
<p><strong>id</strong>中不能出现特殊字符（容器中的唯一标识），name中可以出现特殊的字符（表示引用）。可以指定多个name，之间可以用分号（“；”）、空格（“ ”）或逗号（“，”）分隔开，如果没有指定id，那么第一个name为标识符，其余的为别名； 若指定了id属性，则id为标识符，所有的name均为别名。如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"alias1 alias2;alias3,alias4"</span> <span class="attr">id</span>=<span class="string">"hello1"</span> <span class="attr">class</span>=<span class="string">"com.zyh.spring3.hello.HelloWorld"</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>此时，hello1为标识符，而alias1，alias2，alias3，alias4为别名，它们都可以作为的键值；</p>
<p><strong>【实例化Beand三种方式】</strong></p>
<p>第一种：<strong>采用无参数的构造方法方式实例化（用的最多）</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--创建Bean的三种方式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 第一种方式：使用默认构造函数创建。</span></span><br><span class="line"><span class="comment">        在spring的配置文件中使用bean标签，配以id和class属性之后，且没有其他属性和标签时。</span></span><br><span class="line"><span class="comment">        采用的就是默认构造函数创建bean对象，此时如果类中没有默认构造函数，则对象无法创建。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.service.impl.AccountServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二种：<strong>采用静态工厂实例化的方式</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第二种方式：使用工厂中的静态方法创建对象（使用某个类中的静态方法创建对象，并存入spring容器) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.factory.StaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三种：<strong>采用实例工厂（非静态的）实例化的方式</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第三种方式： 使用普通工厂中的方法创建对象（使用某个类中的方法创建对象，并存入spring容器） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"instanceFactory"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.factory.InstanceFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">factory-bean</span>=<span class="string">"instanceFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>【Bean的作用访问的配置：scope的配置】</strong></p>
<p>Spring创建这个类的时候，默认采用的单例的模式进行创建的。如果想去改变单例模式，需要通过scope进行配置。<br>Scope属性中有以下几个取值:<br>    singleton            ：默认值，单例的。<br>    prototype            ：多例的。<br>    request            ：应用在web应用中，将创建的对象存入到request域中。<br>    session            ：应用在web应用中，将创建的对象存入到session域中。<br>    globalsession        ：应用在集群环境下使用。将创建的对象存入到全局的session中。</p>
<p><strong>总结：开发场景</strong></p>
<p>单例（常用）：一般创建对象单例（例如Service对象、Dao对象，数据源的对象…）</p>
<p>多例：如果spring创建数据库连接对象Connection（每个线程使用的数据库连接对象是不同的，保证线程安全）</p>
<p>​      Struts2（本身多实例，多线程），如果spring创建struts2的对象，一定是多例（了解）</p>
<h3 id="2-4-Bean的生命周期"><a href="#2-4-Bean的生命周期" class="headerlink" title="2.4 Bean的生命周期"></a>2.4 Bean的生命周期</h3><p>单例对象<br>    出生：当容器创建时对象出生<br>    活着：只要容器还在，对象一直活着<br>    死亡：容器销毁，对象消亡<br>    总结：单例对象的生命周期和容器相同<br>多例对象<br>    出生：当我们使用对象时spring框架为我们创建<br>    活着：对象只要是在使用过程中就一直活着。<br>    死亡：当对象长时间不用，且没有别的对象引用时，由Java的垃圾回收器回收<br>    总结：多例对象的生命周期和对象是否被使用有关。与容器是否被销毁无关。</p>
<h3 id="2-5-Spring的依赖注入（DI"><a href="#2-5-Spring的依赖注入（DI" class="headerlink" title="2.5 Spring的依赖注入（DI)"></a><strong>2.5 Spring的依赖注入（DI)</strong></h3><p>依赖注入：Dependency Injection。它是spring框架核心ioc的具体实现。<br>我们的程序在编写时，通过控制反转，把对象的创建交给了spring，但是代码中不可能出现没有依赖的情况。ioc解耦只是降低他们的依赖关系，但不会消除。例如：我们的业务层仍会调用持久层的方法。</p>
<p>那这种业务层和持久层的依赖关系，在使用spring之后，就让spring来维护了。<br>简单的说，就是坐等框架把持久层对象传入业务层，而不用我们自己去获取。 这就是依赖注入。</p>
<hr>
<p><strong>能注入的数据:有三类</strong></p>
<p>(1)基本类型和String类型(值的注入)</p>
<p>(2)其他bean对象类型(在配置文件中或注解配置过的bean)[对象的注入]</p>
<p>(3)复杂类型/集合类型(集合的注入)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 复杂类型的注入/集合类型的注入</span></span><br><span class="line"><span class="comment">    用于给List结构集合注入的标签：</span></span><br><span class="line"><span class="comment">        list array set</span></span><br><span class="line"><span class="comment">    用于个Map结构集合注入的标签:</span></span><br><span class="line"><span class="comment">        map  props</span></span><br><span class="line"><span class="comment">    结构相同，标签可以互换</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService3"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.service.impl.AccountServiceImpl3"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数组--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--在spring的集合注入中，array，list，set是可以通用的--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arrays"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>22<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"date"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--map集合--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key001"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>赵六<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key002"</span> <span class="attr">value</span>=<span class="string">"23"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key003"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"date"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--properties集合，和map集合很相似，也是键值对，键和值只能是String--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集合属性的应用场景：初始化系统中使用常量--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"driver"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"url"</span>&gt;</span>jdbc:mysql:///itcastspring<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>能注入的方式:有三种</strong></p>
<p>构造函数注入：<em>使用的标签:constructor-arg标签出现的位置：bean标签的内部</em></p>
<p>set方法注入 ：<em>涉及的标签：property    出现的位置：bean标签的内部*</em>【推荐使用】***</p>
<p>使用p名称空间注入数据（<strong>本质还是调用set方法</strong>）</p>
<p>引入名称空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>用p名称空间完成属性注入</strong></p>
<p>语法：普通属性   p:属性名=””         对象类型  p:属性名-ref=””</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   使用p空间完成注入</span></span><br><span class="line"><span class="comment">   语法：普通属性    p:属性名=””      对象类型  p:属性名-ref=””</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService2"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.service.impl.AccountServiceImpl2"</span> <span class="attr">p:name</span>=<span class="string">"小刚"</span> <span class="attr">p:age</span>=<span class="string">"25"</span> <span class="attr">p:birthday-ref</span>=<span class="string">"now"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 配置一个日期对象 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"now"</span> <span class="attr">class</span>=<span class="string">"java.util.Date"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>这里注意：需要对属性提供set</strong>方法，方可实现注入。</p>
<h3 id="2-6-基于注解的ioc配置"><a href="#2-6-基于注解的ioc配置" class="headerlink" title="2.6 基于注解的ioc配置"></a>2.6 基于注解的ioc配置</h3><h4 id="2-6-1-注解配置-控制反转ioc"><a href="#2-6-1-注解配置-控制反转ioc" class="headerlink" title="2.6.1 注解配置-控制反转ioc"></a>2.6.1 注解配置-控制反转ioc</h4><p>用于创建对象的</p>
<p>​    他们的作用就和在XML配置文件中编写一个<bean>标签实现的功能是一样的.</bean></p>
<p>（1）@Component:<br>    作用：用于把当前类对象存入spring容器中<br>    属性：</p>
<p>​    value：用于指定bean的id。当我们不写时，它的默认值是当前类名，且首字母改小写。<br>（2）Spring中提供了@Component的衍生注解：<br>​    @Controller        ：用来修饰WEB层类（控制层）（springMVC延用了该注解）<br>​    @Service        ：用来修饰service层类（业务层）<br>​    @Repository        ：用来修饰DAO层类（持久层）<br>以上三个注解他们的作用和属性与Component是一模一样。<br>​    他们三个是spring框架为我们提供明确的三层使用的注解，使我们的三层对象更加清晰。</p>
<p><strong>配置创建容器时要扫描的包</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.cyannote"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-6-2-注解配置-依赖注入di"><a href="#2-6-2-注解配置-依赖注入di" class="headerlink" title="2.6.2 注解配置-依赖注入di"></a>2.6.2 注解配置-依赖注入di</h4><p>用于注入数据的</p>
<p>​    它们的作用就和在xml配置文件中的bean标签中写一个<property>标签的作用是一样的</property></p>
<p>  @Autowired:<br>基于spring</p>
<p>作用：自动按照类型注入。只要容器中有唯一的一个bean对象类型和要注入的变量类型匹配，就可以注入成功<br>        如果ioc容器中没有任何bean的类型和要注入的变量类型匹配，则报错。<br>        如果Ioc容器中有多个类型匹配时：<br>先按照类型匹配，如果不能匹配上，会按照属性的名称进行匹配<br>    出现位置：<br>        可以是变量上，也可以是set方法上<br>    细节：<br>        在使用注解注入时，set方法就不是必须的了。<br>    @Qualifier:<br>    配合@Autowired注解一起使用<br>作用：在按照类型注入的基础之上再按照名称注入。<br>    属性：<br>        value：用于指定注入bean的id。<br>    @Resource<br>    JSR-250标准（基于jdk）<br>作用：直接按照bean的id名称注入。如果id属性不存在，可以再按照类型注入。它可以独立使用<br>    属性：<br>        name：用于指定bean的id，如果指定name，只能按照bean的id注入，不能按照类型注入。<br>    注意：<br>以上三个注入都只能注入其他bean类型的数据，而基本类型和String类型无法使用上述注解实现（使用@Value）。</p>
<p>【原理图】</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562138553642.jpg" alt="img"></p>
<p> @Value<br>        作用：用于注入基本类型和String类型的数据<br>        属性：<br>            value：用于指定数据的值。使用${表达式}可以读取配置文件（.properties文件）的信息（一会讲…）<br>在AccountServiceImpl.java中配置：</p>
<h4 id="2-6-3注解配置-作用域"><a href="#2-6-3注解配置-作用域" class="headerlink" title="2.6.3注解配置-作用域"></a>2.6.3注解配置-作用域</h4><p>他们的作用就和在bean标签中使用scope属性实现的功能是一样的<br>    @Scope<br>    作用：用于指定bean的作用范围<br>    属性：<br>        value：指定范围的取值。常用取值：singleton prototype</p>
<h2 id="3-AOP"><a href="#3-AOP" class="headerlink" title="3.AOP"></a>3.AOP</h2><h3 id="3-1-什么是AOP"><a href="#3-1-什么是AOP" class="headerlink" title="3.1 什么是AOP"></a>3.1 什么是AOP</h3><p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image001-1562155494906.png" alt="img"></p>
<p>AOP (Aspect Oriented Programing) 称为：面向切面编程，它是一种编程思想。</p>
<p>AOP采取<strong>横向抽取机制</strong>，取代了<strong>传统纵向继承</strong>体系重复性代码的编写方式（应用场景：例如性能监视、事务管理、安全检查、缓存、日志记录等）。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image002-1562155528338.jpg" alt="img"></p>
<h3 id="3-2-AOP的作用"><a href="#3-2-AOP的作用" class="headerlink" title="3.2 AOP的作用"></a>3.2 AOP的作用</h3><p>l  权限校验</p>
<p>l  日志记录</p>
<p>l  性能检测</p>
<p>l  缓存技术</p>
<p>l  事务管理</p>
<h3 id="3-3-AOP底层实现"><a href="#3-3-AOP底层实现" class="headerlink" title="3.3 AOP底层实现"></a>3.3 AOP底层实现</h3><p>代理机制。<br>2个：spring的aop的底层原理<br> 1：JDK代理（要求目标对象面向接口）（spring默认的代理方式是JDK代理）<br> 2：CGLIB代理（面向接口、面向类）</p>
<h3 id="3-4-AOP的相关术语"><a href="#3-4-AOP的相关术语" class="headerlink" title="3.4 AOP的相关术语"></a>3.4 AOP的相关术语</h3><p><strong>Joinpoint(连接点): （方法）</strong><br>        所谓连接点是指那些被拦截到的点。在spring中,这些点指的是方法,因为spring只支持方法类型的连接点。<br><strong>Pointcut(切入点): （方法）</strong><br>        所谓切入点是指我们要对哪些Joinpoint进行拦截的定义。<br><strong>Advice(通知/增强): （方法）</strong><br>        所谓通知是指拦截到Joinpoint之后所要做的事情就是通知。<br>通知的类型：前置通知,后置通知,异常通知,最终通知,环绕通知。<br>Target(目标对象):<br>        代理的目标对象。<br>Weaving(织入): （了解）<br>        是指把增强应用到目标对象来创建新的代理对象的过程。<br>        spring采用动态代理织入，而AspectJ采用编译期织入和类装载期织入。<br><strong>Proxy（代理）:</strong><br>        一个类被AOP织入增强后，就产生一个结果代理类。<br><strong>Aspect(切面): （类）</strong><br>        是切入点和通知（引介）的结合。<br>Introduction(引介): （不用了解）<br>        引介是一种特殊的通知在不修改类代码的前提下, Introduction可以在运行期为类动态地添加一些方法或Field。</p>
<h3 id="3-5-Aop的五种通知类型"><a href="#3-5-Aop的五种通知类型" class="headerlink" title="3.5 Aop的五种通知类型"></a>3.5 Aop的五种通知类型</h3><p>前置通知、后置通知、异常通知、最终通知、环绕通知。</p>
<p><img src="D:%5Ctypora%E7%AC%94%E8%AE%B0%5CTypora%E5%9B%BE%E7%89%87%5Cclip_image001-1562158772309.png" alt="img"></p>
<h2 id="4-Spring中的事务控制"><a href="#4-Spring中的事务控制" class="headerlink" title="4.Spring中的事务控制"></a>4.Spring中的事务控制</h2><h3 id="4-1-Spring事务控制我们要明确"><a href="#4-1-Spring事务控制我们要明确" class="headerlink" title="4.1 Spring事务控制我们要明确"></a>4.1 Spring事务控制我们要明确</h3><p>第一：JavaEE体系进行分层开发，事务处理位于业务层，Spring提供了分层设计业务层的事务处理解决方案。 </p>
<p>第二：spring框架为我们提供了一组事务控制的接口 。具体在后面的第二小节介绍。这组接口是在spring-tx-5.0.2.RELEASE.jar中。 </p>
<p>第三：spring的事务控制都是基于AOP的，它既可以使用编程的方式实现，也可以使用配置的方式（声明式）实现。重点是使用配置（声明式事务处理）的方式实现。 </p>
<h3 id="4-2-编程式事务控制"><a href="#4-2-编程式事务控制" class="headerlink" title="4.2 编程式事务控制"></a>4.2 编程式事务控制</h3><p>xml配置文件:</p>
<p>配置事务管理器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一：配置事务管理器=============== --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置事务管理模板</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 二：配置事务管理的模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">ref</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在业务层注入事务管理模板</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置账户的业务层--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.cyannote.service.impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionTemplate"</span> <span class="attr">ref</span>=<span class="string">"transactionTemplate"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>改写业务层的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入事务管理的模板</span></span><br><span class="line">    <span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransactionTemplate</span><span class="params">(TransactionTemplate transactionTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transactionTemplate = transactionTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountById</span><span class="params">(Integer accountId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountDao.findAccountById(accountId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(<span class="keyword">final</span> String sourceName, <span class="keyword">final</span> String targetName, <span class="keyword">final</span> Float money)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"transfer...."</span>);</span><br><span class="line">        transactionTemplate.execute(<span class="keyword">new</span> TransactionCallbackWithoutResult() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doInTransactionWithoutResult</span><span class="params">(TransactionStatus transactionStatus)</span> </span>&#123;</span><br><span class="line">                System.out.println(transactionStatus.isNewTransaction() +  <span class="string">"     "</span>+transactionStatus.isCompleted());</span><br><span class="line">                <span class="comment">//2.1根据名称查询转出账户</span></span><br><span class="line">                Account source = accountDao.findAccountByName(sourceName);</span><br><span class="line">                <span class="comment">//2.2根据名称查询转入账户</span></span><br><span class="line">                Account target = accountDao.findAccountByName(targetName);</span><br><span class="line">                <span class="comment">//2.3转出账户减钱</span></span><br><span class="line">                source.setMoney(source.getMoney()-money);</span><br><span class="line">                <span class="comment">//2.4转入账户加钱</span></span><br><span class="line">                target.setMoney(target.getMoney()+money);</span><br><span class="line">                <span class="comment">//2.5更新转出账户</span></span><br><span class="line">                accountDao.updateAccount(source);</span><br><span class="line"></span><br><span class="line"><span class="comment">//                int i=1/0;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//2.6更新转入账户</span></span><br><span class="line">                accountDao.updateAccount(target);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-声明式事务处理"><a href="#4-3-声明式事务处理" class="headerlink" title="4.3 声明式事务处理"></a>4.3 声明式事务处理</h3><p><strong>配置文件</strong></p>
<ul>
<li><p>配置事务管理器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一：配置事务管理器 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置事务通知</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 二：配置事务的通知--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置aop</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 三：配置aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切入点表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pc"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.cyannote.service..*.*(..))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:pointcut</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--建立切入点表达式和事务通知的对应关系 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注解方式</strong></p>
</li>
</ul>
<p>配置AccountServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span>(readOnly = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountById</span><span class="params">(Integer accountId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountDao.findAccountById(accountId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Transactional</span>(readOnly = <span class="keyword">false</span>,propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">( String sourceName,  String targetName,  Float money)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"transfer...."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.1根据名称查询转出账户</span></span><br><span class="line">        Account source = accountDao.findAccountByName(sourceName);</span><br><span class="line">        <span class="comment">//2.2根据名称查询转入账户</span></span><br><span class="line">        Account target = accountDao.findAccountByName(targetName);</span><br><span class="line">        <span class="comment">//2.3转出账户减钱</span></span><br><span class="line">        source.setMoney(source.getMoney() - money);</span><br><span class="line">        <span class="comment">//2.4转入账户加钱</span></span><br><span class="line">        target.setMoney(target.getMoney() + money);</span><br><span class="line">        <span class="comment">//2.5更新转出账户</span></span><br><span class="line">        accountDao.updateAccount(source);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.6更新转入账户</span></span><br><span class="line">        accountDao.updateAccount(target);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结</p>
<p>Spring整体的总结：</p>
<p>总结：<br>1：IOC DI（xml和注解）<br>2：AOP（5种通知）（xml和注解）<br>3：声明式事务处理（xml和注解）</p>
<ul>
<li>DBUtils（第三方提供的）</li>
<li>JDBCTemplate（是spring提供的）</li>
<li>Mybatis（</li>
</ul>
<p>4：spring3的新特性（纯注解开发）<br>@Configuration<br>@ConnectionScan<br>@Import<br>@Bean</p>
<p>自己创建的对象：使用注解<br>第三方创建的对象（数据源…）：使用配置文件</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/Spring/" data-id="cjyco5lfp0000ow7k3ibol0ak" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-文件上传和下载" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/文件上传和下载/" class="article-date">
  <time class="post-time" datetime="2019-06-10T01:07:23.295Z" itemprop="datePublished">
    <span class="post-month">6月</span><br>
    <span class="post-day">10</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/文件上传和下载/">文件上传和下载</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="文件上传和下载"><a href="#文件上传和下载" class="headerlink" title="文件上传和下载"></a>文件上传和下载</h1><h2 id="1-文件上传"><a href="#1-文件上传" class="headerlink" title="1.文件上传"></a>1.文件上传</h2><p>导包:commons-fileupload .jar        commons-io  .jar</p>
<h3 id="1-1文件上传表单的三个要素"><a href="#1-1文件上传表单的三个要素" class="headerlink" title="1.1文件上传表单的三个要素"></a>1.1文件上传表单的三个要素</h3><ol>
<li>表单的提交的方式需要是POST</li>
<li>表单中需要有&lt;input type=”file”素，需要有name属性和值。</li>
<li>表单enctype=”multipart/form-data”</li>
</ol>
<h3 id="1-2文件上传的步骤"><a href="#1-2文件上传的步骤" class="headerlink" title="1.2文件上传的步骤"></a>1.2文件上传的步骤</h3><ol>
<li><p>创建磁盘文件项工厂</p>
<p>DiskFileItemFactory  df = new DiskFileItemFactory();</p>
</li>
<li><p>创建核心文件解析类</p>
<p>ServletFileUpload sf = new ServletFileUpload(df);</p>
</li>
<li><p>解析请求</p>
<p>list<fileitem>  list =  sf.parseRequest(request);</fileitem></p>
</li>
<li><p>遍历集合,判断请求项 for(FileItem f:list)</p>
<ol>
<li><p>若不是普通项 ! f.isFormItem()</p>
<p>获取文件名,  f.getName()</p>
<p>获取文件内容(输入流)f.getInputStream()</p>
<p>创建输出流 getServletContext.getRealPath(“存储路径”) ; OutPutStream os = new fileOutPutStream(realPath+”\“+filename);</p>
<p>IO流写入文件</p>
</li>
<li><p>普通项</p>
<p>获取参数名 f.getFileName()</p>
<p>获取内容 f.getString();//可传入编码格式解决中文乱码问题</p>
</li>
</ol>
</li>
</ol>
<h3 id="1-3-文件上传的Servlet"><a href="#1-3-文件上传的Servlet" class="headerlink" title="1.3 文件上传的Servlet"></a>1.3 文件上传的Servlet</h3><p>//1.创建磁盘文件项工厂DiskFileItemFactory</p>
<p>//创建一个核心的解析类ServletFileUpload</p>
<p>//利用核心类解析Request,解析后会得到多个部分,返回一个list集合 parseRequest</p>
<p>//遍历list集合,得到代表每个部分的文件项的对象.根据文件项判断是否为文件上传项</p>
<p>isFormItem()</p>
<p>文件上传的API</p>
<h3 id="1-4-DiskFileItemFactory-磁盘文件项工厂"><a href="#1-4-DiskFileItemFactory-磁盘文件项工厂" class="headerlink" title="1.4  DiskFileItemFactory:磁盘文件项工厂"></a>1.4  DiskFileItemFactory:磁盘文件项工厂</h3><p>sizeThreshold 设置文件上传的缓冲区大小,默认10kb</p>
<p>Repository 临时文件存放路径</p>
<h3 id="1-5-ServletFileUpload-核心解析类"><a href="#1-5-ServletFileUpload-核心解析类" class="headerlink" title="1.5  ServletFileUpload:核心解析类"></a>1.5  ServletFileUpload:核心解析类</h3><p>FileItemFactory</p>
<p>isMutipartContent:判断恩仇type属性是否为multipart/form-data</p>
<p>parseRequest:解析request对象,返回一个list集合(每个部分的文件对象)</p>
<p>setFileSizeMax:设置单个文件的大小</p>
<p>setSizeMax:设置上传文件的总大小 </p>
<p>setHeaderEncoding :设置中文文件名乱码的问题</p>
<p>setProgressListener:设置监听文件上传的进度</p>
<h3 id="1-6-FileItem"><a href="#1-6-FileItem" class="headerlink" title="1.6  FileItem"></a><strong>1.6  FileItem</strong></h3><p>isFormField:是否为普通项</p>
<p>getFieldName:获得普通项名字</p>
<p>getString:获得普通项内容</p>
<p>getName获得文件上传项名称</p>
<p>getInputStream:获得上传项内容</p>
<h3 id="1-7-getSize获得上传文件大小"><a href="#1-7-getSize获得上传文件大小" class="headerlink" title="1.7  getSize获得上传文件大小"></a>1.7  getSize获得上传文件大小</h3><p>getContentType:获得上传文件格式</p>
<p>delete删除临时文件</p>
<p>//相同文件名文件上传解决办法</p>
<p>UUID.randomUUID().toString().relplace(“-“,””)+fliename.substring(filename.lastIndexOf(“.”));</p>
<p>//同一文件夹文件过多解决</p>
<h3 id="文件上传代码"><a href="#文件上传代码" class="headerlink" title="文件上传代码"></a>文件上传代码</h3><p><strong>downloadServlet</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.OutputStream;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">import org.apache.commons.fileupload.FileItem;</span><br><span class="line">import org.apache.commons.fileupload.FileUploadException;</span><br><span class="line">import org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line">import org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line">import com.itheima.utils.UUIDUtils;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 上传Servlet</span><br><span class="line"> */</span><br><span class="line">public class uploadServlet extends HttpServlet &#123;</span><br><span class="line">	protected void doGet(HttpServletRequest request,</span><br><span class="line">			HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		doPost(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	protected void doPost(HttpServletRequest request,</span><br><span class="line">			HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			// request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">			// 1.创建磁盘文件项工厂</span><br><span class="line">			DiskFileItemFactory fileitemfactory = new DiskFileItemFactory();</span><br><span class="line">			// 设置文件缓冲区大小</span><br><span class="line">			fileitemfactory.setSizeThreshold(1024 * 1024 * 3);</span><br><span class="line">			// 设置临时文件路径</span><br><span class="line">			String path = getServletContext().getRealPath(&quot;/temp&quot;);</span><br><span class="line">			fileitemfactory.setRepository(new File(path));</span><br><span class="line">			// 2.创建核心解析类</span><br><span class="line">			ServletFileUpload si = new ServletFileUpload(fileitemfactory);</span><br><span class="line">			// 解决中文文件名乱码问题</span><br><span class="line">			si.setHeaderEncoding(&quot;UTF-8&quot;);</span><br><span class="line">			// 3.解析请求</span><br><span class="line">			List&lt;FileItem&gt; parseRequest = si.parseRequest(request);</span><br><span class="line">			// 4. 判断文件上传项</span><br><span class="line">            for (FileItem fileItem : parseRequest) &#123;</span><br><span class="line">                if (fileItem.isFormField()) &#123;</span><br><span class="line">                    // 基础项</span><br><span class="line">                    String name = f.getFieldName();</span><br><span class="line">                    // String content = f.getString();</span><br><span class="line">                    // 解决获取普通项内容乱码的问题</span><br><span class="line">                    String content = f.getString(&quot;UTF-8&quot;);</span><br><span class="line">                    System.out.println(name + &quot;---&quot; + content);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // 文件上传项</span><br><span class="line">                    // 获取文件名</span><br><span class="line">                    String filename = fileItem.getName();</span><br><span class="line">                    // 解决文件名重复的问题,UUID</span><br><span class="line">                   filename = UUIDUtils.getUUID(filename);</span><br><span class="line">                    // 处理ie浏览器文件名带路径的问题</span><br><span class="line">                    if (filename.lastIndexOf(&quot;\\&quot;) != -1) &#123;</span><br><span class="line">                        filename = filename.substring(filename</span><br><span class="line">                                                      .lastIndexOf(&quot;\\&quot;) + 1);</span><br><span class="line">                    &#125;</span><br><span class="line">                    // 获取文件内容</span><br><span class="line">                    InputStream is = fileItem.getInputStream();</span><br><span class="line">                    // 获取上传路径</span><br><span class="line">                    String realPath = getServletContext().getRealPath(</span><br><span class="line">                        &quot;/upload&quot;);</span><br><span class="line">                    // 创建输出流</span><br><span class="line">                    String path2 = UUIDUtils.getPath(filename);</span><br><span class="line">                    String path3 = realPath + path2;</span><br><span class="line">                    File file = new File(path3);</span><br><span class="line">                    if (!file.exists()) &#123;</span><br><span class="line">                        file.mkdirs();</span><br><span class="line">                    &#125;</span><br><span class="line">                    OutputStream os = new FileOutputStream(path3 + &quot;\\&quot;</span><br><span class="line">                                                           + filename);</span><br><span class="line">                    // 上传</span><br><span class="line">                    int len;</span><br><span class="line">                    byte[] b = new byte[1024];</span><br><span class="line">                    while ((len = is.read(b)) != -1) &#123;</span><br><span class="line">                        os.write(b, 0, len);</span><br><span class="line">                    &#125;</span><br><span class="line">                    // 关闭流</span><br><span class="line">                    is.close();</span><br><span class="line">                    os.close();</span><br><span class="line">                    // 删除临时文件</span><br><span class="line">                    fileItem.delete();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">		&#125; catch (FileUploadException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>upload.jsp</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">	pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">	function add() &#123;</span><br><span class="line">		document.getElementById(&quot;div1&quot;).innerHTML += &quot;&lt;div&gt;&lt;input type=&apos;file&apos; name=&apos;updowm&apos;&gt;&lt;input type=&apos;button&apos; value=&apos;删除&apos; onclick=&apos;del(this)&apos;&gt;&lt;/div&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	function del(who) &#123;</span><br><span class="line">		who.parentNode.parentNode.removeChild(who.parentNode);</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;上传页面&lt;/h1&gt;</span><br><span class="line">	&lt;form action=&quot;$&#123;pageContext.request.contextPath &#125;/uploadServlet&quot;</span><br><span class="line">		method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;button&quot; value=&quot;添加&quot; onclick=&quot;add()&quot;&gt;&lt;input</span><br><span class="line">			type=&quot;submit&quot; value=&quot;上传&quot;&gt;&lt;br&gt;</span><br><span class="line">		&lt;div id=&quot;div1&quot;&gt;&lt;/div&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-文件下载"><a href="#2-文件下载" class="headerlink" title="2.文件下载"></a>2.文件下载</h2><h3 id="2-1-文件下载流程"><a href="#2-1-文件下载流程" class="headerlink" title="2.1 文件下载流程"></a>2.1 文件下载流程</h3><ol>
<li><p>获取数据</p>
<p>String filename = request.getParameter(“filename”);</p>
</li>
<li><p>设置两个头和一个输入流</p>
<ol>
<li><p>设置两个头</p>
<p>设置Content-Type</p>
<p>response.setContentType(“getServletContext().getMimeType(filename)”);</p>
<p>设置Content-Disposition</p>
<p>response.setHeader(“Content-Disposition”,”attachment;filename=”+filename)</p>
</li>
<li><p>设置输入流</p>
<p>String path=getServletContext().getRealPath(“/download”);</p>
<p>InputStream is = new FileInputStream(path+”/“+filename);</p>
</li>
</ol>
</li>
<li><p>获取输出流</p>
<p>​        OutPutStream os = response.getOutputStream();</p>
</li>
</ol>
<h3 id="2-2文件下载代码"><a href="#2-2文件下载代码" class="headerlink" title="2.2文件下载代码"></a>2.2文件下载代码</h3><p><strong>downloadServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.DownloadEncodingUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件下载Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">downloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 获取数据</span></span><br><span class="line">		String filename = request.getParameter(<span class="string">"filename"</span>);</span><br><span class="line">		<span class="comment">// 解决文件名中文乱码问题</span></span><br><span class="line">		filename = <span class="keyword">new</span> String(filename.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">		<span class="comment">// 设置两个头,一个流</span></span><br><span class="line">		<span class="comment">// 设置ContentType</span></span><br><span class="line">		response.setContentType(getServletContext().getMimeType(filename));</span><br><span class="line">		<span class="comment">// 设置输入流</span></span><br><span class="line">		String realPath = getServletContext().getRealPath(<span class="string">"/download"</span>);</span><br><span class="line">		InputStream is = <span class="keyword">new</span> FileInputStream(realPath + <span class="string">"/"</span> + filename);</span><br><span class="line">		System.out.println(filename);</span><br><span class="line">		<span class="comment">// 解决不同浏览器文件名中文显示问题</span></span><br><span class="line">		String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">		<span class="keyword">if</span> (agent.contains(<span class="string">"Firefox"</span>)) &#123;</span><br><span class="line">			<span class="comment">// 火狐浏览器</span></span><br><span class="line">			filename = DownloadEncodingUtils.base64EncodeFileName(filename);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			filename = URLEncoder.encode(filename, <span class="string">"UTF-8"</span>);</span><br><span class="line">			filename = filename.replace(<span class="string">"+"</span>, <span class="string">" "</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 设置Content-Disposition</span></span><br><span class="line">		System.out.println(filename);</span><br><span class="line">		response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span></span><br><span class="line">				+ filename);</span><br><span class="line">		<span class="comment">// 获取输出流</span></span><br><span class="line">		ServletOutputStream os = response.getOutputStream();</span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">while</span> ((len = is.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">			os.write(b, <span class="number">0</span>, len);</span><br><span class="line">		&#125;</span><br><span class="line">		is.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>download.jsp</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;文件下载&lt;/h1&gt;</span><br><span class="line">	&lt;a href="$&#123;pageContext.request.contextPath &#125;/download/psb.jpg"&gt;psb.jpg&lt;/a&gt;</span><br><span class="line">	&lt;h3&gt;手动下载&lt;/h3&gt;</span><br><span class="line">	&lt;a</span><br><span class="line">		href="$&#123;pageContext.request.contextPath &#125;/downloadServlet?filename=psb.jpg"&gt;psb.jpg&lt;/a&gt;</span><br><span class="line">	&lt;br&gt;</span><br><span class="line">	&lt;a</span><br><span class="line">		href="$&#123;pageContext.request.contextPath &#125;/downloadServlet?filename=中文.jpg"&gt;中文.jpg&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-文件列表下载"><a href="#2-3-文件列表下载" class="headerlink" title="2.3 文件列表下载"></a>2.3 文件列表下载</h3><p><strong>multiDownloadServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.DownloadEncodingUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class multidownloadServlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">multidownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String path = request.getParameter(<span class="string">"path"</span>);</span><br><span class="line">		path = <span class="keyword">new</span> String(path.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">		File file = <span class="keyword">new</span> File(path);</span><br><span class="line">		String filename = file.getName();</span><br><span class="line">		<span class="comment">// 设置两个头,一个流</span></span><br><span class="line">		response.setContentType(getServletContext().getMimeType(filename));</span><br><span class="line">		InputStream is = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">		<span class="comment">// 处理中文名</span></span><br><span class="line">		String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line">		<span class="keyword">if</span> (agent.contains(<span class="string">"Firefox"</span>)) &#123;</span><br><span class="line">			filename = DownloadEncodingUtils.base64EncodeFileName(filename);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			filename = URLEncoder.encode(filename, <span class="string">"UTF-8"</span>);</span><br><span class="line">			filename = filename.replace(<span class="string">"+"</span>, <span class="string">" "</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attach;filename="</span> + filename);</span><br><span class="line">		ServletOutputStream os = response.getOutputStream();</span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">while</span> ((len = is.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">			os.write(b, <span class="number">0</span>, len);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//关闭流</span></span><br><span class="line">		is.close();</span><br><span class="line">		os.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>multiDownload.jsp</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.io.File"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">"java.util.LinkedList"</span>%&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;多文件下载&lt;/h1&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		<span class="comment">//创建队列</span></span><br><span class="line">		Queue&lt;File&gt; queue = <span class="keyword">new</span> LinkedList&lt;File&gt;();</span><br><span class="line">		<span class="comment">//创建根节点</span></span><br><span class="line">		File root = <span class="keyword">new</span> File(</span><br><span class="line">				<span class="string">"F:\\java基础增强\\javaweb_day19(文件上传和下载)\\资料\\下载资料列表"</span>);</span><br><span class="line">		<span class="comment">//根节点入队</span></span><br><span class="line">		queue.offer(root);</span><br><span class="line">		<span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">			<span class="comment">//出队</span></span><br><span class="line">			File file = queue.poll();</span><br><span class="line">			<span class="comment">//获取出队元素的所有子元素</span></span><br><span class="line">			File[] files = file.listFiles();</span><br><span class="line">			<span class="comment">//遍历子元素</span></span><br><span class="line">			<span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">				<span class="keyword">if</span> (f.isFile()) &#123;</span><br><span class="line">					<span class="comment">//为标准文件,则输出</span></span><br><span class="line">	%&gt;</span><br><span class="line">	&lt;h3&gt;</span><br><span class="line">		&lt;a</span><br><span class="line">			href="$&#123;pageContext.request.contextPath &#125;/multidownloadServlet?path=&lt;%=f.getCanonicalPath()%&gt;"&gt;&lt;%=f.getName()%&gt;&lt;/a&gt;</span><br><span class="line">	&lt;/h3&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="comment">//不是标准文件,则入队</span></span><br><span class="line">					queue.offer(f);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="日历对象-Calendar"><a href="#日历对象-Calendar" class="headerlink" title="日历对象 Calendar"></a>日历对象 Calendar</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Calendar cal = Calendar.getInstance();</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/文件上传和下载/" data-id="cjwqj8oqd0000s47kx4xz3d2h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-hello-world" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/hello-world/" class="article-date">
  <time class="post-time" datetime="2019-06-09T11:40:15.735Z" itemprop="datePublished">
    <span class="post-month">6月</span><br>
    <span class="post-day">09</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/hello-world/">Hello World</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cyannote.github.io.git/hello-world/" data-id="cjwqj8ora0001s47k3s4m8h3k" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; pre</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Hexo</h1>
    <h2 class="blog-subtitle"></h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/source/plugin/img/avatar.jpg">
    <h2 class="author">inverse</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>33</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>0</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/cyannote" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2018 - 2019 inverse<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title class="menuItem">首页</a>
          
            <a href="/tags" title class="menuItem">标签</a>
          
            <a href="/categories" title class="menuItem">分类</a>
          
            <a href="/archives" title class="menuItem">归档</a>
          
            <a href="/xxxxxxxxx" title class="menuItem">xxx</a>
          
            <a href="/xxxxxxx" title class="menuItem">xxxx</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>